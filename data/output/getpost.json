[
  {
    "number": 666,
    "name": "メモ",
    "full_name": "Users/河本/メモ",
    "wip": false,
    "body_md": "> FY20ロードマップ - Google スライド\r\nhttps://docs.google.com/presentation/d/15IfAODhWWYXvSVqDEbC_h1nzVmqQ2fu4i-ORUSI96GI/edit#slide=id.p\r\n\r\n> Develop/リファービッシュ手順メモ - qrio.esa.io\r\nhttps://qrio.esa.io/posts/649\r\n\r\n> Develop/Tips/PDFに画像を貼り付ける方法 - qrio.esa.io\r\nhttps://qrio.esa.io/posts/667\r\n\r\n> Qrio TechBook Q刊 - HackMD\r\nhttps://hackmd.io/@tottokotkd/By3JgSqv4/%2Fs%2FBy3JgSqv4?type=book\r\n\r\n> SmartLock/Tips/Q-SL1 iOS Push通知証明書更新手順 - qrio.esa.io\r\nhttps://qrio.esa.io/posts/658\r\n\r\n# SL2\r\n## sub_lockの表面的な紐づけ解除\r\n- lock_settingsのsub_lock_idを削除してあげればOK\r\n- ちなみに、再度sub_lock_idを登録し直してCUで解施錠すると2ロックの解施錠になる（CU的には鍵持ったままになってそうなので、ちゃんと解除するのであればやっぱりCUからの1ドア2ロックの解除）\r\n\r\n\r\n# APIアクセス\r\n> 面倒だけど、Applicationは作っては使い終わったら消す\r\n\r\n1.認証コードの取得(web)\r\n\r\n```\r\nGET https://AUTH0_API_DOMAIN/authorize?response_type=code&client_id={クライアントID}&redirect_uri={リダイレクト先URL}&scope=offline_access%20openid\r\n---\r\nhttps://qrio-production.auth0.com/authorize?response_type=code&client_id=NDLNNZgifTT8Sff5oKry3jtR4ril0LEm&redirect_uri=http://localhost:3000&scope=offline_access%20openid\r\n```\r\n\r\n2.アクセストークンの取得\r\n```\r\nPOST https://AUTH0_API_DOMAIN/oauth/token\r\nContent-Type: application/x-www-form-urlencoded\r\n{\r\n  grant_type: 'authorization_code',\r\n  client_id: {クライアントID},\r\n  client_secret: {シークレットキー},\r\n  code: {認証コード},\r\n  redirect_uri: {リダイレクト先URL}\r\n}\r\n---\r\nhttps://qrio-production.auth0.com/oauth/token\r\n\r\n```\r\n\r\n# CloudFunctionアプリ対応表\r\n\r\n\r\n|  | Lock  | Knight | Hub |\r\n| -------- | -------- | -------- |-------- |\r\n| CU     | ◯  | ◯ | ☓ | \r\n| kBCU     | ◯  | ◯    |▲→☓(23/7) |\r\n| rBCU     | ◯  | ◯  |◯|\r\n\r\n- CU/kBCUはHubのCloudfunctionは見ない方針で中島さんと方向性確定 （2023/07/14）\r\n\r\n# ログ調査(papertrail)\r\n- 「`lock_id` OR  `key_id`」で大体出る",
    "body_html": "<blockquote data-sourcepos=\"1:1-2:99\">\n<p data-sourcepos=\"1:3-2:99\">FY20ロードマップ - Google スライド<br>\n<a href=\"https://docs.google.com/presentation/d/15IfAODhWWYXvSVqDEbC_h1nzVmqQ2fu4i-ORUSI96GI/edit#slide=id.p\" target=\"_blank\" rel=\"noopener noreferrer\">https://docs.google.com/presentation/d/15IfAODhWWYXvSVqDEbC_h1nzVmqQ2fu4i-ORUSI96GI/edit#slide=id.p</a></p>\n</blockquote>\n<blockquote data-sourcepos=\"4:1-5:29\">\n<p data-sourcepos=\"4:3-5:29\">Develop/リファービッシュ手順メモ - qrio.esa.io<br>\n<a href=\"https://qrio.esa.io/posts/649\">https://qrio.esa.io/posts/649</a></p>\n</blockquote>\n<blockquote data-sourcepos=\"7:1-8:29\">\n<p data-sourcepos=\"7:3-8:29\">Develop/Tips/PDFに画像を貼り付ける方法 - qrio.esa.io<br>\n<a href=\"https://qrio.esa.io/posts/667\">https://qrio.esa.io/posts/667</a></p>\n</blockquote>\n<blockquote data-sourcepos=\"10:1-11:66\">\n<p data-sourcepos=\"10:3-11:66\">Qrio TechBook Q刊 - HackMD<br>\n<a href=\"https://hackmd.io/@tottokotkd/By3JgSqv4/%2Fs%2FBy3JgSqv4?type=book\" target=\"_blank\" rel=\"noopener noreferrer\">https://hackmd.io/@tottokotkd/By3JgSqv4/%2Fs%2FBy3JgSqv4?type=book</a></p>\n</blockquote>\n<blockquote data-sourcepos=\"13:1-14:29\">\n<p data-sourcepos=\"13:3-14:29\">SmartLock/Tips/Q-SL1 iOS Push通知証明書更新手順 - qrio.esa.io<br>\n<a href=\"https://qrio.esa.io/posts/658\">https://qrio.esa.io/posts/658</a></p>\n</blockquote>\n<h1 data-sourcepos=\"16:1-16:5\" id=\"1-0-0\" name=\"1-0-0\"><a class=\"anchor\" id=\"SL2\" name=\"SL2\" href=\"#SL2\" data-position=\"1-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"SL2\"> &gt; SL2</span></a>SL2</h1>\n<h2 data-sourcepos=\"17:1-17:41\" id=\"1-1-0\" name=\"1-1-0\"><a class=\"anchor\" id=\"sub_lockの表面的な紐づけ解除\" name=\"sub_lockの表面的な紐づけ解除\" href=\"#sub_lockの表面的な紐づけ解除\" data-position=\"1-1-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"sub_lockの表面的な紐づけ解除\"> &gt; sub_lockの表面的な紐づけ解除</span></a>sub_lockの表面的な紐づけ解除</h2>\n<ul data-sourcepos=\"18:1-21:0\">\n<li data-sourcepos=\"18:1-18:58\">lock_settingsのsub_lock_idを削除してあげればOK</li>\n<li data-sourcepos=\"19:1-21:0\">ちなみに、再度sub_lock_idを登録し直してCUで解施錠すると2ロックの解施錠になる（CU的には鍵持ったままになってそうなので、ちゃんと解除するのであればやっぱりCUからの1ドア2ロックの解除）</li>\n</ul>\n<h1 data-sourcepos=\"22:1-22:17\" id=\"2-0-0\" name=\"2-0-0\"><a class=\"anchor\" id=\"APIアクセス\" name=\"APIアクセス\" href=\"#APIアクセス\" data-position=\"2-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"APIアクセス\"> &gt; APIアクセス</span></a>APIアクセス</h1>\n<blockquote data-sourcepos=\"23:1-23:73\">\n<p data-sourcepos=\"23:3-23:73\">面倒だけど、Applicationは作っては使い終わったら消す</p>\n</blockquote>\n<p data-sourcepos=\"25:1-25:31\">1.認証コードの取得(web)</p>\n<div class=\"code-block\" data-sourcepos=\"27:1-31:3\"><div class=\"highlight\"><pre class=\"highlight plaintext\"><code>GET https://AUTH0_API_DOMAIN/authorize?response_type=code&amp;client_id={クライアントID}&amp;redirect_uri={リダイレクト先URL}&amp;scope=offline_access%20openid\n---\nhttps://qrio-production.auth0.com/authorize?response_type=code&amp;client_id=NDLNNZgifTT8Sff5oKry3jtR4ril0LEm&amp;redirect_uri=http://localhost:3000&amp;scope=offline_access%20openid\n</code></pre></div></div>\n<p data-sourcepos=\"33:1-33:35\">2.アクセストークンの取得</p>\n<div class=\"code-block\" data-sourcepos=\"34:1-47:3\"><div class=\"highlight\"><pre class=\"highlight plaintext\"><code>POST https://AUTH0_API_DOMAIN/oauth/token\nContent-Type: application/x-www-form-urlencoded\n{\n  grant_type: 'authorization_code',\n  client_id: {クライアントID},\n  client_secret: {シークレットキー},\n  code: {認証コード},\n  redirect_uri: {リダイレクト先URL}\n}\n---\nhttps://qrio-production.auth0.com/oauth/token\n</code></pre></div></div>\n<h1 data-sourcepos=\"49:1-49:33\" id=\"3-0-0\" name=\"3-0-0\"><a class=\"anchor\" id=\"CloudFunctionアプリ対応表\" name=\"CloudFunctionアプリ対応表\" href=\"#CloudFunctionアプリ対応表\" data-position=\"3-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"CloudFunctionアプリ対応表\"> &gt; CloudFunctionアプリ対応表</span></a>CloudFunctionアプリ対応表</h1>\n<table data-sourcepos=\"52:1-56:30\">\n<thead>\n<tr data-sourcepos=\"52:1-52:27\">\n<th data-sourcepos=\"52:2-52:3\"></th>\n<th data-sourcepos=\"52:5-52:11\">Lock</th>\n<th data-sourcepos=\"52:13-52:20\">Knight</th>\n<th data-sourcepos=\"52:22-52:26\">Hub</th>\n</tr>\n</thead>\n<tbody>\n<tr data-sourcepos=\"54:1-54:30\">\n<td data-sourcepos=\"54:2-54:9\">CU</td>\n<td data-sourcepos=\"54:11-54:16\">◯</td>\n<td data-sourcepos=\"54:18-54:22\">◯</td>\n<td data-sourcepos=\"54:24-54:28\">☓</td>\n</tr>\n<tr data-sourcepos=\"55:1-55:45\">\n<td data-sourcepos=\"55:2-55:11\">kBCU</td>\n<td data-sourcepos=\"55:13-55:18\">◯</td>\n<td data-sourcepos=\"55:20-55:27\">◯</td>\n<td data-sourcepos=\"55:29-55:44\">▲→☓(23/7)</td>\n</tr>\n<tr data-sourcepos=\"56:1-56:30\">\n<td data-sourcepos=\"56:2-56:11\">rBCU</td>\n<td data-sourcepos=\"56:13-56:18\">◯</td>\n<td data-sourcepos=\"56:20-56:25\">◯</td>\n<td data-sourcepos=\"56:27-56:29\">◯</td>\n</tr>\n</tbody>\n</table>\n<ul data-sourcepos=\"58:1-59:0\">\n<li data-sourcepos=\"58:1-59:0\">CU/kBCUはHubのCloudfunctionは見ない方針で中島さんと方向性確定 （2023/07/14）</li>\n</ul>\n<h1 data-sourcepos=\"60:1-60:26\" id=\"4-0-0\" name=\"4-0-0\"><a class=\"anchor\" id=\"ログ調査(papertrail)\" name=\"ログ調査(papertrail)\" href=\"#ログ調査(papertrail)\" data-position=\"4-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"ログ調査(papertrail)\"> &gt; ログ調査(papertrail)</span></a>ログ調査(papertrail)</h1>\n<ul data-sourcepos=\"61:1-61:45\">\n<li data-sourcepos=\"61:1-61:45\">「<code>lock_id</code> OR  <code>key_id</code>」で大体出る</li>\n</ul>\n",
    "created_at": "2020-09-01T13:40:22+09:00",
    "message": "Update post.",
    "kind": "stock",
    "comments_count": 0,
    "tasks_count": 0,
    "done_tasks_count": 0,
    "url": "https://qrio.esa.io/posts/666",
    "updated_at": "2023-07-21T15:34:32+09:00",
    "tags": [],
    "category": "Users/河本",
    "revision_number": 14,
    "created_by": {
      "myself": false,
      "name": "河本純一",
      "screen_name": "junichi_kawamoto",
      "icon": "https://img.esa.io/uploads/production/members/82850/icon/thumb_m_6b75ea0d77cd08baba44596f62123749.png"
    },
    "updated_by": {
      "myself": false,
      "name": "河本純一",
      "screen_name": "junichi_kawamoto",
      "icon": "https://img.esa.io/uploads/production/members/82850/icon/thumb_m_6b75ea0d77cd08baba44596f62123749.png"
    },
    "stargazers_count": 0,
    "watchers_count": 1,
    "star": false,
    "watch": false,
    "sharing_urls": null
  },
  {
    "number": 1695,
    "name": "KingDB監視 CloudWatchとPerformance Insightsでのメトリクスの比較",
    "full_name": "Users/杉山/Database/KingDB監視 CloudWatchとPerformance Insightsでのメトリクスの比較",
    "wip": true,
    "body_md": "# King-api AuroraDB\r\n\r\n## 記事内容\r\n\r\nどのようなメトリクスがあってどのような内容を監視できるかの調査だったが、終わり切らなかった。\r\n\r\n## 監視対象メトリクスそれぞれの意義を調べる\r\n\r\n### CloudWatch\r\n\r\ndashboardをstaging/productionにそれぞれ建てている。\r\n(2023/07/18現在、staging環境も93〜のアカウントにいます)\r\n\r\n|項目|値の詳細|導き出せること|\r\n| --- | --- | --- |\r\n| [クラスター]容量 | 使用容量 | 請求の増減 |\r\n| Deadlocks | デッドロックの単位時間あたりの回数 | トランザクションの見直し |\r\n| インスタンス別CPUUtilization | CPU使用率 | プランが適切かどうか |\r\n| DB接続数 |  DB接続数 | プランごとの上限(5,000)に近いと接続数不足やセッションが閉じられないエラーなどが起こる |\r\n| 空きメモリ | インスタンスごとのメモリの空き容量 |プランが適切かどうか、[張り付いていた場合]異常な動作をしていないかどうか |\r\n| ローカルストレージ | DBエンジンが動いているリソースのローカルストレージ空き容量 | プランが適切かどうか、[張り付いていた場合]異常な動作をしていないかどうか |\r\n\r\n###  performance insights\r\n\r\nperformance insightsダッシュボードでは、インスタンスごとに確認できる。(統合した閲覧環境ではない)\r\n主にDBの負荷について確認できる。\r\n\r\n- データベース負荷\r\n    - 平均アクティブセッション(AAS)として算出しており、最大CPUと比較してどれだけCPUに負荷がかかっているかを確認できる\r\n- ディメンション\r\n    - 時間のかかっているクエリを見ることができる\r\n- メトリクス\r\n    - CloudWatchと重複した項目もあるが、詳細なメトリクスが取得できる\r\n\r\n|項目|値の詳細|導き出せること|CloudWatchとの違い|\r\n| --- | --- | --- | --- |\r\n| CPU使用率 | 使用容量(増えると危険) |  | steal,guest,irq,wait,user,system,niceごとに見られる |\r\n| 空きメモリ(減りすぎると危険) |  インスタンスリソースの空きメモリ | プランが適切かどうか ||\r\n| IO レイテンシー | データの読み書きの遅延時間 | プランが適切かどうか(上げる方向),料金にも影響 |  |\r\n| IO オペレーション | 秒間の読み書き処理数 | プランが適切かどうか(上げる方向),料金にも影響 |  |\r\n| IO スループット | 秒間の読み書き処理サイズ | プランが適切かどうか(上げる方向),料金にも影響 |  |\r\n| IO ディスクキューの深さ | 処理待ちのキュー,ストレージのパフォーマンスに影響され増えると危険,一般的には数百まで | プランが適切かどうか(上げる方向) |  |\r\n| バキューム: 使用されている最大のトランザクションID | 20億に到達していないか(現在1 億程度) | AutovacuumがトランザクションIDが周回してしまう前に稼働しているかどうか,Autovacuum Thresholdやscalefactorのチューニング |  |\r\n| トランザクションの最大アイドル時間 | トランザクションが待機となった秒数 |  |  |\r\n| ネットワークスループット | 送受信のバイト数 | プランが適切かどうか(上げる方向),料金にも影響 |  |\r\n| 接続の使用率 | 率と書いてあるが接続数(増えすぎると危険) | プランが適切かどうか |  |\r\n| セッション | セッション数 |  |  |\r\n| クエリ | 1秒あたりのクエリ実行数 | プランが適切かどうか(上げる方向) |  |\r\n| タプル: DML | 1秒あたりのDML(INSERT/UPDATE/DELETE)行数 |  |  |\r\n| タプル: 読み取り | 1秒あたりの読み取り行数(SELECT) |  |  |\r\n| トランザクション | 1秒あたりのトランザクション数 |  |  |\r\n| 進行中のトランザクション | 1秒あたりの継続しているトランザクション | サーバーのクエリチューニング？ |  |\r\n| IO キャッシュとディスク読み取り | ブロック/秒 |  |  |\r\n| デッドロック | 1分あたりのデッドロック数(増えると危険) | トランザクションの見直し |  |\r\n\r\n\r\n### その他考慮事項\r\n\r\n値の増減の見定めにはベースラインが必要か？\r\n\r\n→稼働期間が累積してきたので平均値から大きく外れないか確認できる\r\nが、CloudWatchでないと7日以前のメトリクスは確認できない\r\n(Performance Insightsは現状の設定が無料枠である7日としている)",
    "body_html": "<h1 data-sourcepos=\"1:1-1:19\" id=\"1-0-0\" name=\"1-0-0\"><a class=\"anchor\" id=\"King-api AuroraDB\" name=\"King-api AuroraDB\" href=\"#King-api AuroraDB\" data-position=\"1-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"King-api AuroraDB\"> &gt; King-api AuroraDB</span></a>King-api AuroraDB</h1>\n<h2 data-sourcepos=\"3:1-3:15\" id=\"1-1-0\" name=\"1-1-0\"><a class=\"anchor\" id=\"記事内容\" name=\"記事内容\" href=\"#記事内容\" data-position=\"1-1-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"記事内容\"> &gt; 記事内容</span></a>記事内容</h2>\n<p data-sourcepos=\"5:1-5:138\">どのようなメトリクスがあってどのような内容を監視できるかの調査だったが、終わり切らなかった。</p>\n<h2 data-sourcepos=\"7:1-7:63\" id=\"1-2-0\" name=\"1-2-0\"><a class=\"anchor\" id=\"監視対象メトリクスそれぞれの意義を調べる\" name=\"監視対象メトリクスそれぞれの意義を調べる\" href=\"#監視対象メトリクスそれぞれの意義を調べる\" data-position=\"1-2-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"監視対象メトリクスそれぞれの意義を調べる\"> &gt; 監視対象メトリクスそれぞれの意義を調べる</span></a>監視対象メトリクスそれぞれの意義を調べる</h2>\n<h3 data-sourcepos=\"9:1-9:14\" id=\"1-2-1\" name=\"1-2-1\"><a class=\"anchor\" id=\"CloudWatch\" name=\"CloudWatch\" href=\"#CloudWatch\" data-position=\"1-2-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"CloudWatch\"> &gt; CloudWatch</span></a>CloudWatch</h3>\n<p data-sourcepos=\"11:1-12:72\">dashboardをstaging/productionにそれぞれ建てている。<br>\n(2023/07/18現在、staging環境も93〜のアカウントにいます)</p>\n<table data-sourcepos=\"14:1-21:230\">\n<thead>\n<tr data-sourcepos=\"14:1-14:43\">\n<th data-sourcepos=\"14:2-14:7\">項目</th>\n<th data-sourcepos=\"14:9-14:20\">値の詳細</th>\n<th data-sourcepos=\"14:22-14:42\">導き出せること</th>\n</tr>\n</thead>\n<tbody>\n<tr data-sourcepos=\"16:1-16:60\">\n<td data-sourcepos=\"16:2-16:26\">[クラスター]容量</td>\n<td data-sourcepos=\"16:28-16:41\">使用容量</td>\n<td data-sourcepos=\"16:43-16:59\">請求の増減</td>\n</tr>\n<tr data-sourcepos=\"17:1-17:106\">\n<td data-sourcepos=\"17:2-17:12\">Deadlocks</td>\n<td data-sourcepos=\"17:14-17:66\">デッドロックの単位時間あたりの回数</td>\n<td data-sourcepos=\"17:68-17:105\">トランザクションの見直し</td>\n</tr>\n<tr data-sourcepos=\"18:1-18:87\">\n<td data-sourcepos=\"18:2-18:38\">インスタンス別CPUUtilization</td>\n<td data-sourcepos=\"18:40-18:53\">CPU使用率</td>\n<td data-sourcepos=\"18:55-18:86\">プランが適切かどうか</td>\n</tr>\n<tr data-sourcepos=\"19:1-19:157\">\n<td data-sourcepos=\"19:2-19:14\">DB接続数</td>\n<td data-sourcepos=\"19:16-19:29\">DB接続数</td>\n<td data-sourcepos=\"19:31-19:156\">プランごとの上限(5,000)に近いと接続数不足やセッションが閉じられないエラーなどが起こる</td>\n</tr>\n<tr data-sourcepos=\"20:1-20:182\">\n<td data-sourcepos=\"20:2-20:18\">空きメモリ</td>\n<td data-sourcepos=\"20:20-20:72\">インスタンスごとのメモリの空き容量</td>\n<td data-sourcepos=\"20:74-20:181\">プランが適切かどうか、[張り付いていた場合]異常な動作をしていないかどうか</td>\n</tr>\n<tr data-sourcepos=\"21:1-21:230\">\n<td data-sourcepos=\"21:2-21:30\">ローカルストレージ</td>\n<td data-sourcepos=\"21:32-21:119\">DBエンジンが動いているリソースのローカルストレージ空き容量</td>\n<td data-sourcepos=\"21:121-21:229\">プランが適切かどうか、[張り付いていた場合]異常な動作をしていないかどうか</td>\n</tr>\n</tbody>\n</table>\n<h3 data-sourcepos=\"23:1-23:25\" id=\"1-2-2\" name=\"1-2-2\"><a class=\"anchor\" id=\"performance insights\" name=\"performance insights\" href=\"#performance insights\" data-position=\"1-2-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"performance insights\"> &gt; performance insights</span></a>performance insights</h3>\n<p data-sourcepos=\"25:1-26:47\">performance insightsダッシュボードでは、インスタンスごとに確認できる。(統合した閲覧環境ではない)<br>\n主にDBの負荷について確認できる。</p>\n<ul data-sourcepos=\"28:1-34:0\">\n<li data-sourcepos=\"28:1-29:167\">データベース負荷\n<ul data-sourcepos=\"29:5-29:167\">\n<li data-sourcepos=\"29:5-29:167\">平均アクティブセッション(AAS)として算出しており、最大CPUと比較してどれだけCPUに負荷がかかっているかを確認できる</li>\n</ul></li>\n<li data-sourcepos=\"30:1-31:69\">ディメンション\n<ul data-sourcepos=\"31:5-31:69\">\n<li data-sourcepos=\"31:5-31:69\">時間のかかっているクエリを見ることができる</li>\n</ul></li>\n<li data-sourcepos=\"32:1-34:0\">メトリクス\n<ul data-sourcepos=\"33:5-34:0\">\n<li data-sourcepos=\"33:5-34:0\">CloudWatchと重複した項目もあるが、詳細なメトリクスが取得できる</li>\n</ul></li>\n</ul>\n<table data-sourcepos=\"35:1-54:124\">\n<thead>\n<tr data-sourcepos=\"35:1-35:66\">\n<th data-sourcepos=\"35:2-35:7\">項目</th>\n<th data-sourcepos=\"35:9-35:20\">値の詳細</th>\n<th data-sourcepos=\"35:22-35:42\">導き出せること</th>\n<th data-sourcepos=\"35:44-35:65\">CloudWatchとの違い</th>\n</tr>\n</thead>\n<tbody>\n<tr data-sourcepos=\"37:1-37:115\">\n<td data-sourcepos=\"37:2-37:15\">CPU使用率</td>\n<td data-sourcepos=\"37:17-37:50\">使用容量(増えると危険)</td>\n<td data-sourcepos=\"37:52-37:53\"></td>\n<td data-sourcepos=\"37:55-37:114\">steal,guest,irq,wait,user,system,niceごとに見られる</td>\n</tr>\n<tr data-sourcepos=\"38:1-38:131\">\n<td data-sourcepos=\"38:2-38:44\">空きメモリ(減りすぎると危険)</td>\n<td data-sourcepos=\"38:46-38:96\">インスタンスリソースの空きメモリ</td>\n<td data-sourcepos=\"38:98-38:129\">プランが適切かどうか</td>\n<td data-sourcepos=\"38:131-38:130\"></td>\n</tr>\n<tr data-sourcepos=\"39:1-39:139\">\n<td data-sourcepos=\"39:2-39:24\">IO レイテンシー</td>\n<td data-sourcepos=\"39:26-39:66\">データの読み書きの遅延時間</td>\n<td data-sourcepos=\"39:68-39:135\">プランが適切かどうか(上げる方向),料金にも影響</td>\n<td data-sourcepos=\"39:137-39:138\"></td>\n</tr>\n<tr data-sourcepos=\"40:1-40:133\">\n<td data-sourcepos=\"40:2-40:27\">IO オペレーション</td>\n<td data-sourcepos=\"40:29-40:60\">秒間の読み書き処理数</td>\n<td data-sourcepos=\"40:62-40:129\">プランが適切かどうか(上げる方向),料金にも影響</td>\n<td data-sourcepos=\"40:131-40:132\"></td>\n</tr>\n<tr data-sourcepos=\"41:1-41:136\">\n<td data-sourcepos=\"41:2-41:24\">IO スループット</td>\n<td data-sourcepos=\"41:26-41:63\">秒間の読み書き処理サイズ</td>\n<td data-sourcepos=\"41:65-41:132\">プランが適切かどうか(上げる方向),料金にも影響</td>\n<td data-sourcepos=\"41:134-41:135\"></td>\n</tr>\n<tr data-sourcepos=\"42:1-42:218\">\n<td data-sourcepos=\"42:2-42:36\">IO ディスクキューの深さ</td>\n<td data-sourcepos=\"42:38-42:164\">処理待ちのキュー,ストレージのパフォーマンスに影響され増えると危険,一般的には数百まで</td>\n<td data-sourcepos=\"42:166-42:214\">プランが適切かどうか(上げる方向)</td>\n<td data-sourcepos=\"42:216-42:217\"></td>\n</tr>\n<tr data-sourcepos=\"43:1-43:292\">\n<td data-sourcepos=\"43:2-43:76\">バキューム: 使用されている最大のトランザクションID</td>\n<td data-sourcepos=\"43:78-43:130\">20億に到達していないか(現在1 億程度)</td>\n<td data-sourcepos=\"43:132-43:288\">AutovacuumがトランザクションIDが周回してしまう前に稼働しているかどうか,Autovacuum Thresholdやscalefactorのチューニング</td>\n<td data-sourcepos=\"43:290-43:291\"></td>\n</tr>\n<tr data-sourcepos=\"44:1-44:115\">\n<td data-sourcepos=\"44:2-44:54\">トランザクションの最大アイドル時間</td>\n<td data-sourcepos=\"44:56-44:108\">トランザクションが待機となった秒数</td>\n<td data-sourcepos=\"44:110-44:111\"></td>\n<td data-sourcepos=\"44:113-44:114\"></td>\n</tr>\n<tr data-sourcepos=\"45:1-45:139\">\n<td data-sourcepos=\"45:2-45:39\">ネットワークスループット</td>\n<td data-sourcepos=\"45:41-45:66\">送受信のバイト数</td>\n<td data-sourcepos=\"45:68-45:135\">プランが適切かどうか(上げる方向),料金にも影響</td>\n<td data-sourcepos=\"45:137-45:138\"></td>\n</tr>\n<tr data-sourcepos=\"46:1-46:120\">\n<td data-sourcepos=\"46:2-46:21\">接続の使用率</td>\n<td data-sourcepos=\"46:23-46:83\">率と書いてあるが接続数(増えすぎると危険)</td>\n<td data-sourcepos=\"46:85-46:116\">プランが適切かどうか</td>\n<td data-sourcepos=\"46:118-46:119\"></td>\n</tr>\n<tr data-sourcepos=\"47:1-47:46\">\n<td data-sourcepos=\"47:2-47:18\">セッション</td>\n<td data-sourcepos=\"47:20-47:39\">セッション数</td>\n<td data-sourcepos=\"47:41-47:42\"></td>\n<td data-sourcepos=\"47:44-47:45\"></td>\n</tr>\n<tr data-sourcepos=\"48:1-48:103\">\n<td data-sourcepos=\"48:2-48:12\">クエリ</td>\n<td data-sourcepos=\"48:14-48:49\">1秒あたりのクエリ実行数</td>\n<td data-sourcepos=\"48:51-48:99\">プランが適切かどうか(上げる方向)</td>\n<td data-sourcepos=\"48:101-48:102\"></td>\n</tr>\n<tr data-sourcepos=\"49:1-49:74\">\n<td data-sourcepos=\"49:2-49:17\">タプル: DML</td>\n<td data-sourcepos=\"49:19-49:67\">1秒あたりのDML(INSERT/UPDATE/DELETE)行数</td>\n<td data-sourcepos=\"49:69-49:70\"></td>\n<td data-sourcepos=\"49:72-49:73\"></td>\n</tr>\n<tr data-sourcepos=\"50:1-50:78\">\n<td data-sourcepos=\"50:2-50:26\">タプル: 読み取り</td>\n<td data-sourcepos=\"50:28-50:71\">1秒あたりの読み取り行数(SELECT)</td>\n<td data-sourcepos=\"50:73-50:74\"></td>\n<td data-sourcepos=\"50:76-50:77\"></td>\n</tr>\n<tr data-sourcepos=\"51:1-51:80\">\n<td data-sourcepos=\"51:2-51:27\">トランザクション</td>\n<td data-sourcepos=\"51:29-51:73\">1秒あたりのトランザクション数</td>\n<td data-sourcepos=\"51:75-51:76\"></td>\n<td data-sourcepos=\"51:78-51:79\"></td>\n</tr>\n<tr data-sourcepos=\"52:1-52:152\">\n<td data-sourcepos=\"52:2-52:39\">進行中のトランザクション</td>\n<td data-sourcepos=\"52:41-52:100\">1秒あたりの継続しているトランザクション</td>\n<td data-sourcepos=\"52:102-52:148\">サーバーのクエリチューニング？</td>\n<td data-sourcepos=\"52:150-52:151\"></td>\n</tr>\n<tr data-sourcepos=\"53:1-53:74\">\n<td data-sourcepos=\"53:2-53:48\">IO キャッシュとディスク読み取り</td>\n<td data-sourcepos=\"53:50-53:67\">ブロック/秒</td>\n<td data-sourcepos=\"53:69-53:70\"></td>\n<td data-sourcepos=\"53:72-53:73\"></td>\n</tr>\n<tr data-sourcepos=\"54:1-54:124\">\n<td data-sourcepos=\"54:2-54:21\">デッドロック</td>\n<td data-sourcepos=\"54:23-54:81\">1分あたりのデッドロック数(増えると危険)</td>\n<td data-sourcepos=\"54:83-54:120\">トランザクションの見直し</td>\n<td data-sourcepos=\"54:122-54:123\"></td>\n</tr>\n</tbody>\n</table>\n<h3 data-sourcepos=\"57:1-57:25\" id=\"1-2-3\" name=\"1-2-3\"><a class=\"anchor\" id=\"その他考慮事項\" name=\"その他考慮事項\" href=\"#その他考慮事項\" data-position=\"1-2-3\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"その他考慮事項\"> &gt; その他考慮事項</span></a>その他考慮事項</h3>\n<p data-sourcepos=\"59:1-59:63\">値の増減の見定めにはベースラインが必要か？</p>\n<p data-sourcepos=\"61:1-63:80\">→稼働期間が累積してきたので平均値から大きく外れないか確認できる<br>\nが、CloudWatchでないと7日以前のメトリクスは確認できない<br>\n(Performance Insightsは現状の設定が無料枠である7日としている)</p>\n",
    "created_at": "2023-06-13T14:52:08+09:00",
    "message": "Update post.",
    "kind": "stock",
    "comments_count": 2,
    "tasks_count": 0,
    "done_tasks_count": 0,
    "url": "https://qrio.esa.io/posts/1695",
    "updated_at": "2023-07-20T11:28:12+09:00",
    "tags": [],
    "category": "Users/杉山/Database",
    "revision_number": 27,
    "created_by": {
      "myself": false,
      "name": "杉山聡",
      "screen_name": "satoshi_sugiyama",
      "icon": "https://img.esa.io/uploads/production/members/129432/icon/thumb_m_4589e2842b9d87757c7c9db07c45c00d.jpg"
    },
    "updated_by": {
      "myself": false,
      "name": "杉山聡",
      "screen_name": "satoshi_sugiyama",
      "icon": "https://img.esa.io/uploads/production/members/129432/icon/thumb_m_4589e2842b9d87757c7c9db07c45c00d.jpg"
    },
    "stargazers_count": 0,
    "watchers_count": 1,
    "star": false,
    "watch": false,
    "sharing_urls": null
  },
  {
    "number": 1713,
    "name": "[Cognito] API Reference",
    "full_name": "PS/Platform/コーヒー牛乳プロジェクト/[Cognito] API Reference",
    "wip": true,
    "body_md": "**WIP: SUBJECT FOR CHANGES**\r\n**作業中: 変更の可能性があります．**\r\n\r\n# OpenAPI\r\n[_v2_app_users_仮.pdf (1.5 MB)](https://esa-storage-tokyo.s3-ap-northeast-1.amazonaws.com/uploads/production/attachments/4178/2023/07/11/144372/e1a47951-4db3-4a09-bb35-1ca4af98da82.pdf)\r\n\r\n\r\n# general rules\r\n## Error\r\n```json\r\n{\r\n    \"errors\": [\r\n            {\r\n                \"code\": \"integer\",\r\n                \"message\": \"string\"\r\n            },\r\n    ]\r\n}\r\n```\r\n- `code`: 以下の通り\r\n    - 1: 認証失敗．通常は入力された視覚情報が誤っている場合に発生します．\r\n    - 2: 認証失敗．ユーザーのステータスにより認証を進められないことを示します．通常，新規登録された E メールアドレスの認証が未完了である場合に発生します．\r\n    - 9: バリデーションエラー．新規登録時に，入力された E メールアドレスがすでに User Pools に登録されていることを示します．\r\n    - 22: バリデーションエラー．パスワードとして受け取った文字列が，条件を満たさない場合に発生します．\r\n    - 23: バリデーションエラー．その他のエラーの際に発生します．詳細は各エンドポイントの仕様を確認してください．\r\n- `message`: エラーの詳細が含まれます．入力値や秘匿値を含むため，基本的に **ユーザーには表示しないでください**．\r\n\r\n# endpoints\r\n## POST `/v2/app/users`\r\n- **新規にユーザーを作成する．**\r\n### Query Parameters\r\n- `name`:`String` ユーザーの名前を表します．任意の文字列です．King の DB に保存されます．\r\n- `email`:`String` ユーザーのEメールアドレス．**RFC 5321, 5322 に適合する文字列である**ことが必要です．Cognito のユーザプールに登録されます．\r\n- `password`:`String` ユーザーのパスワード．パスワードは **アルファベット大文字と小文字，` ^ $ * . [ ] { } ( ) ? - \" ! @ # % & / \\ , > < ' : ; | _ ~ ` + =` のいずれか，を一つ以上含む 8 字以上の半角英数記号列**です．Cognito のユーザプールに登録されます．\r\n### Response\r\n```json\r\n{\r\n    \"cognito_id\": \"string\"\r\n}\r\n```\r\n- `cognito_id` Cognito に登録されたユーザーの UUID を表します．\r\n\r\n## POST `/v2/app/users/verify`\r\n- Cognito から送信された E メールアドレスの確認が完了した場合に呼び出します．**このタイミングで King の `Users` レコードに登録されます**．\r\n\r\n### Query Parameters\r\n- `email`:`string` Cognito に登録したユーザーの E メールアドレスです． Cognito に登録された **RFC 5321/5322 に適合する文字列である**ことが必要です．\r\n- `password`:`String` Cognito に登録したパスワード．パスワードは **アルファベット大文字と小文字， ^ $ * . [ ] { } ( ) ? - \" ! @ # % & / \\ , > < ' : ; | _ ~ ` + = のいずれか，を一つ以上含む 8 字以上の半角英数記号列**です．\r\n\r\n### Response\r\n```json\r\n{\r\n    \"id_token\": \"string\",\r\n    \"refresh_token\": \"string\"\r\n}\r\n```\r\n\r\n## POST `/v2/app/users/sign_in`\r\n- Eメールアドレスとパスワードを使って ID トークンを取得します．このエンドポイントは，**ユーザーが Auth0 または Cognito のいずれに登録されている場合でも有効**です．E メールアドレスに紐づくユーザーが Auth0 にのみ登録されている場合は，**自動的に Cognito へ移行**されます．\r\n\r\n### Query Parameters\r\n- `email`:`String`: ユーザーのEメールアドレス．Auth0 または Cognito に登録された **RFC 5321/5322 に適合する文字列である**ことが必要です．\r\n- `password`:`String` Cognito または Auth0 に登録したパスワード．パスワードは **アルファベット大文字と小文字， ^ $ * . [ ] { } ( ) ? - \" ! @ # % & / \\ , > < ' : ; | _ ~ ` + = のいずれか，を一つ以上含む 8 字以上の半角英数記号列**です．\r\n\r\n### Response\r\n```json\r\n{\r\n    \"id_token\": \"string\",\r\n    \"refresh_token\": \"string\"\r\n}\r\n```\r\n- `id_token`:`String` Cognito へのアクセスに使う ID Token です．ユーザーが Auth0 のみに登録されている場合，API は自動的に Cognito への移行処理を行います．従って，ID Token は**常に Cognito より発行**されています．\r\n- `refresh_token`: `String` Token の更新時に必要な Refresh Token です．ユーザーが Auth0 のみに登録されている場合，API は自動的に Cognito への移行処理を行います．従って，Refresh Token は**常に Cognito より発行**されています．\r\n\r\n## POST `/v2/app/users/refresh`\r\n- Refresh Token による ID トークンの更新を行います．\r\n\r\n### Query Parameters\r\n- `id_token`:`String` 直前に使用したID Token. 発行者が **Cognito か Auth0 かは問いません**．\r\n- `refresh_token`:`String` 事前に割り当てられた Refresh Token. 処理時点で有効なトークンである必要があります．発行者は ID Token と同じである必要があります．\r\n\r\n### Response\r\n```json\r\n{\r\n    \"id_token\": \"string\",\r\n    \"refresh_token\": \"string\"\r\n}\r\n```\r\n- `id_token` Cognito の Id Token です． ユーザーが Auth0 のみに登録されている場合，API は自動的に Cognito への移行処理を行います．従って，**ID Token は常に Cognito より発行**されています．",
    "body_html": "<p data-sourcepos=\"1:1-2:51\"><strong>WIP: SUBJECT FOR CHANGES</strong><br>\n<strong>作業中: 変更の可能性があります．</strong></p>\n<h1 data-sourcepos=\"4:1-4:9\" id=\"1-0-0\" name=\"1-0-0\"><a class=\"anchor\" id=\"OpenAPI\" name=\"OpenAPI\" href=\"#OpenAPI\" data-position=\"1-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"OpenAPI\"> &gt; OpenAPI</span></a>OpenAPI</h1>\n<p data-sourcepos=\"5:1-5:186\"><a href=\"https://esa-storage-tokyo.s3-ap-northeast-1.amazonaws.com/uploads/production/attachments/4178/2023/07/11/144372/e1a47951-4db3-4a09-bb35-1ca4af98da82.pdf\" target=\"_blank\" rel=\"noopener noreferrer\">_v2_app_users_仮.pdf (1.5 MB)</a></p>\n<h1 data-sourcepos=\"8:1-8:15\" id=\"2-0-0\" name=\"2-0-0\"><a class=\"anchor\" id=\"general rules\" name=\"general rules\" href=\"#general rules\" data-position=\"2-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"general rules\"> &gt; general rules</span></a>general rules</h1>\n<h2 data-sourcepos=\"9:1-9:8\" id=\"2-1-0\" name=\"2-1-0\"><a class=\"anchor\" id=\"Error\" name=\"Error\" href=\"#Error\" data-position=\"2-1-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"Error\"> &gt; Error</span></a>Error</h2>\n<div class=\"code-block\" data-sourcepos=\"10:1-19:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>json</div><div class=\"highlight\"><pre class=\"highlight json\"><code><span class=\"p\">{</span><span class=\"w\">\n    </span><span class=\"nl\">\"errors\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\">\n            </span><span class=\"p\">{</span><span class=\"w\">\n                </span><span class=\"nl\">\"code\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"integer\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"nl\">\"message\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"string\"</span><span class=\"w\">\n            </span><span class=\"p\">},</span><span class=\"w\">\n    </span><span class=\"p\">]</span><span class=\"w\">\n</span><span class=\"p\">}</span><span class=\"w\">\n</span></code></pre></div></div>\n<ul data-sourcepos=\"20:1-27:0\">\n<li data-sourcepos=\"20:1-25:163\"><code>code</code>: 以下の通り\n<ul data-sourcepos=\"21:5-25:163\">\n<li data-sourcepos=\"21:5-21:105\">1: 認証失敗．通常は入力された視覚情報が誤っている場合に発生します．</li>\n<li data-sourcepos=\"22:5-22:225\">2: 認証失敗．ユーザーのステータスにより認証を進められないことを示します．通常，新規登録された E メールアドレスの認証が未完了である場合に発生します．</li>\n<li data-sourcepos=\"23:5-23:174\">9: バリデーションエラー．新規登録時に，入力された E メールアドレスがすでに User Pools に登録されていることを示します．</li>\n<li data-sourcepos=\"24:5-24:148\">22: バリデーションエラー．パスワードとして受け取った文字列が，条件を満たさない場合に発生します．</li>\n<li data-sourcepos=\"25:5-25:163\">23: バリデーションエラー．その他のエラーの際に発生します．詳細は各エンドポイントの仕様を確認してください．</li>\n</ul></li>\n<li data-sourcepos=\"26:1-27:0\"><code>message</code>: エラーの詳細が含まれます．入力値や秘匿値を含むため，基本的に <strong>ユーザーには表示しないでください</strong>．</li>\n</ul>\n<h1 data-sourcepos=\"28:1-28:11\" id=\"3-0-0\" name=\"3-0-0\"><a class=\"anchor\" id=\"endpoints\" name=\"endpoints\" href=\"#endpoints\" data-position=\"3-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"endpoints\"> &gt; endpoints</span></a>endpoints</h1>\n<h2 data-sourcepos=\"29:1-29:23\" id=\"3-1-0\" name=\"3-1-0\"><a class=\"anchor\" id=\"POST /v2/app/users\" name=\"POST /v2/app/users\" href=\"#POST /v2/app/users\" data-position=\"3-1-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"POST /v2/app/users\"> &gt; POST /v2/app/users</span></a>POST <code>/v2/app/users</code></h2>\n<ul data-sourcepos=\"30:1-30:45\">\n<li data-sourcepos=\"30:1-30:45\"><strong>新規にユーザーを作成する．</strong></li>\n</ul>\n<h3 data-sourcepos=\"31:1-31:20\" id=\"3-1-1\" name=\"3-1-1\"><a class=\"anchor\" id=\"Query Parameters\" name=\"Query Parameters\" href=\"#Query Parameters\" data-position=\"3-1-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"Query Parameters\"> &gt; Query Parameters</span></a>Query Parameters</h3>\n<ul data-sourcepos=\"32:1-34:327\">\n<li data-sourcepos=\"32:1-32:120\"><code>name</code>:<code>String</code> ユーザーの名前を表します．任意の文字列です．King の DB に保存されます．</li>\n<li data-sourcepos=\"33:1-33:188\"><code>email</code>:<code>String</code> ユーザーのEメールアドレス．<strong>RFC 5321, 5322 に適合する文字列である</strong>ことが必要です．Cognito のユーザプールに登録されます．</li>\n<li data-sourcepos=\"34:1-34:327\"><code>password</code>:<code>String</code> ユーザーのパスワード．パスワードは <strong>アルファベット大文字と小文字，<code>^ $ * . [ ] { } ( ) ? - \" ! @ # % &amp; / \\ , &gt; &lt; ' : ; | _ ~</code> + =` のいずれか，を一つ以上含む 8 字以上の半角英数記号列</strong>です．Cognito のユーザプールに登録されます．</li>\n</ul>\n<h3 data-sourcepos=\"35:1-35:12\" id=\"3-1-2\" name=\"3-1-2\"><a class=\"anchor\" id=\"Response\" name=\"Response\" href=\"#Response\" data-position=\"3-1-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"Response\"> &gt; Response</span></a>Response</h3>\n<div class=\"code-block\" data-sourcepos=\"36:1-40:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>json</div><div class=\"highlight\"><pre class=\"highlight json\"><code><span class=\"p\">{</span><span class=\"w\">\n    </span><span class=\"nl\">\"cognito_id\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"string\"</span><span class=\"w\">\n</span><span class=\"p\">}</span><span class=\"w\">\n</span></code></pre></div></div>\n<ul data-sourcepos=\"41:1-42:0\">\n<li data-sourcepos=\"41:1-42:0\"><code>cognito_id</code> Cognito に登録されたユーザーの UUID を表します．</li>\n</ul>\n<h2 data-sourcepos=\"43:1-43:30\" id=\"3-2-0\" name=\"3-2-0\"><a class=\"anchor\" id=\"POST /v2/app/users/verify\" name=\"POST /v2/app/users/verify\" href=\"#POST /v2/app/users/verify\" data-position=\"3-2-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"POST /v2/app/users/verify\"> &gt; POST /v2/app/users/verify</span></a>POST <code>/v2/app/users/verify</code></h2>\n<ul data-sourcepos=\"44:1-45:0\">\n<li data-sourcepos=\"44:1-45:0\">Cognito から送信された E メールアドレスの確認が完了した場合に呼び出します．<strong>このタイミングで King の <code>Users</code> レコードに登録されます</strong>．</li>\n</ul>\n<h3 data-sourcepos=\"46:1-46:20\" id=\"3-2-1\" name=\"3-2-1\"><a class=\"anchor\" id=\"Query Parameters-1\" name=\"Query Parameters-1\" href=\"#Query Parameters-1\" data-position=\"3-2-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"Query Parameters\"> &gt; Query Parameters</span></a>Query Parameters</h3>\n<ul data-sourcepos=\"47:1-49:0\">\n<li data-sourcepos=\"47:1-47:193\"><code>email</code>:<code>string</code> Cognito に登録したユーザーの E メールアドレスです． Cognito に登録された <strong>RFC 5321/5322 に適合する文字列である</strong>ことが必要です．</li>\n<li data-sourcepos=\"48:1-49:0\"><code>password</code>:<code>String</code> Cognito に登録したパスワード．パスワードは <strong>アルファベット大文字と小文字， ^ $ * . [ ] { } ( ) ? - \" ! @ # % &amp; / \\ , &gt; &lt; ' : ; | _ ~ ` + = のいずれか，を一つ以上含む 8 字以上の半角英数記号列</strong>です．</li>\n</ul>\n<h3 data-sourcepos=\"50:1-50:12\" id=\"3-2-2\" name=\"3-2-2\"><a class=\"anchor\" id=\"Response-1\" name=\"Response-1\" href=\"#Response-1\" data-position=\"3-2-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"Response\"> &gt; Response</span></a>Response</h3>\n<div class=\"code-block\" data-sourcepos=\"51:1-56:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>json</div><div class=\"highlight\"><pre class=\"highlight json\"><code><span class=\"p\">{</span><span class=\"w\">\n    </span><span class=\"nl\">\"id_token\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"string\"</span><span class=\"p\">,</span><span class=\"w\">\n    </span><span class=\"nl\">\"refresh_token\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"string\"</span><span class=\"w\">\n</span><span class=\"p\">}</span><span class=\"w\">\n</span></code></pre></div></div>\n<h2 data-sourcepos=\"58:1-58:31\" id=\"3-3-0\" name=\"3-3-0\"><a class=\"anchor\" id=\"POST /v2/app/users/sign_in\" name=\"POST /v2/app/users/sign_in\" href=\"#POST /v2/app/users/sign_in\" data-position=\"3-3-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"POST /v2/app/users/sign_in\"> &gt; POST /v2/app/users/sign_in</span></a>POST <code>/v2/app/users/sign_in</code></h2>\n<ul data-sourcepos=\"59:1-60:0\">\n<li data-sourcepos=\"59:1-60:0\">Eメールアドレスとパスワードを使って ID トークンを取得します．このエンドポイントは，<strong>ユーザーが Auth0 または Cognito のいずれに登録されている場合でも有効</strong>です．E メールアドレスに紐づくユーザーが Auth0 にのみ登録されている場合は，<strong>自動的に Cognito へ移行</strong>されます．</li>\n</ul>\n<h3 data-sourcepos=\"61:1-61:20\" id=\"3-3-1\" name=\"3-3-1\"><a class=\"anchor\" id=\"Query Parameters-2\" name=\"Query Parameters-2\" href=\"#Query Parameters-2\" data-position=\"3-3-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"Query Parameters\"> &gt; Query Parameters</span></a>Query Parameters</h3>\n<ul data-sourcepos=\"62:1-64:0\">\n<li data-sourcepos=\"62:1-62:178\"><code>email</code>:<code>String</code>: ユーザーのEメールアドレス．Auth0 または Cognito に登録された <strong>RFC 5321/5322 に適合する文字列である</strong>ことが必要です．</li>\n<li data-sourcepos=\"63:1-64:0\"><code>password</code>:<code>String</code> Cognito または Auth0 に登録したパスワード．パスワードは <strong>アルファベット大文字と小文字， ^ $ * . [ ] { } ( ) ? - \" ! @ # % &amp; / \\ , &gt; &lt; ' : ; | _ ~ ` + = のいずれか，を一つ以上含む 8 字以上の半角英数記号列</strong>です．</li>\n</ul>\n<h3 data-sourcepos=\"65:1-65:12\" id=\"3-3-2\" name=\"3-3-2\"><a class=\"anchor\" id=\"Response-2\" name=\"Response-2\" href=\"#Response-2\" data-position=\"3-3-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"Response\"> &gt; Response</span></a>Response</h3>\n<div class=\"code-block\" data-sourcepos=\"66:1-71:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>json</div><div class=\"highlight\"><pre class=\"highlight json\"><code><span class=\"p\">{</span><span class=\"w\">\n    </span><span class=\"nl\">\"id_token\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"string\"</span><span class=\"p\">,</span><span class=\"w\">\n    </span><span class=\"nl\">\"refresh_token\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"string\"</span><span class=\"w\">\n</span><span class=\"p\">}</span><span class=\"w\">\n</span></code></pre></div></div>\n<ul data-sourcepos=\"72:1-74:0\">\n<li data-sourcepos=\"72:1-72:277\"><code>id_token</code>:<code>String</code> Cognito へのアクセスに使う ID Token です．ユーザーが Auth0 のみに登録されている場合，API は自動的に Cognito への移行処理を行います．従って，ID Token は<strong>常に Cognito より発行</strong>されています．</li>\n<li data-sourcepos=\"73:1-74:0\"><code>refresh_token</code>: <code>String</code> Token の更新時に必要な Refresh Token です．ユーザーが Auth0 のみに登録されている場合，API は自動的に Cognito への移行処理を行います．従って，Refresh Token は<strong>常に Cognito より発行</strong>されています．</li>\n</ul>\n<h2 data-sourcepos=\"75:1-75:31\" id=\"3-4-0\" name=\"3-4-0\"><a class=\"anchor\" id=\"POST /v2/app/users/refresh\" name=\"POST /v2/app/users/refresh\" href=\"#POST /v2/app/users/refresh\" data-position=\"3-4-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"POST /v2/app/users/refresh\"> &gt; POST /v2/app/users/refresh</span></a>POST <code>/v2/app/users/refresh</code></h2>\n<ul data-sourcepos=\"76:1-77:0\">\n<li data-sourcepos=\"76:1-77:0\">Refresh Token による ID トークンの更新を行います．</li>\n</ul>\n<h3 data-sourcepos=\"78:1-78:20\" id=\"3-4-1\" name=\"3-4-1\"><a class=\"anchor\" id=\"Query Parameters-3\" name=\"Query Parameters-3\" href=\"#Query Parameters-3\" data-position=\"3-4-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"Query Parameters\"> &gt; Query Parameters</span></a>Query Parameters</h3>\n<ul data-sourcepos=\"79:1-81:0\">\n<li data-sourcepos=\"79:1-79:112\"><code>id_token</code>:<code>String</code> 直前に使用したID Token. 発行者が <strong>Cognito か Auth0 かは問いません</strong>．</li>\n<li data-sourcepos=\"80:1-81:0\"><code>refresh_token</code>:<code>String</code> 事前に割り当てられた Refresh Token. 処理時点で有効なトークンである必要があります．発行者は ID Token と同じである必要があります．</li>\n</ul>\n<h3 data-sourcepos=\"82:1-82:12\" id=\"3-4-2\" name=\"3-4-2\"><a class=\"anchor\" id=\"Response-3\" name=\"Response-3\" href=\"#Response-3\" data-position=\"3-4-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"Response\"> &gt; Response</span></a>Response</h3>\n<div class=\"code-block\" data-sourcepos=\"83:1-88:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>json</div><div class=\"highlight\"><pre class=\"highlight json\"><code><span class=\"p\">{</span><span class=\"w\">\n    </span><span class=\"nl\">\"id_token\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"string\"</span><span class=\"p\">,</span><span class=\"w\">\n    </span><span class=\"nl\">\"refresh_token\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"string\"</span><span class=\"w\">\n</span><span class=\"p\">}</span><span class=\"w\">\n</span></code></pre></div></div>\n<ul data-sourcepos=\"89:1-89:245\">\n<li data-sourcepos=\"89:1-89:245\"><code>id_token</code> Cognito の Id Token です． ユーザーが Auth0 のみに登録されている場合，API は自動的に Cognito への移行処理を行います．従って，<strong>ID Token は常に Cognito より発行</strong>されています．</li>\n</ul>\n",
    "created_at": "2023-07-11T13:37:36+09:00",
    "message": "Update post.",
    "kind": "stock",
    "comments_count": 2,
    "tasks_count": 0,
    "done_tasks_count": 0,
    "url": "https://qrio.esa.io/posts/1713",
    "updated_at": "2023-07-19T17:27:31+09:00",
    "tags": [],
    "category": "PS/Platform/コーヒー牛乳プロジェクト",
    "revision_number": 9,
    "created_by": {
      "myself": false,
      "name": "茨木心",
      "screen_name": "kokoro_ibaragi",
      "icon": "https://img.esa.io/uploads/production/users/144372/icon/thumb_m_3b5cdf31d8dab398260d14288a73dcc7.jpg"
    },
    "updated_by": {
      "myself": false,
      "name": "茨木心",
      "screen_name": "kokoro_ibaragi",
      "icon": "https://img.esa.io/uploads/production/users/144372/icon/thumb_m_3b5cdf31d8dab398260d14288a73dcc7.jpg"
    },
    "stargazers_count": 0,
    "watchers_count": 1,
    "star": false,
    "watch": false,
    "sharing_urls": null
  },
  {
    "number": 1538,
    "name": "サーバー負荷試験ツール案(DB移行前後での比較)",
    "full_name": "Users/杉山/Database/サーバー負荷試験ツール案(DB移行前後での比較)",
    "wip": true,
    "body_md": "# 負荷試験\r\n\r\n## 要件\r\n\r\n- sl2-api-db-migration-testのエンドポイントに100リクエスト投げてレスポンスタイムの計測→平均の導出\r\n- 導入工数の少ない手軽なものが良い\r\n- DBにCRUDが起きるAPIが良いか\r\n    - GET u/hash\r\n    - GET u/logs\r\n    - PATCH u/me\r\n上記3APIに対してそれぞれリクエストを出し、レスポンスタイムなどの計測を行う\r\n## エンドポイント\r\n\r\n`https://sl2-api-db-migration-test.herokuapp.com/`\r\n\r\n## 候補ツール\r\n\r\n||JMeter|Taurus|K6|Locust|Hedgehog|AWS DistributedLoadTesting|\r\n| --- | --- | --- | --- | --- | --- | --- |\r\n| 料金 | 無料 | 無料 | 無料版あり | 無料 | 有料 | 有料 |\r\n| UI | GUI/CLI | CLI+Reporter | CLI | GUI/CLI |  | GUI |\r\n| 記述 | JMX/GUI | YAML | Javascript | Python |  | JMX/GUI |\r\n| Docker Image |  | あり | あり | あり |  |  |\r\n| 特徴 | 古くからあるのでドキュメントが多そう | インストール3分+Java VM、YAMLの記述がシンプル | 無料版は制限あり | 簡単そう |  | 前職で利用 結構料金がかかる |\r\n| 公式HP | [JMeter](https://jmeter.apache.org/) | [Taurus](https://gettaurus.org/) | [K6](https://k6.io/docs/) | [Locust](https://docs.locust.io/en/stable/index.html) | [Hedgehog](https://pr.hedgehog-loader.io/) | [AWS Distributed Load Testing](https://aws.amazon.com/jp/solutions/implementations/distributed-load-testing-on-aws/) |\r\n\r\n## 杉山案\r\n\r\nYAMLを使えることからTaurusが導入コスト面で優れていると思います\r\n\r\n## Taurus参考記事\r\n\r\nhttps://engineer.retty.me/entry/2022/12/09/123459\r\n\r\n## Dockerでの作業\r\n\r\n再現性が高い状態を確保したい\r\n一旦プライベートリポジトリで組んで必要になったらQrioのリポジトリに回す\r\n\r\n## repo\r\n\r\nemail/pass/lock_idの入力が求められる。\r\nstaging環境のAuth0を参照しtokenを取得する\r\n上記に伴い、stagingで削除したユーザーは(db-migration-testのDBに残っていたとしても)利用不可能\r\n\r\nhttps://github.com/qrioinc/taurus-docker-test\r\n\r\n## 設定\r\n### concurrency\r\n- Virturl User\r\n    - 200に指定\r\n\r\n### throughput\r\n- rps=request per second\r\n    - 300に指定\r\n\r\n### ramp-up\r\n- concurrencyに到達するまでの増加時間\r\n    - 10sに指定\r\n\r\n### hold-for\r\n- 継続計測時間\r\n    - 60sに指定\r\n\r\n## 実行結果\r\n\r\n### heroku\r\n\r\n- avg. response time: 5.21s\r\n<img width=\"1920\" alt=\"スクリーンショット 2023-03-01 12.03.33.png (176.5 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/03/01/136273/27177eea-c4e8-4ab0-b8a7-2241c8622bbe.png\">\r\n\r\n### aws\r\n- avg. response time: 5.88s\r\n<img width=\"1920\" alt=\"スクリーンショット 2023-03-01 16.17.27.png (185.1 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/03/01/136273/afaa5a25-d39b-4dc9-8fd3-af803407ce41.png\">\r\n\r\n\r\n### avg差\r\n0.67s\r\nほぼ誤差の範囲であると判断できる\r\n",
    "body_html": "<h1 data-sourcepos=\"1:1-1:14\" id=\"1-0-0\" name=\"1-0-0\"><a class=\"anchor\" id=\"負荷試験\" name=\"負荷試験\" href=\"#負荷試験\" data-position=\"1-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"負荷試験\"> &gt; 負荷試験</span></a>負荷試験</h1>\n<h2 data-sourcepos=\"3:1-3:9\" id=\"1-1-0\" name=\"1-1-0\"><a class=\"anchor\" id=\"要件\" name=\"要件\" href=\"#要件\" data-position=\"1-1-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"要件\"> &gt; 要件</span></a>要件</h2>\n<ul data-sourcepos=\"5:1-11:109\">\n<li data-sourcepos=\"5:1-5:132\">sl2-api-db-migration-testのエンドポイントに100リクエスト投げてレスポンスタイムの計測→平均の導出</li>\n<li data-sourcepos=\"6:1-6:50\">導入工数の少ない手軽なものが良い</li>\n<li data-sourcepos=\"7:1-11:109\">DBにCRUDが起きるAPIが良いか\n<ul data-sourcepos=\"8:5-11:109\">\n<li data-sourcepos=\"8:5-8:16\">GET u/hash</li>\n<li data-sourcepos=\"9:5-9:16\">GET u/logs</li>\n<li data-sourcepos=\"10:5-11:109\">PATCH u/me<br>\n上記3APIに対してそれぞれリクエストを出し、レスポンスタイムなどの計測を行う</li>\n</ul></li>\n</ul>\n<h2 data-sourcepos=\"12:1-12:24\" id=\"1-2-0\" name=\"1-2-0\"><a class=\"anchor\" id=\"エンドポイント\" name=\"エンドポイント\" href=\"#エンドポイント\" data-position=\"1-2-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"エンドポイント\"> &gt; エンドポイント</span></a>エンドポイント</h2>\n<p data-sourcepos=\"14:1-14:50\"><code>https://sl2-api-db-migration-test.herokuapp.com/</code></p>\n<h2 data-sourcepos=\"16:1-16:18\" id=\"1-3-0\" name=\"1-3-0\"><a class=\"anchor\" id=\"候補ツール\" name=\"候補ツール\" href=\"#候補ツール\" data-position=\"1-3-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"候補ツール\"> &gt; 候補ツール</span></a>候補ツール</h2>\n<table data-sourcepos=\"18:1-25:334\">\n<thead>\n<tr data-sourcepos=\"18:1-18:62\">\n<th data-sourcepos=\"18:2-18:1\"></th>\n<th data-sourcepos=\"18:3-18:8\">JMeter</th>\n<th data-sourcepos=\"18:10-18:15\">Taurus</th>\n<th data-sourcepos=\"18:17-18:18\">K6</th>\n<th data-sourcepos=\"18:20-18:25\">Locust</th>\n<th data-sourcepos=\"18:27-18:34\">Hedgehog</th>\n<th data-sourcepos=\"18:36-18:61\">AWS DistributedLoadTesting</th>\n</tr>\n</thead>\n<tbody>\n<tr data-sourcepos=\"20:1-20:73\">\n<td data-sourcepos=\"20:2-20:9\">料金</td>\n<td data-sourcepos=\"20:11-20:18\">無料</td>\n<td data-sourcepos=\"20:20-20:27\">無料</td>\n<td data-sourcepos=\"20:29-20:45\">無料版あり</td>\n<td data-sourcepos=\"20:47-20:54\">無料</td>\n<td data-sourcepos=\"20:56-20:63\">有料</td>\n<td data-sourcepos=\"20:65-20:72\">有料</td>\n</tr>\n<tr data-sourcepos=\"21:1-21:56\">\n<td data-sourcepos=\"21:2-21:5\">UI</td>\n<td data-sourcepos=\"21:7-21:15\">GUI/CLI</td>\n<td data-sourcepos=\"21:17-21:30\">CLI+Reporter</td>\n<td data-sourcepos=\"21:32-21:36\">CLI</td>\n<td data-sourcepos=\"21:38-21:46\">GUI/CLI</td>\n<td data-sourcepos=\"21:48-21:49\"></td>\n<td data-sourcepos=\"21:51-21:55\">GUI</td>\n</tr>\n<tr data-sourcepos=\"22:1-22:62\">\n<td data-sourcepos=\"22:2-22:9\">記述</td>\n<td data-sourcepos=\"22:11-22:19\">JMX/GUI</td>\n<td data-sourcepos=\"22:21-22:26\">YAML</td>\n<td data-sourcepos=\"22:28-22:39\">Javascript</td>\n<td data-sourcepos=\"22:41-22:48\">Python</td>\n<td data-sourcepos=\"22:50-22:51\"></td>\n<td data-sourcepos=\"22:53-22:61\">JMX/GUI</td>\n</tr>\n<tr data-sourcepos=\"23:1-23:52\">\n<td data-sourcepos=\"23:2-23:15\">Docker Image</td>\n<td data-sourcepos=\"23:17-23:18\"></td>\n<td data-sourcepos=\"23:20-23:27\">あり</td>\n<td data-sourcepos=\"23:29-23:36\">あり</td>\n<td data-sourcepos=\"23:38-23:45\">あり</td>\n<td data-sourcepos=\"23:47-23:48\"></td>\n<td data-sourcepos=\"23:50-23:51\"></td>\n</tr>\n<tr data-sourcepos=\"24:1-24:219\">\n<td data-sourcepos=\"24:2-24:9\">特徴</td>\n<td data-sourcepos=\"24:11-24:66\">古くからあるのでドキュメントが多そう</td>\n<td data-sourcepos=\"24:68-24:130\">インストール3分+Java VM、YAMLの記述がシンプル</td>\n<td data-sourcepos=\"24:132-24:157\">無料版は制限あり</td>\n<td data-sourcepos=\"24:159-24:172\">簡単そう</td>\n<td data-sourcepos=\"24:174-24:175\"></td>\n<td data-sourcepos=\"24:177-24:218\">前職で利用 結構料金がかかる</td>\n</tr>\n<tr data-sourcepos=\"25:1-25:334\">\n<td data-sourcepos=\"25:2-25:11\">公式HP</td>\n<td data-sourcepos=\"25:13-25:50\"><a href=\"https://jmeter.apache.org/\" target=\"_blank\" rel=\"noopener noreferrer\">JMeter</a></td>\n<td data-sourcepos=\"25:52-25:85\"><a href=\"https://gettaurus.org/\" target=\"_blank\" rel=\"noopener noreferrer\">Taurus</a></td>\n<td data-sourcepos=\"25:87-25:113\"><a href=\"https://k6.io/docs/\" target=\"_blank\" rel=\"noopener noreferrer\">K6</a></td>\n<td data-sourcepos=\"25:115-25:169\"><a href=\"https://docs.locust.io/en/stable/index.html\" target=\"_blank\" rel=\"noopener noreferrer\">Locust</a></td>\n<td data-sourcepos=\"25:171-25:214\"><a href=\"https://pr.hedgehog-loader.io/\" target=\"_blank\" rel=\"noopener noreferrer\">Hedgehog</a></td>\n<td data-sourcepos=\"25:216-25:333\"><a href=\"https://aws.amazon.com/jp/solutions/implementations/distributed-load-testing-on-aws/\" target=\"_blank\" rel=\"noopener noreferrer\">AWS Distributed Load Testing</a></td>\n</tr>\n</tbody>\n</table>\n<h2 data-sourcepos=\"27:1-27:12\" id=\"1-4-0\" name=\"1-4-0\"><a class=\"anchor\" id=\"杉山案\" name=\"杉山案\" href=\"#杉山案\" data-position=\"1-4-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"杉山案\"> &gt; 杉山案</span></a>杉山案</h2>\n<p data-sourcepos=\"29:1-29:88\">YAMLを使えることからTaurusが導入コスト面で優れていると思います</p>\n<h2 data-sourcepos=\"31:1-31:21\" id=\"1-5-0\" name=\"1-5-0\"><a class=\"anchor\" id=\"Taurus参考記事\" name=\"Taurus参考記事\" href=\"#Taurus参考記事\" data-position=\"1-5-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"Taurus参考記事\"> &gt; Taurus参考記事</span></a>Taurus参考記事</h2>\n<p data-sourcepos=\"33:1-33:49\"><a href=\"https://engineer.retty.me/entry/2022/12/09/123459\" target=\"_blank\" rel=\"noopener noreferrer\">https://engineer.retty.me/entry/2022/12/09/123459</a></p>\n<h2 data-sourcepos=\"35:1-35:21\" id=\"1-6-0\" name=\"1-6-0\"><a class=\"anchor\" id=\"Dockerでの作業\" name=\"Dockerでの作業\" href=\"#Dockerでの作業\" data-position=\"1-6-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"Dockerでの作業\"> &gt; Dockerでの作業</span></a>Dockerでの作業</h2>\n<p data-sourcepos=\"37:1-38:103\">再現性が高い状態を確保したい<br>\n一旦プライベートリポジトリで組んで必要になったらQrioのリポジトリに回す</p>\n<h2 data-sourcepos=\"40:1-40:7\" id=\"1-7-0\" name=\"1-7-0\"><a class=\"anchor\" id=\"repo\" name=\"repo\" href=\"#repo\" data-position=\"1-7-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"repo\"> &gt; repo</span></a>repo</h2>\n<p data-sourcepos=\"42:1-44:124\">email/pass/lock_idの入力が求められる。<br>\nstaging環境のAuth0を参照しtokenを取得する<br>\n上記に伴い、stagingで削除したユーザーは(db-migration-testのDBに残っていたとしても)利用不可能</p>\n<p data-sourcepos=\"46:1-46:45\"><a href=\"https://github.com/qrioinc/taurus-docker-test\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/qrioinc/taurus-docker-test</a></p>\n<h2 data-sourcepos=\"48:1-48:9\" id=\"1-8-0\" name=\"1-8-0\"><a class=\"anchor\" id=\"設定\" name=\"設定\" href=\"#設定\" data-position=\"1-8-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"設定\"> &gt; 設定</span></a>設定</h2>\n<h3 data-sourcepos=\"49:1-49:15\" id=\"1-8-1\" name=\"1-8-1\"><a class=\"anchor\" id=\"concurrency\" name=\"concurrency\" href=\"#concurrency\" data-position=\"1-8-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"concurrency\"> &gt; concurrency</span></a>concurrency</h3>\n<ul data-sourcepos=\"50:1-52:0\">\n<li data-sourcepos=\"50:1-52:0\">Virturl User\n<ul data-sourcepos=\"51:5-52:0\">\n<li data-sourcepos=\"51:5-52:0\">200に指定</li>\n</ul></li>\n</ul>\n<h3 data-sourcepos=\"53:1-53:14\" id=\"1-8-2\" name=\"1-8-2\"><a class=\"anchor\" id=\"throughput\" name=\"throughput\" href=\"#throughput\" data-position=\"1-8-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"throughput\"> &gt; throughput</span></a>throughput</h3>\n<ul data-sourcepos=\"54:1-56:0\">\n<li data-sourcepos=\"54:1-56:0\">rps=request per second\n<ul data-sourcepos=\"55:5-56:0\">\n<li data-sourcepos=\"55:5-56:0\">300に指定</li>\n</ul></li>\n</ul>\n<h3 data-sourcepos=\"57:1-57:11\" id=\"1-8-3\" name=\"1-8-3\"><a class=\"anchor\" id=\"ramp-up\" name=\"ramp-up\" href=\"#ramp-up\" data-position=\"1-8-3\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"ramp-up\"> &gt; ramp-up</span></a>ramp-up</h3>\n<ul data-sourcepos=\"58:1-60:0\">\n<li data-sourcepos=\"58:1-60:0\">concurrencyに到達するまでの増加時間\n<ul data-sourcepos=\"59:5-60:0\">\n<li data-sourcepos=\"59:5-60:0\">10sに指定</li>\n</ul></li>\n</ul>\n<h3 data-sourcepos=\"61:1-61:12\" id=\"1-8-4\" name=\"1-8-4\"><a class=\"anchor\" id=\"hold-for\" name=\"hold-for\" href=\"#hold-for\" data-position=\"1-8-4\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"hold-for\"> &gt; hold-for</span></a>hold-for</h3>\n<ul data-sourcepos=\"62:1-64:0\">\n<li data-sourcepos=\"62:1-64:0\">継続計測時間\n<ul data-sourcepos=\"63:5-64:0\">\n<li data-sourcepos=\"63:5-64:0\">60sに指定</li>\n</ul></li>\n</ul>\n<h2 data-sourcepos=\"65:1-65:15\" id=\"1-9-0\" name=\"1-9-0\"><a class=\"anchor\" id=\"実行結果\" name=\"実行結果\" href=\"#実行結果\" data-position=\"1-9-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"実行結果\"> &gt; 実行結果</span></a>実行結果</h2>\n<h3 data-sourcepos=\"67:1-67:10\" id=\"1-9-1\" name=\"1-9-1\"><a class=\"anchor\" id=\"heroku\" name=\"heroku\" href=\"#heroku\" data-position=\"1-9-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"heroku\"> &gt; heroku</span></a>heroku</h3>\n<ul data-sourcepos=\"69:1-69:27\">\n<li data-sourcepos=\"69:1-69:27\">avg. response time: 5.21s</li>\n</ul>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/03/01/136273/27177eea-c4e8-4ab0-b8a7-2241c8622bbe.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"1920\" alt=\"スクリーンショット 2023-03-01 12.03.33.png (176.5 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/03/01/136273/27177eea-c4e8-4ab0-b8a7-2241c8622bbe.png\"></a>\n<h3 data-sourcepos=\"72:1-72:7\" id=\"1-9-2\" name=\"1-9-2\"><a class=\"anchor\" id=\"aws\" name=\"aws\" href=\"#aws\" data-position=\"1-9-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"aws\"> &gt; aws</span></a>aws</h3>\n<ul data-sourcepos=\"73:1-73:27\">\n<li data-sourcepos=\"73:1-73:27\">avg. response time: 5.88s</li>\n</ul>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/03/01/136273/afaa5a25-d39b-4dc9-8fd3-af803407ce41.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"1920\" alt=\"スクリーンショット 2023-03-01 16.17.27.png (185.1 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/03/01/136273/afaa5a25-d39b-4dc9-8fd3-af803407ce41.png\"></a>\n<h3 data-sourcepos=\"77:1-77:10\" id=\"1-9-3\" name=\"1-9-3\"><a class=\"anchor\" id=\"avg差\" name=\"avg差\" href=\"#avg差\" data-position=\"1-9-3\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"avg差\"> &gt; avg差</span></a>avg差</h3>\n<p data-sourcepos=\"78:1-79:48\">0.67s<br>\nほぼ誤差の範囲であると判断できる</p>\n",
    "created_at": "2023-02-27T11:26:03+09:00",
    "message": "Update post.",
    "kind": "stock",
    "comments_count": 3,
    "tasks_count": 0,
    "done_tasks_count": 0,
    "url": "https://qrio.esa.io/posts/1538",
    "updated_at": "2023-07-19T15:18:36+09:00",
    "tags": [],
    "category": "Users/杉山/Database",
    "revision_number": 23,
    "created_by": {
      "myself": false,
      "name": "杉山聡",
      "screen_name": "satoshi_sugiyama",
      "icon": "https://img.esa.io/uploads/production/members/129432/icon/thumb_m_4589e2842b9d87757c7c9db07c45c00d.jpg"
    },
    "updated_by": {
      "myself": false,
      "name": "杉山聡",
      "screen_name": "satoshi_sugiyama",
      "icon": "https://img.esa.io/uploads/production/members/129432/icon/thumb_m_4589e2842b9d87757c7c9db07c45c00d.jpg"
    },
    "stargazers_count": 0,
    "watchers_count": 3,
    "star": false,
    "watch": false,
    "sharing_urls": null
  },
  {
    "number": 1633,
    "name": "sl2-api-production-DB移行後監視(1週間)",
    "full_name": "Users/杉山/Database/sl2-api-production-DB移行後監視(1週間)",
    "wip": false,
    "body_md": "# 概要\r\n\r\nking-apiのDatabaseをHerokuからAWS RDS Auroraに移行したのでその後の様子を監視する履歴\r\nまた、今後の運用に備えて項目/挙動の知見を溜め込む場としても活用予定\r\n\r\n## 項目\r\n\r\n<details>\r\n\r\n### New Relic\r\n  - summary→web transaction time(postgres)\r\n      - Heroku Dynoから見たPostgresのロード時間\r\n### Heroku Dyno Metrics\r\n- [sl2-api-production metrics](https://dashboard.heroku.com/apps/sl2-api-production/metrics/web?ending=0-hours-ago&starting=72-hours-ago)dynoのレスポンスタイム\r\n- MAXを除き99TH PERC.までを取得(特殊な例を除いた全体的な値を取りたい)\r\n### AWS CloudWatch\r\n[Dashboard](https://ap-northeast-1.console.aws.amazon.com/cloudwatch/home?region=ap-northeast-1#dashboards:name=king-api-production-aurora) DB単体の稼働状況\r\n- CPUUtilization\r\n    - AuroraインスタンスごとのCPUの使用率\r\n        - ある程度のスパイクは許容しつつも80%を超えた状態が継続したら注意か？\r\n- ReadLatency\r\n    - Auroraインスタンスの読み込み遅延時間\r\n        - 急上昇したら注意\r\n- WriteLatency\r\n    - Auroraインスタンスの書き込み遅延時間\r\n        - 急上昇したら注意\r\n- DatabaseConnections\r\n    - データベース接続数:許容値は5,000\r\n        - 急上昇したら注意\r\n- FreeableMemory\r\n    - メモリ空き容量\r\n        - 急降下した状態が継続したら注意\r\n\r\n</details>\r\n\r\n## 4/20(thu)\r\n\r\n### New Relic\r\n\r\n#### summary→web transaction time(postgres)\r\n3日分\r\n10:28時点\r\nピークは27.011ms(ユーザー利用ピーク時間帯)\r\n<img width=\"692\" alt=\"スクリーンショット 2023-04-20 10.28.08.png (64.3 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/20/136273/874a4bd0-e3d3-4d59-bf01-61d332c50a09.png\">\r\n\r\n### Heroku Dyno Metrics\r\n3日分\r\n10:30時点\r\nピークは383ms(ユーザー利用ピーク時間帯)\r\n<img width=\"1323\" alt=\"スクリーンショット 2023-04-20 10.33.08.png (162.0 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/20/136273/f340a96c-5116-43b5-aead-ea917529045d.png\">\r\n\r\n### AWS CloudWatch\r\n#### CPUUtilization\r\n稼働開始後(4/19 AM5:00 JST)\r\n〜4/20 AM10:30 JST\r\n<img width=\"691\" alt=\"スクリーンショット 2023-04-20 10.39.11.png (39.8 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/20/136273/f5f06145-5a84-421b-a818-dd974d303613.png\">\r\n\r\n4/19 13:15JST頃\r\nReplicaインスタンス(リーダー)でCPU使用率が**53.1%**→100%まで張り付いているわけではない\r\n<img width=\"694\" alt=\"スクリーンショット 2023-04-20 10.38.03.png (55.0 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/20/136273/6309897b-1fe6-4c45-9afa-204fed5ab349.png\">\r\n\r\n#### ReadLatency\r\n稼働開始後(4/19 AM5:00 JST)\r\n〜4/20 AM10:30 JST\r\n<img width=\"694\" alt=\"スクリーンショット 2023-04-20 10.49.12.png (38.4 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/20/136273/357fb3da-1b93-4ffb-93e3-6d23d0691a2b.png\">\r\n\r\n4/19 13:20JST頃\r\nReplicaインスタンス(リーダー)でReadLatencyが2.9msec→CPU同様、楢原さんに提出するクエリだろうか\r\n<img width=\"693\" alt=\"スクリーンショット 2023-04-20 10.49.54.png (55.1 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/20/136273/f03b150b-6acf-4c83-b85a-1a42f276f3a5.png\">\r\n\r\n#### WriteLatency\r\n稼働開始後(4/19 AM5:00 JST)\r\n〜4/20 AM10:30 JST\r\n<img width=\"691\" alt=\"スクリーンショット 2023-04-20 10.51.54.png (39.7 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/20/136273/6a5a4e97-5fe3-4379-8b3d-2987ccee6da7.png\">\r\n\r\n夜中にピークが訪れている→なぜ？\r\n<img width=\"693\" alt=\"スクリーンショット 2023-04-20 10.52.57.png (61.9 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/20/136273/a4f4549c-547b-46fb-96ad-daf9e06764e7.png\">\r\n\r\n#### DatabaseConnections\r\n稼働開始後(4/19 AM5:00 JST)\r\n〜4/20 AM10:30 JST\r\n<img width=\"693\" alt=\"スクリーンショット 2023-04-20 10.54.06.png (40.3 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/20/136273/55691784-4ce5-4ea2-8595-a8fd8eac88a4.png\">\r\n\r\nWriteLatency同様夜中にピーク値1,862が訪れている\r\n<img width=\"695\" alt=\"スクリーンショット 2023-04-20 10.54.56.png (56.3 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/20/136273/d0b31bee-5337-409b-82f7-7e44140bc2de.png\">\r\n\r\n#### FreeableMemory\r\n稼働開始後(4/19 AM5:00 JST)\r\n〜4/20 AM10:30 JST\r\n<img width=\"693\" alt=\"スクリーンショット 2023-04-20 10.55.52.png (43.1 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/20/136273/0870d04b-8775-46b2-8daa-0d30cb3f8978.png\">\r\n\r\nReadLatencyと同時刻にReplicaで40MB程度降下し少し持ち直した\r\n<img width=\"693\" alt=\"スクリーンショット 2023-04-20 10.56.59.png (56.9 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/20/136273/1ba921b2-d9c9-4bea-b6f4-3551f173f3eb.png\">\r\n\r\nWriteLatencyやDatabaseConnectionsが上昇した時刻にPrimaryで1.5GB程度降下し、少し持ち直した\r\n<img width=\"693\" alt=\"スクリーンショット 2023-04-20 10.58.14.png (53.6 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/20/136273/1a5da4ed-072b-4723-af7a-f25f9c04b4ef.png\">\r\n\r\n\r\n\r\n\r\n\r\n## 4/21(fri)\r\n\r\n### New Relic\r\n#### summary→web transaction time(postgres)\r\n3日分\r\n10:32時点\r\nピークは34.661ms(昨日の午後3:30〜4:00頃JST)\r\n<img width=\"690\" alt=\"スクリーンショット 2023-04-21 10.33.42.png (68.0 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/21/136273/487560dc-30c6-4b2c-b190-3af091d5e946.png\">\r\n\r\n### Heroku Dyno Metrics\r\n3日分\r\n10:32時点\r\nピークは415ms(4/20 18:00〜19:00 JST)利用ピーク時間帯\r\n<img width=\"1324\" alt=\"スクリーンショット 2023-04-21 10.37.05.png (55.4 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/21/136273/9f0402d6-2f46-4931-8328-e395ac589fc9.png\">\r\n\r\n### AWS CloudWatch\r\n#### CPUUtilization\r\n4/20 AM10:30 JST\r\n〜4/21 AM10:30 JST\r\n<img width=\"892\" alt=\"スクリーンショット 2023-04-21 10.45.16.png (45.3 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/21/136273/b9ddaa03-f614-4970-998f-b4dee3579980.png\">\r\n\r\nReplicaでのピークが2度ある\r\n4/20 4:20UTC(13:20 JST) 53.53%\r\n<img width=\"892\" alt=\"スクリーンショット 2023-04-21 10.48.04.png (63.6 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/21/136273/9d9a8902-ef9e-46bd-9ac5-4567d56cd14f.png\">\r\n4/20 23:55UTC(4/21 8:55 JST) 92.5%\r\n<img width=\"891\" alt=\"スクリーンショット 2023-04-21 10.48.19.png (61.6 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/21/136273/8a203928-f624-4509-8240-6569a7156986.png\">\r\n\r\n#### ReadLatency\r\n4/20 AM10:30 JST\r\n〜4/21 AM10:30 JST\r\n<img width=\"892\" alt=\"スクリーンショット 2023-04-21 10.51.34.png (44.5 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/21/136273/ef7cbf6a-fc30-4d7f-be44-9beae25f237c.png\">\r\n<img width=\"892\" alt=\"スクリーンショット 2023-04-21 10.52.59.png (66.7 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/21/136273/a2e5e7aa-f1d8-4f56-a709-63e9707d434a.png\">\r\n<img width=\"891\" alt=\"スクリーンショット 2023-04-21 10.53.18.png (62.3 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/21/136273/425b9e0d-55c0-442c-8064-87fda7ff9651.png\">\r\n\r\n\r\n#### WriteLatency\r\n<img width=\"891\" alt=\"スクリーンショット 2023-04-21 10.55.27.png (45.9 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/21/136273/d2fe90ce-0421-45cf-a3e3-42792f848044.png\">\r\n<img width=\"889\" alt=\"スクリーンショット 2023-04-21 10.56.09.png (62.5 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/21/136273/1f08e73b-d8b8-46b7-b6b9-ccddf370a8fe.png\">\r\n\r\n#### DatabaseConnections\r\n<img width=\"892\" alt=\"スクリーンショット 2023-04-21 10.57.58.png (49.0 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/21/136273/d1e4b50c-60db-4876-a628-c88e99743da4.png\">\r\n<img width=\"892\" alt=\"スクリーンショット 2023-04-21 10.58.24.png (61.7 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/21/136273/0957517c-b991-49fe-b90e-6c511995fc47.png\">\r\n\r\n#### FreeableMemory\r\n\r\n<img width=\"892\" alt=\"スクリーンショット 2023-04-21 10.59.15.png (51.4 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/21/136273/63349207-1104-4a6c-9d83-c59e71aab77f.png\">\r\n<img width=\"892\" alt=\"スクリーンショット 2023-04-21 10.59.32.png (66.1 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/21/136273/b47ee8d7-3396-4f02-8be1-03b67f4402c7.png\">\r\n\r\n\r\n## 4/22(sat)\r\n\r\n### New Relic\r\n#### summary→web transaction time(postgres)\r\n9:20時点\r\n<img width=\"687\" alt=\"スクリーンショット 2023-04-22 9.20.11.png (57.4 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/22/136273/c5ceb534-281d-4aef-9394-c0c6d3666346.png\">\r\n\r\n### Heroku Dyno Metrics\r\n<img width=\"1325\" alt=\"スクリーンショット 2023-04-22 9.21.29.png (142.6 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/22/136273/a7d91885-9307-494c-b0db-7b7f781690f1.png\">\r\n\r\n\r\n### AWS CloudWatch\r\n\r\n\r\n## 4/23(sun)\r\n\r\n### New Relic\r\n#### summary→web transaction time(postgres)\r\n\r\n### Heroku Dyno Metrics\r\n\r\n### AWS CloudWatch\r\n\r\n## 4/24(mon)\r\n\r\n### New Relic\r\n#### summary→web transaction time(postgres)\r\n<img width=\"686\" alt=\"スクリーンショット 2023-04-24 10.50.56.png (56.1 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/24/136273/ac7ca018-a863-42a2-8d62-79ae02d7943a.png\">\r\n\r\n### Heroku Dyno Metrics\r\n<img width=\"1323\" alt=\"スクリーンショット 2023-04-24 10.52.33.png (52.9 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/24/136273/00477b08-0075-4f58-9c6b-77856153ace4.png\">\r\n\r\n\r\n### AWS CloudWatch\r\n#### CPUUtilizaion\r\n<img width=\"621\" alt=\"スクリーンショット 2023-04-24 10.49.07.png (28.0 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/24/136273/db329b1d-fd0d-432c-becf-54ebd1916985.png\">\r\n\r\n#### DBConnections\r\n<img width=\"622\" alt=\"スクリーンショット 2023-04-24 10.49.59.png (26.8 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/24/136273/e592bba7-e949-48ce-a6a0-66da325365ed.png\">\r\n#### FreeableMemory\r\n<img width=\"620\" alt=\"スクリーンショット 2023-04-24 10.50.29.png (29.2 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/24/136273/e8027c49-5835-4954-b454-3ce3f73b12b8.png\">\r\n\r\n\r\n## 4/25(tue)\r\n\r\n### New Relic\r\n#### summary→web transaction time(postgres)\r\nやはりJST AM4:00頃にスパイクがある\r\n<img width=\"665\" alt=\"スクリーンショット 2023-04-25 10.32.48.png (158.6 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/25/136273/d494ac28-f2b9-4511-86a3-7f2441e1e892.png\">\r\n\r\n### Heroku Dyno Metrics\r\n同上\r\n<img width=\"1201\" alt=\"スクリーンショット 2023-04-25 10.33.54.png (112.5 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/25/136273/41337a95-ce80-4230-9069-15b655f22dfe.png\">\r\n\r\n\r\n### AWS CloudWatch\r\n#### CPUUtilization\r\n<img width=\"457\" alt=\"スクリーンショット 2023-04-25 10.34.48.png (65.2 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/25/136273/4d0259b6-fd64-4201-8aa3-e660864da391.png\">\r\n\r\n#### DBConnections\r\n<img width=\"458\" alt=\"スクリーンショット 2023-04-25 10.35.19.png (60.7 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/25/136273/9a1921f1-dd7e-446e-8987-9050d75b26bc.png\">\r\n\r\n#### FreeableMemory\r\n<img width=\"459\" alt=\"スクリーンショット 2023-04-25 10.35.42.png (62.2 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/25/136273/8d1dd015-0175-4f2b-b4d4-57d6e0ad7b84.png\">\r\n\r\n\r\n## 4/26(wed)\r\n\r\n### New Relic\r\n#### summary→web transaction time(postgres)\r\n<img width=\"985\" alt=\"スクリーンショット 2023-04-26 10.13.45.png (64.1 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/26/136273/d06705c8-4f40-43ba-a06c-3d7f513d1a51.png\">\r\n\r\n### Heroku Dyno Metrics\r\n<img width=\"1204\" alt=\"スクリーンショット 2023-04-26 10.15.11.png (42.5 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/26/136273/fc0efd9f-a0eb-4e98-9fbc-86e8170a28ac.png\">\r\n\r\n\r\n### AWS CloudWatch\r\n#### CPUUtilization\r\n<img width=\"619\" alt=\"スクリーンショット 2023-04-26 10.15.52.png (29.0 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/26/136273/a6bfea88-c9d8-4fb6-8621-a3be5afd402a.png\">\r\n\r\n#### DBConnections\r\nUTC19:00のピークよりもサーバーリリース時の方が高い\r\ndynoの入れ替えをおこなっている際に一部のconnectionsが残ってスライドする方式のためか\r\n\r\n<img width=\"620\" alt=\"スクリーンショット 2023-04-26 10.16.32.png (26.0 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/26/136273/cd40bff9-3d37-452b-9919-53283c7dac3a.png\">\r\n\r\n#### FreeableMemory\r\n<img width=\"618\" alt=\"スクリーンショット 2023-04-26 10.17.41.png (27.7 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/26/136273/c0c5d3e2-a714-4992-abf2-16bc96923145.png\">\r\n\r\n\r\n## 結果\r\n\r\n- 現状大きな問題は起こっていない\r\n- Herokuの頃からあったJST AM4:00のDBConnetionsスパイクについて今回顕在化したのみで、大きな問題の原因とはなっていないが注視、調査が必要",
    "body_html": "<h1 data-sourcepos=\"1:1-1:8\" id=\"1-0-0\" name=\"1-0-0\"><a class=\"anchor\" id=\"概要\" name=\"概要\" href=\"#概要\" data-position=\"1-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"概要\"> &gt; 概要</span></a>概要</h1>\n<p data-sourcepos=\"3:1-4:100\">king-apiのDatabaseをHerokuからAWS RDS Auroraに移行したのでその後の様子を監視する履歴<br>\nまた、今後の運用に備えて項目/挙動の知見を溜め込む場としても活用予定</p>\n<h2 data-sourcepos=\"6:1-6:9\" id=\"1-1-0\" name=\"1-1-0\"><a class=\"anchor\" id=\"項目\" name=\"項目\" href=\"#項目\" data-position=\"1-1-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"項目\"> &gt; 項目</span></a>項目</h2>\n<details>\n<h3 data-sourcepos=\"10:1-10:13\" id=\"1-1-1\" name=\"1-1-1\"><a class=\"anchor\" id=\"New Relic\" name=\"New Relic\" href=\"#New Relic\" data-position=\"1-1-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"New Relic\"> &gt; New Relic</span></a>New Relic</h3>\n<ul data-sourcepos=\"11:3-12:57\">\n<li data-sourcepos=\"11:3-12:57\">summary→web transaction time(postgres)\n<ul data-sourcepos=\"12:7-12:57\">\n<li data-sourcepos=\"12:7-12:57\">Heroku Dynoから見たPostgresのロード時間</li>\n</ul></li>\n</ul>\n<h3 data-sourcepos=\"13:1-13:23\" id=\"1-1-2\" name=\"1-1-2\"><a class=\"anchor\" id=\"Heroku Dyno Metrics\" name=\"Heroku Dyno Metrics\" href=\"#Heroku Dyno Metrics\" data-position=\"1-1-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"Heroku Dyno Metrics\"> &gt; Heroku Dyno Metrics</span></a>Heroku Dyno Metrics</h3>\n<ul data-sourcepos=\"14:1-15:95\">\n<li data-sourcepos=\"14:1-14:168\"><a href=\"https://dashboard.heroku.com/apps/sl2-api-production/metrics/web?ending=0-hours-ago&amp;starting=72-hours-ago\" target=\"_blank\" rel=\"noopener noreferrer\">sl2-api-production metrics</a>dynoのレスポンスタイム</li>\n<li data-sourcepos=\"15:1-15:95\">MAXを除き99TH PERC.までを取得(特殊な例を除いた全体的な値を取りたい)</li>\n</ul>\n<h3 data-sourcepos=\"16:1-16:18\" id=\"1-1-3\" name=\"1-1-3\"><a class=\"anchor\" id=\"AWS CloudWatch\" name=\"AWS CloudWatch\" href=\"#AWS CloudWatch\" data-position=\"1-1-3\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"AWS CloudWatch\"> &gt; AWS CloudWatch</span></a>AWS CloudWatch</h3>\n<p data-sourcepos=\"17:1-17:163\"><a href=\"https://ap-northeast-1.console.aws.amazon.com/cloudwatch/home?region=ap-northeast-1#dashboards:name=king-api-production-aurora\" target=\"_blank\" rel=\"noopener noreferrer\">Dashboard</a> DB単体の稼働状況</p>\n<ul data-sourcepos=\"18:1-33:0\">\n<li data-sourcepos=\"18:1-20:109\">CPUUtilization\n<ul data-sourcepos=\"19:5-20:109\">\n<li data-sourcepos=\"19:5-20:109\">AuroraインスタンスごとのCPUの使用率\n<ul data-sourcepos=\"20:9-20:109\">\n<li data-sourcepos=\"20:9-20:109\">ある程度のスパイクは許容しつつも80%を超えた状態が継続したら注意か？</li>\n</ul></li>\n</ul></li>\n<li data-sourcepos=\"21:1-23:34\">ReadLatency\n<ul data-sourcepos=\"22:5-23:34\">\n<li data-sourcepos=\"22:5-23:34\">Auroraインスタンスの読み込み遅延時間\n<ul data-sourcepos=\"23:9-23:34\">\n<li data-sourcepos=\"23:9-23:34\">急上昇したら注意</li>\n</ul></li>\n</ul></li>\n<li data-sourcepos=\"24:1-26:34\">WriteLatency\n<ul data-sourcepos=\"25:5-26:34\">\n<li data-sourcepos=\"25:5-26:34\">Auroraインスタンスの書き込み遅延時間\n<ul data-sourcepos=\"26:9-26:34\">\n<li data-sourcepos=\"26:9-26:34\">急上昇したら注意</li>\n</ul></li>\n</ul></li>\n<li data-sourcepos=\"27:1-29:34\">DatabaseConnections\n<ul data-sourcepos=\"28:5-29:34\">\n<li data-sourcepos=\"28:5-29:34\">データベース接続数:許容値は5,000\n<ul data-sourcepos=\"29:9-29:34\">\n<li data-sourcepos=\"29:9-29:34\">急上昇したら注意</li>\n</ul></li>\n</ul></li>\n<li data-sourcepos=\"30:1-33:0\">FreeableMemory\n<ul data-sourcepos=\"31:5-33:0\">\n<li data-sourcepos=\"31:5-33:0\">メモリ空き容量\n<ul data-sourcepos=\"32:9-33:0\">\n<li data-sourcepos=\"32:9-33:0\">急降下した状態が継続したら注意</li>\n</ul></li>\n</ul></li>\n</ul>\n</details>\n<h2 data-sourcepos=\"36:1-36:12\" id=\"1-2-0\" name=\"1-2-0\"><a class=\"anchor\" id=\"4/20(thu)\" name=\"4/20(thu)\" href=\"#4/20(thu)\" data-position=\"1-2-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"4/20(thu)\"> &gt; 4/20(thu)</span></a>4/20(thu)</h2>\n<h3 data-sourcepos=\"38:1-38:13\" id=\"1-2-1\" name=\"1-2-1\"><a class=\"anchor\" id=\"New Relic-1\" name=\"New Relic-1\" href=\"#New Relic-1\" data-position=\"1-2-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"New Relic\"> &gt; New Relic</span></a>New Relic</h3>\n<h4 data-sourcepos=\"40:1-40:45\">summary→web transaction time(postgres)</h4>\n<p data-sourcepos=\"41:1-44:205\">3日分<br>\n10:28時点<br>\nピークは27.011ms(ユーザー利用ピーク時間帯)<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/20/136273/874a4bd0-e3d3-4d59-bf01-61d332c50a09.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"692\" alt=\"スクリーンショット 2023-04-20 10.28.08.png (64.3 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/20/136273/874a4bd0-e3d3-4d59-bf01-61d332c50a09.png\"></a></p>\n<h3 data-sourcepos=\"46:1-46:23\" id=\"1-2-2\" name=\"1-2-2\"><a class=\"anchor\" id=\"Heroku Dyno Metrics-1\" name=\"Heroku Dyno Metrics-1\" href=\"#Heroku Dyno Metrics-1\" data-position=\"1-2-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"Heroku Dyno Metrics\"> &gt; Heroku Dyno Metrics</span></a>Heroku Dyno Metrics</h3>\n<p data-sourcepos=\"47:1-50:207\">3日分<br>\n10:30時点<br>\nピークは383ms(ユーザー利用ピーク時間帯)<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/20/136273/f340a96c-5116-43b5-aead-ea917529045d.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"1323\" alt=\"スクリーンショット 2023-04-20 10.33.08.png (162.0 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/20/136273/f340a96c-5116-43b5-aead-ea917529045d.png\"></a></p>\n<h3 data-sourcepos=\"52:1-52:18\" id=\"1-2-3\" name=\"1-2-3\"><a class=\"anchor\" id=\"AWS CloudWatch-1\" name=\"AWS CloudWatch-1\" href=\"#AWS CloudWatch-1\" data-position=\"1-2-3\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"AWS CloudWatch\"> &gt; AWS CloudWatch</span></a>AWS CloudWatch</h3>\n<h4 data-sourcepos=\"53:1-53:19\">CPUUtilization</h4>\n<p data-sourcepos=\"54:1-56:205\">稼働開始後(4/19 AM5:00 JST)<br>\n〜4/20 AM10:30 JST<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/20/136273/f5f06145-5a84-421b-a818-dd974d303613.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"691\" alt=\"スクリーンショット 2023-04-20 10.39.11.png (39.8 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/20/136273/f5f06145-5a84-421b-a818-dd974d303613.png\"></a></p>\n<p data-sourcepos=\"58:1-60:205\">4/19 13:15JST頃<br>\nReplicaインスタンス(リーダー)でCPU使用率が**53.1%**→100%まで張り付いているわけではない<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/20/136273/6309897b-1fe6-4c45-9afa-204fed5ab349.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"694\" alt=\"スクリーンショット 2023-04-20 10.38.03.png (55.0 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/20/136273/6309897b-1fe6-4c45-9afa-204fed5ab349.png\"></a></p>\n<h4 data-sourcepos=\"62:1-62:16\">ReadLatency</h4>\n<p data-sourcepos=\"63:1-65:205\">稼働開始後(4/19 AM5:00 JST)<br>\n〜4/20 AM10:30 JST<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/20/136273/357fb3da-1b93-4ffb-93e3-6d23d0691a2b.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"694\" alt=\"スクリーンショット 2023-04-20 10.49.12.png (38.4 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/20/136273/357fb3da-1b93-4ffb-93e3-6d23d0691a2b.png\"></a></p>\n<p data-sourcepos=\"67:1-69:205\">4/19 13:20JST頃<br>\nReplicaインスタンス(リーダー)でReadLatencyが2.9msec→CPU同様、楢原さんに提出するクエリだろうか<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/20/136273/f03b150b-6acf-4c83-b85a-1a42f276f3a5.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"693\" alt=\"スクリーンショット 2023-04-20 10.49.54.png (55.1 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/20/136273/f03b150b-6acf-4c83-b85a-1a42f276f3a5.png\"></a></p>\n<h4 data-sourcepos=\"71:1-71:17\">WriteLatency</h4>\n<p data-sourcepos=\"72:1-74:205\">稼働開始後(4/19 AM5:00 JST)<br>\n〜4/20 AM10:30 JST<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/20/136273/6a5a4e97-5fe3-4379-8b3d-2987ccee6da7.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"691\" alt=\"スクリーンショット 2023-04-20 10.51.54.png (39.7 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/20/136273/6a5a4e97-5fe3-4379-8b3d-2987ccee6da7.png\"></a></p>\n<p data-sourcepos=\"76:1-77:205\">夜中にピークが訪れている→なぜ？<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/20/136273/a4f4549c-547b-46fb-96ad-daf9e06764e7.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"693\" alt=\"スクリーンショット 2023-04-20 10.52.57.png (61.9 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/20/136273/a4f4549c-547b-46fb-96ad-daf9e06764e7.png\"></a></p>\n<h4 data-sourcepos=\"79:1-79:24\">DatabaseConnections</h4>\n<p data-sourcepos=\"80:1-82:205\">稼働開始後(4/19 AM5:00 JST)<br>\n〜4/20 AM10:30 JST<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/20/136273/55691784-4ce5-4ea2-8595-a8fd8eac88a4.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"693\" alt=\"スクリーンショット 2023-04-20 10.54.06.png (40.3 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/20/136273/55691784-4ce5-4ea2-8595-a8fd8eac88a4.png\"></a></p>\n<p data-sourcepos=\"84:1-85:205\">WriteLatency同様夜中にピーク値1,862が訪れている<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/20/136273/d0b31bee-5337-409b-82f7-7e44140bc2de.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"695\" alt=\"スクリーンショット 2023-04-20 10.54.56.png (56.3 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/20/136273/d0b31bee-5337-409b-82f7-7e44140bc2de.png\"></a></p>\n<h4 data-sourcepos=\"87:1-87:19\">FreeableMemory</h4>\n<p data-sourcepos=\"88:1-90:205\">稼働開始後(4/19 AM5:00 JST)<br>\n〜4/20 AM10:30 JST<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/20/136273/0870d04b-8775-46b2-8daa-0d30cb3f8978.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"693\" alt=\"スクリーンショット 2023-04-20 10.55.52.png (43.1 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/20/136273/0870d04b-8775-46b2-8daa-0d30cb3f8978.png\"></a></p>\n<p data-sourcepos=\"92:1-93:205\">ReadLatencyと同時刻にReplicaで40MB程度降下し少し持ち直した<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/20/136273/1ba921b2-d9c9-4bea-b6f4-3551f173f3eb.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"693\" alt=\"スクリーンショット 2023-04-20 10.56.59.png (56.9 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/20/136273/1ba921b2-d9c9-4bea-b6f4-3551f173f3eb.png\"></a></p>\n<p data-sourcepos=\"95:1-96:205\">WriteLatencyやDatabaseConnectionsが上昇した時刻にPrimaryで1.5GB程度降下し、少し持ち直した<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/20/136273/1a5da4ed-072b-4723-af7a-f25f9c04b4ef.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"693\" alt=\"スクリーンショット 2023-04-20 10.58.14.png (53.6 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/20/136273/1a5da4ed-072b-4723-af7a-f25f9c04b4ef.png\"></a></p>\n<h2 data-sourcepos=\"102:1-102:12\" id=\"1-3-0\" name=\"1-3-0\"><a class=\"anchor\" id=\"4/21(fri)\" name=\"4/21(fri)\" href=\"#4/21(fri)\" data-position=\"1-3-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"4/21(fri)\"> &gt; 4/21(fri)</span></a>4/21(fri)</h2>\n<h3 data-sourcepos=\"104:1-104:13\" id=\"1-3-1\" name=\"1-3-1\"><a class=\"anchor\" id=\"New Relic-2\" name=\"New Relic-2\" href=\"#New Relic-2\" data-position=\"1-3-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"New Relic\"> &gt; New Relic</span></a>New Relic</h3>\n<h4 data-sourcepos=\"105:1-105:45\">summary→web transaction time(postgres)</h4>\n<p data-sourcepos=\"106:1-109:205\">3日分<br>\n10:32時点<br>\nピークは34.661ms(昨日の午後3:30〜4:00頃JST)<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/21/136273/487560dc-30c6-4b2c-b190-3af091d5e946.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"690\" alt=\"スクリーンショット 2023-04-21 10.33.42.png (68.0 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/21/136273/487560dc-30c6-4b2c-b190-3af091d5e946.png\"></a></p>\n<h3 data-sourcepos=\"111:1-111:23\" id=\"1-3-2\" name=\"1-3-2\"><a class=\"anchor\" id=\"Heroku Dyno Metrics-2\" name=\"Heroku Dyno Metrics-2\" href=\"#Heroku Dyno Metrics-2\" data-position=\"1-3-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"Heroku Dyno Metrics\"> &gt; Heroku Dyno Metrics</span></a>Heroku Dyno Metrics</h3>\n<p data-sourcepos=\"112:1-115:206\">3日分<br>\n10:32時点<br>\nピークは415ms(4/20 18:00〜19:00 JST)利用ピーク時間帯<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/21/136273/9f0402d6-2f46-4931-8328-e395ac589fc9.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"1324\" alt=\"スクリーンショット 2023-04-21 10.37.05.png (55.4 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/21/136273/9f0402d6-2f46-4931-8328-e395ac589fc9.png\"></a></p>\n<h3 data-sourcepos=\"117:1-117:18\" id=\"1-3-3\" name=\"1-3-3\"><a class=\"anchor\" id=\"AWS CloudWatch-2\" name=\"AWS CloudWatch-2\" href=\"#AWS CloudWatch-2\" data-position=\"1-3-3\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"AWS CloudWatch\"> &gt; AWS CloudWatch</span></a>AWS CloudWatch</h3>\n<h4 data-sourcepos=\"118:1-118:19\">CPUUtilization</h4>\n<p data-sourcepos=\"119:1-121:205\">4/20 AM10:30 JST<br>\n〜4/21 AM10:30 JST<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/21/136273/b9ddaa03-f614-4970-998f-b4dee3579980.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"892\" alt=\"スクリーンショット 2023-04-21 10.45.16.png (45.3 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/21/136273/b9ddaa03-f614-4970-998f-b4dee3579980.png\"></a></p>\n<p data-sourcepos=\"123:1-127:205\">Replicaでのピークが2度ある<br>\n4/20 4:20UTC(13:20 JST) 53.53%<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/21/136273/9d9a8902-ef9e-46bd-9ac5-4567d56cd14f.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"892\" alt=\"スクリーンショット 2023-04-21 10.48.04.png (63.6 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/21/136273/9d9a8902-ef9e-46bd-9ac5-4567d56cd14f.png\"></a><br>\n4/20 23:55UTC(4/21 8:55 JST) 92.5%<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/21/136273/8a203928-f624-4509-8240-6569a7156986.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"891\" alt=\"スクリーンショット 2023-04-21 10.48.19.png (61.6 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/21/136273/8a203928-f624-4509-8240-6569a7156986.png\"></a></p>\n<h4 data-sourcepos=\"129:1-129:16\">ReadLatency</h4>\n<p data-sourcepos=\"130:1-134:205\">4/20 AM10:30 JST<br>\n〜4/21 AM10:30 JST<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/21/136273/ef7cbf6a-fc30-4d7f-be44-9beae25f237c.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"892\" alt=\"スクリーンショット 2023-04-21 10.51.34.png (44.5 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/21/136273/ef7cbf6a-fc30-4d7f-be44-9beae25f237c.png\"></a><br>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/21/136273/a2e5e7aa-f1d8-4f56-a709-63e9707d434a.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"892\" alt=\"スクリーンショット 2023-04-21 10.52.59.png (66.7 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/21/136273/a2e5e7aa-f1d8-4f56-a709-63e9707d434a.png\"></a><br>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/21/136273/425b9e0d-55c0-442c-8064-87fda7ff9651.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"891\" alt=\"スクリーンショット 2023-04-21 10.53.18.png (62.3 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/21/136273/425b9e0d-55c0-442c-8064-87fda7ff9651.png\"></a></p>\n<h4 data-sourcepos=\"137:1-137:17\">WriteLatency</h4>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/21/136273/d2fe90ce-0421-45cf-a3e3-42792f848044.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"891\" alt=\"スクリーンショット 2023-04-21 10.55.27.png (45.9 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/21/136273/d2fe90ce-0421-45cf-a3e3-42792f848044.png\"></a>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/21/136273/1f08e73b-d8b8-46b7-b6b9-ccddf370a8fe.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"889\" alt=\"スクリーンショット 2023-04-21 10.56.09.png (62.5 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/21/136273/1f08e73b-d8b8-46b7-b6b9-ccddf370a8fe.png\"></a>\n<h4 data-sourcepos=\"141:1-141:24\">DatabaseConnections</h4>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/21/136273/d1e4b50c-60db-4876-a628-c88e99743da4.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"892\" alt=\"スクリーンショット 2023-04-21 10.57.58.png (49.0 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/21/136273/d1e4b50c-60db-4876-a628-c88e99743da4.png\"></a>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/21/136273/0957517c-b991-49fe-b90e-6c511995fc47.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"892\" alt=\"スクリーンショット 2023-04-21 10.58.24.png (61.7 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/21/136273/0957517c-b991-49fe-b90e-6c511995fc47.png\"></a>\n<h4 data-sourcepos=\"145:1-145:19\">FreeableMemory</h4>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/21/136273/63349207-1104-4a6c-9d83-c59e71aab77f.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"892\" alt=\"スクリーンショット 2023-04-21 10.59.15.png (51.4 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/21/136273/63349207-1104-4a6c-9d83-c59e71aab77f.png\"></a>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/21/136273/b47ee8d7-3396-4f02-8be1-03b67f4402c7.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"892\" alt=\"スクリーンショット 2023-04-21 10.59.32.png (66.1 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/21/136273/b47ee8d7-3396-4f02-8be1-03b67f4402c7.png\"></a>\n<h2 data-sourcepos=\"151:1-151:12\" id=\"1-4-0\" name=\"1-4-0\"><a class=\"anchor\" id=\"4/22(sat)\" name=\"4/22(sat)\" href=\"#4/22(sat)\" data-position=\"1-4-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"4/22(sat)\"> &gt; 4/22(sat)</span></a>4/22(sat)</h2>\n<h3 data-sourcepos=\"153:1-153:13\" id=\"1-4-1\" name=\"1-4-1\"><a class=\"anchor\" id=\"New Relic-3\" name=\"New Relic-3\" href=\"#New Relic-3\" data-position=\"1-4-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"New Relic\"> &gt; New Relic</span></a>New Relic</h3>\n<h4 data-sourcepos=\"154:1-154:45\">summary→web transaction time(postgres)</h4>\n<p data-sourcepos=\"155:1-156:204\">9:20時点<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/22/136273/c5ceb534-281d-4aef-9394-c0c6d3666346.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"687\" alt=\"スクリーンショット 2023-04-22 9.20.11.png (57.4 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/22/136273/c5ceb534-281d-4aef-9394-c0c6d3666346.png\"></a></p>\n<h3 data-sourcepos=\"158:1-158:23\" id=\"1-4-2\" name=\"1-4-2\"><a class=\"anchor\" id=\"Heroku Dyno Metrics-3\" name=\"Heroku Dyno Metrics-3\" href=\"#Heroku Dyno Metrics-3\" data-position=\"1-4-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"Heroku Dyno Metrics\"> &gt; Heroku Dyno Metrics</span></a>Heroku Dyno Metrics</h3>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/22/136273/a7d91885-9307-494c-b0db-7b7f781690f1.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"1325\" alt=\"スクリーンショット 2023-04-22 9.21.29.png (142.6 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/22/136273/a7d91885-9307-494c-b0db-7b7f781690f1.png\"></a>\n<h3 data-sourcepos=\"162:1-162:18\" id=\"1-4-3\" name=\"1-4-3\"><a class=\"anchor\" id=\"AWS CloudWatch-3\" name=\"AWS CloudWatch-3\" href=\"#AWS CloudWatch-3\" data-position=\"1-4-3\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"AWS CloudWatch\"> &gt; AWS CloudWatch</span></a>AWS CloudWatch</h3>\n<h2 data-sourcepos=\"165:1-165:12\" id=\"1-5-0\" name=\"1-5-0\"><a class=\"anchor\" id=\"4/23(sun)\" name=\"4/23(sun)\" href=\"#4/23(sun)\" data-position=\"1-5-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"4/23(sun)\"> &gt; 4/23(sun)</span></a>4/23(sun)</h2>\n<h3 data-sourcepos=\"167:1-167:13\" id=\"1-5-1\" name=\"1-5-1\"><a class=\"anchor\" id=\"New Relic-4\" name=\"New Relic-4\" href=\"#New Relic-4\" data-position=\"1-5-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"New Relic\"> &gt; New Relic</span></a>New Relic</h3>\n<h4 data-sourcepos=\"168:1-168:45\">summary→web transaction time(postgres)</h4>\n<h3 data-sourcepos=\"170:1-170:23\" id=\"1-5-2\" name=\"1-5-2\"><a class=\"anchor\" id=\"Heroku Dyno Metrics-4\" name=\"Heroku Dyno Metrics-4\" href=\"#Heroku Dyno Metrics-4\" data-position=\"1-5-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"Heroku Dyno Metrics\"> &gt; Heroku Dyno Metrics</span></a>Heroku Dyno Metrics</h3>\n<h3 data-sourcepos=\"172:1-172:18\" id=\"1-5-3\" name=\"1-5-3\"><a class=\"anchor\" id=\"AWS CloudWatch-4\" name=\"AWS CloudWatch-4\" href=\"#AWS CloudWatch-4\" data-position=\"1-5-3\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"AWS CloudWatch\"> &gt; AWS CloudWatch</span></a>AWS CloudWatch</h3>\n<h2 data-sourcepos=\"174:1-174:12\" id=\"1-6-0\" name=\"1-6-0\"><a class=\"anchor\" id=\"4/24(mon)\" name=\"4/24(mon)\" href=\"#4/24(mon)\" data-position=\"1-6-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"4/24(mon)\"> &gt; 4/24(mon)</span></a>4/24(mon)</h2>\n<h3 data-sourcepos=\"176:1-176:13\" id=\"1-6-1\" name=\"1-6-1\"><a class=\"anchor\" id=\"New Relic-5\" name=\"New Relic-5\" href=\"#New Relic-5\" data-position=\"1-6-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"New Relic\"> &gt; New Relic</span></a>New Relic</h3>\n<h4 data-sourcepos=\"177:1-177:45\">summary→web transaction time(postgres)</h4>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/24/136273/ac7ca018-a863-42a2-8d62-79ae02d7943a.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"686\" alt=\"スクリーンショット 2023-04-24 10.50.56.png (56.1 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/24/136273/ac7ca018-a863-42a2-8d62-79ae02d7943a.png\"></a>\n<h3 data-sourcepos=\"180:1-180:23\" id=\"1-6-2\" name=\"1-6-2\"><a class=\"anchor\" id=\"Heroku Dyno Metrics-5\" name=\"Heroku Dyno Metrics-5\" href=\"#Heroku Dyno Metrics-5\" data-position=\"1-6-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"Heroku Dyno Metrics\"> &gt; Heroku Dyno Metrics</span></a>Heroku Dyno Metrics</h3>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/24/136273/00477b08-0075-4f58-9c6b-77856153ace4.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"1323\" alt=\"スクリーンショット 2023-04-24 10.52.33.png (52.9 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/24/136273/00477b08-0075-4f58-9c6b-77856153ace4.png\"></a>\n<h3 data-sourcepos=\"184:1-184:18\" id=\"1-6-3\" name=\"1-6-3\"><a class=\"anchor\" id=\"AWS CloudWatch-5\" name=\"AWS CloudWatch-5\" href=\"#AWS CloudWatch-5\" data-position=\"1-6-3\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"AWS CloudWatch\"> &gt; AWS CloudWatch</span></a>AWS CloudWatch</h3>\n<h4 data-sourcepos=\"185:1-185:18\">CPUUtilizaion</h4>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/24/136273/db329b1d-fd0d-432c-becf-54ebd1916985.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"621\" alt=\"スクリーンショット 2023-04-24 10.49.07.png (28.0 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/24/136273/db329b1d-fd0d-432c-becf-54ebd1916985.png\"></a>\n<h4 data-sourcepos=\"188:1-188:18\">DBConnections</h4>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/24/136273/e592bba7-e949-48ce-a6a0-66da325365ed.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"622\" alt=\"スクリーンショット 2023-04-24 10.49.59.png (26.8 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/24/136273/e592bba7-e949-48ce-a6a0-66da325365ed.png\"></a>\n#### FreeableMemory\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/24/136273/e8027c49-5835-4954-b454-3ce3f73b12b8.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"620\" alt=\"スクリーンショット 2023-04-24 10.50.29.png (29.2 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/24/136273/e8027c49-5835-4954-b454-3ce3f73b12b8.png\"></a>\n<h2 data-sourcepos=\"194:1-194:12\" id=\"1-7-0\" name=\"1-7-0\"><a class=\"anchor\" id=\"4/25(tue)\" name=\"4/25(tue)\" href=\"#4/25(tue)\" data-position=\"1-7-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"4/25(tue)\"> &gt; 4/25(tue)</span></a>4/25(tue)</h2>\n<h3 data-sourcepos=\"196:1-196:13\" id=\"1-7-1\" name=\"1-7-1\"><a class=\"anchor\" id=\"New Relic-6\" name=\"New Relic-6\" href=\"#New Relic-6\" data-position=\"1-7-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"New Relic\"> &gt; New Relic</span></a>New Relic</h3>\n<h4 data-sourcepos=\"197:1-197:45\">summary→web transaction time(postgres)</h4>\n<p data-sourcepos=\"198:1-199:206\">やはりJST AM4:00頃にスパイクがある<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/25/136273/d494ac28-f2b9-4511-86a3-7f2441e1e892.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"665\" alt=\"スクリーンショット 2023-04-25 10.32.48.png (158.6 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/25/136273/d494ac28-f2b9-4511-86a3-7f2441e1e892.png\"></a></p>\n<h3 data-sourcepos=\"201:1-201:23\" id=\"1-7-2\" name=\"1-7-2\"><a class=\"anchor\" id=\"Heroku Dyno Metrics-6\" name=\"Heroku Dyno Metrics-6\" href=\"#Heroku Dyno Metrics-6\" data-position=\"1-7-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"Heroku Dyno Metrics\"> &gt; Heroku Dyno Metrics</span></a>Heroku Dyno Metrics</h3>\n<p data-sourcepos=\"202:1-203:207\">同上<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/25/136273/41337a95-ce80-4230-9069-15b655f22dfe.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"1201\" alt=\"スクリーンショット 2023-04-25 10.33.54.png (112.5 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/25/136273/41337a95-ce80-4230-9069-15b655f22dfe.png\"></a></p>\n<h3 data-sourcepos=\"206:1-206:18\" id=\"1-7-3\" name=\"1-7-3\"><a class=\"anchor\" id=\"AWS CloudWatch-6\" name=\"AWS CloudWatch-6\" href=\"#AWS CloudWatch-6\" data-position=\"1-7-3\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"AWS CloudWatch\"> &gt; AWS CloudWatch</span></a>AWS CloudWatch</h3>\n<h4 data-sourcepos=\"207:1-207:19\">CPUUtilization</h4>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/25/136273/4d0259b6-fd64-4201-8aa3-e660864da391.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"457\" alt=\"スクリーンショット 2023-04-25 10.34.48.png (65.2 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/25/136273/4d0259b6-fd64-4201-8aa3-e660864da391.png\"></a>\n<h4 data-sourcepos=\"210:1-210:18\">DBConnections</h4>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/25/136273/9a1921f1-dd7e-446e-8987-9050d75b26bc.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"458\" alt=\"スクリーンショット 2023-04-25 10.35.19.png (60.7 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/25/136273/9a1921f1-dd7e-446e-8987-9050d75b26bc.png\"></a>\n<h4 data-sourcepos=\"213:1-213:19\">FreeableMemory</h4>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/25/136273/8d1dd015-0175-4f2b-b4d4-57d6e0ad7b84.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"459\" alt=\"スクリーンショット 2023-04-25 10.35.42.png (62.2 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/25/136273/8d1dd015-0175-4f2b-b4d4-57d6e0ad7b84.png\"></a>\n<h2 data-sourcepos=\"217:1-217:12\" id=\"1-8-0\" name=\"1-8-0\"><a class=\"anchor\" id=\"4/26(wed)\" name=\"4/26(wed)\" href=\"#4/26(wed)\" data-position=\"1-8-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"4/26(wed)\"> &gt; 4/26(wed)</span></a>4/26(wed)</h2>\n<h3 data-sourcepos=\"219:1-219:13\" id=\"1-8-1\" name=\"1-8-1\"><a class=\"anchor\" id=\"New Relic-7\" name=\"New Relic-7\" href=\"#New Relic-7\" data-position=\"1-8-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"New Relic\"> &gt; New Relic</span></a>New Relic</h3>\n<h4 data-sourcepos=\"220:1-220:45\">summary→web transaction time(postgres)</h4>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/26/136273/d06705c8-4f40-43ba-a06c-3d7f513d1a51.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"985\" alt=\"スクリーンショット 2023-04-26 10.13.45.png (64.1 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/26/136273/d06705c8-4f40-43ba-a06c-3d7f513d1a51.png\"></a>\n<h3 data-sourcepos=\"223:1-223:23\" id=\"1-8-2\" name=\"1-8-2\"><a class=\"anchor\" id=\"Heroku Dyno Metrics-7\" name=\"Heroku Dyno Metrics-7\" href=\"#Heroku Dyno Metrics-7\" data-position=\"1-8-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"Heroku Dyno Metrics\"> &gt; Heroku Dyno Metrics</span></a>Heroku Dyno Metrics</h3>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/26/136273/fc0efd9f-a0eb-4e98-9fbc-86e8170a28ac.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"1204\" alt=\"スクリーンショット 2023-04-26 10.15.11.png (42.5 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/26/136273/fc0efd9f-a0eb-4e98-9fbc-86e8170a28ac.png\"></a>\n<h3 data-sourcepos=\"227:1-227:18\" id=\"1-8-3\" name=\"1-8-3\"><a class=\"anchor\" id=\"AWS CloudWatch-7\" name=\"AWS CloudWatch-7\" href=\"#AWS CloudWatch-7\" data-position=\"1-8-3\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"AWS CloudWatch\"> &gt; AWS CloudWatch</span></a>AWS CloudWatch</h3>\n<h4 data-sourcepos=\"228:1-228:19\">CPUUtilization</h4>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/26/136273/a6bfea88-c9d8-4fb6-8621-a3be5afd402a.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"619\" alt=\"スクリーンショット 2023-04-26 10.15.52.png (29.0 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/26/136273/a6bfea88-c9d8-4fb6-8621-a3be5afd402a.png\"></a>\n<h4 data-sourcepos=\"231:1-231:18\">DBConnections</h4>\n<p data-sourcepos=\"232:1-233:117\">UTC19:00のピークよりもサーバーリリース時の方が高い<br>\ndynoの入れ替えをおこなっている際に一部のconnectionsが残ってスライドする方式のためか</p>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/26/136273/cd40bff9-3d37-452b-9919-53283c7dac3a.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"620\" alt=\"スクリーンショット 2023-04-26 10.16.32.png (26.0 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/26/136273/cd40bff9-3d37-452b-9919-53283c7dac3a.png\"></a>\n<h4 data-sourcepos=\"237:1-237:19\">FreeableMemory</h4>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/26/136273/c0c5d3e2-a714-4992-abf2-16bc96923145.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"618\" alt=\"スクリーンショット 2023-04-26 10.17.41.png (27.7 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/26/136273/c0c5d3e2-a714-4992-abf2-16bc96923145.png\"></a>\n<h2 data-sourcepos=\"241:1-241:9\" id=\"1-9-0\" name=\"1-9-0\"><a class=\"anchor\" id=\"結果\" name=\"結果\" href=\"#結果\" data-position=\"1-9-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"結果\"> &gt; 結果</span></a>結果</h2>\n<ul data-sourcepos=\"243:1-244:186\">\n<li data-sourcepos=\"243:1-243:47\">現状大きな問題は起こっていない</li>\n<li data-sourcepos=\"244:1-244:186\">Herokuの頃からあったJST AM4:00のDBConnetionsスパイクについて今回顕在化したのみで、大きな問題の原因とはなっていないが注視、調査が必要</li>\n</ul>\n",
    "created_at": "2023-04-20T10:48:29+09:00",
    "message": "Update post.",
    "kind": "stock",
    "comments_count": 5,
    "tasks_count": 0,
    "done_tasks_count": 0,
    "url": "https://qrio.esa.io/posts/1633",
    "updated_at": "2023-07-18T10:50:15+09:00",
    "tags": [],
    "category": "Users/杉山/Database",
    "revision_number": 22,
    "created_by": {
      "myself": false,
      "name": "杉山聡",
      "screen_name": "satoshi_sugiyama",
      "icon": "https://img.esa.io/uploads/production/members/129432/icon/thumb_m_4589e2842b9d87757c7c9db07c45c00d.jpg"
    },
    "updated_by": {
      "myself": false,
      "name": "杉山聡",
      "screen_name": "satoshi_sugiyama",
      "icon": "https://img.esa.io/uploads/production/members/129432/icon/thumb_m_4589e2842b9d87757c7c9db07c45c00d.jpg"
    },
    "stargazers_count": 0,
    "watchers_count": 1,
    "star": false,
    "watch": false,
    "sharing_urls": null
  },
  {
    "number": 1627,
    "name": "本番DB移行履歴(bucardo監視開始〜完了まで)",
    "full_name": "Users/杉山/Database/本番DB移行履歴(bucardo監視開始〜完了まで)",
    "wip": false,
    "body_md": "## 前作\r\n\r\nproduction-aurora作成実施履歴\r\nhttps://qrio.esa.io/posts/1626\r\n\r\n本稿は↑の続きです\r\n\r\n## 手順書\r\n\r\nhttps://docs.google.com/spreadsheets/d/1W3DymCJ_ifiXtSUwVAjcl9tzPGfz5WE6bmnnwYL9Gbo/edit#gid=1297114524\r\n\r\n## EC2-dockerコンテナでのプロセスの初期状態(pg_dumpとpg_restore実行終了の確認用)\r\n### psqlコマンド\r\n#### dump(Heroku)\r\n```sql\r\npsql -p 5432 -U ubev937lfpa1d3 -d dncvsso7me9p6 -h vpce-0bed708f6ce21788a-f4tmby1p.vpce-svc-0de703034cbfc279a.ap-northeast-1.vpce.amazonaws.com -c \"select usename,application_name,query from pg_stat_activity where application_name = 'pg_dump';\"\r\n```\r\n#### restore(Aurora)\r\n```sql\r\npsql -p 5432 -U kingadmin -d kingapi -h king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com -c \"select usename,application_name,query from pg_stat_activity where application_name = 'pg_restore';\"\r\n```\r\n### topコマンド\r\n```sh\r\ntop - 19:16:37 up 15:18,  0 users,  load average: 0.00, 0.00, 0.00\r\nTasks:  10 total,   1 running,   9 sleeping,   0 stopped,   0 zombie\r\n%Cpu(s):  0.0 us,  0.0 sy,  0.0 ni,100.0 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st\r\nMiB Mem :  61287.0 total,  56927.2 free,    487.7 used,   3872.1 buff/cache\r\nMiB Swap:      0.0 total,      0.0 free,      0.0 used.  60099.3 avail Mem\r\n\r\n    PID USER      PR  NI    VIRT    RES    SHR S  %CPU  %MEM     TIME+ COMMAND\r\n      1 postgres  20   0    4624   3580   3180 S   0.0   0.0   0:00.02 bash\r\n    145 postgres  20   0  215724  30488  27728 S   0.0   0.0   0:01.00 postgres\r\n    147 postgres  20   0  215856  12260   9428 S   0.0   0.0   0:00.03 postgres\r\n    148 postgres  20   0  215724   7056   4296 S   0.0   0.0   0:00.30 postgres\r\n    149 postgres  20   0  215724  11676   8888 S   0.0   0.0   0:00.29 postgres\r\n    150 postgres  20   0  216264   9996   6948 S   0.0   0.0   0:00.50 postgres\r\n    151 postgres  20   0   70460   6492   3732 S   0.0   0.0   0:00.93 postgres\r\n    152 postgres  20   0  216140   7676   4724 S   0.0   0.0   0:00.01 postgres\r\n   1701 root      20   0    2888   1060    968 S   0.0   0.0   0:00.02 sh\r\n   1841 root      20   0    7312   3484   2920 R   0.0   0.0   0:00.00 top\r\n```\r\nCOMMAND列を参照し、`pg_dump`や`pg_restore`がいない状態が終了とする\r\n\r\n\r\n\r\n## 20_データプールの開始\r\n\r\n### 開始時刻\r\n4/18 AM04:28\r\n### 手順\r\n```sh\r\nbucardo add sync sync_heroku_aws relgroup=herd_heroku_db db=heroku_db,aws_db\r\n```\r\n### 実行後\r\n```sh\r\n# bucardo add sync sync_heroku_aws relgroup=herd_heroku_db db=heroku_db,aws_db\r\nAdded sync \"sync_heroku_aws\"\r\nUsing existing dbgroup \"dbs\"\r\n\r\n# bucardo status sync_heroku_aws\r\n======================================================================\r\nSync name                : sync_heroku_aws\r\nCurrent state            : No records found\r\nSource relgroup/database : herd_heroku_db / heroku_db\r\nTables in sync           : 2\r\nStatus                   : Active\r\nCheck time               : None\r\nOverdue time             : 00:00:00\r\nExpired time             : 00:00:00\r\nStayalive/Kidsalive      : Yes / Yes\r\nRebuild index            : No\r\nAutokick                 : Yes\r\nOnetimecopy              : No\r\nPost-copy analyze        : Yes\r\nLast error:              :\r\n======================================================================\r\n```\r\n\r\nbucardoスキーマが追加されていることを確認した\r\n```sql\r\n# psql -p 5432 -U ubev937lfpa1d3 -d dncvsso7me9p6 -h vpce-0bed708f6ce21788a-f4tmby1p.vpce-svc-0de703034cbfc279a.ap-northeast-1.vpce.amazonaws.com\r\npsql (14.7 (Ubuntu 14.7-0ubuntu0.22.04.1))\r\nSSL connection (protocol: TLSv1.3, cipher: TLS_AES_256_GCM_SHA384, bits: 256, compression: off)\r\nType \"help\" for help.\r\n\r\ndncvsso7me9p6=> \\dn\r\n       List of schemas\r\n    Name    |     Owner\r\n------------+----------------\r\n bucardo    | ubev937lfpa1d3\r\n heroku_ext | postgres\r\n public     | ubev937lfpa1d3\r\n(3 rows)\r\n```\r\n\r\n### 10:50時点でのbucardoプールレコード数\r\n約6時間経過\r\nlogsが約100万、display_logsが約50万レコード\r\n\r\n<img width=\"957\" alt=\"スクリーンショット 2023-04-18 10.49.36.png (74.8 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/18/136273/3a3ebb2e-275e-4bc1-aadc-5f4d0b75aace.png\">\r\n<img width=\"987\" alt=\"スクリーンショット 2023-04-18 10.49.46.png (72.5 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/18/136273/f67acc50-0371-46ba-8ab0-6506a1a815b3.png\">\r\n\r\nメンテ中に撮影\r\n<img width=\"910\" alt=\"スクリーンショット 2023-04-19 1.20.53.png (80.9 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/19/136273/f1a00719-a408-408a-b9d3-1acdca1485cc.png\">\r\n<img width=\"891\" alt=\"スクリーンショット 2023-04-19 1.21.19.png (80.7 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/19/136273/46751422-092a-4a12-8579-09318febccaa.png\">\r\n\r\n\r\n## 21_logs, display_logsのdump\r\n\r\n### 開始時刻\r\n4/18 AM04:30\r\n### 手順\r\n```sh\r\npg_dump --format=custom --verbose --data-only --table=logs --table=display_logs -h vpce-0bed708f6ce21788a-f4tmby1p.vpce-svc-0de703034cbfc279a.ap-northeast-1.vpce.amazonaws.com -U ubev937lfpa1d3 -p 5432 -d dncvsso7me9p6 > logs_displaylogs.dump\r\n```\r\n### 終了確認方法\r\n- `top`コマンドか`ps -aux`コマンドで`pg_dump`のプロセスがいなくなっていることを確認する\r\n- psqlコマンドで`pg_stat_activity`から`application_name = 'pg_dump'`のレコードがいなくなっていることを確認する\r\n### 実行後\r\n\r\n```sh\r\n# pg_dump --format=custom --verbose --data-only --table=logs --table=display_logs -h vpce-0bed708f6ce21788a-f4tmby1p.vpce-svc-0de703034cbfc279a.ap-northeast-1.vpce.amazonaws.com -U ubev937lfpa1d3 -p 5432 -d dncvsso7me9p6 > logs_displaylogs.dump\r\npg_dump: last built-in OID is 16383\r\npg_dump: reading extensions\r\npg_dump: identifying extension members\r\npg_dump: reading schemas\r\npg_dump: reading user-defined tables\r\npg_dump: reading user-defined functions\r\npg_dump: reading user-defined types\r\npg_dump: reading procedural languages\r\npg_dump: reading user-defined aggregate functions\r\npg_dump: reading user-defined operators\r\npg_dump: reading user-defined access methods\r\npg_dump: reading user-defined operator classes\r\npg_dump: reading user-defined operator families\r\npg_dump: reading user-defined text search parsers\r\npg_dump: reading user-defined text search templates\r\npg_dump: reading user-defined text search dictionaries\r\npg_dump: reading user-defined text search configurations\r\npg_dump: reading user-defined foreign-data wrappers\r\npg_dump: reading user-defined foreign servers\r\npg_dump: reading default privileges\r\npg_dump: reading user-defined collations\r\npg_dump: reading user-defined conversions\r\npg_dump: reading type casts\r\npg_dump: reading transforms\r\npg_dump: reading table inheritance information\r\npg_dump: reading event triggers\r\npg_dump: finding extension tables\r\npg_dump: finding inheritance relationships\r\npg_dump: reading column info for interesting tables\r\npg_dump: finding the columns and types of table \"public.logs\"\r\npg_dump: finding the columns and types of table \"public.display_logs\"\r\npg_dump: flagging inherited columns in subtables\r\npg_dump: reading indexes\r\npg_dump: reading indexes for table \"public.logs\"\r\npg_dump: reading indexes for table \"public.display_logs\"\r\npg_dump: flagging indexes in partitioned tables\r\npg_dump: reading extended statistics\r\npg_dump: reading constraints\r\npg_dump: reading foreign key constraints for table \"public.logs\"\r\npg_dump: reading foreign key constraints for table \"public.display_logs\"\r\npg_dump: reading triggers\r\npg_dump: reading triggers for table \"public.logs\"\r\npg_dump: reading triggers for table \"public.display_logs\"\r\npg_dump: reading rewrite rules\r\npg_dump: reading policies\r\npg_dump: reading row-level security policies\r\npg_dump: reading publications\r\npg_dump: reading publication membership\r\npg_dump: reading subscriptions\r\npg_dump: reading dependency data\r\npg_dump: saving encoding = UTF8\r\npg_dump: saving standard_conforming_strings = on\r\npg_dump: saving search_path =\r\npg_dump: saving database definition\r\npg_dump: dumping contents of table \"public.display_logs\"\r\n```\r\n\r\npsqlコマンドでクエリの確認→OK\r\n```sql\r\npsql -p 5432 -U ubev937lfpa1d3 -d dncvsso7me9p6 -h vpce-0bed708f6ce21788a-f4tmby1p.vpce-svc-0de703034cbfc279a.ap-northeast-1.vpce.amazonaws.com -c \"select usename,application_name,query from pg_stat_activity where application_name = 'pg_dump';\"\r\n    usename     | application_name |                                                                     query\r\n\r\n----------------+------------------+-----------------------------------------------------------------------------------------------------------------------------------------------\r\n ubev937lfpa1d3 | pg_dump          | COPY public.display_logs (id, master_key_id, mst_display_log_id, user_name, logged_at, created_at, open_close_type, lock_position) TO stdout;\r\n(1 row)\r\n```\r\n\r\ntopコマンドでプロセスの確認→OK\r\n\r\n```sh\r\ntop - 19:31:09 up 15:32,  0 users,  load average: 0.57, 0.16, 0.05\r\nTasks:  12 total,   2 running,  10 sleeping,   0 stopped,   0 zombie\r\n%Cpu(s): 11.7 us,  0.9 sy,  0.0 ni, 87.1 id,  0.0 wa,  0.0 hi,  0.3 si,  0.0 st\r\nMiB Mem :  61287.0 total,  56560.3 free,    505.3 used,   4221.3 buff/cache\r\nMiB Swap:      0.0 total,      0.0 free,      0.0 used.  60081.1 avail Mem\r\n\r\n    PID USER      PR  NI    VIRT    RES    SHR S  %CPU  %MEM     TIME+ COMMAND\r\n   1884 root      20   0   19684  13700  10196 R  99.7   0.0   0:50.07 pg_dump\r\n      1 postgres  20   0    4624   3580   3180 S   0.0   0.0   0:00.02 bash\r\n    145 postgres  20   0  215724  30488  27728 S   0.0   0.0   0:01.02 postgres\r\n    147 postgres  20   0  215856  12260   9428 S   0.0   0.0   0:00.03 postgres\r\n    148 postgres  20   0  215724   9564   6772 S   0.0   0.0   0:00.30 postgres\r\n    149 postgres  20   0  215724  11676   8888 S   0.0   0.0   0:00.30 postgres\r\n    150 postgres  20   0  216264   9996   6948 S   0.0   0.0   0:00.51 postgres\r\n    151 postgres  20   0   70460   6492   3732 S   0.0   0.0   0:00.95 postgres\r\n```\r\n\r\n### 終了確認\r\n4/18 AM9:00→OK\r\n\r\ndumpファイルの容量:108GB\r\n\r\n```sh\r\ntop - 00:02:16 up 20:03,  0 users,  load average: 0.00, 0.05, 0.38\r\nTasks:  12 total,   1 running,  11 sleeping,   0 stopped,   0 zombie\r\n%Cpu(s):  0.0 us,  0.0 sy,  0.0 ni,100.0 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st\r\nMiB Mem :  61287.0 total,    800.2 free,    478.3 used,  60008.5 buff/cache\r\nMiB Swap:      0.0 total,      0.0 free,      0.0 used.  60094.1 avail Mem\r\n\r\n    PID USER      PR  NI    VIRT    RES    SHR S  %CPU  %MEM     TIME+ COMMAND\r\n      1 postgres  20   0    4624   3580   3180 S   0.0   0.0   0:00.02 bash\r\n    145 postgres  20   0  215724  30488  27728 S   0.0   0.0   0:01.36 postgres\r\n    147 postgres  20   0  215856  12260   9428 S   0.0   0.0   0:00.04 postgres\r\n    148 postgres  20   0  215724   9564   6772 S   0.0   0.0   0:00.39 postgres\r\n    149 postgres  20   0  215724  11676   8888 S   0.0   0.0   0:00.38 postgres\r\n    150 postgres  20   0  216264   9996   6948 S   0.0   0.0   0:00.68 postgres\r\n    151 postgres  20   0   70460   6492   3732 S   0.0   0.0   0:01.27 postgres\r\n    152 postgres  20   0  216140   7676   4724 S   0.0   0.0   0:00.02 postgres\r\n   1701 root      20   0    2888   1060    968 S   0.0   0.0   0:00.02 sh\r\n   1886 root      20   0    2888    988    900 S   0.0   0.0   0:00.02 sh\r\n   2454 root      20   0    2888    992    900 S   0.0   0.0   0:00.01 sh\r\n   2460 root      20   0    7312   2948   2620 R   0.0   0.0   0:00.00 top\r\n```\r\n\r\n```sql\r\npsql -p 5432 -U ubev937lfpa1d3 -d dncvsso7me9p6 -h vpce-0bed708f6ce21788a-f4tmby1p.vpce-svc-0de703034cbfc279a.ap-northeast-1.vpce.amazonaws.com -c \"select usename,application_name,query from pg_stat_activity where application_name = 'pg_dump';\"\r\n usename | application_name | query\r\n---------+------------------+-------\r\n(0 rows)\r\n```\r\n## 22_パラメーターグループの変更\r\n\r\n### 開始時刻\r\n4/18 AM09:00\r\n### 手順\r\nクラスターパラメーターグループを変更する\r\n### 実行後\r\n<img width=\"793\" alt=\"スクリーンショット 2023-04-18 9.05.38.png (234.4 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/18/136273/566f5ca8-2805-455f-b070-70d59e801a6e.png\">\r\n\r\n## 23_パラメーターグループの変更確認\r\n\r\n### 開始時刻\r\n4/18 AM09:05\r\n### 手順\r\nクラスターパラメーターグループを確認する\r\n```sql\r\nshow session_replication_role;\r\n```\r\n### 実行後\r\n\r\n```sql\r\n# psql -p 5432 -U kingadmin -d kingapi -h king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com -c \" show session_replication_role;\"\r\n session_replication_role\r\n--------------------------\r\n replica\r\n(1 row)\r\n```\r\n\r\n## 24_logs, display_logsのrestore\r\n\r\n### 開始時刻\r\n4/18 AM09:08\r\n### 手順\r\n```sh\r\npg_restore --verbose --data-only -h king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com -p 5432 -d kingapi -U kingadmin  --jobs=8 logs_displaylogs.dump\r\n```\r\n### 終了確認方法\r\n- `top`コマンドか`ps -aux`コマンドで`pg_restore`のプロセスがいなくなっていることを確認する\r\n- psqlコマンドで`pg_stat_activity`から`application_name = 'pg_restore'`のレコードがいなくなっていることを確認する\r\n### 実行後\r\n```sh\r\n# pg_restore --verbose --data-only -h king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com -p 5432 -d kingapi -U kingadmin  --jobs=8 logs_displaylogs.dump\r\npg_restore: connecting to database for restore\r\npg_restore: processing item 4588 ENCODING ENCODING\r\npg_restore: processing item 4589 STDSTRINGS STDSTRINGS\r\npg_restore: processing item 4590 SEARCHPATH SEARCHPATH\r\npg_restore: processing item 4591 DATABASE dncvsso7me9p6\r\npg_restore: processing item 4592 DATABASE PROPERTIES dncvsso7me9p6\r\npg_restore: entering main parallel loop\r\npg_restore: launching item 4584 TABLE DATA logs\r\npg_restore: launching item 4585 TABLE DATA display_logs\r\npg_restore: processing data for table \"public.logs\"\r\npg_restore: processing data for table \"public.display_logs\"\r\n\r\nここから移動するのでセッションが切れる\r\n```\r\nプロセスが動いているか確認\r\n```sh\r\ntop - 00:09:11 up 20:10,  0 users,  load average: 0.16, 0.05, 0.25\r\nTasks:  23 total,   1 running,  22 sleeping,   0 stopped,   0 zombie\r\n%Cpu(s):  1.6 us,  0.2 sy,  0.0 ni, 98.2 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st\r\nMiB Mem :  61287.0 total,    872.1 free,    466.2 used,  59948.6 buff/cache\r\nMiB Swap:      0.0 total,      0.0 free,      0.0 used.  60106.1 avail Mem\r\n\r\n    PID USER      PR  NI    VIRT    RES    SHR S  %CPU  %MEM     TIME+ COMMAND\r\n   2491 root      20   0   17948   7400   5280 S   7.6   0.0   0:04.57 pg_restore\r\n   2490 root      20   0   17948   7400   5280 S   7.0   0.0   0:04.09 pg_restore\r\n      1 postgres  20   0    4624   3580   3180 S   0.0   0.0   0:00.02 bash\r\n    145 postgres  20   0  215724  30488  27728 S   0.0   0.0   0:01.37 postgres\r\n    147 postgres  20   0  215856  12260   9428 S   0.0   0.0   0:00.04 postgres\r\n    148 postgres  20   0  215724   9564   6772 S   0.0   0.0   0:00.40 postgres\r\n    149 postgres  20   0  215724  11676   8888 S   0.0   0.0   0:00.39 postgres\r\n    150 postgres  20   0  216264   9996   6948 S   0.0   0.0   0:00.69 postgres\r\n    151 postgres  20   0   70460   6492   3732 S   0.0   0.0   0:01.28 postgres\r\n    152 postgres  20   0  216140   7676   4724 S   0.0   0.0   0:00.02 postgres\r\n   1701 root      20   0    2888   1060    968 S   0.0   0.0   0:00.02 sh\r\n   1886 root      20   0    2888    988    900 S   0.0   0.0   0:00.02 sh\r\n   2454 root      20   0    2888    992    900 S   0.0   0.0   0:00.01 sh\r\n   2476 root      20   0    2888    984    896 S   0.0   0.0   0:00.02 sh\r\n   2489 root      20   0   17856  11448   9424 S   0.0   0.0   0:00.05 pg_restore\r\n   2492 root      20   0   17948   7400   5280 S   0.0   0.0   0:00.02 pg_restore\r\n   2493 root      20   0   17948   7400   5280 S   0.0   0.0   0:00.02 pg_restore\r\n   2494 root      20   0   17948   7400   5280 S   0.0   0.0   0:00.02 pg_restore\r\n```\r\n順調な様子\r\n14:50 経過確認 cloudwatch\r\n<img width=\"1920\" alt=\"スクリーンショット 2023-04-18 14.46.18.png (208.4 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/18/136273/adf6db7c-82be-4529-b185-3a2faedb3a3d.png\">\r\n\r\n終了\r\n確認クエリ\r\nアクティブなクエリを取得する(where application_name=pg_restoreで絞り込み)\r\n```sql\r\nkingapi=> select usename,application_name,query from pg_stat_activity where application_name = 'pg_restore';\r\n(0 rows)\r\n```\r\n\r\n展開後の容量:614GB程度\r\n<img width=\"908\" alt=\"スクリーンショット 2023-04-19 0.57.07.png (79.5 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/19/136273/d32e8f71-8bb3-4c94-8179-9b32469da3c3.png\">\r\n\r\n\r\n## 25_パラメーターグループの変更\r\n\r\n### 開始時刻\r\n4/19 0:10\r\n### 手順\r\nパラメータグループをking-api-production-parametergroupに変更して適応\r\n### 実行後\r\n<img width=\"772\" alt=\"スクリーンショット 2023-04-19 0.09.50.png (96.3 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/19/136273/e5eda443-a12a-4dcb-a898-d9047db1f4b5.png\">\r\n<img width=\"299\" alt=\"スクリーンショット 2023-04-19 0.10.21.png (10.8 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/19/136273/41d03c45-3496-4864-a985-0cd7cc982b5f.png\">\r\n\r\n\r\n## 26_パラメータグループの確認\r\n### 開始時刻\r\n4:19 0:10\r\n### 手順\r\n`show session_replication_role;`\r\n### 実行後\r\n```sql\r\nkingapi=> show session_replication_role;\r\n-[ RECORD 1 ]------------+-------\r\nsession_replication_role | origin\r\n```\r\n## 27_監視止める\r\n### 開始時刻\r\n4:18 23:55\r\n### 手順\r\npingdom操作\r\n### 実行後\r\n\r\n## 29_prod-king-opeメンテイン\r\n### 開始時刻\r\n4/19 0:40\r\n### 手順\r\n```\r\nheroku apps:info -a prod-king-ope\r\n\r\nheroku maintenance:on -a prod-king-ope\r\nheroku ps:scale web=0 -a prod-king-ope\r\n\r\nheroku apps:info -a prod-king-ope\r\n\r\nheroku logs -t -a prod-king-ope\r\n```\r\n### 実行後\r\n\r\n## 30_customer-support-api-prodメンテイン\r\n### 開始時刻\r\n4/19 0:40\r\n### 手順\r\n```\r\nheroku apps:info -a customer-support-api-production\r\n\r\nheroku maintenance:on -a customer-support-api-production\r\nheroku ps:scale web=0 -a customer-support-api-production\r\n\r\nheroku apps:info -a customer-support-api-production\r\n\r\nheroku logs -t -a customer-support-api-production\r\n```\r\n### 実行後\r\n\r\n## 33_roomon-api-production メンテイン\r\n### 開始時刻\r\n4/19 1:00\r\n### 手順\r\n```\r\nスケジューラーの削除\r\n\r\nheroku apps:info -a roomon-api-production\r\n\r\nheroku maintenance:on -a roomon-api-production\r\nheroku ps:scale web=0 -a roomon-api-production\r\n\r\nheroku apps:info -a roomon-api-production\r\n\r\nheroku logs -t -a roomon-api-production\r\n```\r\n### 実行後\r\n\r\n## 34_sirius-api-production メンテイン\r\n### 開始時刻\r\n4/19 1:00\r\n### 手順\r\n```\r\nスケジューラーの削除\r\n\r\nheroku apps:info -a sirius-api-production\r\n\r\nheroku maintenance:on -a sirius-api-production\r\nheroku ps:scale web=0 -a sirius-api-production\r\nheroku ps:scale worker=0 -a sirius-api-production\r\n\r\n反映を確認\r\nheroku apps:info -a sirius-api-production\r\n\r\nメンテモードを確認\r\nhttps://sirius-api-production.herokuapp.com/\r\n\r\nログを確認\r\nheroku logs -t -a sirius-api-production\r\n```\r\n### 実行後\r\n\r\n## 35_king メンテイン\r\n### 開始時刻\r\n4/19 1:00\r\n### 手順\r\n```\r\nheroku apps:info -a sl2-api-production\r\n\r\nheroku maintenance:on -a sl2-api-production\r\nheroku ps:scale web=0 -a sl2-api-production\r\nheroku ps:scale worker=0 -a sl2-api-production\r\n\r\nheroku apps:info -a sl2-api-production\r\n\r\nheroku logs -t -a sl2-api-production\r\n```\r\n### 実行後\r\n\r\n## 37_logs, display_logs以外のdump\r\n### 開始時刻\r\n4/19 1:06\r\n### 手順\r\n```\r\npg_dump --format=custom --verbose --data-only --exclude-table=logs --exclude-table=display_logs -h vpce-0bed708f6ce21788a-f4tmby1p.vpce-svc-0de703034cbfc279a.ap-northeast-1.vpce.amazonaws.com -U ubev937lfpa1d3 -p 5432 -d dncvsso7me9p6 > main_data.dump\r\n\r\n```\r\n### 実行後\r\n\r\n<details>\r\n\r\n```sh\r\npg_dump --format=custom --verbose --data-only --exclude-table=logs --exclude-table=display_logs -h vpce-0bed708f6ce21788a-f4tmby1p.vpce-svc-0de703034cbfc279a.ap-northeast-1.vpce.amazonaws.com -U ubev937lfpa1d3 -p 5432 -d dncvsso7me9p6 > main_data.dump\r\npg_dump: last built-in OID is 16383\r\npg_dump: reading extensions\r\npg_dump: identifying extension members\r\npg_dump: reading schemas\r\npg_dump: reading user-defined tables\r\npg_dump: reading user-defined functions\r\npg_dump: reading user-defined types\r\npg_dump: reading procedural languages\r\npg_dump: reading user-defined aggregate functions\r\npg_dump: reading user-defined operators\r\npg_dump: reading user-defined access methods\r\npg_dump: reading user-defined operator classes\r\npg_dump: reading user-defined operator families\r\npg_dump: reading user-defined text search parsers\r\npg_dump: reading user-defined text search templates\r\npg_dump: reading user-defined text search dictionaries\r\npg_dump: reading user-defined text search configurations\r\npg_dump: reading user-defined foreign-data wrappers\r\npg_dump: reading user-defined foreign servers\r\npg_dump: reading default privileges\r\npg_dump: reading user-defined collations\r\npg_dump: reading user-defined conversions\r\npg_dump: reading type casts\r\npg_dump: reading transforms\r\npg_dump: reading table inheritance information\r\npg_dump: reading event triggers\r\npg_dump: finding extension tables\r\npg_dump: finding inheritance relationships\r\npg_dump: reading column info for interesting tables\r\npg_dump: finding the columns and types of table \"public.schema_migrations\"\r\npg_dump: finding the columns and types of table \"public.ar_internal_metadata\"\r\npg_dump: finding the columns and types of table \"public.locks\"\r\npg_dump: finding the columns and types of table \"public.hubs\"\r\npg_dump: finding the columns and types of table \"public.fobs\"\r\npg_dump: finding the columns and types of table \"public.users\"\r\npg_dump: finding the columns and types of table \"public.master_keys\"\r\npg_dump: finding the columns and types of table \"public.lock_settings\"\r\npg_dump: finding the columns and types of table \"public.term_of_validities\"\r\npg_dump: finding the columns and types of table \"public.durations\"\r\npg_dump: finding the columns and types of table \"public.dailies\"\r\npg_dump: finding the columns and types of table \"public.weeklies\"\r\npg_dump: finding the columns and types of table \"public.family_keys\"\r\npg_dump: finding the columns and types of table \"public.guest_keys\"\r\npg_dump: finding the columns and types of table \"public.fob_keys\"\r\npg_dump: finding the columns and types of table \"public.invitations\"\r\npg_dump: finding the columns and types of table \"public.json_web_keys\"\r\npg_dump: finding the columns and types of table \"public.command_logs\"\r\npg_dump: finding the columns and types of table \"public.webhook_tokens\"\r\npg_dump: finding the columns and types of table \"public.lock_webhook_tokens\"\r\npg_dump: finding the columns and types of table \"public.delayed_jobs\"\r\npg_dump: finding the columns and types of table \"public.managers\"\r\npg_dump: finding the columns and types of table \"public.webhooks\"\r\npg_dump: finding the columns and types of table \"public.autolock_schedules\"\r\npg_dump: finding the columns and types of table \"public.relationships\"\r\npg_dump: finding the columns and types of table \"public.wenas\"\r\npg_dump: finding the columns and types of table \"public.wena_keys\"\r\npg_dump: finding the columns and types of table \"public.knights\"\r\npg_dump: finding the columns and types of table \"public.knight_keys\"\r\npg_dump: finding the columns and types of table \"public.knight_cards\"\r\npg_dump: finding the columns and types of table \"public.knight_pins\"\r\npg_dump: finding the columns and types of table \"public.knight_commands\"\r\npg_dump: finding the columns and types of table \"public.knight_logs\"\r\npg_dump: finding the columns and types of table \"public.entrance_locks\"\r\npg_dump: finding the columns and types of table \"public.entrance_master_keys\"\r\npg_dump: finding the columns and types of table \"public.entrance_lock_settings\"\r\npg_dump: finding the columns and types of table \"public.entrance_knight_keys\"\r\npg_dump: finding the columns and types of table \"public.entrance_knight_pins\"\r\npg_dump: finding the columns and types of table \"public.resident_keys\"\r\npg_dump: finding the columns and types of table \"public.entrance_resident_keys\"\r\npg_dump: finding the columns and types of table \"public.entrance_invitations\"\r\npg_dump: finding the columns and types of table \"public.resident_guest_keys\"\r\npg_dump: finding the columns and types of table \"public.entrance_resident_guest_keys\"\r\npg_dump: finding the columns and types of table \"public.entrance_fob_keys\"\r\npg_dump: finding the columns and types of table \"public.mst_display_logs\"\r\npg_dump: finding the columns and types of table \"public.door_mode_changed_histories\"\r\npg_dump: finding the columns and types of table \"public.entrance_block_knight_cards\"\r\npg_dump: finding the columns and types of table \"public.entrance_block_fob_keys\"\r\npg_dump: finding the columns and types of table \"public.active_storage_blobs\"\r\npg_dump: finding the columns and types of table \"public.active_storage_attachments\"\r\npg_dump: finding the columns and types of table \"public.active_storage_variant_records\"\r\npg_dump: finding the columns and types of table \"public.pg_stat_statements_info\"\r\npg_dump: finding the columns and types of table \"public.pg_stat_statements\"\r\npg_dump: finding the columns and types of table \"public.laresia_pins\"\r\npg_dump: finding the columns and types of table \"bucardo.bucardo_delta_names\"\r\npg_dump: finding the columns and types of table \"bucardo.bucardo_delta_targets\"\r\npg_dump: finding the columns and types of table \"bucardo.bucardo_truncate_trigger\"\r\npg_dump: finding the columns and types of table \"bucardo.bucardo_truncate_trigger_log\"\r\npg_dump: finding the columns and types of table \"bucardo.bucardo_sequences\"\r\npg_dump: finding the columns and types of table \"bucardo.delta_public_display_logs\"\r\npg_dump: finding the columns and types of table \"bucardo.track_public_display_logs\"\r\npg_dump: finding the columns and types of table \"bucardo.stage_public_display_logs\"\r\npg_dump: finding the columns and types of table \"bucardo.delta_public_logs\"\r\npg_dump: finding the columns and types of table \"bucardo.track_public_logs\"\r\npg_dump: finding the columns and types of table \"bucardo.stage_public_logs\"\r\npg_dump: flagging inherited columns in subtables\r\npg_dump: reading indexes\r\npg_dump: reading indexes for table \"public.schema_migrations\"\r\npg_dump: reading indexes for table \"public.ar_internal_metadata\"\r\npg_dump: reading indexes for table \"public.locks\"\r\npg_dump: reading indexes for table \"public.hubs\"\r\npg_dump: reading indexes for table \"public.fobs\"\r\npg_dump: reading indexes for table \"public.users\"\r\npg_dump: reading indexes for table \"public.master_keys\"\r\npg_dump: reading indexes for table \"public.lock_settings\"\r\npg_dump: reading indexes for table \"public.term_of_validities\"\r\npg_dump: reading indexes for table \"public.durations\"\r\npg_dump: reading indexes for table \"public.dailies\"\r\npg_dump: reading indexes for table \"public.weeklies\"\r\npg_dump: reading indexes for table \"public.family_keys\"\r\npg_dump: reading indexes for table \"public.guest_keys\"\r\npg_dump: reading indexes for table \"public.fob_keys\"\r\npg_dump: reading indexes for table \"public.invitations\"\r\npg_dump: reading indexes for table \"public.json_web_keys\"\r\npg_dump: reading indexes for table \"public.command_logs\"\r\npg_dump: reading indexes for table \"public.webhook_tokens\"\r\npg_dump: reading indexes for table \"public.lock_webhook_tokens\"\r\npg_dump: reading indexes for table \"public.delayed_jobs\"\r\npg_dump: reading indexes for table \"public.managers\"\r\npg_dump: reading indexes for table \"public.webhooks\"\r\npg_dump: reading indexes for table \"public.autolock_schedules\"\r\npg_dump: reading indexes for table \"public.relationships\"\r\npg_dump: reading indexes for table \"public.wenas\"\r\npg_dump: reading indexes for table \"public.wena_keys\"\r\npg_dump: reading indexes for table \"public.knights\"\r\npg_dump: reading indexes for table \"public.knight_keys\"\r\npg_dump: reading indexes for table \"public.knight_cards\"\r\npg_dump: reading indexes for table \"public.knight_pins\"\r\npg_dump: reading indexes for table \"public.knight_commands\"\r\npg_dump: reading indexes for table \"public.knight_logs\"\r\npg_dump: reading indexes for table \"public.entrance_locks\"\r\npg_dump: reading indexes for table \"public.entrance_master_keys\"\r\npg_dump: reading indexes for table \"public.entrance_lock_settings\"\r\npg_dump: reading indexes for table \"public.entrance_knight_keys\"\r\npg_dump: reading indexes for table \"public.entrance_knight_pins\"\r\npg_dump: reading indexes for table \"public.resident_keys\"\r\npg_dump: reading indexes for table \"public.entrance_resident_keys\"\r\npg_dump: reading indexes for table \"public.entrance_invitations\"\r\npg_dump: reading indexes for table \"public.resident_guest_keys\"\r\npg_dump: reading indexes for table \"public.entrance_resident_guest_keys\"\r\npg_dump: reading indexes for table \"public.entrance_fob_keys\"\r\npg_dump: reading indexes for table \"public.mst_display_logs\"\r\npg_dump: reading indexes for table \"public.door_mode_changed_histories\"\r\npg_dump: reading indexes for table \"public.entrance_block_knight_cards\"\r\npg_dump: reading indexes for table \"public.entrance_block_fob_keys\"\r\npg_dump: reading indexes for table \"public.active_storage_blobs\"\r\npg_dump: reading indexes for table \"public.active_storage_attachments\"\r\npg_dump: reading indexes for table \"public.active_storage_variant_records\"\r\npg_dump: reading indexes for table \"public.laresia_pins\"\r\npg_dump: reading indexes for table \"bucardo.bucardo_delta_names\"\r\npg_dump: reading indexes for table \"bucardo.bucardo_delta_targets\"\r\npg_dump: reading indexes for table \"bucardo.bucardo_truncate_trigger\"\r\npg_dump: reading indexes for table \"bucardo.bucardo_sequences\"\r\npg_dump: reading indexes for table \"bucardo.delta_public_display_logs\"\r\npg_dump: reading indexes for table \"bucardo.track_public_display_logs\"\r\npg_dump: reading indexes for table \"bucardo.delta_public_logs\"\r\npg_dump: reading indexes for table \"bucardo.track_public_logs\"\r\npg_dump: flagging indexes in partitioned tables\r\npg_dump: reading extended statistics\r\npg_dump: reading constraints\r\npg_dump: reading foreign key constraints for table \"public.locks\"\r\npg_dump: reading foreign key constraints for table \"public.hubs\"\r\npg_dump: reading foreign key constraints for table \"public.fobs\"\r\npg_dump: reading foreign key constraints for table \"public.users\"\r\npg_dump: reading foreign key constraints for table \"public.master_keys\"\r\npg_dump: reading foreign key constraints for table \"public.lock_settings\"\r\npg_dump: reading foreign key constraints for table \"public.term_of_validities\"\r\npg_dump: reading foreign key constraints for table \"public.durations\"\r\npg_dump: reading foreign key constraints for table \"public.dailies\"\r\npg_dump: reading foreign key constraints for table \"public.weeklies\"\r\npg_dump: reading foreign key constraints for table \"public.family_keys\"\r\npg_dump: reading foreign key constraints for table \"public.guest_keys\"\r\npg_dump: reading foreign key constraints for table \"public.fob_keys\"\r\npg_dump: reading foreign key constraints for table \"public.invitations\"\r\npg_dump: reading foreign key constraints for table \"public.command_logs\"\r\npg_dump: reading foreign key constraints for table \"public.webhook_tokens\"\r\npg_dump: reading foreign key constraints for table \"public.lock_webhook_tokens\"\r\npg_dump: reading foreign key constraints for table \"public.managers\"\r\npg_dump: reading foreign key constraints for table \"public.webhooks\"\r\npg_dump: reading foreign key constraints for table \"public.autolock_schedules\"\r\npg_dump: reading foreign key constraints for table \"public.relationships\"\r\npg_dump: reading foreign key constraints for table \"public.wenas\"\r\npg_dump: reading foreign key constraints for table \"public.wena_keys\"\r\npg_dump: reading foreign key constraints for table \"public.knights\"\r\npg_dump: reading foreign key constraints for table \"public.knight_keys\"\r\npg_dump: reading foreign key constraints for table \"public.knight_cards\"\r\npg_dump: reading foreign key constraints for table \"public.knight_pins\"\r\npg_dump: reading foreign key constraints for table \"public.knight_logs\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_locks\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_master_keys\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_lock_settings\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_knight_keys\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_knight_pins\"\r\npg_dump: reading foreign key constraints for table \"public.resident_keys\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_resident_keys\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_invitations\"\r\npg_dump: reading foreign key constraints for table \"public.resident_guest_keys\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_resident_guest_keys\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_fob_keys\"\r\npg_dump: reading foreign key constraints for table \"public.mst_display_logs\"\r\npg_dump: reading foreign key constraints for table \"public.door_mode_changed_histories\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_block_knight_cards\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_block_fob_keys\"\r\npg_dump: reading foreign key constraints for table \"public.active_storage_blobs\"\r\npg_dump: reading foreign key constraints for table \"public.active_storage_attachments\"\r\npg_dump: reading foreign key constraints for table \"public.active_storage_variant_records\"\r\npg_dump: reading foreign key constraints for table \"public.laresia_pins\"\r\npg_dump: reading foreign key constraints for table \"bucardo.bucardo_delta_names\"\r\npg_dump: reading triggers\r\npg_dump: reading triggers for table \"public.locks\"\r\npg_dump: reading triggers for table \"public.hubs\"\r\npg_dump: reading triggers for table \"public.fobs\"\r\npg_dump: reading triggers for table \"public.users\"\r\npg_dump: reading triggers for table \"public.master_keys\"\r\npg_dump: reading triggers for table \"public.lock_settings\"\r\npg_dump: reading triggers for table \"public.term_of_validities\"\r\npg_dump: reading triggers for table \"public.durations\"\r\npg_dump: reading triggers for table \"public.dailies\"\r\npg_dump: reading triggers for table \"public.weeklies\"\r\npg_dump: reading triggers for table \"public.family_keys\"\r\npg_dump: reading triggers for table \"public.guest_keys\"\r\npg_dump: reading triggers for table \"public.fob_keys\"\r\npg_dump: reading triggers for table \"public.invitations\"\r\npg_dump: reading triggers for table \"public.command_logs\"\r\npg_dump: reading triggers for table \"public.webhook_tokens\"\r\npg_dump: reading triggers for table \"public.lock_webhook_tokens\"\r\npg_dump: reading triggers for table \"public.managers\"\r\npg_dump: reading triggers for table \"public.webhooks\"\r\npg_dump: reading triggers for table \"public.autolock_schedules\"\r\npg_dump: reading triggers for table \"public.relationships\"\r\npg_dump: reading triggers for table \"public.wenas\"\r\npg_dump: reading triggers for table \"public.wena_keys\"\r\npg_dump: reading triggers for table \"public.knights\"\r\npg_dump: reading triggers for table \"public.knight_keys\"\r\npg_dump: reading triggers for table \"public.knight_cards\"\r\npg_dump: reading triggers for table \"public.knight_pins\"\r\npg_dump: reading triggers for table \"public.knight_logs\"\r\npg_dump: reading triggers for table \"public.entrance_locks\"\r\npg_dump: reading triggers for table \"public.entrance_master_keys\"\r\npg_dump: reading triggers for table \"public.entrance_lock_settings\"\r\npg_dump: reading triggers for table \"public.entrance_knight_keys\"\r\npg_dump: reading triggers for table \"public.entrance_knight_pins\"\r\npg_dump: reading triggers for table \"public.resident_keys\"\r\npg_dump: reading triggers for table \"public.entrance_resident_keys\"\r\npg_dump: reading triggers for table \"public.entrance_invitations\"\r\npg_dump: reading triggers for table \"public.resident_guest_keys\"\r\npg_dump: reading triggers for table \"public.entrance_resident_guest_keys\"\r\npg_dump: reading triggers for table \"public.entrance_fob_keys\"\r\npg_dump: reading triggers for table \"public.mst_display_logs\"\r\npg_dump: reading triggers for table \"public.door_mode_changed_histories\"\r\npg_dump: reading triggers for table \"public.entrance_block_knight_cards\"\r\npg_dump: reading triggers for table \"public.entrance_block_fob_keys\"\r\npg_dump: reading triggers for table \"public.active_storage_blobs\"\r\npg_dump: reading triggers for table \"public.active_storage_attachments\"\r\npg_dump: reading triggers for table \"public.active_storage_variant_records\"\r\npg_dump: reading triggers for table \"public.laresia_pins\"\r\npg_dump: reading triggers for table \"bucardo.bucardo_delta_names\"\r\npg_dump: reading rewrite rules\r\npg_dump: reading policies\r\npg_dump: reading row-level security policies\r\npg_dump: reading publications\r\npg_dump: reading publication membership\r\npg_dump: reading subscriptions\r\npg_dump: reading large objects\r\npg_dump: reading dependency data\r\npg_dump: saving encoding = UTF8\r\npg_dump: saving standard_conforming_strings = on\r\npg_dump: saving search_path =\r\npg_dump: saving database definition\r\npg_dump: dumping contents of table \"bucardo.bucardo_delta_names\"\r\npg_dump: dumping contents of table \"bucardo.bucardo_delta_targets\"\r\npg_dump: dumping contents of table \"bucardo.bucardo_sequences\"\r\npg_dump: dumping contents of table \"bucardo.bucardo_truncate_trigger\"\r\npg_dump: dumping contents of table \"bucardo.bucardo_truncate_trigger_log\"\r\npg_dump: dumping contents of table \"bucardo.delta_public_display_logs\"\r\npg_dump: dumping contents of table \"bucardo.delta_public_logs\"\r\npg_dump: dumping contents of table \"bucardo.stage_public_display_logs\"\r\npg_dump: dumping contents of table \"bucardo.stage_public_logs\"\r\npg_dump: dumping contents of table \"bucardo.track_public_display_logs\"\r\npg_dump: dumping contents of table \"bucardo.track_public_logs\"\r\npg_dump: dumping contents of table \"public.active_storage_blobs\"\r\npg_dump: dumping contents of table \"public.active_storage_attachments\"\r\npg_dump: dumping contents of table \"public.active_storage_variant_records\"\r\npg_dump: dumping contents of table \"public.ar_internal_metadata\"\r\npg_dump: dumping contents of table \"public.locks\"\r\npg_dump: dumping contents of table \"public.users\"\r\npg_dump: dumping contents of table \"public.master_keys\"\r\npg_dump: dumping contents of table \"public.autolock_schedules\"\r\npg_dump: dumping contents of table \"public.hubs\"\r\npg_dump: dumping contents of table \"public.command_logs\"\r\npg_dump: dumping contents of table \"public.term_of_validities\"\r\npg_dump: dumping contents of table \"public.dailies\"\r\npg_dump: dumping contents of table \"public.delayed_jobs\"\r\npg_dump: dumping contents of table \"public.door_mode_changed_histories\"\r\npg_dump: dumping contents of table \"public.durations\"\r\npg_dump: dumping contents of table \"public.entrance_locks\"\r\npg_dump: dumping contents of table \"public.entrance_master_keys\"\r\npg_dump: dumping contents of table \"public.fobs\"\r\npg_dump: dumping contents of table \"public.fob_keys\"\r\npg_dump: dumping contents of table \"public.entrance_fob_keys\"\r\npg_dump: dumping contents of table \"public.entrance_block_fob_keys\"\r\npg_dump: dumping contents of table \"public.knights\"\r\npg_dump: dumping contents of table \"public.entrance_knight_keys\"\r\npg_dump: dumping contents of table \"public.knight_keys\"\r\npg_dump: dumping contents of table \"public.knight_cards\"\r\npg_dump: dumping contents of table \"public.entrance_block_knight_cards\"\r\npg_dump: dumping contents of table \"public.invitations\"\r\npg_dump: dumping contents of table \"public.entrance_invitations\"\r\npg_dump: dumping contents of table \"public.entrance_knight_pins\"\r\npg_dump: dumping contents of table \"public.entrance_lock_settings\"\r\npg_dump: dumping contents of table \"public.resident_guest_keys\"\r\npg_dump: dumping contents of table \"public.entrance_resident_guest_keys\"\r\npg_dump: dumping contents of table \"public.resident_keys\"\r\npg_dump: dumping contents of table \"public.entrance_resident_keys\"\r\npg_dump: dumping contents of table \"public.family_keys\"\r\npg_dump: dumping contents of table \"public.guest_keys\"\r\npg_dump: dumping contents of table \"public.json_web_keys\"\r\npg_dump: dumping contents of table \"public.knight_commands\"\r\npg_dump: dumping contents of table \"public.knight_logs\"pg_dump: dumping contents of table \"public.knight_pins\"\r\npg_dump: dumping contents of table \"public.laresia_pins\"\r\npg_dump: dumping contents of table \"public.lock_settings\"\r\npg_dump: dumping contents of table \"public.webhook_tokens\"\r\npg_dump: dumping contents of table \"public.lock_webhook_tokens\"\r\npg_dump: dumping contents of table \"public.managers\"\r\npg_dump: dumping contents of table \"public.mst_display_logs\"\r\npg_dump: dumping contents of table \"public.relationships\"\r\npg_dump: dumping contents of table \"public.schema_migrations\"\r\npg_dump: dumping contents of table \"public.webhooks\"\r\npg_dump: dumping contents of table \"public.weeklies\"\r\npg_dump: dumping contents of table \"public.wenas\"\r\npg_dump: dumping contents of table \"public.wena_keys\"\r\n```\r\n</details>\r\n\r\n## 38_logs, display_logs以外のrestore\r\n### 開始時刻\r\n4/19 1:14\r\n### 手順\r\n```\r\npg_restore --verbose --data-only -h king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com -p 5432 -d kingapi -U kingadmin main_data.dump\r\n```\r\n### 実行後\r\n\r\n<details>\r\n```\r\npg_restore --verbose --data-only -h king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com -p 5432 -d kingapi -U kingadmin main_data.dump\r\npg_restore: connecting to database for restore\r\npg_restore: processing data for table \"bucardo.bucardo_delta_names\"\r\npg_restore: while PROCESSING TOC:\r\npg_restore: from TOC entry 4966; 0 39797081 TABLE DATA bucardo_delta_names ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  schema \"bucardo\" does not exist\r\nCommand was: COPY bucardo.bucardo_delta_names (sync, tablename, deltaname, trackname, cdate) FROM stdin;\r\npg_restore: processing data for table \"bucardo.bucardo_delta_targets\"\r\npg_restore: from TOC entry 4967; 0 39797089 TABLE DATA bucardo_delta_targets ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  schema \"bucardo\" does not exist\r\nCommand was: COPY bucardo.bucardo_delta_targets (tablename, target, cdate) FROM stdin;\r\npg_restore: processing data for table \"bucardo.bucardo_sequences\"\r\npg_restore: from TOC entry 4970; 0 39797108 TABLE DATA bucardo_sequences ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  schema \"bucardo\" does not exist\r\nCommand was: COPY bucardo.bucardo_sequences (schemaname, seqname, syncname, targetname, last_value, start_value, increment_by, max_value, min_value, is_cycled, is_called) FROM stdin;\r\npg_restore: processing data for table \"bucardo.bucardo_truncate_trigger\"\r\npg_restore: from TOC entry 4968; 0 39797095 TABLE DATA bucardo_truncate_trigger ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  schema \"bucardo\" does not exist\r\nCommand was: COPY bucardo.bucardo_truncate_trigger (tablename, sname, tname, sync, replicated, cdate) FROM stdin;\r\npg_restore: processing data for table \"bucardo.bucardo_truncate_trigger_log\"\r\npg_restore: from TOC entry 4969; 0 39797102 TABLE DATA bucardo_truncate_trigger_log ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  schema \"bucardo\" does not exist\r\nCommand was: COPY bucardo.bucardo_truncate_trigger_log (tablename, sname, tname, sync, target, replicated, cdate) FROM stdin;\r\npg_restore: processing data for table \"bucardo.delta_public_display_logs\"\r\npg_restore: from TOC entry 4971; 0 39797115 TABLE DATA delta_public_display_logs ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  schema \"bucardo\" does not exist\r\nCommand was: COPY bucardo.delta_public_display_logs (id, txntime) FROM stdin;\r\npg_restore: processing data for table \"bucardo.delta_public_logs\"\r\npg_restore: from TOC entry 4974; 0 39797137 TABLE DATA delta_public_logs ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  schema \"bucardo\" does not exist\r\nCommand was: COPY bucardo.delta_public_logs (id, txntime) FROM stdin;\r\npg_restore: processing data for table \"bucardo.stage_public_display_logs\"\r\npg_restore: from TOC entry 4973; 0 39797129 TABLE DATA stage_public_display_logs ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  schema \"bucardo\" does not exist\r\nCommand was: COPY bucardo.stage_public_display_logs (txntime, target) FROM stdin;\r\npg_restore: processing data for table \"bucardo.stage_public_logs\"\r\npg_restore: from TOC entry 4976; 0 39797151 TABLE DATA stage_public_logs ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  schema \"bucardo\" does not exist\r\nCommand was: COPY bucardo.stage_public_logs (txntime, target) FROM stdin;\r\npg_restore: processing data for table \"bucardo.track_public_display_logs\"\r\npg_restore: from TOC entry 4972; 0 39797123 TABLE DATA track_public_display_logs ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  schema \"bucardo\" does not exist\r\nCommand was: COPY bucardo.track_public_display_logs (txntime, target) FROM stdin;\r\npg_restore: processing data for table \"bucardo.track_public_logs\"\r\npg_restore: from TOC entry 4975; 0 39797145 TABLE DATA track_public_logs ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  schema \"bucardo\" does not exist\r\nCommand was: COPY bucardo.track_public_logs (txntime, target) FROM stdin;\r\npg_restore: processing data for table \"public.active_storage_blobs\"\r\npg_restore: processing data for table \"public.active_storage_attachments\"\r\npg_restore: processing data for table \"public.active_storage_variant_records\"\r\npg_restore: processing data for table \"public.ar_internal_metadata\"\r\npg_restore: processing data for table \"public.locks\"\r\npg_restore: processing data for table \"public.users\"\r\npg_restore: processing data for table \"public.master_keys\"\r\npg_restore: processing data for table \"public.autolock_schedules\"\r\npg_restore: processing data for table \"public.hubs\"\r\npg_restore: processing data for table \"public.command_logs\"\r\npg_restore: processing data for table \"public.term_of_validities\"\r\npg_restore: processing data for table \"public.dailies\"\r\npg_restore: processing data for table \"public.delayed_jobs\"\r\npg_restore: processing data for table \"public.door_mode_changed_histories\"\r\npg_restore: processing data for table \"public.durations\"\r\npg_restore: processing data for table \"public.entrance_locks\"\r\npg_restore: processing data for table \"public.entrance_master_keys\"\r\npg_restore: processing data for table \"public.fobs\"\r\npg_restore: processing data for table \"public.fob_keys\"\r\npg_restore: processing data for table \"public.entrance_fob_keys\"\r\npg_restore: processing data for table \"public.entrance_block_fob_keys\"\r\npg_restore: processing data for table \"public.knights\"\r\npg_restore: processing data for table \"public.entrance_knight_keys\"\r\npg_restore: processing data for table \"public.knight_keys\"\r\npg_restore: processing data for table \"public.knight_cards\"\r\npg_restore: processing data for table \"public.entrance_block_knight_cards\"\r\npg_restore: processing data for table \"public.invitations\"\r\npg_restore: processing data for table \"public.entrance_invitations\"\r\npg_restore: processing data for table \"public.entrance_knight_pins\"\r\npg_restore: processing data for table \"public.entrance_lock_settings\"\r\npg_restore: processing data for table \"public.resident_guest_keys\"\r\npg_restore: processing data for table \"public.entrance_resident_guest_keys\"\r\npg_restore: processing data for table \"public.resident_keys\"\r\npg_restore: processing data for table \"public.entrance_resident_keys\"\r\npg_restore: processing data for table \"public.family_keys\"\r\npg_restore: processing data for table \"public.guest_keys\"\r\npg_restore: processing data for table \"public.json_web_keys\"\r\npg_restore: processing data for table \"public.knight_commands\"\r\npg_restore: processing data for table \"public.knight_logs\"pg_restore: processing data for table \"public.knight_pins\"\r\npg_restore: processing data for table \"public.laresia_pins\"\r\npg_restore: processing data for table \"public.lock_settings\"\r\npg_restore: processing data for table \"public.webhook_tokens\"\r\npg_restore: processing data for table \"public.lock_webhook_tokens\"\r\npg_restore: processing data for table \"public.managers\"\r\npg_restore: processing data for table \"public.mst_display_logs\"\r\npg_restore: processing data for table \"public.relationships\"\r\npg_restore: processing data for table \"public.schema_migrations\"\r\npg_restore: processing data for table \"public.webhooks\"\r\npg_restore: processing data for table \"public.weeklies\"\r\npg_restore: processing data for table \"public.wenas\"\r\npg_restore: processing data for table \"public.wena_keys\"\r\npg_restore: executing SEQUENCE SET active_storage_attachments_id_seq\r\npg_restore: executing SEQUENCE SET active_storage_blobs_id_seq\r\npg_restore: executing SEQUENCE SET active_storage_variant_records_id_seq\r\npg_restore: executing SEQUENCE SET delayed_jobs_id_seq\r\npg_restore: executing SEQUENCE SET json_web_keys_id_seq\r\npg_restore: warning: errors ignored on restore: 11\r\n```\r\n</details>\r\n\r\nエラー数11がbucardoスキーマに関する内容なので問題なし\r\n## 40_bucardo流し込み(logs, display_logs)\r\n### 開始時刻\r\n4/19 1:49\r\n### 手順\r\n```\r\nbucardo start\r\n```\r\n### 実行後\r\n```\r\nbucardo start\r\nChecking for existing processes\r\nStarting Bucardo\r\n# bucardo status sync_heroku_aws\r\n======================================================================\r\nSync name                : sync_heroku_aws\r\nCurrent state            : Get deltas from db heroku_db\r\nSource relgroup/database : herd_heroku_db / heroku_db\r\nTables in sync           : 2\r\nStatus                   : Active\r\nCheck time               : None\r\nOverdue time             : 00:00:00\r\nExpired time             : 00:00:00\r\nStayalive/Kidsalive      : Yes / Yes\r\nRebuild index            : No\r\nAutokick                 : Yes\r\nOnetimecopy              : No\r\nPost-copy analyze        : Yes\r\nLast error:              :\r\n======================================================================\r\n\r\nbucardo status sync_heroku_aws\r\n======================================================================\r\nSync name                : sync_heroku_aws\r\nCurrent state            : Deleting based on heroku_db.public.logs\r\nSource relgroup/database : herd_heroku_db / heroku_db\r\nTables in sync           : 2\r\nStatus                   : Active\r\nCheck time               : None\r\nOverdue time             : 00:00:00\r\nExpired time             : 00:00:00\r\nStayalive/Kidsalive      : Yes / Yes\r\nRebuild index            : No\r\nAutokick                 : Yes\r\nOnetimecopy              : No\r\nPost-copy analyze        : Yes\r\nLast error:              :\r\n======================================================================\r\n\r\nbucardo status sync_heroku_aws\r\n======================================================================\r\nSync name                : sync_heroku_aws\r\nCurrent state            : Copying from heroku_db.public.logs\r\nSource relgroup/database : herd_heroku_db / heroku_db\r\nTables in sync           : 2\r\nStatus                   : Active\r\nCheck time               : None\r\nOverdue time             : 00:00:00\r\nExpired time             : 00:00:00\r\nStayalive/Kidsalive      : Yes / Yes\r\nRebuild index            : No\r\nAutokick                 : Yes\r\nOnetimecopy              : No\r\nPost-copy analyze        : Yes\r\nLast error:              :\r\n======================================================================\r\n2:48頃\r\nbucardo status sync_heroku_aws\r\n======================================================================\r\nSync name                : sync_heroku_aws\r\nCurrent state            : Deleting based on heroku_db.public.display_logs\r\nSource relgroup/database : herd_heroku_db / heroku_db\r\nTables in sync           : 2\r\nStatus                   : Active\r\nCheck time               : None\r\nOverdue time             : 00:00:00\r\nExpired time             : 00:00:00\r\nStayalive/Kidsalive      : Yes / Yes\r\nRebuild index            : No\r\nAutokick                 : Yes\r\nOnetimecopy              : No\r\nPost-copy analyze        : Yes\r\nLast error:              :\r\n======================================================================\r\n\r\n```\r\n\r\n```\r\ntail -F /var/log/bucardo/log.bucardo\r\n(4672) [Tue Apr 18 16:49:11 2023] VAC New VAC daemon. PID=4672\r\n(4672) [Tue Apr 18 16:49:11 2023] VAC Connected to database \"heroku_db\" with backend PID of 257387\r\n(4670) [Tue Apr 18 16:49:11 2023] MCP Created VAC 4672\r\n(4674) [Tue Apr 18 16:49:12 2023] CTL New controller for sync \"sync_heroku_aws\". Relgroup is \"herd_heroku_db\", dbs is \"dbs\". PID=4674\r\n(4674) [Tue Apr 18 16:49:12 2023] CTL   stayalive: 1 checksecs: 0 kicked: 1\r\n(4674) [Tue Apr 18 16:49:12 2023] CTL   kidsalive: 1 onetimecopy: 0 lifetimesecs: 0 (NULL) maxkicks: 0\r\n(4674) [Tue Apr 18 16:49:12 2023] CTL Database \"aws_db\" backend PID: 63600\r\n(4670) [Tue Apr 18 16:49:12 2023] MCP Created controller 4674 for sync \"sync_heroku_aws\". Kick is 1\r\n(4674) [Tue Apr 18 16:49:12 2023] CTL Database \"heroku_db\" backend PID: 257388\r\n(4676) [Tue Apr 18 16:49:12 2023] KID (sync_heroku_aws) New kid, sync \"sync_heroku_aws\" alive=1 Parent=4674 PID=4676 kicked=1\r\n\r\n2:50\r\nbucardo status sync_heroku_aws\r\n======================================================================\r\nSync name                : sync_heroku_aws\r\nCurrent state            : Copying from heroku_db.public.display_logs\r\nSource relgroup/database : herd_heroku_db / heroku_db\r\nTables in sync           : 2\r\nStatus                   : Active\r\nCheck time               : None\r\nOverdue time             : 00:00:00\r\nExpired time             : 00:00:00\r\nStayalive/Kidsalive      : Yes / Yes\r\nRebuild index            : No\r\nAutokick                 : Yes\r\nOnetimecopy              : No\r\nPost-copy analyze        : Yes\r\nLast error:              :\r\n======================================================================\r\n\r\n\r\n```\r\n\r\n## 43_同期確認チェック\r\n### 開始時刻\r\n4/19 3:08\r\n### 手順\r\n```\r\nbucardo status sync_heroku_aws\r\n```\r\nエラー(Last Error)がないか確認する。\r\n### 実行後\r\n```\r\nbucardo status sync_heroku_aws\r\n======================================================================\r\nLast good                : Apr 18, 2023 16:49:12 (time to run: 1h 18m 43s)\r\nRows deleted/inserted    : 758,129 / 5,968,028\r\nSync name                : sync_heroku_aws\r\nCurrent state            : Good\r\nSource relgroup/database : herd_heroku_db / heroku_db\r\nTables in sync           : 2\r\nStatus                   : Active\r\nCheck time               : None\r\nOverdue time             : 00:00:00\r\nExpired time             : 00:00:00\r\nStayalive/Kidsalive      : Yes / Yes\r\nRebuild index            : No\r\nAutokick                 : Yes\r\nOnetimecopy              : No\r\nPost-copy analyze        : Yes\r\nLast error:              :\r\n======================================================================\r\n```\r\n## 44_レコード差分チェック\r\n### 開始時刻\r\n4/19 3:10\r\n### 手順\r\n```\r\nbash count.sh\r\n```\r\nhttps://qrio.esa.io/posts/1629 に貼り付け→確認\r\n### 実行後\r\nhttps://qrio.esa.io/posts/1629\r\n\r\n全チェックOK\r\n\r\n## 45_データ差分残し\r\n### 開始時刻\r\n4/19 3:17~3:30\r\n### 手順\r\n```\r\nbash data_bk.sh\r\n```\r\n\r\n## 46_EC2上のdocker内で収集したcsvデータのDL\r\n### 開始時刻\r\n4/19 \r\n### 手順\r\n```\r\nscp -r -i \"king-api-production-bucardo-ec2.pem\" ubuntu@ec2-52-197-147-182.ap-northeast-1.compute.amazonaws.com:/home/ubuntu/data_bk .\r\ndisplay_logs_heroku.csv                                100%  289MB  55.9MB/s   00:05\r\nlogs_heroku.csv                                        100%  838MB  54.1MB/s   00:15\r\nlogs_aws.csv                                           100%  837MB  52.4MB/s   00:15\r\ndisplay_logs_aws.csv                                   100%  289MB  56.1MB/s   00:05\r\n```\r\n\r\n### 実行後\r\n```\r\nCopying from container - 2.362GB\r\nSuccessfully copied 2.362GB to /home/ubuntu/.\r\n\r\n\r\n```\r\n## 48_同期確認後完了\r\n### 開始時刻\r\n4/19 3:35\r\n### 手順\r\n```\r\nbucardo stop\r\n```\r\n### 実行後\r\n```\r\nbucardo stop\r\nCreating /var/run/bucardo/fullstopbucardo ... Done\r\n```\r\n\r\n## 49_DBインスタンスタイプ戻し\r\n### 開始時刻\r\n4/19 \r\n### 手順\r\n```\r\ndb.r5.24xlarge→db.r5.2xlarge(ライターに実行→フェイルオーバーでインスタンス入れ替え)\r\n```\r\n### 実行後\r\n<img width=\"1508\" alt=\"スクリーンショット 2023-04-19 3.37.21.png (88.0 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/19/136273/4fc8bb9b-9284-41eb-8af8-2330063056b9.png\">\r\n<img width=\"1486\" alt=\"スクリーンショット 2023-04-19 3.38.17.png (52.5 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/19/136273/3803eac8-3dc2-42eb-a48d-e402cb0db2eb.png\">\r\n<img width=\"1486\" alt=\"スクリーンショット 2023-04-19 3.38.17.png (52.5 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/19/136273/dd611c19-a450-4f1f-acfa-3b29f1781667.png\">\r\n<img width=\"1500\" alt=\"スクリーンショット 2023-04-19 3.49.12.png (66.1 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/19/136273/2f1c0ad0-7ba0-4e66-9f78-d8d05d8d8df8.png\">\r\n\r\n\r\n\r\n## 53_DB向き先切り替えking\r\n### 開始時刻\r\n4/19 3:50〜4:01\r\n\r\n### 手順\r\n```\r\n# DBの向き先切り替え\r\nheroku addons:attach postgresql-objective-43050 --as OLD_DATABASE -a sl2-api-production\r\nheroku addons:detach DATABASE_URL -a sl2-api-production\r\nheroku config:set DATABASE_URL=postgres://kingadmin:m3hkFJq4gkRVAZvY5Z1FkT7LeKtnjJSl@king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com:5432/kingapi -a sl2-api-production\r\nheroku config:set FOLLOWER_DATABASE_URL=postgres://kingadmin:m3hkFJq4gkRVAZvY5Z1FkT7LeKtnjJSl@king-api-production.cluster-ro-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com:5432/kingapi -a sl2-api-production\r\n\r\n# 内部DB疎通確認\r\nheroku run rails c -a sl2-api-production --size=private-s\r\n\r\nActiveRecord::Base.connection_db_config\r\n\r\nLock.find('b6b91bcf-80a7-77b3-0d4a-2479f77e7957')\r\n```\r\n### 実行後\r\n```\r\nheroku addons:attach postgresql-objective-43050 --as OLD_DATABASE -a sl2-api-production\r\nAttaching postgresql-objective-43050 as OLD_DATABASE to ⬢ sl2-api-production... done\r\nSetting OLD_DATABASE config vars and restarting ⬢ sl2-api-production... done, v712\r\n\r\nheroku addons:detach DATABASE_URL -a sl2-api-production\r\nDetaching DATABASE to postgresql-objective-43050 from ⬢ sl2-api-production... done\r\nUnsetting DATABASE config vars and restarting ⬢ sl2-api-production... done, v713\r\n\r\nheroku config:set DATABASE_URL=postgres://kingadmin:m3hkFJq4gkRVAZvY5Z1FkT7LeKtnjJSl@king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com:5432/kingapi -a sl2-api-production\r\nSetting DATABASE_URL and restarting ⬢ sl2-api-production... done, v714\r\n ▸    Release command executing: this config change will\r\n ▸    not be available until the command succeeds. Use\r\n ▸    `heroku releases:output` to view the log.\r\nDATABASE_URL: postgres://kingadmin:m3hkFJq4gkRVAZvY5Z1FkT7LeKtnjJSl@king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com:5432/kingapi\r\n\r\nheroku config:set FOLLOWER_DATABASE_URL=postgres://kingadmin:m3hkFJq4gkRVAZvY5Z1FkT7LeKtnjJSl@king-api-production.cluster-ro-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com:5432/kingapi -a sl2-api-production\r\nSetting FOLLOWER_DATABASE_URL and restarting ⬢ sl2-api-production... done, v715\r\n ▸    Release command executing: this config change will\r\n ▸    not be available until the command succeeds. Use\r\n ▸    `heroku releases:output` to view the log.\r\nFOLLOWER_DATABASE_URL: postgres://kingadmin:m3hkFJq4gkRVAZvY5Z1FkT7LeKtnjJSl@king-api-production.cluster-ro-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com:5432/kingapi\r\n\r\nheroku run rails c -a sl2-api-production --size=private-s\r\nRunning rails c on ⬢ sl2-api-production... up, run.1620 (Private-S)\r\n[Scout] [04/18/23 19:00:21 +0000 run.1620 (11)] INFO : No configuration file loaded, and no configuration found in ENV. For assistance configuring Scout, visit https://docs.scoutapm.com/#ruby-configuration-options\r\n[Scout] [04/18/23 19:00:21 +0000 run.1620 (11)] INFO : Scout Agent [5.1.1] Initialized\r\n[Scout] [04/18/23 19:00:21 +0000 run.1620 (11)] INFO : Not Loading Instruments\r\n[Scout] [04/18/23 19:00:21 +0000 run.1620 (11)] INFO : Scout Agent [5.1.1] Installed\r\n[Scout] [04/18/23 19:00:21 +0000 run.1620 (11)] INFO : Monitoring isn't enabled for the [production] environment.\r\n[Scout] [04/18/23 19:00:21 +0000 run.1620 (11)] INFO : Agent attempting to load in interactive mode.\r\n[Scout] [04/18/23 19:00:21 +0000 run.1620 (11)] INFO : Deferring agent start. Standing by for first request\r\nLoading production environment (Rails 7.0.2.4)\r\nirb(main):001:0> ActiveRecord::Base.connection_db_con\r\nfig\r\n=> \r\n#<ActiveRecord::DatabaseConfigurations::UrlConfig:0x00007f2ace632298\r\n @configuration_hash=\r\n  {:adapter=>\"postgresql\",\r\n   :encoding=>\"unicode\",\r\n   :pool=>51,\r\n   :host=>\r\n    \"king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com\",\r\n   :port=>5432,\r\n   :username=>\"kingadmin\",\r\n   :variables=>{\"statement_timeout\"=>300000},\r\n   :database=>\"kingapi\",\r\n   :password=>\"m3hkFJq4gkRVAZvY5Z1FkT7LeKtnjJSl\"},\r\n @env_name=\"production\",\r\n @name=\"primary\",\r\n @url=\r\n  \"postgres://kingadmin:m3hkFJq4gkRVAZvY5Z1FkT7LeKtnjJSl@king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com:5432/kingapi\">\r\nirb(main):002:0> Lock.find('b6b91bcf-80a7-77b3-0d4a-2\r\n479f77e7957')\r\n=> \r\n#<Lock:0x00007f2acdbcfc38\r\n id: \"b6b91bcf-80a7-77b3-0d4a-2479f77e7957\",\r\n serial_no: \"1064127\",\r\n bd_address: \"70:26:05:D3:FA:62\",\r\n fw_version: \"3.0.2\",\r\n key_seed:\r\n  \"f2d44d1e5c23d932649e1ec1aa55474768089634c1a6ca98e1e6b6646c917241\",\r\n nonce: \"474dc4c26bc4b09d8f4e8bf35497d700\",\r\n enable_sound: true,\r\n enable_autolock: true,\r\n enable_autolock_sound: false,\r\n battery_a: 5,\r\n battery_b: 0,\r\n created_at:\r\n  Tue, 05 Jun 2018 00:00:00.000000000 UTC +00:00,\r\n updated_at:\r\n  Thu, 13 Apr 2023 00:38:04.783963000 UTC +00:00,\r\n beacon_interval: 10,\r\n model_id: 1>\r\n```\r\n## 54_sirius\r\n### 開始時刻\r\n### 手順\r\n```\r\n\"# DBの向き先切り替え\r\nheroku config:set KING_DATABASE_URL=postgres://kingadmin:m3hkFJq4gkRVAZvY5Z1FkT7LeKtnjJSl@king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com:5432/kingapi -a sirius-api-production\r\n\r\n# 内部DB疎通確認\r\nheroku run --size=private-s --app=sirius-api-production bash\r\n\r\nrails c --no-sandbox\r\nActiveRecord::Base.connection_db_config\r\nLock.connection_db_config\r\nLock.find('b6b91bcf-80a7-77b3-0d4a-2479f77e7957')\"\r\n```\r\n### 実行後\r\n```\r\nheroku config:set KING_DATABASE_URL=postgres://kingadmin:m3hkFJq4gkRVAZvY5Z1FkT7LeKtnjJSl@king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com:5432/kingapi -a sirius-api-production\r\nSetting KING_DATABASE_URL and restarting ⬢ sirius-api-production... done, v326\r\n ▸    Release command executing: this config change will not be available\r\n ▸    until the command succeeds. Use `heroku releases:output` to view the\r\n ▸    log.\r\nKING_DATABASE_URL: postgres://kingadmin:m3hkFJq4gkRVAZvY5Z1FkT7LeKtnjJSl@king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com:5432/kingapi\r\n\r\nheroku run --size=private-s --app=sirius-api-production bash     4:02:53\r\nRunning bash on ⬢ sirius-api-production... up, run.8213 (Private-S)\r\n^@^@~ $ rails c --sandbox\r\n[DEPRECATION] Committee: please set query_hash_key = rack.request.query_hash because we'll change default value in next major version.\r\n[DEPRECATION] Committee: please set query_hash_key = rack.request.query_hash because we'll change default value in next major version.\r\n[DEPRECATION] Committee: Committee::Middleware::ResponseValidation doesn't support strict option now but we'll support this option. This change break backward compatibility so please remove strict option from ResponseValidation\r\n[DEPRECATION] Committee: please set parse_response_by_content_type = false because we'll change default value in next major version.\r\n[DEPRECATION] Committee: please set parse_response_by_content_type = false because we'll change default value in next major version.\r\nW, [2023-04-18T19:08:27.502528 #56]  WARN -- : Creating scope :of_name. Overwriting existing method Group.of_name.\r\nW, [2023-04-18T19:08:27.534588 #56]  WARN -- : Creating scope :exit. Overwriting existing method Knight.exit.\r\nW, [2023-04-18T19:08:27.549037 #56]  WARN -- : Creating scope :open. Overwriting existing method Log.open.\r\nW, [2023-04-18T19:08:27.553262 #56]  WARN -- : Creating scope :of_name. Overwriting existing method Manager.of_name.\r\nLoading production environment in sandbox (Rails 6.1.4)\r\nAny modifications you make will be rolled back on exit\r\nirb(main):001:0> ActiveRecord::Base.connection_db_config\r\n=> #<ActiveRecord::DatabaseConfigurations::UrlConfig:0x00005598446cdbf8 @env_name=\"production\", @name=\"primary\", @configuration_hash={:adapter=>\"postgresql\", :encoding=>\"unicode\", :pool=>5, :timeout=>5000, :host=>\"ec2-54-249-222-140.ap-northeast-1.compute.amazonaws.com\", :username=>\"u9c4jt4mc7cito\", :port=>5432, :database=>\"d4n1pdive53kt6\", :password=>\"p5b62d81083f00dff63087996bb60f87a827999ee0c730f1e4363ffa0e37a404f\"}, @url=\"postgres://u9c4jt4mc7cito:p5b62d81083f00dff63087996bb60f87a827999ee0c730f1e4363ffa0e37a404f@ec2-54-249-222-140.ap-northeast-1.compute.amazonaws.com:5432/d4n1pdive53kt6\">\r\nirb(main):002:0> Lock.connection_db_config\r\n=> #<ActiveRecord::DatabaseConfigurations::UrlConfig:0x00005598446cc028 @env_name=\"production\", @name=\"king\", @configuration_hash={:adapter=>\"postgresql\", :encoding=>\"unicode\", :pool=>5, :timeout=>5000, :host=>\"king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com\", :username=>\"kingadmin\", :port=>5432, :database=>\"kingapi\", :password=>\"m3hkFJq4gkRVAZvY5Z1FkT7LeKtnjJSl\"}, @url=\"postgres://kingadmin:m3hkFJq4gkRVAZvY5Z1FkT7LeKtnjJSl@king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com:5432/kingapi\">\r\nirb(main):003:0> Lock.find('b6b91bcf-80a7-77b3-0d4a-2479f77e7957')\r\n=> #<Lock id: \"b6b91bcf-80a7-77b3-0d4a-2479f77e7957\", serial_no: \"1064127\", bd_address: \"70:26:05:D3:FA:62\", fw_version: \"3.0.2\", key_seed: \"f2d44d1e5c23d932649e1ec1aa55474768089634c1a6ca98e1...\", nonce: \"474dc4c26bc4b09d8f4e8bf35497d700\", enable_sound: true, enable_autolock: true, enable_autolock_sound: false, battery_a: 5, battery_b: 0, created_at: \"2018-06-05 00:00:00.000000000 +0000\", updated_at: \"2023-04-13 00:38:04.783963000 +0000\", beacon_interval: 10, model_id: 1>\r\n```\r\n\r\n## 55_roomon\r\n### 開始時刻\r\n### 手順\r\n```\r\n# DBの向き先切り替え\r\nheroku config:set KING_DATABASE_URL=postgres://kingadmin:m3hkFJq4gkRVAZvY5Z1FkT7LeKtnjJSl@king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com:5432/kingapi -a roomon-api-production\r\n\r\n# 内部DB疎通確認\r\n→ メンテ開けで確認\r\n```\r\n### 実行後\r\n```\r\nheroku config:set KING_DATABASE_URL=postgres://kingadmin:m3hkFJq4gkRVAZvY5Z1FkT7LeKtnjJSl@king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com:5432/kingapi -a roomon-api-production\r\nSetting KING_DATABASE_URL and restarting ⬢ roomon-api-production... done, v132\r\nKING_DATABASE_URL: postgres://kingadmin:m3hkFJq4gkRVAZvY5Z1FkT7LeKtnjJSl@king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com:5432/kingapi\r\n```\r\n\r\n## メンテ明け 1.sirius-api-production\r\n### 実行後\r\n```\r\n# sugiyamasatoshi @ sugiyamasatoshinoMacBook-Pro in ~ [4:16:49]\r\n$ heroku ps:scale web=2 -a sirius-api-production\r\nScaling dynos... done, now running web at 2:Private-S\r\n\r\n# sugiyamasatoshi @ sugiyamasatoshinoMacBook-Pro in ~ [4:17:22]\r\n$ heroku ps:scale worker=1 -a sirius-api-production\r\nScaling dynos... done, now running worker at 1:Private-S\r\n\r\n# sugiyamasatoshi @ sugiyamasatoshinoMacBook-Pro in ~ [4:17:35]\r\n$ heroku maintenance:off -a sirius-api-production\r\nDisabling maintenance mode for ⬢ sirius-api-production... done\r\n\r\nheroku apps:info -a sirius-api-production  4:17:44\r\n\r\n=== sirius-api-production\r\nAddons:         heroku-postgresql:private-0\r\n                heroku-redis:premium-1\r\n                newrelic:wayne\r\n                papertrail:fixa\r\n                scheduler:standard\r\nAuto Cert Mgmt: true\r\nCollaborators:  takuya.ishida@qrioinc.com\r\nDynos:          web: 2, worker: 1\r\nGit URL:        https://git.heroku.com/sirius-api-production.git\r\nOwner:          qrioinc@herokumanager.com\r\nPipeline:       sirius-api - production\r\nRegion:         tokyo\r\nRepo Size:      982 KB\r\nSlug Size:      43 MB\r\nSpace:          king\r\nStack:          heroku-20\r\nWeb URL:        https://sirius-api-production.herokuapp.com/\r\n```\r\n\r\n## メンテ明け 2.king-api-production\r\n### 実行後\r\n```\r\nheroku apps:info -a sl2-api-production     4:21:51\r\n=== sl2-api-production\r\nAddons:         advanced-scheduler:hobby\r\n                heroku-postgresql:private-5\r\n                heroku-postgresql:standard-5\r\n                heroku-redis:premium-5\r\n                newrelic:hawke\r\n                papertrail:fredrik\r\n                redismonitor:free\r\n                scheduler:standard\r\nAuto Cert Mgmt: true\r\nCollaborators:  kazuyoshi.kawakami@qrioinc.com\r\nDynos:\r\nGit URL:        https://git.heroku.com/sl2-api-production.git\r\nOwner:          qrioinc@herokumanager.com\r\nPipeline:       king-api - production\r\nRegion:         tokyo\r\nRepo Size:      0 B\r\nSlug Size:      91 MB\r\nSpace:          king\r\nStack:          heroku-22\r\nWeb URL:        https://sl2-api-production.herokuapp.com/\r\n\r\n# sugiyamasatoshi @ sugiyamasatoshinoMacBook-Pro in ~ [4:22:41]\r\n$ heroku ps:scale web=4 -a sl2-api-production\r\nScaling dynos... done, now running web at 4:Private-M\r\n\r\n# sugiyamasatoshi @ sugiyamasatoshinoMacBook-Pro in ~ [4:22:56]\r\n$ heroku ps:scale worker=2 -a sl2-api-production\r\nScaling dynos... done, now running worker at 2:Private-S\r\n\r\n# sugiyamasatoshi @ sugiyamasatoshinoMacBook-Pro in ~ [4:23:05]\r\n$ heroku apps:info -a sl2-api-production     4:23:05\r\n=== sl2-api-production\r\nAddons:         advanced-scheduler:hobby\r\n                heroku-postgresql:private-5\r\n                heroku-postgresql:standard-5\r\n                heroku-redis:premium-5\r\n                newrelic:hawke\r\n                papertrail:fredrik\r\n                redismonitor:free\r\n                scheduler:standard\r\nAuto Cert Mgmt: true\r\nCollaborators:  kazuyoshi.kawakami@qrioinc.com\r\nDynos:          web: 4, worker: 2\r\nGit URL:        https://git.heroku.com/sl2-api-production.git\r\nOwner:          qrioinc@herokumanager.com\r\nPipeline:       king-api - production\r\nRegion:         tokyo\r\nRepo Size:      0 B\r\nSlug Size:      91 MB\r\nSpace:          king\r\nStack:          heroku-22\r\nWeb URL:        https://sl2-api-production.herokuapp.com/\r\n\r\nheroku maintenance:off -a sl2-api-production                                4:25:36\r\nDisabling maintenance mode for ⬢ sl2-api-production... done\r\n```\r\n\r\n\r\n## メンテ明け 3.roomon-api-production\r\n### 実行後\r\n```\r\nheroku apps:info -a roomon-api-production          4:27:23\r\n=== roomon-api-production\r\nAddons:         heroku-postgresql:private-0\r\n                newrelic:hawke\r\n                papertrail:fixa\r\n                scheduler:standard\r\nAuto Cert Mgmt: true\r\nDynos:\r\nGit URL:        https://git.heroku.com/roomon-api-production.git\r\nOwner:          qrioinc@herokumanager.com\r\nPipeline:       roomon-api - production\r\nRegion:         tokyo\r\nRepo Size:      42 MB\r\nSlug Size:      78 MB\r\nSpace:          king\r\nStack:          heroku-22\r\nWeb URL:        https://roomon-api-production.herokuapp.com/\r\n\r\nheroku ps:scale web=2 -a roomon-api-production     4:28:38\r\nScaling dynos... done, now running web at 2:Private-M\r\n\r\nheroku maintenance:off -a roomon-api-production    4:27:23\r\nDisabling maintenance mode for ⬢ roomon-api-production... done\r\n```\r\n\r\n## メンテ明け customer-support-api-prod\r\n```\r\nheroku config:set KING_DATABASE_URL=postgres://kingadmin:m3hkFJq4gkRVAZvY5Z1FkT7LeKtnjJSl@king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com:5432/kingapi -a customer-support-api-prod\r\nSetting KING_DATABASE_URL and restarting ⬢ customer-support-api-prod... done, v34\r\nKING_DATABASE_URL: postgres://kingadmin:m3hkFJq4gkRVAZvY5Z1FkT7LeKtnjJSl@king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com:5432/kingapi\r\n\r\nheroku apps:info -a customer-support-api-prod      4:41:01\r\n=== customer-support-api-prod\r\nAuto Cert Mgmt: false\r\nDynos:\r\nGit URL:        https://git.heroku.com/customer-support-api-prod.git\r\nOwner:          qrioinc@herokumanager.com\r\nPipeline:       customer-support-api - production\r\nRegion:         tokyo\r\nRepo Size:      302 KB\r\nSlug Size:      63 MB\r\nSpace:          king\r\nStack:          heroku-22\r\nWeb URL:        https://customer-support-api-prod.herokuapp.com/\r\n\r\nheroku ps:scale web=1 -a customer-support-api-prod 4:42:35\r\nScaling dynos... done, now running web at 1:Private-M\r\n\r\n# sugiyamasatoshi @ sugiyamasatoshinoMacBook-Pro in ~ [4:42:58]\r\n$ heroku maintenance:off -a customer-support-api-prod\r\nDisabling maintenance mode for ⬢ customer-support-api-prod... done\r\n\r\n# sugiyamasatoshi @ sugiyamasatoshinoMacBook-Pro in ~ [4:43:07]\r\n$ heroku apps:info -a customer-support-api-prod      4:43:07\r\n=== customer-support-api-prod\r\nAuto Cert Mgmt: false\r\nDynos:          web: 1\r\nGit URL:        https://git.heroku.com/customer-support-api-prod.git\r\nOwner:          qrioinc@herokumanager.com\r\nPipeline:       customer-support-api - production\r\nRegion:         tokyo\r\nRepo Size:      302 KB\r\nSlug Size:      63 MB\r\nSpace:          king\r\nStack:          heroku-22\r\nWeb URL:        https://customer-support-api-prod.herokuapp.com/\r\n\r\n```\r\n\r\n## メンテ明け prod-king-ope\r\n```\r\nheroku config:set DATABASE_URL=postgres://kingadmin:m3hkFJq4gkRVAZvY5Z1FkT7LeKtnjJSl@king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com:5432/kingapi DATABASE_HOSTNAME=king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com DATABASE_NAME=kingapi DATABASE_USERNAME=kingadmin DATABASE_PASSWORD=m3hkFJq4gkRVAZvY5Z1FkT7LeKtnjJSl -a prod-king-ope\r\nSetting DATABASE_URL, DATABASE_HOSTNAME, DATABASE_NAME, DATABASE_USERNAME, DATABASE_PASSWORD and restarting ⬢ prod-king-ope... done, v175\r\nDATABASE_HOSTNAME: king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com\r\nDATABASE_NAME:     kingapi\r\nDATABASE_PASSWORD: m3hkFJq4gkRVAZvY5Z1FkT7LeKtnjJSl\r\nDATABASE_URL:      postgres://kingadmin:m3hkFJq4gkRVAZvY5Z1FkT7LeKtnjJSl@king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com:5432/kingapi\r\nDATABASE_USERNAME: kingadmin\r\n\r\nheroku apps:info -a prod-king-ope                  4:45:03\r\n=== prod-king-ope\r\nAddons:         papertrail:choklad\r\n                process-scheduler:pet-project\r\nAuto Cert Mgmt: true\r\nDynos:\r\nGit URL:        https://git.heroku.com/prod-king-ope.git\r\nOwner:          qrioinc@herokumanager.com\r\nPipeline:       king-ope - production\r\nRegion:         tokyo\r\nRepo Size:      0 B\r\nSlug Size:      109 MB\r\nSpace:          king\r\nStack:          heroku-22\r\nWeb URL:        https://prod-king-ope.herokuapp.com/\r\n\r\nheroku apps:info -a prod-king-ope                  4:45:03\r\n=== prod-king-ope\r\nAddons:         papertrail:choklad\r\n                process-scheduler:pet-project\r\nAuto Cert Mgmt: true\r\nDynos:\r\nGit URL:        https://git.heroku.com/prod-king-ope.git\r\nOwner:          qrioinc@herokumanager.com\r\nPipeline:       king-ope - production\r\nRegion:         tokyo\r\nRepo Size:      0 B\r\nSlug Size:      109 MB\r\nSpace:          king\r\nStack:          heroku-22\r\nWeb URL:        https://prod-king-ope.herokuapp.com/\r\n\r\n# sugiyamasatoshi @ sugiyamasatoshinoMacBook-Pro in ~ [4:45:14]\r\n$ heroku ps:scale web=1 -a prod-king-ope             4:45:14\r\nScaling dynos... done, now running web at 1:Private-S\r\n\r\n# sugiyamasatoshi @ sugiyamasatoshinoMacBook-Pro in ~ [4:45:35]\r\n$ heroku maintenance:off -a prod-king-ope            4:45:35\r\nDisabling maintenance mode for ⬢ prod-king-ope... done\r\n\r\n# sugiyamasatoshi @ sugiyamasatoshinoMacBook-Pro in ~ [4:45:43]\r\n$ heroku apps:info -a prod-king-ope                  4:45:43\r\n=== prod-king-ope\r\nAddons:         papertrail:choklad\r\n                process-scheduler:pet-project\r\nAuto Cert Mgmt: true\r\nDynos:          web: 1\r\nGit URL:        https://git.heroku.com/prod-king-ope.git\r\nOwner:          qrioinc@herokumanager.com\r\nPipeline:       king-ope - production\r\nRegion:         tokyo\r\nRepo Size:      0 B\r\nSlug Size:      109 MB\r\nSpace:          king\r\nStack:          heroku-22\r\nWeb URL:        https://prod-king-ope.herokuapp.com/\r\n```\r\n\r\n## redash接続\r\n\r\n```\r\nRedashのVPCとAuroraのVPCをピアリングする\r\n双方のVPCのルートテーブルにDestinationを相手側のVPC CIDR、ターゲットに作成したピアリング接続を指定する\r\nAuroraのセキュリティグループをredash CIDRから許可する\r\nredashのQ-SL2とsl2-followerの接続情報を変更する\r\n```\r\n## 反省点\r\n\r\n- Auroraにmain_dataをrestoreする際にbucardoスキーマを除外してdumpしておけばエラーが出ることはない(既知のエラーなので不要)\r\n- main_dataのrestoreに想定より時間がかかっている\r\n    - --jobs=8などの指定がなかった(logsとdisplay_logsはjobs指定で速度が上がった実績あり)",
    "body_html": "<h2 data-sourcepos=\"1:1-1:9\" id=\"0-1-0\" name=\"0-1-0\"><a class=\"anchor\" id=\"前作\" name=\"前作\" href=\"#前作\" data-position=\"0-1-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"前作\"> &gt; 前作</span></a>前作</h2>\n<p data-sourcepos=\"3:1-4:30\">production-aurora作成実施履歴<br>\n<a href=\"https://qrio.esa.io/posts/1626\">https://qrio.esa.io/posts/1626</a></p>\n<p data-sourcepos=\"6:1-6:27\">本稿は↑の続きです</p>\n<h2 data-sourcepos=\"8:1-8:12\" id=\"0-2-0\" name=\"0-2-0\"><a class=\"anchor\" id=\"手順書\" name=\"手順書\" href=\"#手順書\" data-position=\"0-2-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"手順書\"> &gt; 手順書</span></a>手順書</h2>\n<p data-sourcepos=\"10:1-10:103\"><a href=\"https://docs.google.com/spreadsheets/d/1W3DymCJ_ifiXtSUwVAjcl9tzPGfz5WE6bmnnwYL9Gbo/edit#gid=1297114524\" target=\"_blank\" rel=\"noopener noreferrer\">https://docs.google.com/spreadsheets/d/1W3DymCJ_ifiXtSUwVAjcl9tzPGfz5WE6bmnnwYL9Gbo/edit#gid=1297114524</a></p>\n<h2 data-sourcepos=\"12:1-12:104\" id=\"0-3-0\" name=\"0-3-0\"><a class=\"anchor\" id=\"EC2-dockerコンテナでのプロセスの初期状態(pg_dumpとpg_restore実行終了の確認用)\" name=\"EC2-dockerコンテナでのプロセスの初期状態(pg_dumpとpg_restore実行終了の確認用)\" href=\"#EC2-dockerコンテナでのプロセスの初期状態(pg_dumpとpg_restore実行終了の確認用)\" data-position=\"0-3-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"EC2-dockerコンテナでのプロセスの初期状態(pg_dumpとpg_restore実行終了の確認用)\"> &gt; EC2-dockerコンテナでのプロセスの初期状態(pg_dumpとpg_restore実行終了の確認用)</span></a>EC2-dockerコンテナでのプロセスの初期状態(pg_dumpとpg_restore実行終了の確認用)</h2>\n<h3 data-sourcepos=\"13:1-13:20\" id=\"0-3-1\" name=\"0-3-1\"><a class=\"anchor\" id=\"psqlコマンド\" name=\"psqlコマンド\" href=\"#psqlコマンド\" data-position=\"0-3-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"psqlコマンド\"> &gt; psqlコマンド</span></a>psqlコマンド</h3>\n<h4 data-sourcepos=\"14:1-14:17\">dump(Heroku)</h4>\n<div class=\"code-block\" data-sourcepos=\"15:1-17:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sql</div><div class=\"highlight\"><pre class=\"highlight sql\"><code><span class=\"n\">psql</span> <span class=\"o\">-</span><span class=\"n\">p</span> <span class=\"mi\">5432</span> <span class=\"o\">-</span><span class=\"n\">U</span> <span class=\"n\">ubev937lfpa1d3</span> <span class=\"o\">-</span><span class=\"n\">d</span> <span class=\"n\">dncvsso7me9p6</span> <span class=\"o\">-</span><span class=\"n\">h</span> <span class=\"n\">vpce</span><span class=\"o\">-</span><span class=\"mi\">0</span><span class=\"n\">bed708f6ce21788a</span><span class=\"o\">-</span><span class=\"n\">f4tmby1p</span><span class=\"p\">.</span><span class=\"n\">vpce</span><span class=\"o\">-</span><span class=\"n\">svc</span><span class=\"o\">-</span><span class=\"mi\">0</span><span class=\"n\">de703034cbfc279a</span><span class=\"p\">.</span><span class=\"n\">ap</span><span class=\"o\">-</span><span class=\"n\">northeast</span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">.</span><span class=\"n\">vpce</span><span class=\"p\">.</span><span class=\"n\">amazonaws</span><span class=\"p\">.</span><span class=\"n\">com</span> <span class=\"o\">-</span><span class=\"k\">c</span> <span class=\"nv\">\"select usename,application_name,query from pg_stat_activity where application_name = 'pg_dump';\"</span>\n</code></pre></div></div>\n<h4 data-sourcepos=\"18:1-18:20\">restore(Aurora)</h4>\n<div class=\"code-block\" data-sourcepos=\"19:1-21:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sql</div><div class=\"highlight\"><pre class=\"highlight sql\"><code><span class=\"n\">psql</span> <span class=\"o\">-</span><span class=\"n\">p</span> <span class=\"mi\">5432</span> <span class=\"o\">-</span><span class=\"n\">U</span> <span class=\"n\">kingadmin</span> <span class=\"o\">-</span><span class=\"n\">d</span> <span class=\"n\">kingapi</span> <span class=\"o\">-</span><span class=\"n\">h</span> <span class=\"n\">king</span><span class=\"o\">-</span><span class=\"n\">api</span><span class=\"o\">-</span><span class=\"n\">production</span><span class=\"p\">.</span><span class=\"k\">cluster</span><span class=\"o\">-</span><span class=\"n\">cucbox6dvi64</span><span class=\"p\">.</span><span class=\"n\">ap</span><span class=\"o\">-</span><span class=\"n\">northeast</span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">.</span><span class=\"n\">rds</span><span class=\"p\">.</span><span class=\"n\">amazonaws</span><span class=\"p\">.</span><span class=\"n\">com</span> <span class=\"o\">-</span><span class=\"k\">c</span> <span class=\"nv\">\"select usename,application_name,query from pg_stat_activity where application_name = 'pg_restore';\"</span>\n</code></pre></div></div>\n<h3 data-sourcepos=\"22:1-22:19\" id=\"0-3-2\" name=\"0-3-2\"><a class=\"anchor\" id=\"topコマンド\" name=\"topコマンド\" href=\"#topコマンド\" data-position=\"0-3-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"topコマンド\"> &gt; topコマンド</span></a>topコマンド</h3>\n<div class=\"code-block\" data-sourcepos=\"23:1-41:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>top - 19:16:37 up 15:18,  0 <span class=\"nb\">users</span>,  load average: 0.00, 0.00, 0.00\nTasks:  10 total,   1 running,   9 sleeping,   0 stopped,   0 zombie\n%Cpu<span class=\"o\">(</span>s<span class=\"o\">)</span>:  0.0 us,  0.0 sy,  0.0 ni,100.0 <span class=\"nb\">id</span>,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st\nMiB Mem :  61287.0 total,  56927.2 free,    487.7 used,   3872.1 buff/cache\nMiB Swap:      0.0 total,      0.0 free,      0.0 used.  60099.3 avail Mem\n\n    PID USER      PR  NI    VIRT    RES    SHR S  %CPU  %MEM     TIME+ COMMAND\n      1 postgres  20   0    4624   3580   3180 S   0.0   0.0   0:00.02 bash\n    145 postgres  20   0  215724  30488  27728 S   0.0   0.0   0:01.00 postgres\n    147 postgres  20   0  215856  12260   9428 S   0.0   0.0   0:00.03 postgres\n    148 postgres  20   0  215724   7056   4296 S   0.0   0.0   0:00.30 postgres\n    149 postgres  20   0  215724  11676   8888 S   0.0   0.0   0:00.29 postgres\n    150 postgres  20   0  216264   9996   6948 S   0.0   0.0   0:00.50 postgres\n    151 postgres  20   0   70460   6492   3732 S   0.0   0.0   0:00.93 postgres\n    152 postgres  20   0  216140   7676   4724 S   0.0   0.0   0:00.01 postgres\n   1701 root      20   0    2888   1060    968 S   0.0   0.0   0:00.02 sh\n   1841 root      20   0    7312   3484   2920 R   0.0   0.0   0:00.00 top\n</code></pre></div></div>\n<p data-sourcepos=\"42:1-42:85\">COMMAND列を参照し、<code>pg_dump</code>や<code>pg_restore</code>がいない状態が終了とする</p>\n<h2 data-sourcepos=\"46:1-46:33\" id=\"0-4-0\" name=\"0-4-0\"><a class=\"anchor\" id=\"20_データプールの開始\" name=\"20_データプールの開始\" href=\"#20_データプールの開始\" data-position=\"0-4-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"20_データプールの開始\"> &gt; 20_データプールの開始</span></a>20_データプールの開始</h2>\n<h3 data-sourcepos=\"48:1-48:16\" id=\"0-4-1\" name=\"0-4-1\"><a class=\"anchor\" id=\"開始時刻\" name=\"開始時刻\" href=\"#開始時刻\" data-position=\"0-4-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"開始時刻\"> &gt; 開始時刻</span></a>開始時刻</h3>\n<p data-sourcepos=\"49:1-49:12\">4/18 AM04:28</p>\n<h3 data-sourcepos=\"50:1-50:10\" id=\"0-4-2\" name=\"0-4-2\"><a class=\"anchor\" id=\"手順\" name=\"手順\" href=\"#手順\" data-position=\"0-4-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"手順\"> &gt; 手順</span></a>手順</h3>\n<div class=\"code-block\" data-sourcepos=\"51:1-53:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>bucardo add <span class=\"nb\">sync </span>sync_heroku_aws <span class=\"nv\">relgroup</span><span class=\"o\">=</span>herd_heroku_db <span class=\"nv\">db</span><span class=\"o\">=</span>heroku_db,aws_db\n</code></pre></div></div>\n<h3 data-sourcepos=\"54:1-54:13\" id=\"0-4-3\" name=\"0-4-3\"><a class=\"anchor\" id=\"実行後\" name=\"実行後\" href=\"#実行後\" data-position=\"0-4-3\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"実行後\"> &gt; 実行後</span></a>実行後</h3>\n<div class=\"code-block\" data-sourcepos=\"55:1-77:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code><span class=\"c\"># bucardo add sync sync_heroku_aws relgroup=herd_heroku_db db=heroku_db,aws_db</span>\nAdded <span class=\"nb\">sync</span> <span class=\"s2\">\"sync_heroku_aws\"</span>\nUsing existing dbgroup <span class=\"s2\">\"dbs\"</span>\n\n<span class=\"c\"># bucardo status sync_heroku_aws</span>\n<span class=\"o\">======================================================================</span>\nSync name                : sync_heroku_aws\nCurrent state            : No records found\nSource relgroup/database : herd_heroku_db / heroku_db\nTables <span class=\"k\">in </span><span class=\"nb\">sync</span>           : 2\nStatus                   : Active\nCheck <span class=\"nb\">time</span>               : None\nOverdue <span class=\"nb\">time</span>             : 00:00:00\nExpired <span class=\"nb\">time</span>             : 00:00:00\nStayalive/Kidsalive      : Yes / Yes\nRebuild index            : No\nAutokick                 : Yes\nOnetimecopy              : No\nPost-copy analyze        : Yes\nLast error:              :\n<span class=\"o\">======================================================================</span>\n</code></pre></div></div>\n<p data-sourcepos=\"79:1-79:64\">bucardoスキーマが追加されていることを確認した</p>\n<div class=\"code-block\" data-sourcepos=\"80:1-94:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sql</div><div class=\"highlight\"><pre class=\"highlight sql\"><code><span class=\"o\">#</span> <span class=\"n\">psql</span> <span class=\"o\">-</span><span class=\"n\">p</span> <span class=\"mi\">5432</span> <span class=\"o\">-</span><span class=\"n\">U</span> <span class=\"n\">ubev937lfpa1d3</span> <span class=\"o\">-</span><span class=\"n\">d</span> <span class=\"n\">dncvsso7me9p6</span> <span class=\"o\">-</span><span class=\"n\">h</span> <span class=\"n\">vpce</span><span class=\"o\">-</span><span class=\"mi\">0</span><span class=\"n\">bed708f6ce21788a</span><span class=\"o\">-</span><span class=\"n\">f4tmby1p</span><span class=\"p\">.</span><span class=\"n\">vpce</span><span class=\"o\">-</span><span class=\"n\">svc</span><span class=\"o\">-</span><span class=\"mi\">0</span><span class=\"n\">de703034cbfc279a</span><span class=\"p\">.</span><span class=\"n\">ap</span><span class=\"o\">-</span><span class=\"n\">northeast</span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">.</span><span class=\"n\">vpce</span><span class=\"p\">.</span><span class=\"n\">amazonaws</span><span class=\"p\">.</span><span class=\"n\">com</span>\n<span class=\"n\">psql</span> <span class=\"p\">(</span><span class=\"mi\">14</span><span class=\"p\">.</span><span class=\"mi\">7</span> <span class=\"p\">(</span><span class=\"n\">Ubuntu</span> <span class=\"mi\">14</span><span class=\"p\">.</span><span class=\"mi\">7</span><span class=\"o\">-</span><span class=\"mi\">0</span><span class=\"n\">ubuntu0</span><span class=\"p\">.</span><span class=\"mi\">22</span><span class=\"p\">.</span><span class=\"mi\">04</span><span class=\"p\">.</span><span class=\"mi\">1</span><span class=\"p\">))</span>\n<span class=\"n\">SSL</span> <span class=\"k\">connection</span> <span class=\"p\">(</span><span class=\"n\">protocol</span><span class=\"p\">:</span> <span class=\"n\">TLSv1</span><span class=\"p\">.</span><span class=\"mi\">3</span><span class=\"p\">,</span> <span class=\"n\">cipher</span><span class=\"p\">:</span> <span class=\"n\">TLS_AES_256_GCM_SHA384</span><span class=\"p\">,</span> <span class=\"n\">bits</span><span class=\"p\">:</span> <span class=\"mi\">256</span><span class=\"p\">,</span> <span class=\"n\">compression</span><span class=\"p\">:</span> <span class=\"k\">off</span><span class=\"p\">)</span>\n<span class=\"k\">Type</span> <span class=\"nv\">\"help\"</span> <span class=\"k\">for</span> <span class=\"n\">help</span><span class=\"p\">.</span>\n\n<span class=\"n\">dncvsso7me9p6</span><span class=\"o\">=&gt;</span> <span class=\"err\">\\</span><span class=\"n\">dn</span>\n       <span class=\"n\">List</span> <span class=\"k\">of</span> <span class=\"n\">schemas</span>\n    <span class=\"n\">Name</span>    <span class=\"o\">|</span>     <span class=\"k\">Owner</span>\n<span class=\"c1\">------------+----------------</span>\n <span class=\"n\">bucardo</span>    <span class=\"o\">|</span> <span class=\"n\">ubev937lfpa1d3</span>\n <span class=\"n\">heroku_ext</span> <span class=\"o\">|</span> <span class=\"n\">postgres</span>\n <span class=\"k\">public</span>     <span class=\"o\">|</span> <span class=\"n\">ubev937lfpa1d3</span>\n<span class=\"p\">(</span><span class=\"mi\">3</span> <span class=\"k\">rows</span><span class=\"p\">)</span>\n</code></pre></div></div>\n<h3 data-sourcepos=\"96:1-96:52\" id=\"0-4-4\" name=\"0-4-4\"><a class=\"anchor\" id=\"10:50時点でのbucardoプールレコード数\" name=\"10:50時点でのbucardoプールレコード数\" href=\"#10:50時点でのbucardoプールレコード数\" data-position=\"0-4-4\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"10__colon__50時点でのbucardoプールレコード数\"> &gt; 10__colon__50時点でのbucardoプールレコード数</span></a>10:50時点でのbucardoプールレコード数</h3>\n<p data-sourcepos=\"97:1-98:54\">約6時間経過<br>\nlogsが約100万、display_logsが約50万レコード</p>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/18/136273/3a3ebb2e-275e-4bc1-aadc-5f4d0b75aace.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"957\" alt=\"スクリーンショット 2023-04-18 10.49.36.png (74.8 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/18/136273/3a3ebb2e-275e-4bc1-aadc-5f4d0b75aace.png\"></a>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/18/136273/f67acc50-0371-46ba-8ab0-6506a1a815b3.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"987\" alt=\"スクリーンショット 2023-04-18 10.49.46.png (72.5 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/18/136273/f67acc50-0371-46ba-8ab0-6506a1a815b3.png\"></a>\n<p data-sourcepos=\"103:1-105:204\">メンテ中に撮影<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/19/136273/f1a00719-a408-408a-b9d3-1acdca1485cc.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"910\" alt=\"スクリーンショット 2023-04-19 1.20.53.png (80.9 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/19/136273/f1a00719-a408-408a-b9d3-1acdca1485cc.png\"></a><br>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/19/136273/46751422-092a-4a12-8579-09318febccaa.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"891\" alt=\"スクリーンショット 2023-04-19 1.21.19.png (80.7 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/19/136273/46751422-092a-4a12-8579-09318febccaa.png\"></a></p>\n<h2 data-sourcepos=\"108:1-108:31\" id=\"0-5-0\" name=\"0-5-0\"><a class=\"anchor\" id=\"21_logs, display_logsのdump\" name=\"21_logs, display_logsのdump\" href=\"#21_logs, display_logsのdump\" data-position=\"0-5-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"21_logs, display_logsのdump\"> &gt; 21_logs, display_logsのdump</span></a>21_logs, display_logsのdump</h2>\n<h3 data-sourcepos=\"110:1-110:16\" id=\"0-5-1\" name=\"0-5-1\"><a class=\"anchor\" id=\"開始時刻-1\" name=\"開始時刻-1\" href=\"#開始時刻-1\" data-position=\"0-5-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"開始時刻\"> &gt; 開始時刻</span></a>開始時刻</h3>\n<p data-sourcepos=\"111:1-111:12\">4/18 AM04:30</p>\n<h3 data-sourcepos=\"112:1-112:10\" id=\"0-5-2\" name=\"0-5-2\"><a class=\"anchor\" id=\"手順-1\" name=\"手順-1\" href=\"#手順-1\" data-position=\"0-5-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"手順\"> &gt; 手順</span></a>手順</h3>\n<div class=\"code-block\" data-sourcepos=\"113:1-115:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>pg_dump <span class=\"nt\">--format</span><span class=\"o\">=</span>custom <span class=\"nt\">--verbose</span> <span class=\"nt\">--data-only</span> <span class=\"nt\">--table</span><span class=\"o\">=</span>logs <span class=\"nt\">--table</span><span class=\"o\">=</span>display_logs <span class=\"nt\">-h</span> vpce-0bed708f6ce21788a-f4tmby1p.vpce-svc-0de703034cbfc279a.ap-northeast-1.vpce.amazonaws.com <span class=\"nt\">-U</span> ubev937lfpa1d3 <span class=\"nt\">-p</span> 5432 <span class=\"nt\">-d</span> dncvsso7me9p6 <span class=\"o\">&gt;</span> logs_displaylogs.dump\n</code></pre></div></div>\n<h3 data-sourcepos=\"116:1-116:22\" id=\"0-5-3\" name=\"0-5-3\"><a class=\"anchor\" id=\"終了確認方法\" name=\"終了確認方法\" href=\"#終了確認方法\" data-position=\"0-5-3\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"終了確認方法\"> &gt; 終了確認方法</span></a>終了確認方法</h3>\n<ul data-sourcepos=\"117:1-118:138\">\n<li data-sourcepos=\"117:1-117:118\"><code>top</code>コマンドか<code>ps -aux</code>コマンドで<code>pg_dump</code>のプロセスがいなくなっていることを確認する</li>\n<li data-sourcepos=\"118:1-118:138\">psqlコマンドで<code>pg_stat_activity</code>から<code>application_name = 'pg_dump'</code>のレコードがいなくなっていることを確認する</li>\n</ul>\n<h3 data-sourcepos=\"119:1-119:13\" id=\"0-5-4\" name=\"0-5-4\"><a class=\"anchor\" id=\"実行後-1\" name=\"実行後-1\" href=\"#実行後-1\" data-position=\"0-5-4\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"実行後\"> &gt; 実行後</span></a>実行後</h3>\n<div class=\"code-block\" data-sourcepos=\"121:1-178:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code><span class=\"c\"># pg_dump --format=custom --verbose --data-only --table=logs --table=display_logs -h vpce-0bed708f6ce21788a-f4tmby1p.vpce-svc-0de703034cbfc279a.ap-northeast-1.vpce.amazonaws.com -U ubev937lfpa1d3 -p 5432 -d dncvsso7me9p6 &gt; logs_displaylogs.dump</span>\npg_dump: last built-in OID is 16383\npg_dump: reading extensions\npg_dump: identifying extension members\npg_dump: reading schemas\npg_dump: reading user-defined tables\npg_dump: reading user-defined functions\npg_dump: reading user-defined types\npg_dump: reading procedural languages\npg_dump: reading user-defined aggregate functions\npg_dump: reading user-defined operators\npg_dump: reading user-defined access methods\npg_dump: reading user-defined operator classes\npg_dump: reading user-defined operator families\npg_dump: reading user-defined text search parsers\npg_dump: reading user-defined text search templates\npg_dump: reading user-defined text search dictionaries\npg_dump: reading user-defined text search configurations\npg_dump: reading user-defined foreign-data wrappers\npg_dump: reading user-defined foreign servers\npg_dump: reading default privileges\npg_dump: reading user-defined collations\npg_dump: reading user-defined conversions\npg_dump: reading <span class=\"nb\">type </span>casts\npg_dump: reading transforms\npg_dump: reading table inheritance information\npg_dump: reading event triggers\npg_dump: finding extension tables\npg_dump: finding inheritance relationships\npg_dump: reading column info <span class=\"k\">for </span>interesting tables\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.logs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.display_logs\"</span>\npg_dump: flagging inherited columns <span class=\"k\">in </span>subtables\npg_dump: reading indexes\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.logs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.display_logs\"</span>\npg_dump: flagging indexes <span class=\"k\">in </span>partitioned tables\npg_dump: reading extended statistics\npg_dump: reading constraints\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.logs\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.display_logs\"</span>\npg_dump: reading triggers\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.logs\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.display_logs\"</span>\npg_dump: reading rewrite rules\npg_dump: reading policies\npg_dump: reading row-level security policies\npg_dump: reading publications\npg_dump: reading publication membership\npg_dump: reading subscriptions\npg_dump: reading dependency data\npg_dump: saving encoding <span class=\"o\">=</span> UTF8\npg_dump: saving standard_conforming_strings <span class=\"o\">=</span> on\npg_dump: saving search_path <span class=\"o\">=</span>\npg_dump: saving database definition\npg_dump: dumping contents of table <span class=\"s2\">\"public.display_logs\"</span>\n</code></pre></div></div>\n<p data-sourcepos=\"180:1-180:42\">psqlコマンドでクエリの確認→OK</p>\n<div class=\"code-block\" data-sourcepos=\"181:1-188:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sql</div><div class=\"highlight\"><pre class=\"highlight sql\"><code><span class=\"n\">psql</span> <span class=\"o\">-</span><span class=\"n\">p</span> <span class=\"mi\">5432</span> <span class=\"o\">-</span><span class=\"n\">U</span> <span class=\"n\">ubev937lfpa1d3</span> <span class=\"o\">-</span><span class=\"n\">d</span> <span class=\"n\">dncvsso7me9p6</span> <span class=\"o\">-</span><span class=\"n\">h</span> <span class=\"n\">vpce</span><span class=\"o\">-</span><span class=\"mi\">0</span><span class=\"n\">bed708f6ce21788a</span><span class=\"o\">-</span><span class=\"n\">f4tmby1p</span><span class=\"p\">.</span><span class=\"n\">vpce</span><span class=\"o\">-</span><span class=\"n\">svc</span><span class=\"o\">-</span><span class=\"mi\">0</span><span class=\"n\">de703034cbfc279a</span><span class=\"p\">.</span><span class=\"n\">ap</span><span class=\"o\">-</span><span class=\"n\">northeast</span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">.</span><span class=\"n\">vpce</span><span class=\"p\">.</span><span class=\"n\">amazonaws</span><span class=\"p\">.</span><span class=\"n\">com</span> <span class=\"o\">-</span><span class=\"k\">c</span> <span class=\"nv\">\"select usename,application_name,query from pg_stat_activity where application_name = 'pg_dump';\"</span>\n    <span class=\"n\">usename</span>     <span class=\"o\">|</span> <span class=\"n\">application_name</span> <span class=\"o\">|</span>                                                                     <span class=\"n\">query</span>\n\n<span class=\"c1\">----------------+------------------+-----------------------------------------------------------------------------------------------------------------------------------------------</span>\n <span class=\"n\">ubev937lfpa1d3</span> <span class=\"o\">|</span> <span class=\"n\">pg_dump</span>          <span class=\"o\">|</span> <span class=\"k\">COPY</span> <span class=\"k\">public</span><span class=\"p\">.</span><span class=\"n\">display_logs</span> <span class=\"p\">(</span><span class=\"n\">id</span><span class=\"p\">,</span> <span class=\"n\">master_key_id</span><span class=\"p\">,</span> <span class=\"n\">mst_display_log_id</span><span class=\"p\">,</span> <span class=\"n\">user_name</span><span class=\"p\">,</span> <span class=\"n\">logged_at</span><span class=\"p\">,</span> <span class=\"n\">created_at</span><span class=\"p\">,</span> <span class=\"n\">open_close_type</span><span class=\"p\">,</span> <span class=\"n\">lock_position</span><span class=\"p\">)</span> <span class=\"k\">TO</span> <span class=\"k\">stdout</span><span class=\"p\">;</span>\n<span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"k\">row</span><span class=\"p\">)</span>\n</code></pre></div></div>\n<p data-sourcepos=\"190:1-190:44\">topコマンドでプロセスの確認→OK</p>\n<div class=\"code-block\" data-sourcepos=\"192:1-208:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>top - 19:31:09 up 15:32,  0 <span class=\"nb\">users</span>,  load average: 0.57, 0.16, 0.05\nTasks:  12 total,   2 running,  10 sleeping,   0 stopped,   0 zombie\n%Cpu<span class=\"o\">(</span>s<span class=\"o\">)</span>: 11.7 us,  0.9 sy,  0.0 ni, 87.1 <span class=\"nb\">id</span>,  0.0 wa,  0.0 hi,  0.3 si,  0.0 st\nMiB Mem :  61287.0 total,  56560.3 free,    505.3 used,   4221.3 buff/cache\nMiB Swap:      0.0 total,      0.0 free,      0.0 used.  60081.1 avail Mem\n\n    PID USER      PR  NI    VIRT    RES    SHR S  %CPU  %MEM     TIME+ COMMAND\n   1884 root      20   0   19684  13700  10196 R  99.7   0.0   0:50.07 pg_dump\n      1 postgres  20   0    4624   3580   3180 S   0.0   0.0   0:00.02 bash\n    145 postgres  20   0  215724  30488  27728 S   0.0   0.0   0:01.02 postgres\n    147 postgres  20   0  215856  12260   9428 S   0.0   0.0   0:00.03 postgres\n    148 postgres  20   0  215724   9564   6772 S   0.0   0.0   0:00.30 postgres\n    149 postgres  20   0  215724  11676   8888 S   0.0   0.0   0:00.30 postgres\n    150 postgres  20   0  216264   9996   6948 S   0.0   0.0   0:00.51 postgres\n    151 postgres  20   0   70460   6492   3732 S   0.0   0.0   0:00.95 postgres\n</code></pre></div></div>\n<h3 data-sourcepos=\"210:1-210:16\" id=\"0-5-5\" name=\"0-5-5\"><a class=\"anchor\" id=\"終了確認\" name=\"終了確認\" href=\"#終了確認\" data-position=\"0-5-5\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"終了確認\"> &gt; 終了確認</span></a>終了確認</h3>\n<p data-sourcepos=\"211:1-211:16\">4/18 AM9:00→OK</p>\n<p data-sourcepos=\"213:1-213:31\">dumpファイルの容量:108GB</p>\n<div class=\"code-block\" data-sourcepos=\"215:1-235:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>top - 00:02:16 up 20:03,  0 <span class=\"nb\">users</span>,  load average: 0.00, 0.05, 0.38\nTasks:  12 total,   1 running,  11 sleeping,   0 stopped,   0 zombie\n%Cpu<span class=\"o\">(</span>s<span class=\"o\">)</span>:  0.0 us,  0.0 sy,  0.0 ni,100.0 <span class=\"nb\">id</span>,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st\nMiB Mem :  61287.0 total,    800.2 free,    478.3 used,  60008.5 buff/cache\nMiB Swap:      0.0 total,      0.0 free,      0.0 used.  60094.1 avail Mem\n\n    PID USER      PR  NI    VIRT    RES    SHR S  %CPU  %MEM     TIME+ COMMAND\n      1 postgres  20   0    4624   3580   3180 S   0.0   0.0   0:00.02 bash\n    145 postgres  20   0  215724  30488  27728 S   0.0   0.0   0:01.36 postgres\n    147 postgres  20   0  215856  12260   9428 S   0.0   0.0   0:00.04 postgres\n    148 postgres  20   0  215724   9564   6772 S   0.0   0.0   0:00.39 postgres\n    149 postgres  20   0  215724  11676   8888 S   0.0   0.0   0:00.38 postgres\n    150 postgres  20   0  216264   9996   6948 S   0.0   0.0   0:00.68 postgres\n    151 postgres  20   0   70460   6492   3732 S   0.0   0.0   0:01.27 postgres\n    152 postgres  20   0  216140   7676   4724 S   0.0   0.0   0:00.02 postgres\n   1701 root      20   0    2888   1060    968 S   0.0   0.0   0:00.02 sh\n   1886 root      20   0    2888    988    900 S   0.0   0.0   0:00.02 sh\n   2454 root      20   0    2888    992    900 S   0.0   0.0   0:00.01 sh\n   2460 root      20   0    7312   2948   2620 R   0.0   0.0   0:00.00 top\n</code></pre></div></div>\n<div class=\"code-block\" data-sourcepos=\"237:1-242:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sql</div><div class=\"highlight\"><pre class=\"highlight sql\"><code><span class=\"n\">psql</span> <span class=\"o\">-</span><span class=\"n\">p</span> <span class=\"mi\">5432</span> <span class=\"o\">-</span><span class=\"n\">U</span> <span class=\"n\">ubev937lfpa1d3</span> <span class=\"o\">-</span><span class=\"n\">d</span> <span class=\"n\">dncvsso7me9p6</span> <span class=\"o\">-</span><span class=\"n\">h</span> <span class=\"n\">vpce</span><span class=\"o\">-</span><span class=\"mi\">0</span><span class=\"n\">bed708f6ce21788a</span><span class=\"o\">-</span><span class=\"n\">f4tmby1p</span><span class=\"p\">.</span><span class=\"n\">vpce</span><span class=\"o\">-</span><span class=\"n\">svc</span><span class=\"o\">-</span><span class=\"mi\">0</span><span class=\"n\">de703034cbfc279a</span><span class=\"p\">.</span><span class=\"n\">ap</span><span class=\"o\">-</span><span class=\"n\">northeast</span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">.</span><span class=\"n\">vpce</span><span class=\"p\">.</span><span class=\"n\">amazonaws</span><span class=\"p\">.</span><span class=\"n\">com</span> <span class=\"o\">-</span><span class=\"k\">c</span> <span class=\"nv\">\"select usename,application_name,query from pg_stat_activity where application_name = 'pg_dump';\"</span>\n <span class=\"n\">usename</span> <span class=\"o\">|</span> <span class=\"n\">application_name</span> <span class=\"o\">|</span> <span class=\"n\">query</span>\n<span class=\"c1\">---------+------------------+-------</span>\n<span class=\"p\">(</span><span class=\"mi\">0</span> <span class=\"k\">rows</span><span class=\"p\">)</span>\n</code></pre></div></div>\n<h2 data-sourcepos=\"243:1-243:45\" id=\"0-6-0\" name=\"0-6-0\"><a class=\"anchor\" id=\"22_パラメーターグループの変更\" name=\"22_パラメーターグループの変更\" href=\"#22_パラメーターグループの変更\" data-position=\"0-6-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"22_パラメーターグループの変更\"> &gt; 22_パラメーターグループの変更</span></a>22_パラメーターグループの変更</h2>\n<h3 data-sourcepos=\"245:1-245:16\" id=\"0-6-1\" name=\"0-6-1\"><a class=\"anchor\" id=\"開始時刻-2\" name=\"開始時刻-2\" href=\"#開始時刻-2\" data-position=\"0-6-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"開始時刻\"> &gt; 開始時刻</span></a>開始時刻</h3>\n<p data-sourcepos=\"246:1-246:12\">4/18 AM09:00</p>\n<h3 data-sourcepos=\"247:1-247:10\" id=\"0-6-2\" name=\"0-6-2\"><a class=\"anchor\" id=\"手順-2\" name=\"手順-2\" href=\"#手順-2\" data-position=\"0-6-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"手順\"> &gt; 手順</span></a>手順</h3>\n<p data-sourcepos=\"248:1-248:60\">クラスターパラメーターグループを変更する</p>\n<h3 data-sourcepos=\"249:1-249:13\" id=\"0-6-3\" name=\"0-6-3\"><a class=\"anchor\" id=\"実行後-2\" name=\"実行後-2\" href=\"#実行後-2\" data-position=\"0-6-3\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"実行後\"> &gt; 実行後</span></a>実行後</h3>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/18/136273/566f5ca8-2805-455f-b070-70d59e801a6e.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"793\" alt=\"スクリーンショット 2023-04-18 9.05.38.png (234.4 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/18/136273/566f5ca8-2805-455f-b070-70d59e801a6e.png\"></a>\n<h2 data-sourcepos=\"252:1-252:51\" id=\"0-7-0\" name=\"0-7-0\"><a class=\"anchor\" id=\"23_パラメーターグループの変更確認\" name=\"23_パラメーターグループの変更確認\" href=\"#23_パラメーターグループの変更確認\" data-position=\"0-7-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"23_パラメーターグループの変更確認\"> &gt; 23_パラメーターグループの変更確認</span></a>23_パラメーターグループの変更確認</h2>\n<h3 data-sourcepos=\"254:1-254:16\" id=\"0-7-1\" name=\"0-7-1\"><a class=\"anchor\" id=\"開始時刻-3\" name=\"開始時刻-3\" href=\"#開始時刻-3\" data-position=\"0-7-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"開始時刻\"> &gt; 開始時刻</span></a>開始時刻</h3>\n<p data-sourcepos=\"255:1-255:12\">4/18 AM09:05</p>\n<h3 data-sourcepos=\"256:1-256:10\" id=\"0-7-2\" name=\"0-7-2\"><a class=\"anchor\" id=\"手順-3\" name=\"手順-3\" href=\"#手順-3\" data-position=\"0-7-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"手順\"> &gt; 手順</span></a>手順</h3>\n<p data-sourcepos=\"257:1-257:60\">クラスターパラメーターグループを確認する</p>\n<div class=\"code-block\" data-sourcepos=\"258:1-260:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sql</div><div class=\"highlight\"><pre class=\"highlight sql\"><code><span class=\"k\">show</span> <span class=\"n\">session_replication_role</span><span class=\"p\">;</span>\n</code></pre></div></div>\n<h3 data-sourcepos=\"261:1-261:13\" id=\"0-7-3\" name=\"0-7-3\"><a class=\"anchor\" id=\"実行後-3\" name=\"実行後-3\" href=\"#実行後-3\" data-position=\"0-7-3\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"実行後\"> &gt; 実行後</span></a>実行後</h3>\n<div class=\"code-block\" data-sourcepos=\"263:1-269:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sql</div><div class=\"highlight\"><pre class=\"highlight sql\"><code><span class=\"o\">#</span> <span class=\"n\">psql</span> <span class=\"o\">-</span><span class=\"n\">p</span> <span class=\"mi\">5432</span> <span class=\"o\">-</span><span class=\"n\">U</span> <span class=\"n\">kingadmin</span> <span class=\"o\">-</span><span class=\"n\">d</span> <span class=\"n\">kingapi</span> <span class=\"o\">-</span><span class=\"n\">h</span> <span class=\"n\">king</span><span class=\"o\">-</span><span class=\"n\">api</span><span class=\"o\">-</span><span class=\"n\">production</span><span class=\"p\">.</span><span class=\"k\">cluster</span><span class=\"o\">-</span><span class=\"n\">cucbox6dvi64</span><span class=\"p\">.</span><span class=\"n\">ap</span><span class=\"o\">-</span><span class=\"n\">northeast</span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">.</span><span class=\"n\">rds</span><span class=\"p\">.</span><span class=\"n\">amazonaws</span><span class=\"p\">.</span><span class=\"n\">com</span> <span class=\"o\">-</span><span class=\"k\">c</span> <span class=\"nv\">\" show session_replication_role;\"</span>\n <span class=\"n\">session_replication_role</span>\n<span class=\"c1\">--------------------------</span>\n <span class=\"n\">replica</span>\n<span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"k\">row</span><span class=\"p\">)</span>\n</code></pre></div></div>\n<h2 data-sourcepos=\"271:1-271:34\" id=\"0-8-0\" name=\"0-8-0\"><a class=\"anchor\" id=\"24_logs, display_logsのrestore\" name=\"24_logs, display_logsのrestore\" href=\"#24_logs, display_logsのrestore\" data-position=\"0-8-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"24_logs, display_logsのrestore\"> &gt; 24_logs, display_logsのrestore</span></a>24_logs, display_logsのrestore</h2>\n<h3 data-sourcepos=\"273:1-273:16\" id=\"0-8-1\" name=\"0-8-1\"><a class=\"anchor\" id=\"開始時刻-4\" name=\"開始時刻-4\" href=\"#開始時刻-4\" data-position=\"0-8-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"開始時刻\"> &gt; 開始時刻</span></a>開始時刻</h3>\n<p data-sourcepos=\"274:1-274:12\">4/18 AM09:08</p>\n<h3 data-sourcepos=\"275:1-275:10\" id=\"0-8-2\" name=\"0-8-2\"><a class=\"anchor\" id=\"手順-4\" name=\"手順-4\" href=\"#手順-4\" data-position=\"0-8-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"手順\"> &gt; 手順</span></a>手順</h3>\n<div class=\"code-block\" data-sourcepos=\"276:1-278:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>pg_restore <span class=\"nt\">--verbose</span> <span class=\"nt\">--data-only</span> <span class=\"nt\">-h</span> king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com <span class=\"nt\">-p</span> 5432 <span class=\"nt\">-d</span> kingapi <span class=\"nt\">-U</span> kingadmin  <span class=\"nt\">--jobs</span><span class=\"o\">=</span>8 logs_displaylogs.dump\n</code></pre></div></div>\n<h3 data-sourcepos=\"279:1-279:22\" id=\"0-8-3\" name=\"0-8-3\"><a class=\"anchor\" id=\"終了確認方法-1\" name=\"終了確認方法-1\" href=\"#終了確認方法-1\" data-position=\"0-8-3\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"終了確認方法\"> &gt; 終了確認方法</span></a>終了確認方法</h3>\n<ul data-sourcepos=\"280:1-281:141\">\n<li data-sourcepos=\"280:1-280:121\"><code>top</code>コマンドか<code>ps -aux</code>コマンドで<code>pg_restore</code>のプロセスがいなくなっていることを確認する</li>\n<li data-sourcepos=\"281:1-281:141\">psqlコマンドで<code>pg_stat_activity</code>から<code>application_name = 'pg_restore'</code>のレコードがいなくなっていることを確認する</li>\n</ul>\n<h3 data-sourcepos=\"282:1-282:13\" id=\"0-8-4\" name=\"0-8-4\"><a class=\"anchor\" id=\"実行後-4\" name=\"実行後-4\" href=\"#実行後-4\" data-position=\"0-8-4\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"実行後\"> &gt; 実行後</span></a>実行後</h3>\n<div class=\"code-block\" data-sourcepos=\"283:1-298:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code><span class=\"c\"># pg_restore --verbose --data-only -h king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com -p 5432 -d kingapi -U kingadmin  --jobs=8 logs_displaylogs.dump</span>\npg_restore: connecting to database <span class=\"k\">for </span>restore\npg_restore: processing item 4588 ENCODING ENCODING\npg_restore: processing item 4589 STDSTRINGS STDSTRINGS\npg_restore: processing item 4590 SEARCHPATH SEARCHPATH\npg_restore: processing item 4591 DATABASE dncvsso7me9p6\npg_restore: processing item 4592 DATABASE PROPERTIES dncvsso7me9p6\npg_restore: entering main parallel loop\npg_restore: launching item 4584 TABLE DATA logs\npg_restore: launching item 4585 TABLE DATA display_logs\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.logs\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.display_logs\"</span>\n\nここから移動するのでセッションが切れる\n</code></pre></div></div>\n<p data-sourcepos=\"299:1-299:39\">プロセスが動いているか確認</p>\n<div class=\"code-block\" data-sourcepos=\"300:1-326:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>top - 00:09:11 up 20:10,  0 <span class=\"nb\">users</span>,  load average: 0.16, 0.05, 0.25\nTasks:  23 total,   1 running,  22 sleeping,   0 stopped,   0 zombie\n%Cpu<span class=\"o\">(</span>s<span class=\"o\">)</span>:  1.6 us,  0.2 sy,  0.0 ni, 98.2 <span class=\"nb\">id</span>,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st\nMiB Mem :  61287.0 total,    872.1 free,    466.2 used,  59948.6 buff/cache\nMiB Swap:      0.0 total,      0.0 free,      0.0 used.  60106.1 avail Mem\n\n    PID USER      PR  NI    VIRT    RES    SHR S  %CPU  %MEM     TIME+ COMMAND\n   2491 root      20   0   17948   7400   5280 S   7.6   0.0   0:04.57 pg_restore\n   2490 root      20   0   17948   7400   5280 S   7.0   0.0   0:04.09 pg_restore\n      1 postgres  20   0    4624   3580   3180 S   0.0   0.0   0:00.02 bash\n    145 postgres  20   0  215724  30488  27728 S   0.0   0.0   0:01.37 postgres\n    147 postgres  20   0  215856  12260   9428 S   0.0   0.0   0:00.04 postgres\n    148 postgres  20   0  215724   9564   6772 S   0.0   0.0   0:00.40 postgres\n    149 postgres  20   0  215724  11676   8888 S   0.0   0.0   0:00.39 postgres\n    150 postgres  20   0  216264   9996   6948 S   0.0   0.0   0:00.69 postgres\n    151 postgres  20   0   70460   6492   3732 S   0.0   0.0   0:01.28 postgres\n    152 postgres  20   0  216140   7676   4724 S   0.0   0.0   0:00.02 postgres\n   1701 root      20   0    2888   1060    968 S   0.0   0.0   0:00.02 sh\n   1886 root      20   0    2888    988    900 S   0.0   0.0   0:00.02 sh\n   2454 root      20   0    2888    992    900 S   0.0   0.0   0:00.01 sh\n   2476 root      20   0    2888    984    896 S   0.0   0.0   0:00.02 sh\n   2489 root      20   0   17856  11448   9424 S   0.0   0.0   0:00.05 pg_restore\n   2492 root      20   0   17948   7400   5280 S   0.0   0.0   0:00.02 pg_restore\n   2493 root      20   0   17948   7400   5280 S   0.0   0.0   0:00.02 pg_restore\n   2494 root      20   0   17948   7400   5280 S   0.0   0.0   0:00.02 pg_restore\n</code></pre></div></div>\n<p data-sourcepos=\"327:1-329:207\">順調な様子<br>\n14:50 経過確認 cloudwatch<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/18/136273/adf6db7c-82be-4529-b185-3a2faedb3a3d.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"1920\" alt=\"スクリーンショット 2023-04-18 14.46.18.png (208.4 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/18/136273/adf6db7c-82be-4529-b185-3a2faedb3a3d.png\"></a></p>\n<p data-sourcepos=\"331:1-333:92\">終了<br>\n確認クエリ<br>\nアクティブなクエリを取得する(where application_name=pg_restoreで絞り込み)</p>\n<div class=\"code-block\" data-sourcepos=\"334:1-337:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sql</div><div class=\"highlight\"><pre class=\"highlight sql\"><code><span class=\"n\">kingapi</span><span class=\"o\">=&gt;</span> <span class=\"k\">select</span> <span class=\"n\">usename</span><span class=\"p\">,</span><span class=\"n\">application_name</span><span class=\"p\">,</span><span class=\"n\">query</span> <span class=\"k\">from</span> <span class=\"n\">pg_stat_activity</span> <span class=\"k\">where</span> <span class=\"n\">application_name</span> <span class=\"o\">=</span> <span class=\"s1\">'pg_restore'</span><span class=\"p\">;</span>\n<span class=\"p\">(</span><span class=\"mi\">0</span> <span class=\"k\">rows</span><span class=\"p\">)</span>\n</code></pre></div></div>\n<p data-sourcepos=\"339:1-340:204\">展開後の容量:614GB程度<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/19/136273/d32e8f71-8bb3-4c94-8179-9b32469da3c3.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"908\" alt=\"スクリーンショット 2023-04-19 0.57.07.png (79.5 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/19/136273/d32e8f71-8bb3-4c94-8179-9b32469da3c3.png\"></a></p>\n<h2 data-sourcepos=\"343:1-343:45\" id=\"0-9-0\" name=\"0-9-0\"><a class=\"anchor\" id=\"25_パラメーターグループの変更\" name=\"25_パラメーターグループの変更\" href=\"#25_パラメーターグループの変更\" data-position=\"0-9-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"25_パラメーターグループの変更\"> &gt; 25_パラメーターグループの変更</span></a>25_パラメーターグループの変更</h2>\n<h3 data-sourcepos=\"345:1-345:16\" id=\"0-9-1\" name=\"0-9-1\"><a class=\"anchor\" id=\"開始時刻-5\" name=\"開始時刻-5\" href=\"#開始時刻-5\" data-position=\"0-9-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"開始時刻\"> &gt; 開始時刻</span></a>開始時刻</h3>\n<p data-sourcepos=\"346:1-346:9\">4/19 0:10</p>\n<h3 data-sourcepos=\"347:1-347:10\" id=\"0-9-2\" name=\"0-9-2\"><a class=\"anchor\" id=\"手順-5\" name=\"手順-5\" href=\"#手順-5\" data-position=\"0-9-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"手順\"> &gt; 手順</span></a>手順</h3>\n<p data-sourcepos=\"348:1-348:85\">パラメータグループをking-api-production-parametergroupに変更して適応</p>\n<h3 data-sourcepos=\"349:1-349:13\" id=\"0-9-3\" name=\"0-9-3\"><a class=\"anchor\" id=\"実行後-5\" name=\"実行後-5\" href=\"#実行後-5\" data-position=\"0-9-3\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"実行後\"> &gt; 実行後</span></a>実行後</h3>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/19/136273/e5eda443-a12a-4dcb-a898-d9047db1f4b5.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"772\" alt=\"スクリーンショット 2023-04-19 0.09.50.png (96.3 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/19/136273/e5eda443-a12a-4dcb-a898-d9047db1f4b5.png\"></a>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/19/136273/41d03c45-3496-4864-a985-0cd7cc982b5f.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"299\" alt=\"スクリーンショット 2023-04-19 0.10.21.png (10.8 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/19/136273/41d03c45-3496-4864-a985-0cd7cc982b5f.png\"></a>\n<h2 data-sourcepos=\"354:1-354:42\" id=\"0-10-0\" name=\"0-10-0\"><a class=\"anchor\" id=\"26_パラメータグループの確認\" name=\"26_パラメータグループの確認\" href=\"#26_パラメータグループの確認\" data-position=\"0-10-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"26_パラメータグループの確認\"> &gt; 26_パラメータグループの確認</span></a>26_パラメータグループの確認</h2>\n<h3 data-sourcepos=\"355:1-355:16\" id=\"0-10-1\" name=\"0-10-1\"><a class=\"anchor\" id=\"開始時刻-6\" name=\"開始時刻-6\" href=\"#開始時刻-6\" data-position=\"0-10-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"開始時刻\"> &gt; 開始時刻</span></a>開始時刻</h3>\n<p data-sourcepos=\"356:1-356:9\">4:19 0:10</p>\n<h3 data-sourcepos=\"357:1-357:10\" id=\"0-10-2\" name=\"0-10-2\"><a class=\"anchor\" id=\"手順-6\" name=\"手順-6\" href=\"#手順-6\" data-position=\"0-10-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"手順\"> &gt; 手順</span></a>手順</h3>\n<p data-sourcepos=\"358:1-358:32\"><code>show session_replication_role;</code></p>\n<h3 data-sourcepos=\"359:1-359:13\" id=\"0-10-3\" name=\"0-10-3\"><a class=\"anchor\" id=\"実行後-6\" name=\"実行後-6\" href=\"#実行後-6\" data-position=\"0-10-3\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"実行後\"> &gt; 実行後</span></a>実行後</h3>\n<div class=\"code-block\" data-sourcepos=\"360:1-364:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sql</div><div class=\"highlight\"><pre class=\"highlight sql\"><code><span class=\"n\">kingapi</span><span class=\"o\">=&gt;</span> <span class=\"k\">show</span> <span class=\"n\">session_replication_role</span><span class=\"p\">;</span>\n<span class=\"o\">-</span><span class=\"p\">[</span> <span class=\"n\">RECORD</span> <span class=\"mi\">1</span> <span class=\"p\">]</span><span class=\"c1\">------------+-------</span>\n<span class=\"n\">session_replication_role</span> <span class=\"o\">|</span> <span class=\"n\">origin</span>\n</code></pre></div></div>\n<h2 data-sourcepos=\"365:1-365:21\" id=\"0-11-0\" name=\"0-11-0\"><a class=\"anchor\" id=\"27_監視止める\" name=\"27_監視止める\" href=\"#27_監視止める\" data-position=\"0-11-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"27_監視止める\"> &gt; 27_監視止める</span></a>27_監視止める</h2>\n<h3 data-sourcepos=\"366:1-366:16\" id=\"0-11-1\" name=\"0-11-1\"><a class=\"anchor\" id=\"開始時刻-7\" name=\"開始時刻-7\" href=\"#開始時刻-7\" data-position=\"0-11-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"開始時刻\"> &gt; 開始時刻</span></a>開始時刻</h3>\n<p data-sourcepos=\"367:1-367:10\">4:18 23:55</p>\n<h3 data-sourcepos=\"368:1-368:10\" id=\"0-11-2\" name=\"0-11-2\"><a class=\"anchor\" id=\"手順-7\" name=\"手順-7\" href=\"#手順-7\" data-position=\"0-11-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"手順\"> &gt; 手順</span></a>手順</h3>\n<p data-sourcepos=\"369:1-369:13\">pingdom操作</p>\n<h3 data-sourcepos=\"370:1-370:13\" id=\"0-11-3\" name=\"0-11-3\"><a class=\"anchor\" id=\"実行後-7\" name=\"実行後-7\" href=\"#実行後-7\" data-position=\"0-11-3\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"実行後\"> &gt; 実行後</span></a>実行後</h3>\n<h2 data-sourcepos=\"372:1-372:34\" id=\"0-12-0\" name=\"0-12-0\"><a class=\"anchor\" id=\"29_prod-king-opeメンテイン\" name=\"29_prod-king-opeメンテイン\" href=\"#29_prod-king-opeメンテイン\" data-position=\"0-12-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"29_prod-king-opeメンテイン\"> &gt; 29_prod-king-opeメンテイン</span></a>29_prod-king-opeメンテイン</h2>\n<h3 data-sourcepos=\"373:1-373:16\" id=\"0-12-1\" name=\"0-12-1\"><a class=\"anchor\" id=\"開始時刻-8\" name=\"開始時刻-8\" href=\"#開始時刻-8\" data-position=\"0-12-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"開始時刻\"> &gt; 開始時刻</span></a>開始時刻</h3>\n<p data-sourcepos=\"374:1-374:9\">4/19 0:40</p>\n<h3 data-sourcepos=\"375:1-375:10\" id=\"0-12-2\" name=\"0-12-2\"><a class=\"anchor\" id=\"手順-8\" name=\"手順-8\" href=\"#手順-8\" data-position=\"0-12-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"手順\"> &gt; 手順</span></a>手順</h3>\n<div class=\"code-block\" data-sourcepos=\"376:1-385:3\"><div class=\"highlight\"><pre class=\"highlight plaintext\"><code>heroku apps:info -a prod-king-ope\n\nheroku maintenance:on -a prod-king-ope\nheroku ps:scale web=0 -a prod-king-ope\n\nheroku apps:info -a prod-king-ope\n\nheroku logs -t -a prod-king-ope\n</code></pre></div></div>\n<h3 data-sourcepos=\"386:1-386:13\" id=\"0-12-3\" name=\"0-12-3\"><a class=\"anchor\" id=\"実行後-8\" name=\"実行後-8\" href=\"#実行後-8\" data-position=\"0-12-3\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"実行後\"> &gt; 実行後</span></a>実行後</h3>\n<h2 data-sourcepos=\"388:1-388:46\" id=\"0-13-0\" name=\"0-13-0\"><a class=\"anchor\" id=\"30_customer-support-api-prodメンテイン\" name=\"30_customer-support-api-prodメンテイン\" href=\"#30_customer-support-api-prodメンテイン\" data-position=\"0-13-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"30_customer-support-api-prodメンテイン\"> &gt; 30_customer-support-api-prodメンテイン</span></a>30_customer-support-api-prodメンテイン</h2>\n<h3 data-sourcepos=\"389:1-389:16\" id=\"0-13-1\" name=\"0-13-1\"><a class=\"anchor\" id=\"開始時刻-9\" name=\"開始時刻-9\" href=\"#開始時刻-9\" data-position=\"0-13-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"開始時刻\"> &gt; 開始時刻</span></a>開始時刻</h3>\n<p data-sourcepos=\"390:1-390:9\">4/19 0:40</p>\n<h3 data-sourcepos=\"391:1-391:10\" id=\"0-13-2\" name=\"0-13-2\"><a class=\"anchor\" id=\"手順-9\" name=\"手順-9\" href=\"#手順-9\" data-position=\"0-13-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"手順\"> &gt; 手順</span></a>手順</h3>\n<div class=\"code-block\" data-sourcepos=\"392:1-401:3\"><div class=\"highlight\"><pre class=\"highlight plaintext\"><code>heroku apps:info -a customer-support-api-production\n\nheroku maintenance:on -a customer-support-api-production\nheroku ps:scale web=0 -a customer-support-api-production\n\nheroku apps:info -a customer-support-api-production\n\nheroku logs -t -a customer-support-api-production\n</code></pre></div></div>\n<h3 data-sourcepos=\"402:1-402:13\" id=\"0-13-3\" name=\"0-13-3\"><a class=\"anchor\" id=\"実行後-9\" name=\"実行後-9\" href=\"#実行後-9\" data-position=\"0-13-3\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"実行後\"> &gt; 実行後</span></a>実行後</h3>\n<h2 data-sourcepos=\"404:1-404:43\" id=\"0-14-0\" name=\"0-14-0\"><a class=\"anchor\" id=\"33_roomon-api-production メンテイン\" name=\"33_roomon-api-production メンテイン\" href=\"#33_roomon-api-production メンテイン\" data-position=\"0-14-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"33_roomon-api-production メンテイン\"> &gt; 33_roomon-api-production メンテイン</span></a>33_roomon-api-production メンテイン</h2>\n<h3 data-sourcepos=\"405:1-405:16\" id=\"0-14-1\" name=\"0-14-1\"><a class=\"anchor\" id=\"開始時刻-10\" name=\"開始時刻-10\" href=\"#開始時刻-10\" data-position=\"0-14-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"開始時刻\"> &gt; 開始時刻</span></a>開始時刻</h3>\n<p data-sourcepos=\"406:1-406:9\">4/19 1:00</p>\n<h3 data-sourcepos=\"407:1-407:10\" id=\"0-14-2\" name=\"0-14-2\"><a class=\"anchor\" id=\"手順-10\" name=\"手順-10\" href=\"#手順-10\" data-position=\"0-14-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"手順\"> &gt; 手順</span></a>手順</h3>\n<div class=\"code-block\" data-sourcepos=\"408:1-419:3\"><div class=\"highlight\"><pre class=\"highlight plaintext\"><code>スケジューラーの削除\n\nheroku apps:info -a roomon-api-production\n\nheroku maintenance:on -a roomon-api-production\nheroku ps:scale web=0 -a roomon-api-production\n\nheroku apps:info -a roomon-api-production\n\nheroku logs -t -a roomon-api-production\n</code></pre></div></div>\n<h3 data-sourcepos=\"420:1-420:13\" id=\"0-14-3\" name=\"0-14-3\"><a class=\"anchor\" id=\"実行後-10\" name=\"実行後-10\" href=\"#実行後-10\" data-position=\"0-14-3\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"実行後\"> &gt; 実行後</span></a>実行後</h3>\n<h2 data-sourcepos=\"422:1-422:43\" id=\"0-15-0\" name=\"0-15-0\"><a class=\"anchor\" id=\"34_sirius-api-production メンテイン\" name=\"34_sirius-api-production メンテイン\" href=\"#34_sirius-api-production メンテイン\" data-position=\"0-15-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"34_sirius-api-production メンテイン\"> &gt; 34_sirius-api-production メンテイン</span></a>34_sirius-api-production メンテイン</h2>\n<h3 data-sourcepos=\"423:1-423:16\" id=\"0-15-1\" name=\"0-15-1\"><a class=\"anchor\" id=\"開始時刻-11\" name=\"開始時刻-11\" href=\"#開始時刻-11\" data-position=\"0-15-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"開始時刻\"> &gt; 開始時刻</span></a>開始時刻</h3>\n<p data-sourcepos=\"424:1-424:9\">4/19 1:00</p>\n<h3 data-sourcepos=\"425:1-425:10\" id=\"0-15-2\" name=\"0-15-2\"><a class=\"anchor\" id=\"手順-11\" name=\"手順-11\" href=\"#手順-11\" data-position=\"0-15-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"手順\"> &gt; 手順</span></a>手順</h3>\n<div class=\"code-block\" data-sourcepos=\"426:1-443:3\"><div class=\"highlight\"><pre class=\"highlight plaintext\"><code>スケジューラーの削除\n\nheroku apps:info -a sirius-api-production\n\nheroku maintenance:on -a sirius-api-production\nheroku ps:scale web=0 -a sirius-api-production\nheroku ps:scale worker=0 -a sirius-api-production\n\n反映を確認\nheroku apps:info -a sirius-api-production\n\nメンテモードを確認\nhttps://sirius-api-production.herokuapp.com/\n\nログを確認\nheroku logs -t -a sirius-api-production\n</code></pre></div></div>\n<h3 data-sourcepos=\"444:1-444:13\" id=\"0-15-3\" name=\"0-15-3\"><a class=\"anchor\" id=\"実行後-11\" name=\"実行後-11\" href=\"#実行後-11\" data-position=\"0-15-3\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"実行後\"> &gt; 実行後</span></a>実行後</h3>\n<h2 data-sourcepos=\"446:1-446:26\" id=\"0-16-0\" name=\"0-16-0\"><a class=\"anchor\" id=\"35_king メンテイン\" name=\"35_king メンテイン\" href=\"#35_king メンテイン\" data-position=\"0-16-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"35_king メンテイン\"> &gt; 35_king メンテイン</span></a>35_king メンテイン</h2>\n<h3 data-sourcepos=\"447:1-447:16\" id=\"0-16-1\" name=\"0-16-1\"><a class=\"anchor\" id=\"開始時刻-12\" name=\"開始時刻-12\" href=\"#開始時刻-12\" data-position=\"0-16-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"開始時刻\"> &gt; 開始時刻</span></a>開始時刻</h3>\n<p data-sourcepos=\"448:1-448:9\">4/19 1:00</p>\n<h3 data-sourcepos=\"449:1-449:10\" id=\"0-16-2\" name=\"0-16-2\"><a class=\"anchor\" id=\"手順-12\" name=\"手順-12\" href=\"#手順-12\" data-position=\"0-16-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"手順\"> &gt; 手順</span></a>手順</h3>\n<div class=\"code-block\" data-sourcepos=\"450:1-460:3\"><div class=\"highlight\"><pre class=\"highlight plaintext\"><code>heroku apps:info -a sl2-api-production\n\nheroku maintenance:on -a sl2-api-production\nheroku ps:scale web=0 -a sl2-api-production\nheroku ps:scale worker=0 -a sl2-api-production\n\nheroku apps:info -a sl2-api-production\n\nheroku logs -t -a sl2-api-production\n</code></pre></div></div>\n<h3 data-sourcepos=\"461:1-461:13\" id=\"0-16-3\" name=\"0-16-3\"><a class=\"anchor\" id=\"実行後-12\" name=\"実行後-12\" href=\"#実行後-12\" data-position=\"0-16-3\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"実行後\"> &gt; 実行後</span></a>実行後</h3>\n<h2 data-sourcepos=\"463:1-463:37\" id=\"0-17-0\" name=\"0-17-0\"><a class=\"anchor\" id=\"37_logs, display_logs以外のdump\" name=\"37_logs, display_logs以外のdump\" href=\"#37_logs, display_logs以外のdump\" data-position=\"0-17-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"37_logs, display_logs以外のdump\"> &gt; 37_logs, display_logs以外のdump</span></a>37_logs, display_logs以外のdump</h2>\n<h3 data-sourcepos=\"464:1-464:16\" id=\"0-17-1\" name=\"0-17-1\"><a class=\"anchor\" id=\"開始時刻-13\" name=\"開始時刻-13\" href=\"#開始時刻-13\" data-position=\"0-17-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"開始時刻\"> &gt; 開始時刻</span></a>開始時刻</h3>\n<p data-sourcepos=\"465:1-465:9\">4/19 1:06</p>\n<h3 data-sourcepos=\"466:1-466:10\" id=\"0-17-2\" name=\"0-17-2\"><a class=\"anchor\" id=\"手順-13\" name=\"手順-13\" href=\"#手順-13\" data-position=\"0-17-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"手順\"> &gt; 手順</span></a>手順</h3>\n<div class=\"code-block\" data-sourcepos=\"467:1-470:3\"><div class=\"highlight\"><pre class=\"highlight plaintext\"><code>pg_dump --format=custom --verbose --data-only --exclude-table=logs --exclude-table=display_logs -h vpce-0bed708f6ce21788a-f4tmby1p.vpce-svc-0de703034cbfc279a.ap-northeast-1.vpce.amazonaws.com -U ubev937lfpa1d3 -p 5432 -d dncvsso7me9p6 &gt; main_data.dump\n</code></pre></div></div>\n<h3 data-sourcepos=\"471:1-471:13\" id=\"0-17-3\" name=\"0-17-3\"><a class=\"anchor\" id=\"実行後-13\" name=\"実行後-13\" href=\"#実行後-13\" data-position=\"0-17-3\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"実行後\"> &gt; 実行後</span></a>実行後</h3>\n<details>\n<div class=\"code-block\" data-sourcepos=\"475:1-807:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>pg_dump <span class=\"nt\">--format</span><span class=\"o\">=</span>custom <span class=\"nt\">--verbose</span> <span class=\"nt\">--data-only</span> <span class=\"nt\">--exclude-table</span><span class=\"o\">=</span>logs <span class=\"nt\">--exclude-table</span><span class=\"o\">=</span>display_logs <span class=\"nt\">-h</span> vpce-0bed708f6ce21788a-f4tmby1p.vpce-svc-0de703034cbfc279a.ap-northeast-1.vpce.amazonaws.com <span class=\"nt\">-U</span> ubev937lfpa1d3 <span class=\"nt\">-p</span> 5432 <span class=\"nt\">-d</span> dncvsso7me9p6 <span class=\"o\">&gt;</span> main_data.dump\npg_dump: last built-in OID is 16383\npg_dump: reading extensions\npg_dump: identifying extension members\npg_dump: reading schemas\npg_dump: reading user-defined tables\npg_dump: reading user-defined functions\npg_dump: reading user-defined types\npg_dump: reading procedural languages\npg_dump: reading user-defined aggregate functions\npg_dump: reading user-defined operators\npg_dump: reading user-defined access methods\npg_dump: reading user-defined operator classes\npg_dump: reading user-defined operator families\npg_dump: reading user-defined text search parsers\npg_dump: reading user-defined text search templates\npg_dump: reading user-defined text search dictionaries\npg_dump: reading user-defined text search configurations\npg_dump: reading user-defined foreign-data wrappers\npg_dump: reading user-defined foreign servers\npg_dump: reading default privileges\npg_dump: reading user-defined collations\npg_dump: reading user-defined conversions\npg_dump: reading <span class=\"nb\">type </span>casts\npg_dump: reading transforms\npg_dump: reading table inheritance information\npg_dump: reading event triggers\npg_dump: finding extension tables\npg_dump: finding inheritance relationships\npg_dump: reading column info <span class=\"k\">for </span>interesting tables\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.schema_migrations\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.ar_internal_metadata\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.locks\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.hubs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.fobs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.users\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.master_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.lock_settings\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.term_of_validities\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.durations\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.dailies\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.weeklies\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.family_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.guest_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.fob_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.invitations\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.json_web_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.command_logs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.webhook_tokens\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.lock_webhook_tokens\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.delayed_jobs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.managers\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.webhooks\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.autolock_schedules\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.relationships\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.wenas\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.wena_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.knights\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.knight_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.knight_cards\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.knight_pins\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.knight_commands\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.knight_logs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.entrance_locks\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.entrance_master_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.entrance_lock_settings\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.entrance_knight_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.entrance_knight_pins\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.resident_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.entrance_resident_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.entrance_invitations\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.resident_guest_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.entrance_resident_guest_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.entrance_fob_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.mst_display_logs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.door_mode_changed_histories\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.entrance_block_knight_cards\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.entrance_block_fob_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.active_storage_blobs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.active_storage_attachments\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.active_storage_variant_records\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.pg_stat_statements_info\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.pg_stat_statements\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.laresia_pins\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.bucardo_delta_names\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.bucardo_delta_targets\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.bucardo_truncate_trigger\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.bucardo_truncate_trigger_log\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.bucardo_sequences\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.delta_public_display_logs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.track_public_display_logs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.stage_public_display_logs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.delta_public_logs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.track_public_logs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.stage_public_logs\"</span>\npg_dump: flagging inherited columns <span class=\"k\">in </span>subtables\npg_dump: reading indexes\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.schema_migrations\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.ar_internal_metadata\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.locks\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.hubs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.fobs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.users\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.master_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.lock_settings\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.term_of_validities\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.durations\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.dailies\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.weeklies\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.family_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.guest_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.fob_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.invitations\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.json_web_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.command_logs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.webhook_tokens\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.lock_webhook_tokens\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.delayed_jobs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.managers\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.webhooks\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.autolock_schedules\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.relationships\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.wenas\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.wena_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.knights\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_cards\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_pins\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_commands\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_logs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_locks\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_master_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_lock_settings\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_knight_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_knight_pins\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.resident_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_resident_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_invitations\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.resident_guest_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_resident_guest_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_fob_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.mst_display_logs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.door_mode_changed_histories\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_block_knight_cards\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_block_fob_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.active_storage_blobs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.active_storage_attachments\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.active_storage_variant_records\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.laresia_pins\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.bucardo_delta_names\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.bucardo_delta_targets\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.bucardo_truncate_trigger\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.bucardo_sequences\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_display_logs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_display_logs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_logs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_logs\"</span>\npg_dump: flagging indexes <span class=\"k\">in </span>partitioned tables\npg_dump: reading extended statistics\npg_dump: reading constraints\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.locks\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.hubs\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.fobs\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.users\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.master_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.lock_settings\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.term_of_validities\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.durations\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.dailies\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.weeklies\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.family_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.guest_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.fob_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.invitations\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.command_logs\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.webhook_tokens\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.lock_webhook_tokens\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.managers\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.webhooks\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.autolock_schedules\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.relationships\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.wenas\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.wena_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.knights\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_cards\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_pins\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_logs\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_locks\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_master_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_lock_settings\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_knight_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_knight_pins\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.resident_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_resident_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_invitations\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.resident_guest_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_resident_guest_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_fob_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.mst_display_logs\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.door_mode_changed_histories\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_block_knight_cards\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_block_fob_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.active_storage_blobs\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.active_storage_attachments\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.active_storage_variant_records\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.laresia_pins\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.bucardo_delta_names\"</span>\npg_dump: reading triggers\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.locks\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.hubs\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.fobs\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.users\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.master_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.lock_settings\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.term_of_validities\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.durations\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.dailies\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.weeklies\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.family_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.guest_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.fob_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.invitations\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.command_logs\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.webhook_tokens\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.lock_webhook_tokens\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.managers\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.webhooks\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.autolock_schedules\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.relationships\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.wenas\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.wena_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.knights\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_cards\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_pins\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_logs\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_locks\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_master_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_lock_settings\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_knight_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_knight_pins\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.resident_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_resident_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_invitations\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.resident_guest_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_resident_guest_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_fob_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.mst_display_logs\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.door_mode_changed_histories\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_block_knight_cards\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_block_fob_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.active_storage_blobs\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.active_storage_attachments\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.active_storage_variant_records\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.laresia_pins\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.bucardo_delta_names\"</span>\npg_dump: reading rewrite rules\npg_dump: reading policies\npg_dump: reading row-level security policies\npg_dump: reading publications\npg_dump: reading publication membership\npg_dump: reading subscriptions\npg_dump: reading large objects\npg_dump: reading dependency data\npg_dump: saving encoding <span class=\"o\">=</span> UTF8\npg_dump: saving standard_conforming_strings <span class=\"o\">=</span> on\npg_dump: saving search_path <span class=\"o\">=</span>\npg_dump: saving database definition\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.bucardo_delta_names\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.bucardo_delta_targets\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.bucardo_sequences\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.bucardo_truncate_trigger\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.bucardo_truncate_trigger_log\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.delta_public_display_logs\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.delta_public_logs\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.stage_public_display_logs\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.stage_public_logs\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.track_public_display_logs\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.track_public_logs\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.active_storage_blobs\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.active_storage_attachments\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.active_storage_variant_records\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.ar_internal_metadata\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.locks\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.users\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.master_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.autolock_schedules\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.hubs\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.command_logs\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.term_of_validities\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.dailies\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.delayed_jobs\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.door_mode_changed_histories\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.durations\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.entrance_locks\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.entrance_master_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.fobs\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.fob_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.entrance_fob_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.entrance_block_fob_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.knights\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.entrance_knight_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.knight_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.knight_cards\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.entrance_block_knight_cards\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.invitations\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.entrance_invitations\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.entrance_knight_pins\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.entrance_lock_settings\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.resident_guest_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.entrance_resident_guest_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.resident_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.entrance_resident_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.family_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.guest_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.json_web_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.knight_commands\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.knight_logs\"</span>pg_dump: dumping contents of table <span class=\"s2\">\"public.knight_pins\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.laresia_pins\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.lock_settings\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.webhook_tokens\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.lock_webhook_tokens\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.managers\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.mst_display_logs\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.relationships\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.schema_migrations\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.webhooks\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.weeklies\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.wenas\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.wena_keys\"</span>\n</code></pre></div></div>\n</details>\n<h2 data-sourcepos=\"810:1-810:40\" id=\"0-18-0\" name=\"0-18-0\"><a class=\"anchor\" id=\"38_logs, display_logs以外のrestore\" name=\"38_logs, display_logs以外のrestore\" href=\"#38_logs, display_logs以外のrestore\" data-position=\"0-18-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"38_logs, display_logs以外のrestore\"> &gt; 38_logs, display_logs以外のrestore</span></a>38_logs, display_logs以外のrestore</h2>\n<h3 data-sourcepos=\"811:1-811:16\" id=\"0-18-1\" name=\"0-18-1\"><a class=\"anchor\" id=\"開始時刻-14\" name=\"開始時刻-14\" href=\"#開始時刻-14\" data-position=\"0-18-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"開始時刻\"> &gt; 開始時刻</span></a>開始時刻</h3>\n<p data-sourcepos=\"812:1-812:9\">4/19 1:14</p>\n<h3 data-sourcepos=\"813:1-813:10\" id=\"0-18-2\" name=\"0-18-2\"><a class=\"anchor\" id=\"手順-14\" name=\"手順-14\" href=\"#手順-14\" data-position=\"0-18-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"手順\"> &gt; 手順</span></a>手順</h3>\n<div class=\"code-block\" data-sourcepos=\"814:1-816:3\"><div class=\"highlight\"><pre class=\"highlight plaintext\"><code>pg_restore --verbose --data-only -h king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com -p 5432 -d kingapi -U kingadmin main_data.dump\n</code></pre></div></div>\n<h3 data-sourcepos=\"817:1-817:13\" id=\"0-18-3\" name=\"0-18-3\"><a class=\"anchor\" id=\"実行後-14\" name=\"実行後-14\" href=\"#実行後-14\" data-position=\"0-18-3\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"実行後\"> &gt; 実行後</span></a>実行後</h3>\n<details>\n```\npg_restore --verbose --data-only -h king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com -p 5432 -d kingapi -U kingadmin main_data.dump\npg_restore: connecting to database for restore\npg_restore: processing data for table \"bucardo.bucardo_delta_names\"\npg_restore: while PROCESSING TOC:\npg_restore: from TOC entry 4966; 0 39797081 TABLE DATA bucardo_delta_names ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  schema \"bucardo\" does not exist\nCommand was: COPY bucardo.bucardo_delta_names (sync, tablename, deltaname, trackname, cdate) FROM stdin;\npg_restore: processing data for table \"bucardo.bucardo_delta_targets\"\npg_restore: from TOC entry 4967; 0 39797089 TABLE DATA bucardo_delta_targets ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  schema \"bucardo\" does not exist\nCommand was: COPY bucardo.bucardo_delta_targets (tablename, target, cdate) FROM stdin;\npg_restore: processing data for table \"bucardo.bucardo_sequences\"\npg_restore: from TOC entry 4970; 0 39797108 TABLE DATA bucardo_sequences ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  schema \"bucardo\" does not exist\nCommand was: COPY bucardo.bucardo_sequences (schemaname, seqname, syncname, targetname, last_value, start_value, increment_by, max_value, min_value, is_cycled, is_called) FROM stdin;\npg_restore: processing data for table \"bucardo.bucardo_truncate_trigger\"\npg_restore: from TOC entry 4968; 0 39797095 TABLE DATA bucardo_truncate_trigger ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  schema \"bucardo\" does not exist\nCommand was: COPY bucardo.bucardo_truncate_trigger (tablename, sname, tname, sync, replicated, cdate) FROM stdin;\npg_restore: processing data for table \"bucardo.bucardo_truncate_trigger_log\"\npg_restore: from TOC entry 4969; 0 39797102 TABLE DATA bucardo_truncate_trigger_log ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  schema \"bucardo\" does not exist\nCommand was: COPY bucardo.bucardo_truncate_trigger_log (tablename, sname, tname, sync, target, replicated, cdate) FROM stdin;\npg_restore: processing data for table \"bucardo.delta_public_display_logs\"\npg_restore: from TOC entry 4971; 0 39797115 TABLE DATA delta_public_display_logs ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  schema \"bucardo\" does not exist\nCommand was: COPY bucardo.delta_public_display_logs (id, txntime) FROM stdin;\npg_restore: processing data for table \"bucardo.delta_public_logs\"\npg_restore: from TOC entry 4974; 0 39797137 TABLE DATA delta_public_logs ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  schema \"bucardo\" does not exist\nCommand was: COPY bucardo.delta_public_logs (id, txntime) FROM stdin;\npg_restore: processing data for table \"bucardo.stage_public_display_logs\"\npg_restore: from TOC entry 4973; 0 39797129 TABLE DATA stage_public_display_logs ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  schema \"bucardo\" does not exist\nCommand was: COPY bucardo.stage_public_display_logs (txntime, target) FROM stdin;\npg_restore: processing data for table \"bucardo.stage_public_logs\"\npg_restore: from TOC entry 4976; 0 39797151 TABLE DATA stage_public_logs ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  schema \"bucardo\" does not exist\nCommand was: COPY bucardo.stage_public_logs (txntime, target) FROM stdin;\npg_restore: processing data for table \"bucardo.track_public_display_logs\"\npg_restore: from TOC entry 4972; 0 39797123 TABLE DATA track_public_display_logs ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  schema \"bucardo\" does not exist\nCommand was: COPY bucardo.track_public_display_logs (txntime, target) FROM stdin;\npg_restore: processing data for table \"bucardo.track_public_logs\"\npg_restore: from TOC entry 4975; 0 39797145 TABLE DATA track_public_logs ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  schema \"bucardo\" does not exist\nCommand was: COPY bucardo.track_public_logs (txntime, target) FROM stdin;\npg_restore: processing data for table \"public.active_storage_blobs\"\npg_restore: processing data for table \"public.active_storage_attachments\"\npg_restore: processing data for table \"public.active_storage_variant_records\"\npg_restore: processing data for table \"public.ar_internal_metadata\"\npg_restore: processing data for table \"public.locks\"\npg_restore: processing data for table \"public.users\"\npg_restore: processing data for table \"public.master_keys\"\npg_restore: processing data for table \"public.autolock_schedules\"\npg_restore: processing data for table \"public.hubs\"\npg_restore: processing data for table \"public.command_logs\"\npg_restore: processing data for table \"public.term_of_validities\"\npg_restore: processing data for table \"public.dailies\"\npg_restore: processing data for table \"public.delayed_jobs\"\npg_restore: processing data for table \"public.door_mode_changed_histories\"\npg_restore: processing data for table \"public.durations\"\npg_restore: processing data for table \"public.entrance_locks\"\npg_restore: processing data for table \"public.entrance_master_keys\"\npg_restore: processing data for table \"public.fobs\"\npg_restore: processing data for table \"public.fob_keys\"\npg_restore: processing data for table \"public.entrance_fob_keys\"\npg_restore: processing data for table \"public.entrance_block_fob_keys\"\npg_restore: processing data for table \"public.knights\"\npg_restore: processing data for table \"public.entrance_knight_keys\"\npg_restore: processing data for table \"public.knight_keys\"\npg_restore: processing data for table \"public.knight_cards\"\npg_restore: processing data for table \"public.entrance_block_knight_cards\"\npg_restore: processing data for table \"public.invitations\"\npg_restore: processing data for table \"public.entrance_invitations\"\npg_restore: processing data for table \"public.entrance_knight_pins\"\npg_restore: processing data for table \"public.entrance_lock_settings\"\npg_restore: processing data for table \"public.resident_guest_keys\"\npg_restore: processing data for table \"public.entrance_resident_guest_keys\"\npg_restore: processing data for table \"public.resident_keys\"\npg_restore: processing data for table \"public.entrance_resident_keys\"\npg_restore: processing data for table \"public.family_keys\"\npg_restore: processing data for table \"public.guest_keys\"\npg_restore: processing data for table \"public.json_web_keys\"\npg_restore: processing data for table \"public.knight_commands\"\npg_restore: processing data for table \"public.knight_logs\"pg_restore: processing data for table \"public.knight_pins\"\npg_restore: processing data for table \"public.laresia_pins\"\npg_restore: processing data for table \"public.lock_settings\"\npg_restore: processing data for table \"public.webhook_tokens\"\npg_restore: processing data for table \"public.lock_webhook_tokens\"\npg_restore: processing data for table \"public.managers\"\npg_restore: processing data for table \"public.mst_display_logs\"\npg_restore: processing data for table \"public.relationships\"\npg_restore: processing data for table \"public.schema_migrations\"\npg_restore: processing data for table \"public.webhooks\"\npg_restore: processing data for table \"public.weeklies\"\npg_restore: processing data for table \"public.wenas\"\npg_restore: processing data for table \"public.wena_keys\"\npg_restore: executing SEQUENCE SET active_storage_attachments_id_seq\npg_restore: executing SEQUENCE SET active_storage_blobs_id_seq\npg_restore: executing SEQUENCE SET active_storage_variant_records_id_seq\npg_restore: executing SEQUENCE SET delayed_jobs_id_seq\npg_restore: executing SEQUENCE SET json_web_keys_id_seq\npg_restore: warning: errors ignored on restore: 11\n```\n</details>\n<p data-sourcepos=\"928:1-928:75\">エラー数11がbucardoスキーマに関する内容なので問題なし</p>\n<h2 data-sourcepos=\"929:1-929:45\" id=\"0-19-0\" name=\"0-19-0\"><a class=\"anchor\" id=\"40_bucardo流し込み(logs, display_logs)\" name=\"40_bucardo流し込み(logs, display_logs)\" href=\"#40_bucardo流し込み(logs, display_logs)\" data-position=\"0-19-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"40_bucardo流し込み(logs, display_logs)\"> &gt; 40_bucardo流し込み(logs, display_logs)</span></a>40_bucardo流し込み(logs, display_logs)</h2>\n<h3 data-sourcepos=\"930:1-930:16\" id=\"0-19-1\" name=\"0-19-1\"><a class=\"anchor\" id=\"開始時刻-15\" name=\"開始時刻-15\" href=\"#開始時刻-15\" data-position=\"0-19-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"開始時刻\"> &gt; 開始時刻</span></a>開始時刻</h3>\n<p data-sourcepos=\"931:1-931:9\">4/19 1:49</p>\n<h3 data-sourcepos=\"932:1-932:10\" id=\"0-19-2\" name=\"0-19-2\"><a class=\"anchor\" id=\"手順-15\" name=\"手順-15\" href=\"#手順-15\" data-position=\"0-19-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"手順\"> &gt; 手順</span></a>手順</h3>\n<div class=\"code-block\" data-sourcepos=\"933:1-935:3\"><div class=\"highlight\"><pre class=\"highlight plaintext\"><code>bucardo start\n</code></pre></div></div>\n<h3 data-sourcepos=\"936:1-936:13\" id=\"0-19-3\" name=\"0-19-3\"><a class=\"anchor\" id=\"実行後-15\" name=\"実行後-15\" href=\"#実行後-15\" data-position=\"0-19-3\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"実行後\"> &gt; 実行後</span></a>実行後</h3>\n<div class=\"code-block\" data-sourcepos=\"937:1-1013:3\"><div class=\"highlight\"><pre class=\"highlight plaintext\"><code>bucardo start\nChecking for existing processes\nStarting Bucardo\n# bucardo status sync_heroku_aws\n======================================================================\nSync name                : sync_heroku_aws\nCurrent state            : Get deltas from db heroku_db\nSource relgroup/database : herd_heroku_db / heroku_db\nTables in sync           : 2\nStatus                   : Active\nCheck time               : None\nOverdue time             : 00:00:00\nExpired time             : 00:00:00\nStayalive/Kidsalive      : Yes / Yes\nRebuild index            : No\nAutokick                 : Yes\nOnetimecopy              : No\nPost-copy analyze        : Yes\nLast error:              :\n======================================================================\n\nbucardo status sync_heroku_aws\n======================================================================\nSync name                : sync_heroku_aws\nCurrent state            : Deleting based on heroku_db.public.logs\nSource relgroup/database : herd_heroku_db / heroku_db\nTables in sync           : 2\nStatus                   : Active\nCheck time               : None\nOverdue time             : 00:00:00\nExpired time             : 00:00:00\nStayalive/Kidsalive      : Yes / Yes\nRebuild index            : No\nAutokick                 : Yes\nOnetimecopy              : No\nPost-copy analyze        : Yes\nLast error:              :\n======================================================================\n\nbucardo status sync_heroku_aws\n======================================================================\nSync name                : sync_heroku_aws\nCurrent state            : Copying from heroku_db.public.logs\nSource relgroup/database : herd_heroku_db / heroku_db\nTables in sync           : 2\nStatus                   : Active\nCheck time               : None\nOverdue time             : 00:00:00\nExpired time             : 00:00:00\nStayalive/Kidsalive      : Yes / Yes\nRebuild index            : No\nAutokick                 : Yes\nOnetimecopy              : No\nPost-copy analyze        : Yes\nLast error:              :\n======================================================================\n2:48頃\nbucardo status sync_heroku_aws\n======================================================================\nSync name                : sync_heroku_aws\nCurrent state            : Deleting based on heroku_db.public.display_logs\nSource relgroup/database : herd_heroku_db / heroku_db\nTables in sync           : 2\nStatus                   : Active\nCheck time               : None\nOverdue time             : 00:00:00\nExpired time             : 00:00:00\nStayalive/Kidsalive      : Yes / Yes\nRebuild index            : No\nAutokick                 : Yes\nOnetimecopy              : No\nPost-copy analyze        : Yes\nLast error:              :\n======================================================================\n</code></pre></div></div>\n<div class=\"code-block\" data-sourcepos=\"1015:1-1048:3\"><div class=\"highlight\"><pre class=\"highlight plaintext\"><code>tail -F /var/log/bucardo/log.bucardo\n(4672) [Tue Apr 18 16:49:11 2023] VAC New VAC daemon. PID=4672\n(4672) [Tue Apr 18 16:49:11 2023] VAC Connected to database \"heroku_db\" with backend PID of 257387\n(4670) [Tue Apr 18 16:49:11 2023] MCP Created VAC 4672\n(4674) [Tue Apr 18 16:49:12 2023] CTL New controller for sync \"sync_heroku_aws\". Relgroup is \"herd_heroku_db\", dbs is \"dbs\". PID=4674\n(4674) [Tue Apr 18 16:49:12 2023] CTL   stayalive: 1 checksecs: 0 kicked: 1\n(4674) [Tue Apr 18 16:49:12 2023] CTL   kidsalive: 1 onetimecopy: 0 lifetimesecs: 0 (NULL) maxkicks: 0\n(4674) [Tue Apr 18 16:49:12 2023] CTL Database \"aws_db\" backend PID: 63600\n(4670) [Tue Apr 18 16:49:12 2023] MCP Created controller 4674 for sync \"sync_heroku_aws\". Kick is 1\n(4674) [Tue Apr 18 16:49:12 2023] CTL Database \"heroku_db\" backend PID: 257388\n(4676) [Tue Apr 18 16:49:12 2023] KID (sync_heroku_aws) New kid, sync \"sync_heroku_aws\" alive=1 Parent=4674 PID=4676 kicked=1\n\n2:50\nbucardo status sync_heroku_aws\n======================================================================\nSync name                : sync_heroku_aws\nCurrent state            : Copying from heroku_db.public.display_logs\nSource relgroup/database : herd_heroku_db / heroku_db\nTables in sync           : 2\nStatus                   : Active\nCheck time               : None\nOverdue time             : 00:00:00\nExpired time             : 00:00:00\nStayalive/Kidsalive      : Yes / Yes\nRebuild index            : No\nAutokick                 : Yes\nOnetimecopy              : No\nPost-copy analyze        : Yes\nLast error:              :\n======================================================================\n\n</code></pre></div></div>\n<h2 data-sourcepos=\"1050:1-1050:30\" id=\"0-20-0\" name=\"0-20-0\"><a class=\"anchor\" id=\"43_同期確認チェック\" name=\"43_同期確認チェック\" href=\"#43_同期確認チェック\" data-position=\"0-20-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"43_同期確認チェック\"> &gt; 43_同期確認チェック</span></a>43_同期確認チェック</h2>\n<h3 data-sourcepos=\"1051:1-1051:16\" id=\"0-20-1\" name=\"0-20-1\"><a class=\"anchor\" id=\"開始時刻-16\" name=\"開始時刻-16\" href=\"#開始時刻-16\" data-position=\"0-20-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"開始時刻\"> &gt; 開始時刻</span></a>開始時刻</h3>\n<p data-sourcepos=\"1052:1-1052:9\">4/19 3:08</p>\n<h3 data-sourcepos=\"1053:1-1053:10\" id=\"0-20-2\" name=\"0-20-2\"><a class=\"anchor\" id=\"手順-16\" name=\"手順-16\" href=\"#手順-16\" data-position=\"0-20-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"手順\"> &gt; 手順</span></a>手順</h3>\n<div class=\"code-block\" data-sourcepos=\"1054:1-1056:3\"><div class=\"highlight\"><pre class=\"highlight plaintext\"><code>bucardo status sync_heroku_aws\n</code></pre></div></div>\n<p data-sourcepos=\"1057:1-1057:48\">エラー(Last Error)がないか確認する。</p>\n<h3 data-sourcepos=\"1058:1-1058:13\" id=\"0-20-3\" name=\"0-20-3\"><a class=\"anchor\" id=\"実行後-16\" name=\"実行後-16\" href=\"#実行後-16\" data-position=\"0-20-3\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"実行後\"> &gt; 実行後</span></a>実行後</h3>\n<div class=\"code-block\" data-sourcepos=\"1059:1-1079:3\"><div class=\"highlight\"><pre class=\"highlight plaintext\"><code>bucardo status sync_heroku_aws\n======================================================================\nLast good                : Apr 18, 2023 16:49:12 (time to run: 1h 18m 43s)\nRows deleted/inserted    : 758,129 / 5,968,028\nSync name                : sync_heroku_aws\nCurrent state            : Good\nSource relgroup/database : herd_heroku_db / heroku_db\nTables in sync           : 2\nStatus                   : Active\nCheck time               : None\nOverdue time             : 00:00:00\nExpired time             : 00:00:00\nStayalive/Kidsalive      : Yes / Yes\nRebuild index            : No\nAutokick                 : Yes\nOnetimecopy              : No\nPost-copy analyze        : Yes\nLast error:              :\n======================================================================\n</code></pre></div></div>\n<h2 data-sourcepos=\"1080:1-1080:36\" id=\"0-21-0\" name=\"0-21-0\"><a class=\"anchor\" id=\"44_レコード差分チェック\" name=\"44_レコード差分チェック\" href=\"#44_レコード差分チェック\" data-position=\"0-21-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"44_レコード差分チェック\"> &gt; 44_レコード差分チェック</span></a>44_レコード差分チェック</h2>\n<h3 data-sourcepos=\"1081:1-1081:16\" id=\"0-21-1\" name=\"0-21-1\"><a class=\"anchor\" id=\"開始時刻-17\" name=\"開始時刻-17\" href=\"#開始時刻-17\" data-position=\"0-21-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"開始時刻\"> &gt; 開始時刻</span></a>開始時刻</h3>\n<p data-sourcepos=\"1082:1-1082:9\">4/19 3:10</p>\n<h3 data-sourcepos=\"1083:1-1083:10\" id=\"0-21-2\" name=\"0-21-2\"><a class=\"anchor\" id=\"手順-17\" name=\"手順-17\" href=\"#手順-17\" data-position=\"0-21-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"手順\"> &gt; 手順</span></a>手順</h3>\n<div class=\"code-block\" data-sourcepos=\"1084:1-1086:3\"><div class=\"highlight\"><pre class=\"highlight plaintext\"><code>bash count.sh\n</code></pre></div></div>\n<p data-sourcepos=\"1087:1-1087:55\"><a href=\"https://qrio.esa.io/posts/1629\">https://qrio.esa.io/posts/1629</a> に貼り付け→確認</p>\n<h3 data-sourcepos=\"1088:1-1088:13\" id=\"0-21-3\" name=\"0-21-3\"><a class=\"anchor\" id=\"実行後-17\" name=\"実行後-17\" href=\"#実行後-17\" data-position=\"0-21-3\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"実行後\"> &gt; 実行後</span></a>実行後</h3>\n<p data-sourcepos=\"1089:1-1089:30\"><a href=\"https://qrio.esa.io/posts/1629\">https://qrio.esa.io/posts/1629</a></p>\n<p data-sourcepos=\"1091:1-1091:17\">全チェックOK</p>\n<h2 data-sourcepos=\"1093:1-1093:27\" id=\"0-22-0\" name=\"0-22-0\"><a class=\"anchor\" id=\"45_データ差分残し\" name=\"45_データ差分残し\" href=\"#45_データ差分残し\" data-position=\"0-22-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"45_データ差分残し\"> &gt; 45_データ差分残し</span></a>45_データ差分残し</h2>\n<h3 data-sourcepos=\"1094:1-1094:16\" id=\"0-22-1\" name=\"0-22-1\"><a class=\"anchor\" id=\"開始時刻-18\" name=\"開始時刻-18\" href=\"#開始時刻-18\" data-position=\"0-22-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"開始時刻\"> &gt; 開始時刻</span></a>開始時刻</h3>\n<p data-sourcepos=\"1095:1-1095:14\">4/19 3:17~3:30</p>\n<h3 data-sourcepos=\"1096:1-1096:10\" id=\"0-22-2\" name=\"0-22-2\"><a class=\"anchor\" id=\"手順-18\" name=\"手順-18\" href=\"#手順-18\" data-position=\"0-22-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"手順\"> &gt; 手順</span></a>手順</h3>\n<div class=\"code-block\" data-sourcepos=\"1097:1-1099:3\"><div class=\"highlight\"><pre class=\"highlight plaintext\"><code>bash data_bk.sh\n</code></pre></div></div>\n<h2 data-sourcepos=\"1101:1-1101:56\" id=\"0-23-0\" name=\"0-23-0\"><a class=\"anchor\" id=\"46_EC2上のdocker内で収集したcsvデータのDL\" name=\"46_EC2上のdocker内で収集したcsvデータのDL\" href=\"#46_EC2上のdocker内で収集したcsvデータのDL\" data-position=\"0-23-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"46_EC2上のdocker内で収集したcsvデータのDL\"> &gt; 46_EC2上のdocker内で収集したcsvデータのDL</span></a>46_EC2上のdocker内で収集したcsvデータのDL</h2>\n<h3 data-sourcepos=\"1102:1-1102:16\" id=\"0-23-1\" name=\"0-23-1\"><a class=\"anchor\" id=\"開始時刻-19\" name=\"開始時刻-19\" href=\"#開始時刻-19\" data-position=\"0-23-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"開始時刻\"> &gt; 開始時刻</span></a>開始時刻</h3>\n<p data-sourcepos=\"1103:1-1103:5\">4/19</p>\n<h3 data-sourcepos=\"1104:1-1104:10\" id=\"0-23-2\" name=\"0-23-2\"><a class=\"anchor\" id=\"手順-19\" name=\"手順-19\" href=\"#手順-19\" data-position=\"0-23-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"手順\"> &gt; 手順</span></a>手順</h3>\n<div class=\"code-block\" data-sourcepos=\"1105:1-1111:3\"><div class=\"highlight\"><pre class=\"highlight plaintext\"><code>scp -r -i \"king-api-production-bucardo-ec2.pem\" ubuntu@ec2-52-197-147-182.ap-northeast-1.compute.amazonaws.com:/home/ubuntu/data_bk .\ndisplay_logs_heroku.csv                                100%  289MB  55.9MB/s   00:05\nlogs_heroku.csv                                        100%  838MB  54.1MB/s   00:15\nlogs_aws.csv                                           100%  837MB  52.4MB/s   00:15\ndisplay_logs_aws.csv                                   100%  289MB  56.1MB/s   00:05\n</code></pre></div></div>\n<h3 data-sourcepos=\"1113:1-1113:13\" id=\"0-23-3\" name=\"0-23-3\"><a class=\"anchor\" id=\"実行後-18\" name=\"実行後-18\" href=\"#実行後-18\" data-position=\"0-23-3\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"実行後\"> &gt; 実行後</span></a>実行後</h3>\n<div class=\"code-block\" data-sourcepos=\"1114:1-1119:3\"><div class=\"highlight\"><pre class=\"highlight plaintext\"><code>Copying from container - 2.362GB\nSuccessfully copied 2.362GB to /home/ubuntu/.\n\n</code></pre></div></div>\n<h2 data-sourcepos=\"1120:1-1120:27\" id=\"0-24-0\" name=\"0-24-0\"><a class=\"anchor\" id=\"48_同期確認後完了\" name=\"48_同期確認後完了\" href=\"#48_同期確認後完了\" data-position=\"0-24-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"48_同期確認後完了\"> &gt; 48_同期確認後完了</span></a>48_同期確認後完了</h2>\n<h3 data-sourcepos=\"1121:1-1121:16\" id=\"0-24-1\" name=\"0-24-1\"><a class=\"anchor\" id=\"開始時刻-20\" name=\"開始時刻-20\" href=\"#開始時刻-20\" data-position=\"0-24-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"開始時刻\"> &gt; 開始時刻</span></a>開始時刻</h3>\n<p data-sourcepos=\"1122:1-1122:9\">4/19 3:35</p>\n<h3 data-sourcepos=\"1123:1-1123:10\" id=\"0-24-2\" name=\"0-24-2\"><a class=\"anchor\" id=\"手順-20\" name=\"手順-20\" href=\"#手順-20\" data-position=\"0-24-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"手順\"> &gt; 手順</span></a>手順</h3>\n<div class=\"code-block\" data-sourcepos=\"1124:1-1126:3\"><div class=\"highlight\"><pre class=\"highlight plaintext\"><code>bucardo stop\n</code></pre></div></div>\n<h3 data-sourcepos=\"1127:1-1127:13\" id=\"0-24-3\" name=\"0-24-3\"><a class=\"anchor\" id=\"実行後-19\" name=\"実行後-19\" href=\"#実行後-19\" data-position=\"0-24-3\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"実行後\"> &gt; 実行後</span></a>実行後</h3>\n<div class=\"code-block\" data-sourcepos=\"1128:1-1131:3\"><div class=\"highlight\"><pre class=\"highlight plaintext\"><code>bucardo stop\nCreating /var/run/bucardo/fullstopbucardo ... Done\n</code></pre></div></div>\n<h2 data-sourcepos=\"1133:1-1133:41\" id=\"0-25-0\" name=\"0-25-0\"><a class=\"anchor\" id=\"49_DBインスタンスタイプ戻し\" name=\"49_DBインスタンスタイプ戻し\" href=\"#49_DBインスタンスタイプ戻し\" data-position=\"0-25-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"49_DBインスタンスタイプ戻し\"> &gt; 49_DBインスタンスタイプ戻し</span></a>49_DBインスタンスタイプ戻し</h2>\n<h3 data-sourcepos=\"1134:1-1134:16\" id=\"0-25-1\" name=\"0-25-1\"><a class=\"anchor\" id=\"開始時刻-21\" name=\"開始時刻-21\" href=\"#開始時刻-21\" data-position=\"0-25-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"開始時刻\"> &gt; 開始時刻</span></a>開始時刻</h3>\n<p data-sourcepos=\"1135:1-1135:5\">4/19</p>\n<h3 data-sourcepos=\"1136:1-1136:10\" id=\"0-25-2\" name=\"0-25-2\"><a class=\"anchor\" id=\"手順-21\" name=\"手順-21\" href=\"#手順-21\" data-position=\"0-25-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"手順\"> &gt; 手順</span></a>手順</h3>\n<div class=\"code-block\" data-sourcepos=\"1137:1-1139:3\"><div class=\"highlight\"><pre class=\"highlight plaintext\"><code>db.r5.24xlarge→db.r5.2xlarge(ライターに実行→フェイルオーバーでインスタンス入れ替え)\n</code></pre></div></div>\n<h3 data-sourcepos=\"1140:1-1140:13\" id=\"0-25-3\" name=\"0-25-3\"><a class=\"anchor\" id=\"実行後-20\" name=\"実行後-20\" href=\"#実行後-20\" data-position=\"0-25-3\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"実行後\"> &gt; 実行後</span></a>実行後</h3>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/19/136273/4fc8bb9b-9284-41eb-8af8-2330063056b9.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"1508\" alt=\"スクリーンショット 2023-04-19 3.37.21.png (88.0 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/19/136273/4fc8bb9b-9284-41eb-8af8-2330063056b9.png\"></a>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/19/136273/3803eac8-3dc2-42eb-a48d-e402cb0db2eb.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"1486\" alt=\"スクリーンショット 2023-04-19 3.38.17.png (52.5 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/19/136273/3803eac8-3dc2-42eb-a48d-e402cb0db2eb.png\"></a>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/19/136273/dd611c19-a450-4f1f-acfa-3b29f1781667.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"1486\" alt=\"スクリーンショット 2023-04-19 3.38.17.png (52.5 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/19/136273/dd611c19-a450-4f1f-acfa-3b29f1781667.png\"></a>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/19/136273/2f1c0ad0-7ba0-4e66-9f78-d8d05d8d8df8.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"1500\" alt=\"スクリーンショット 2023-04-19 3.49.12.png (66.1 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/19/136273/2f1c0ad0-7ba0-4e66-9f78-d8d05d8d8df8.png\"></a>\n<h2 data-sourcepos=\"1148:1-1148:33\" id=\"0-26-0\" name=\"0-26-0\"><a class=\"anchor\" id=\"53_DB向き先切り替えking\" name=\"53_DB向き先切り替えking\" href=\"#53_DB向き先切り替えking\" data-position=\"0-26-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"53_DB向き先切り替えking\"> &gt; 53_DB向き先切り替えking</span></a>53_DB向き先切り替えking</h2>\n<h3 data-sourcepos=\"1149:1-1149:16\" id=\"0-26-1\" name=\"0-26-1\"><a class=\"anchor\" id=\"開始時刻-22\" name=\"開始時刻-22\" href=\"#開始時刻-22\" data-position=\"0-26-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"開始時刻\"> &gt; 開始時刻</span></a>開始時刻</h3>\n<p data-sourcepos=\"1150:1-1150:16\">4/19 3:50〜4:01</p>\n<h3 data-sourcepos=\"1152:1-1152:10\" id=\"0-26-2\" name=\"0-26-2\"><a class=\"anchor\" id=\"手順-22\" name=\"手順-22\" href=\"#手順-22\" data-position=\"0-26-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"手順\"> &gt; 手順</span></a>手順</h3>\n<div class=\"code-block\" data-sourcepos=\"1153:1-1166:3\"><div class=\"highlight\"><pre class=\"highlight plaintext\"><code># DBの向き先切り替え\nheroku addons:attach postgresql-objective-43050 --as OLD_DATABASE -a sl2-api-production\nheroku addons:detach DATABASE_URL -a sl2-api-production\nheroku config:set DATABASE_URL=postgres://kingadmin:m3hkFJq4gkRVAZvY5Z1FkT7LeKtnjJSl@king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com:5432/kingapi -a sl2-api-production\nheroku config:set FOLLOWER_DATABASE_URL=postgres://kingadmin:m3hkFJq4gkRVAZvY5Z1FkT7LeKtnjJSl@king-api-production.cluster-ro-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com:5432/kingapi -a sl2-api-production\n\n# 内部DB疎通確認\nheroku run rails c -a sl2-api-production --size=private-s\n\nActiveRecord::Base.connection_db_config\n\nLock.find('b6b91bcf-80a7-77b3-0d4a-2479f77e7957')\n</code></pre></div></div>\n<h3 data-sourcepos=\"1167:1-1167:13\" id=\"0-26-3\" name=\"0-26-3\"><a class=\"anchor\" id=\"実行後-21\" name=\"実行後-21\" href=\"#実行後-21\" data-position=\"0-26-3\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"実行後\"> &gt; 実行後</span></a>実行後</h3>\n<div class=\"code-block\" data-sourcepos=\"1168:1-1242:3\"><div class=\"highlight\"><pre class=\"highlight plaintext\"><code>heroku addons:attach postgresql-objective-43050 --as OLD_DATABASE -a sl2-api-production\nAttaching postgresql-objective-43050 as OLD_DATABASE to ⬢ sl2-api-production... done\nSetting OLD_DATABASE config vars and restarting ⬢ sl2-api-production... done, v712\n\nheroku addons:detach DATABASE_URL -a sl2-api-production\nDetaching DATABASE to postgresql-objective-43050 from ⬢ sl2-api-production... done\nUnsetting DATABASE config vars and restarting ⬢ sl2-api-production... done, v713\n\nheroku config:set DATABASE_URL=postgres://kingadmin:m3hkFJq4gkRVAZvY5Z1FkT7LeKtnjJSl@king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com:5432/kingapi -a sl2-api-production\nSetting DATABASE_URL and restarting ⬢ sl2-api-production... done, v714\n ▸    Release command executing: this config change will\n ▸    not be available until the command succeeds. Use\n ▸    `heroku releases:output` to view the log.\nDATABASE_URL: postgres://kingadmin:m3hkFJq4gkRVAZvY5Z1FkT7LeKtnjJSl@king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com:5432/kingapi\n\nheroku config:set FOLLOWER_DATABASE_URL=postgres://kingadmin:m3hkFJq4gkRVAZvY5Z1FkT7LeKtnjJSl@king-api-production.cluster-ro-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com:5432/kingapi -a sl2-api-production\nSetting FOLLOWER_DATABASE_URL and restarting ⬢ sl2-api-production... done, v715\n ▸    Release command executing: this config change will\n ▸    not be available until the command succeeds. Use\n ▸    `heroku releases:output` to view the log.\nFOLLOWER_DATABASE_URL: postgres://kingadmin:m3hkFJq4gkRVAZvY5Z1FkT7LeKtnjJSl@king-api-production.cluster-ro-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com:5432/kingapi\n\nheroku run rails c -a sl2-api-production --size=private-s\nRunning rails c on ⬢ sl2-api-production... up, run.1620 (Private-S)\n[Scout] [04/18/23 19:00:21 +0000 run.1620 (11)] INFO : No configuration file loaded, and no configuration found in ENV. For assistance configuring Scout, visit https://docs.scoutapm.com/#ruby-configuration-options\n[Scout] [04/18/23 19:00:21 +0000 run.1620 (11)] INFO : Scout Agent [5.1.1] Initialized\n[Scout] [04/18/23 19:00:21 +0000 run.1620 (11)] INFO : Not Loading Instruments\n[Scout] [04/18/23 19:00:21 +0000 run.1620 (11)] INFO : Scout Agent [5.1.1] Installed\n[Scout] [04/18/23 19:00:21 +0000 run.1620 (11)] INFO : Monitoring isn't enabled for the [production] environment.\n[Scout] [04/18/23 19:00:21 +0000 run.1620 (11)] INFO : Agent attempting to load in interactive mode.\n[Scout] [04/18/23 19:00:21 +0000 run.1620 (11)] INFO : Deferring agent start. Standing by for first request\nLoading production environment (Rails 7.0.2.4)\nirb(main):001:0&gt; ActiveRecord::Base.connection_db_con\nfig\n=&gt; \n#&lt;ActiveRecord::DatabaseConfigurations::UrlConfig:0x00007f2ace632298\n @configuration_hash=\n  {:adapter=&gt;\"postgresql\",\n   :encoding=&gt;\"unicode\",\n   :pool=&gt;51,\n   :host=&gt;\n    \"king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com\",\n   :port=&gt;5432,\n   :username=&gt;\"kingadmin\",\n   :variables=&gt;{\"statement_timeout\"=&gt;300000},\n   :database=&gt;\"kingapi\",\n   :password=&gt;\"m3hkFJq4gkRVAZvY5Z1FkT7LeKtnjJSl\"},\n @env_name=\"production\",\n @name=\"primary\",\n @url=\n  \"postgres://kingadmin:m3hkFJq4gkRVAZvY5Z1FkT7LeKtnjJSl@king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com:5432/kingapi\"&gt;\nirb(main):002:0&gt; Lock.find('b6b91bcf-80a7-77b3-0d4a-2\n479f77e7957')\n=&gt; \n#&lt;Lock:0x00007f2acdbcfc38\n id: \"b6b91bcf-80a7-77b3-0d4a-2479f77e7957\",\n serial_no: \"1064127\",\n bd_address: \"70:26:05:D3:FA:62\",\n fw_version: \"3.0.2\",\n key_seed:\n  \"f2d44d1e5c23d932649e1ec1aa55474768089634c1a6ca98e1e6b6646c917241\",\n nonce: \"474dc4c26bc4b09d8f4e8bf35497d700\",\n enable_sound: true,\n enable_autolock: true,\n enable_autolock_sound: false,\n battery_a: 5,\n battery_b: 0,\n created_at:\n  Tue, 05 Jun 2018 00:00:00.000000000 UTC +00:00,\n updated_at:\n  Thu, 13 Apr 2023 00:38:04.783963000 UTC +00:00,\n beacon_interval: 10,\n model_id: 1&gt;\n</code></pre></div></div>\n<h2 data-sourcepos=\"1243:1-1243:12\" id=\"0-27-0\" name=\"0-27-0\"><a class=\"anchor\" id=\"54_sirius\" name=\"54_sirius\" href=\"#54_sirius\" data-position=\"0-27-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"54_sirius\"> &gt; 54_sirius</span></a>54_sirius</h2>\n<h3 data-sourcepos=\"1244:1-1244:16\" id=\"0-27-1\" name=\"0-27-1\"><a class=\"anchor\" id=\"開始時刻-23\" name=\"開始時刻-23\" href=\"#開始時刻-23\" data-position=\"0-27-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"開始時刻\"> &gt; 開始時刻</span></a>開始時刻</h3>\n<h3 data-sourcepos=\"1245:1-1245:10\" id=\"0-27-2\" name=\"0-27-2\"><a class=\"anchor\" id=\"手順-23\" name=\"手順-23\" href=\"#手順-23\" data-position=\"0-27-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"手順\"> &gt; 手順</span></a>手順</h3>\n<div class=\"code-block\" data-sourcepos=\"1246:1-1257:3\"><div class=\"highlight\"><pre class=\"highlight plaintext\"><code>\"# DBの向き先切り替え\nheroku config:set KING_DATABASE_URL=postgres://kingadmin:m3hkFJq4gkRVAZvY5Z1FkT7LeKtnjJSl@king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com:5432/kingapi -a sirius-api-production\n\n# 内部DB疎通確認\nheroku run --size=private-s --app=sirius-api-production bash\n\nrails c --no-sandbox\nActiveRecord::Base.connection_db_config\nLock.connection_db_config\nLock.find('b6b91bcf-80a7-77b3-0d4a-2479f77e7957')\"\n</code></pre></div></div>\n<h3 data-sourcepos=\"1258:1-1258:13\" id=\"0-27-3\" name=\"0-27-3\"><a class=\"anchor\" id=\"実行後-22\" name=\"実行後-22\" href=\"#実行後-22\" data-position=\"0-27-3\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"実行後\"> &gt; 実行後</span></a>実行後</h3>\n<div class=\"code-block\" data-sourcepos=\"1259:1-1287:3\"><div class=\"highlight\"><pre class=\"highlight plaintext\"><code>heroku config:set KING_DATABASE_URL=postgres://kingadmin:m3hkFJq4gkRVAZvY5Z1FkT7LeKtnjJSl@king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com:5432/kingapi -a sirius-api-production\nSetting KING_DATABASE_URL and restarting ⬢ sirius-api-production... done, v326\n ▸    Release command executing: this config change will not be available\n ▸    until the command succeeds. Use `heroku releases:output` to view the\n ▸    log.\nKING_DATABASE_URL: postgres://kingadmin:m3hkFJq4gkRVAZvY5Z1FkT7LeKtnjJSl@king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com:5432/kingapi\n\nheroku run --size=private-s --app=sirius-api-production bash     4:02:53\nRunning bash on ⬢ sirius-api-production... up, run.8213 (Private-S)\n^@^@~ $ rails c --sandbox\n[DEPRECATION] Committee: please set query_hash_key = rack.request.query_hash because we'll change default value in next major version.\n[DEPRECATION] Committee: please set query_hash_key = rack.request.query_hash because we'll change default value in next major version.\n[DEPRECATION] Committee: Committee::Middleware::ResponseValidation doesn't support strict option now but we'll support this option. This change break backward compatibility so please remove strict option from ResponseValidation\n[DEPRECATION] Committee: please set parse_response_by_content_type = false because we'll change default value in next major version.\n[DEPRECATION] Committee: please set parse_response_by_content_type = false because we'll change default value in next major version.\nW, [2023-04-18T19:08:27.502528 #56]  WARN -- : Creating scope :of_name. Overwriting existing method Group.of_name.\nW, [2023-04-18T19:08:27.534588 #56]  WARN -- : Creating scope :exit. Overwriting existing method Knight.exit.\nW, [2023-04-18T19:08:27.549037 #56]  WARN -- : Creating scope :open. Overwriting existing method Log.open.\nW, [2023-04-18T19:08:27.553262 #56]  WARN -- : Creating scope :of_name. Overwriting existing method Manager.of_name.\nLoading production environment in sandbox (Rails 6.1.4)\nAny modifications you make will be rolled back on exit\nirb(main):001:0&gt; ActiveRecord::Base.connection_db_config\n=&gt; #&lt;ActiveRecord::DatabaseConfigurations::UrlConfig:0x00005598446cdbf8 @env_name=\"production\", @name=\"primary\", @configuration_hash={:adapter=&gt;\"postgresql\", :encoding=&gt;\"unicode\", :pool=&gt;5, :timeout=&gt;5000, :host=&gt;\"ec2-54-249-222-140.ap-northeast-1.compute.amazonaws.com\", :username=&gt;\"u9c4jt4mc7cito\", :port=&gt;5432, :database=&gt;\"d4n1pdive53kt6\", :password=&gt;\"p5b62d81083f00dff63087996bb60f87a827999ee0c730f1e4363ffa0e37a404f\"}, @url=\"postgres://u9c4jt4mc7cito:p5b62d81083f00dff63087996bb60f87a827999ee0c730f1e4363ffa0e37a404f@ec2-54-249-222-140.ap-northeast-1.compute.amazonaws.com:5432/d4n1pdive53kt6\"&gt;\nirb(main):002:0&gt; Lock.connection_db_config\n=&gt; #&lt;ActiveRecord::DatabaseConfigurations::UrlConfig:0x00005598446cc028 @env_name=\"production\", @name=\"king\", @configuration_hash={:adapter=&gt;\"postgresql\", :encoding=&gt;\"unicode\", :pool=&gt;5, :timeout=&gt;5000, :host=&gt;\"king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com\", :username=&gt;\"kingadmin\", :port=&gt;5432, :database=&gt;\"kingapi\", :password=&gt;\"m3hkFJq4gkRVAZvY5Z1FkT7LeKtnjJSl\"}, @url=\"postgres://kingadmin:m3hkFJq4gkRVAZvY5Z1FkT7LeKtnjJSl@king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com:5432/kingapi\"&gt;\nirb(main):003:0&gt; Lock.find('b6b91bcf-80a7-77b3-0d4a-2479f77e7957')\n=&gt; #&lt;Lock id: \"b6b91bcf-80a7-77b3-0d4a-2479f77e7957\", serial_no: \"1064127\", bd_address: \"70:26:05:D3:FA:62\", fw_version: \"3.0.2\", key_seed: \"f2d44d1e5c23d932649e1ec1aa55474768089634c1a6ca98e1...\", nonce: \"474dc4c26bc4b09d8f4e8bf35497d700\", enable_sound: true, enable_autolock: true, enable_autolock_sound: false, battery_a: 5, battery_b: 0, created_at: \"2018-06-05 00:00:00.000000000 +0000\", updated_at: \"2023-04-13 00:38:04.783963000 +0000\", beacon_interval: 10, model_id: 1&gt;\n</code></pre></div></div>\n<h2 data-sourcepos=\"1289:1-1289:12\" id=\"0-28-0\" name=\"0-28-0\"><a class=\"anchor\" id=\"55_roomon\" name=\"55_roomon\" href=\"#55_roomon\" data-position=\"0-28-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"55_roomon\"> &gt; 55_roomon</span></a>55_roomon</h2>\n<h3 data-sourcepos=\"1290:1-1290:16\" id=\"0-28-1\" name=\"0-28-1\"><a class=\"anchor\" id=\"開始時刻-24\" name=\"開始時刻-24\" href=\"#開始時刻-24\" data-position=\"0-28-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"開始時刻\"> &gt; 開始時刻</span></a>開始時刻</h3>\n<h3 data-sourcepos=\"1291:1-1291:10\" id=\"0-28-2\" name=\"0-28-2\"><a class=\"anchor\" id=\"手順-24\" name=\"手順-24\" href=\"#手順-24\" data-position=\"0-28-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"手順\"> &gt; 手順</span></a>手順</h3>\n<div class=\"code-block\" data-sourcepos=\"1292:1-1298:3\"><div class=\"highlight\"><pre class=\"highlight plaintext\"><code># DBの向き先切り替え\nheroku config:set KING_DATABASE_URL=postgres://kingadmin:m3hkFJq4gkRVAZvY5Z1FkT7LeKtnjJSl@king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com:5432/kingapi -a roomon-api-production\n\n# 内部DB疎通確認\n→ メンテ開けで確認\n</code></pre></div></div>\n<h3 data-sourcepos=\"1299:1-1299:13\" id=\"0-28-3\" name=\"0-28-3\"><a class=\"anchor\" id=\"実行後-23\" name=\"実行後-23\" href=\"#実行後-23\" data-position=\"0-28-3\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"実行後\"> &gt; 実行後</span></a>実行後</h3>\n<div class=\"code-block\" data-sourcepos=\"1300:1-1304:3\"><div class=\"highlight\"><pre class=\"highlight plaintext\"><code>heroku config:set KING_DATABASE_URL=postgres://kingadmin:m3hkFJq4gkRVAZvY5Z1FkT7LeKtnjJSl@king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com:5432/kingapi -a roomon-api-production\nSetting KING_DATABASE_URL and restarting ⬢ roomon-api-production... done, v132\nKING_DATABASE_URL: postgres://kingadmin:m3hkFJq4gkRVAZvY5Z1FkT7LeKtnjJSl@king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com:5432/kingapi\n</code></pre></div></div>\n<h2 data-sourcepos=\"1306:1-1306:42\" id=\"0-29-0\" name=\"0-29-0\"><a class=\"anchor\" id=\"メンテ明け 1.sirius-api-production\" name=\"メンテ明け 1.sirius-api-production\" href=\"#メンテ明け 1.sirius-api-production\" data-position=\"0-29-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"メンテ明け 1.sirius-api-production\"> &gt; メンテ明け 1.sirius-api-production</span></a>メンテ明け 1.sirius-api-production</h2>\n<h3 data-sourcepos=\"1307:1-1307:13\" id=\"0-29-1\" name=\"0-29-1\"><a class=\"anchor\" id=\"実行後-24\" name=\"実行後-24\" href=\"#実行後-24\" data-position=\"0-29-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"実行後\"> &gt; 実行後</span></a>実行後</h3>\n<div class=\"code-block\" data-sourcepos=\"1308:1-1341:3\"><div class=\"highlight\"><pre class=\"highlight plaintext\"><code># sugiyamasatoshi @ sugiyamasatoshinoMacBook-Pro in ~ [4:16:49]\n$ heroku ps:scale web=2 -a sirius-api-production\nScaling dynos... done, now running web at 2:Private-S\n\n# sugiyamasatoshi @ sugiyamasatoshinoMacBook-Pro in ~ [4:17:22]\n$ heroku ps:scale worker=1 -a sirius-api-production\nScaling dynos... done, now running worker at 1:Private-S\n\n# sugiyamasatoshi @ sugiyamasatoshinoMacBook-Pro in ~ [4:17:35]\n$ heroku maintenance:off -a sirius-api-production\nDisabling maintenance mode for ⬢ sirius-api-production... done\n\nheroku apps:info -a sirius-api-production  4:17:44\n\n=== sirius-api-production\nAddons:         heroku-postgresql:private-0\n                heroku-redis:premium-1\n                newrelic:wayne\n                papertrail:fixa\n                scheduler:standard\nAuto Cert Mgmt: true\nCollaborators:  takuya.ishida@qrioinc.com\nDynos:          web: 2, worker: 1\nGit URL:        https://git.heroku.com/sirius-api-production.git\nOwner:          qrioinc@herokumanager.com\nPipeline:       sirius-api - production\nRegion:         tokyo\nRepo Size:      982 KB\nSlug Size:      43 MB\nSpace:          king\nStack:          heroku-20\nWeb URL:        https://sirius-api-production.herokuapp.com/\n</code></pre></div></div>\n<h2 data-sourcepos=\"1343:1-1343:40\" id=\"0-30-0\" name=\"0-30-0\"><a class=\"anchor\" id=\"メンテ明け 2.king-api-production\" name=\"メンテ明け 2.king-api-production\" href=\"#メンテ明け 2.king-api-production\" data-position=\"0-30-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"メンテ明け 2.king-api-production\"> &gt; メンテ明け 2.king-api-production</span></a>メンテ明け 2.king-api-production</h2>\n<h3 data-sourcepos=\"1344:1-1344:13\" id=\"0-30-1\" name=\"0-30-1\"><a class=\"anchor\" id=\"実行後-25\" name=\"実行後-25\" href=\"#実行後-25\" data-position=\"0-30-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"実行後\"> &gt; 実行後</span></a>実行後</h3>\n<div class=\"code-block\" data-sourcepos=\"1345:1-1403:3\"><div class=\"highlight\"><pre class=\"highlight plaintext\"><code>heroku apps:info -a sl2-api-production     4:21:51\n=== sl2-api-production\nAddons:         advanced-scheduler:hobby\n                heroku-postgresql:private-5\n                heroku-postgresql:standard-5\n                heroku-redis:premium-5\n                newrelic:hawke\n                papertrail:fredrik\n                redismonitor:free\n                scheduler:standard\nAuto Cert Mgmt: true\nCollaborators:  kazuyoshi.kawakami@qrioinc.com\nDynos:\nGit URL:        https://git.heroku.com/sl2-api-production.git\nOwner:          qrioinc@herokumanager.com\nPipeline:       king-api - production\nRegion:         tokyo\nRepo Size:      0 B\nSlug Size:      91 MB\nSpace:          king\nStack:          heroku-22\nWeb URL:        https://sl2-api-production.herokuapp.com/\n\n# sugiyamasatoshi @ sugiyamasatoshinoMacBook-Pro in ~ [4:22:41]\n$ heroku ps:scale web=4 -a sl2-api-production\nScaling dynos... done, now running web at 4:Private-M\n\n# sugiyamasatoshi @ sugiyamasatoshinoMacBook-Pro in ~ [4:22:56]\n$ heroku ps:scale worker=2 -a sl2-api-production\nScaling dynos... done, now running worker at 2:Private-S\n\n# sugiyamasatoshi @ sugiyamasatoshinoMacBook-Pro in ~ [4:23:05]\n$ heroku apps:info -a sl2-api-production     4:23:05\n=== sl2-api-production\nAddons:         advanced-scheduler:hobby\n                heroku-postgresql:private-5\n                heroku-postgresql:standard-5\n                heroku-redis:premium-5\n                newrelic:hawke\n                papertrail:fredrik\n                redismonitor:free\n                scheduler:standard\nAuto Cert Mgmt: true\nCollaborators:  kazuyoshi.kawakami@qrioinc.com\nDynos:          web: 4, worker: 2\nGit URL:        https://git.heroku.com/sl2-api-production.git\nOwner:          qrioinc@herokumanager.com\nPipeline:       king-api - production\nRegion:         tokyo\nRepo Size:      0 B\nSlug Size:      91 MB\nSpace:          king\nStack:          heroku-22\nWeb URL:        https://sl2-api-production.herokuapp.com/\n\nheroku maintenance:off -a sl2-api-production                                4:25:36\nDisabling maintenance mode for ⬢ sl2-api-production... done\n</code></pre></div></div>\n<h2 data-sourcepos=\"1406:1-1406:42\" id=\"0-31-0\" name=\"0-31-0\"><a class=\"anchor\" id=\"メンテ明け 3.roomon-api-production\" name=\"メンテ明け 3.roomon-api-production\" href=\"#メンテ明け 3.roomon-api-production\" data-position=\"0-31-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"メンテ明け 3.roomon-api-production\"> &gt; メンテ明け 3.roomon-api-production</span></a>メンテ明け 3.roomon-api-production</h2>\n<h3 data-sourcepos=\"1407:1-1407:13\" id=\"0-31-1\" name=\"0-31-1\"><a class=\"anchor\" id=\"実行後-26\" name=\"実行後-26\" href=\"#実行後-26\" data-position=\"0-31-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"実行後\"> &gt; 実行後</span></a>実行後</h3>\n<div class=\"code-block\" data-sourcepos=\"1408:1-1432:3\"><div class=\"highlight\"><pre class=\"highlight plaintext\"><code>heroku apps:info -a roomon-api-production          4:27:23\n=== roomon-api-production\nAddons:         heroku-postgresql:private-0\n                newrelic:hawke\n                papertrail:fixa\n                scheduler:standard\nAuto Cert Mgmt: true\nDynos:\nGit URL:        https://git.heroku.com/roomon-api-production.git\nOwner:          qrioinc@herokumanager.com\nPipeline:       roomon-api - production\nRegion:         tokyo\nRepo Size:      42 MB\nSlug Size:      78 MB\nSpace:          king\nStack:          heroku-22\nWeb URL:        https://roomon-api-production.herokuapp.com/\n\nheroku ps:scale web=2 -a roomon-api-production     4:28:38\nScaling dynos... done, now running web at 2:Private-M\n\nheroku maintenance:off -a roomon-api-production    4:27:23\nDisabling maintenance mode for ⬢ roomon-api-production... done\n</code></pre></div></div>\n<h2 data-sourcepos=\"1434:1-1434:44\" id=\"0-32-0\" name=\"0-32-0\"><a class=\"anchor\" id=\"メンテ明け customer-support-api-prod\" name=\"メンテ明け customer-support-api-prod\" href=\"#メンテ明け customer-support-api-prod\" data-position=\"0-32-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"メンテ明け customer-support-api-prod\"> &gt; メンテ明け customer-support-api-prod</span></a>メンテ明け customer-support-api-prod</h2>\n<div class=\"code-block\" data-sourcepos=\"1435:1-1476:3\"><div class=\"highlight\"><pre class=\"highlight plaintext\"><code>heroku config:set KING_DATABASE_URL=postgres://kingadmin:m3hkFJq4gkRVAZvY5Z1FkT7LeKtnjJSl@king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com:5432/kingapi -a customer-support-api-prod\nSetting KING_DATABASE_URL and restarting ⬢ customer-support-api-prod... done, v34\nKING_DATABASE_URL: postgres://kingadmin:m3hkFJq4gkRVAZvY5Z1FkT7LeKtnjJSl@king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com:5432/kingapi\n\nheroku apps:info -a customer-support-api-prod      4:41:01\n=== customer-support-api-prod\nAuto Cert Mgmt: false\nDynos:\nGit URL:        https://git.heroku.com/customer-support-api-prod.git\nOwner:          qrioinc@herokumanager.com\nPipeline:       customer-support-api - production\nRegion:         tokyo\nRepo Size:      302 KB\nSlug Size:      63 MB\nSpace:          king\nStack:          heroku-22\nWeb URL:        https://customer-support-api-prod.herokuapp.com/\n\nheroku ps:scale web=1 -a customer-support-api-prod 4:42:35\nScaling dynos... done, now running web at 1:Private-M\n\n# sugiyamasatoshi @ sugiyamasatoshinoMacBook-Pro in ~ [4:42:58]\n$ heroku maintenance:off -a customer-support-api-prod\nDisabling maintenance mode for ⬢ customer-support-api-prod... done\n\n# sugiyamasatoshi @ sugiyamasatoshinoMacBook-Pro in ~ [4:43:07]\n$ heroku apps:info -a customer-support-api-prod      4:43:07\n=== customer-support-api-prod\nAuto Cert Mgmt: false\nDynos:          web: 1\nGit URL:        https://git.heroku.com/customer-support-api-prod.git\nOwner:          qrioinc@herokumanager.com\nPipeline:       customer-support-api - production\nRegion:         tokyo\nRepo Size:      302 KB\nSlug Size:      63 MB\nSpace:          king\nStack:          heroku-22\nWeb URL:        https://customer-support-api-prod.herokuapp.com/\n</code></pre></div></div>\n<h2 data-sourcepos=\"1478:1-1478:32\" id=\"0-33-0\" name=\"0-33-0\"><a class=\"anchor\" id=\"メンテ明け prod-king-ope\" name=\"メンテ明け prod-king-ope\" href=\"#メンテ明け prod-king-ope\" data-position=\"0-33-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"メンテ明け prod-king-ope\"> &gt; メンテ明け prod-king-ope</span></a>メンテ明け prod-king-ope</h2>\n<div class=\"code-block\" data-sourcepos=\"1479:1-1544:3\"><div class=\"highlight\"><pre class=\"highlight plaintext\"><code>heroku config:set DATABASE_URL=postgres://kingadmin:m3hkFJq4gkRVAZvY5Z1FkT7LeKtnjJSl@king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com:5432/kingapi DATABASE_HOSTNAME=king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com DATABASE_NAME=kingapi DATABASE_USERNAME=kingadmin DATABASE_PASSWORD=m3hkFJq4gkRVAZvY5Z1FkT7LeKtnjJSl -a prod-king-ope\nSetting DATABASE_URL, DATABASE_HOSTNAME, DATABASE_NAME, DATABASE_USERNAME, DATABASE_PASSWORD and restarting ⬢ prod-king-ope... done, v175\nDATABASE_HOSTNAME: king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com\nDATABASE_NAME:     kingapi\nDATABASE_PASSWORD: m3hkFJq4gkRVAZvY5Z1FkT7LeKtnjJSl\nDATABASE_URL:      postgres://kingadmin:m3hkFJq4gkRVAZvY5Z1FkT7LeKtnjJSl@king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com:5432/kingapi\nDATABASE_USERNAME: kingadmin\n\nheroku apps:info -a prod-king-ope                  4:45:03\n=== prod-king-ope\nAddons:         papertrail:choklad\n                process-scheduler:pet-project\nAuto Cert Mgmt: true\nDynos:\nGit URL:        https://git.heroku.com/prod-king-ope.git\nOwner:          qrioinc@herokumanager.com\nPipeline:       king-ope - production\nRegion:         tokyo\nRepo Size:      0 B\nSlug Size:      109 MB\nSpace:          king\nStack:          heroku-22\nWeb URL:        https://prod-king-ope.herokuapp.com/\n\nheroku apps:info -a prod-king-ope                  4:45:03\n=== prod-king-ope\nAddons:         papertrail:choklad\n                process-scheduler:pet-project\nAuto Cert Mgmt: true\nDynos:\nGit URL:        https://git.heroku.com/prod-king-ope.git\nOwner:          qrioinc@herokumanager.com\nPipeline:       king-ope - production\nRegion:         tokyo\nRepo Size:      0 B\nSlug Size:      109 MB\nSpace:          king\nStack:          heroku-22\nWeb URL:        https://prod-king-ope.herokuapp.com/\n\n# sugiyamasatoshi @ sugiyamasatoshinoMacBook-Pro in ~ [4:45:14]\n$ heroku ps:scale web=1 -a prod-king-ope             4:45:14\nScaling dynos... done, now running web at 1:Private-S\n\n# sugiyamasatoshi @ sugiyamasatoshinoMacBook-Pro in ~ [4:45:35]\n$ heroku maintenance:off -a prod-king-ope            4:45:35\nDisabling maintenance mode for ⬢ prod-king-ope... done\n\n# sugiyamasatoshi @ sugiyamasatoshinoMacBook-Pro in ~ [4:45:43]\n$ heroku apps:info -a prod-king-ope                  4:45:43\n=== prod-king-ope\nAddons:         papertrail:choklad\n                process-scheduler:pet-project\nAuto Cert Mgmt: true\nDynos:          web: 1\nGit URL:        https://git.heroku.com/prod-king-ope.git\nOwner:          qrioinc@herokumanager.com\nPipeline:       king-ope - production\nRegion:         tokyo\nRepo Size:      0 B\nSlug Size:      109 MB\nSpace:          king\nStack:          heroku-22\nWeb URL:        https://prod-king-ope.herokuapp.com/\n</code></pre></div></div>\n<h2 data-sourcepos=\"1546:1-1546:15\" id=\"0-34-0\" name=\"0-34-0\"><a class=\"anchor\" id=\"redash接続\" name=\"redash接続\" href=\"#redash接続\" data-position=\"0-34-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"redash接続\"> &gt; redash接続</span></a>redash接続</h2>\n<div class=\"code-block\" data-sourcepos=\"1548:1-1553:3\"><div class=\"highlight\"><pre class=\"highlight plaintext\"><code>RedashのVPCとAuroraのVPCをピアリングする\n双方のVPCのルートテーブルにDestinationを相手側のVPC CIDR、ターゲットに作成したピアリング接続を指定する\nAuroraのセキュリティグループをredash CIDRから許可する\nredashのQ-SL2とsl2-followerの接続情報を変更する\n</code></pre></div></div>\n<h2 data-sourcepos=\"1554:1-1554:12\" id=\"0-35-0\" name=\"0-35-0\"><a class=\"anchor\" id=\"反省点\" name=\"反省点\" href=\"#反省点\" data-position=\"0-35-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"反省点\"> &gt; 反省点</span></a>反省点</h2>\n<ul data-sourcepos=\"1556:1-1558:114\">\n<li data-sourcepos=\"1556:1-1556:163\">Auroraにmain_dataをrestoreする際にbucardoスキーマを除外してdumpしておけばエラーが出ることはない(既知のエラーなので不要)</li>\n<li data-sourcepos=\"1557:1-1558:114\">main_dataのrestoreに想定より時間がかかっている\n<ul data-sourcepos=\"1558:5-1558:114\">\n<li data-sourcepos=\"1558:5-1558:114\">--jobs=8などの指定がなかった(logsとdisplay_logsはjobs指定で速度が上がった実績あり)</li>\n</ul></li>\n</ul>\n",
    "created_at": "2023-04-18T04:17:47+09:00",
    "message": "Update post.",
    "kind": "stock",
    "comments_count": 0,
    "tasks_count": 0,
    "done_tasks_count": 0,
    "url": "https://qrio.esa.io/posts/1627",
    "updated_at": "2023-07-18T10:50:01+09:00",
    "tags": [],
    "category": "Users/杉山/Database",
    "revision_number": 34,
    "created_by": {
      "myself": false,
      "name": "杉山聡",
      "screen_name": "satoshi_sugiyama",
      "icon": "https://img.esa.io/uploads/production/members/129432/icon/thumb_m_4589e2842b9d87757c7c9db07c45c00d.jpg"
    },
    "updated_by": {
      "myself": false,
      "name": "杉山聡",
      "screen_name": "satoshi_sugiyama",
      "icon": "https://img.esa.io/uploads/production/members/129432/icon/thumb_m_4589e2842b9d87757c7c9db07c45c00d.jpg"
    },
    "stargazers_count": 0,
    "watchers_count": 1,
    "star": false,
    "watch": false,
    "sharing_urls": null
  },
  {
    "number": 1637,
    "name": "STG環境のbucardoEC2インスタンス削除",
    "full_name": "Users/杉山/Database/STG環境のbucardoEC2インスタンス削除",
    "wip": false,
    "body_md": "## 実施日\r\n\r\n4/27(木)\r\n\r\n\r\n## STG環境影響範囲\r\n- EC2内Dockerコンテナでbucardoの設定にAuroraの接続情報が含まれる\r\n- 稼働中のAuroraの動作に影響するEC2スタックのリソースが削除されないか確認→下記で確認済み\r\n\r\n## 削除対象リソース\r\n\r\n### king-api-staging-bucardo-stack\r\n\r\n- [EC2インスタンス](https://ap-northeast-1.console.aws.amazon.com/ec2/home?region=ap-northeast-1#Instances:search=i-0a30d63c9441cb1b3)\r\n- EC2ルートテーブル(rtb-0095985c19a342cd1)\r\n    - EC2のパブリックルート\r\n- [EC2サブネット](https://ap-northeast-1.console.aws.amazon.com/vpc/home?region=ap-northeast-1#subnets:search=subnet-0ddce66efa1483d93)\r\n- EC2サブネット関連付け\r\n- IAMプロフィール(ECRアクセス用)(ECR-Access-for-king-api-staging-bucardo-ec2)\r\n    - [IAMロール](https://ap-northeast-1.console.aws.amazon.com/iam/home?#/roles/ECR-Access-for-king-api-staging-bucardo-ec2)\r\n- EC2起動テンプレート[king-api-staging-bucardo-ec2-install-template](https://ap-northeast-1.console.aws.amazon.com/ec2/v2/home?region=ap-northeast-1#LaunchTemplateDetails:launchTemplateId=lt-0a609e4c0198906df)\r\n- EC2キーペア(king-api-staging-bucardo-ec2)\r\n- [EC2のSSHセキュリティグループ](https://ap-northeast-1.console.aws.amazon.com/ec2/home?region=ap-northeast-1#SecurityGroup:groupId=sg-086bef993b9abd1c0)\r\n- Auroraセキュリティグループ内のEC2→Auroraのセキュリティグループルール(sgr-0394704162de97bbe)\r\n- [EC2からHerokuSTGDBへのセキュリティグループ(privatelink用なので利用せず)](https://ap-northeast-1.console.aws.amazon.com/ec2/home?region=ap-northeast-1#SecurityGroup:groupId=sg-0753d37514d41e5f2)\r\n\r\n稼働中のAuroraに関係する部分は`Auroraセキュリティグループ内のEC2→Auroraのセキュリティグループルール`程度\r\n\r\n## 状態確認\r\n### king-api-staging-bucardo-stackのドリフト(CFn制御外の変更)\r\nなし\r\n<img width=\"1594\" alt=\"スクリーンショット 2023-04-26 8.36.51.png (166.0 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/26/136273/e983e9d0-31e6-4d3f-8880-46ab02abd9c4.png\">\r\n\r\n### bucardo\r\nherokuから(移行時)4/3以降の反映がない状態で、理想的である\r\n(herokudbは既に削除済み)\r\n```\r\nroot@1bce13d6f8dd:/# bucardo status sync_heroku_aws\r\n======================================================================\r\nLast good                : Apr 03, 2023 06:47:54 (time to run: 1s)\r\nRows deleted/inserted    : 0 / 1\r\nSync name                : sync_heroku_aws\r\nCurrent state            : Good\r\nSource relgroup/database : herd_heroku_db / heroku_db\r\nTables in sync           : 2\r\nStatus                   : Active\r\nCheck time               : None\r\nOverdue time             : 00:00:00\r\nExpired time             : 00:00:00\r\nStayalive/Kidsalive      : Yes / Yes\r\nRebuild index            : No\r\nAutokick                 : Yes\r\nOnetimecopy              : No\r\nPost-copy analyze        : Yes\r\nLast error:              : \r\n======================================================================\r\n```\r\n\r\n### プロセス(4/25 12:56)\r\n\r\n```\r\nroot@1bce13d6f8dd:/# ps -aux\r\nUSER         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND\r\npostgres       1  0.0  0.0   4624  3652 pts/0    Ss+  Mar31   0:00 /bin/bash\r\npostgres     110  0.0  0.1 215724 30048 ?        Ss   Apr02   0:41 /usr/lib/postgresql/14/bin/postgres -D /var/lib/postgresql/14/main -c config_file=/etc/post\r\npostgres     112  0.0  0.0 215856 12300 ?        Ss   Apr02   0:00 postgres: 14/main: checkpointer \r\npostgres     113  0.0  0.0 215724  7040 ?        Ss   Apr02   0:13 postgres: 14/main: background writer \r\npostgres     114  0.0  0.0 215724 11716 ?        Ss   Apr02   0:13 postgres: 14/main: walwriter \r\npostgres     115  0.0  0.0 216264  9892 ?        Ss   Apr02   0:24 postgres: 14/main: autovacuum launcher \r\npostgres     116  0.0  0.0  70460  7364 ?        Ss   Apr02   0:42 postgres: 14/main: stats collector \r\npostgres     117  0.0  0.0 216140  7648 ?        Ss   Apr02   0:00 postgres: 14/main: logical replication launcher \r\nroot         513  0.0  0.0   2888  1004 pts/1    Ss+  Apr03   0:00 sh\r\nroot         532  0.0  0.0   2888  1060 pts/2    Ss+  Apr03   0:00 sh\r\nroot        1062  0.0  0.0   2888  1000 pts/3    Ss+  Apr03   0:00 sh\r\nroot        7507  0.0  0.0   2888   972 pts/4    Ss+  Apr05   0:00 sh\r\nroot       53122  0.0  0.0   4628  3864 pts/5    Ss   Apr21   0:00 bash\r\nroot       53135  0.0  0.0  19892 13060 pts/5    S+   Apr21   0:00 /usr/lib/postgresql/14/bin/psql -p 5432 -U kingadmin -d kingapi -h king-api-staging.cluster\r\nroot       64286  0.0  0.0   4624  3752 pts/6    Ss   03:53   0:00 bash\r\nroot       64303  0.0  0.0   7368  3152 pts/6    R+   03:55   0:00 ps -aux\r\n```\r\n`PID 110〜117`はbucardo dbに対するpostgresプロセスである\r\n\r\n`PID 53135`はstaging auroraに繋ぎにいってるように見えるのでkillする必要がありそうだが、現在何もしていないようだ\r\n\r\n```\r\nselect usename,application_name from pg_stat_activity;\r\n-[ RECORD 1 ]----+---------------------------------\r\nusename          | \r\napplication_name | \r\n-[ RECORD 2 ]----+---------------------------------\r\nusename          | rdsadmin\r\napplication_name | \r\n-[ RECORD 3 ]----+---------------------------------\r\nusename          | rdsadmin\r\napplication_name | PostgreSQL JDBC Driver\r\n-[ RECORD 4 ]----+---------------------------------\r\nusename          | rdsadmin\r\napplication_name | PostgreSQL JDBC Driver\r\n-[ RECORD 5 ]----+---------------------------------\r\nusename          | kingadmin\r\napplication_name | puma: cluster worker 1: 12 [app]\r\n-[ RECORD 6 ]----+---------------------------------\r\nusename          | rdsadmin\r\napplication_name | PostgreSQL JDBC Driver\r\n-[ RECORD 7 ]----+---------------------------------\r\nusename          | rdsadmin\r\napplication_name | \r\n-[ RECORD 8 ]----+---------------------------------\r\nusename          | kingadmin\r\napplication_name | psql\r\n-[ RECORD 9 ]----+---------------------------------\r\nusename          | kingadmin\r\napplication_name | TablePlus\r\n-[ RECORD 10 ]---+---------------------------------\r\nusename          | kingadmin\r\napplication_name | puma: cluster worker 1: 12 [app]\r\n-[ RECORD 11 ]---+---------------------------------\r\nusename          | kingadmin\r\napplication_name | puma: cluster worker 0: 12 [app]\r\n-[ RECORD 12 ]---+---------------------------------\r\nusename          | kingadmin\r\napplication_name | psql(これを見る時の接続)\r\n-[ RECORD 13 ]---+---------------------------------\r\nusename          | \r\napplication_name | \r\n-[ RECORD 14 ]---+---------------------------------\r\nusename          | \r\napplication_name | \r\n-[ RECORD 15 ]---+---------------------------------\r\nusename          | \r\napplication_name | \r\n-[ RECORD 16 ]---+---------------------------------\r\nusename          | \r\napplication_name | \r\n-[ RECORD 17 ]---+---------------------------------\r\nusename          | \r\napplication_name |\r\n```\r\n\r\n## 実行操作\r\n\r\n### 準備\r\n- [x] papertrailを起動しておく\r\n- [x] cloud watchのking-api-staging-auroraダッシュボードを開いておく(CPU、Connection周りを注視)\r\n\r\n### コマンド\r\n```bash\r\n# EC2そのものを削除される前に念のためbucardoの設定項目ごとに正規手順で削除\r\n[EC2-docker] bucardo remove sync sync_heroku_aws # 同期の削除\r\n[EC2-docker] bucardo remove relgroup herd_heroku_db # リレーショングループの削除\r\n[EC2-docker] bucardo remove all tables # 監視テーブル削除\r\n[EC2-docker] bucardo remove dbgroup dbs # 接続DBグループ削除\r\n[EC2-docker] bucardo remove db aws_db # Auroraの接続情報削除\r\n[EC2-docker] bucardo remove db heroku_db # HerokuDBの接続情報削除\r\n\r\n# 上記psqlプロセスの停止\r\n[EC2-docker] service postgresql stop\r\n\r\n# EC2の停止(インスタンスストアボリュームが揮発)\r\n[local] aws ec2 stop-instances --instance-ids i-0a30d63c9441cb1b3\r\n\r\n# private linkとEC2スタックの削除(private linkはstagingの場合存在していないが、本番同等の操作として検証にする)\r\n[local] sh ./local_scripts/ec2_stack_delete.sh ./config/staging.env sl2-api-staging\r\n```\r\n\r\n### CU確認\r\nStagingCUでリモート解施錠とログの確認、ユーザー名の変更を行いAuroraに対して更新動作をする\r\n### ec2_stack_delete.shの挙動\r\n[github:king-cloudformation](https://github.com/qrioinc/king-cloudformation)\r\n\r\n1. PrivateLinkがあるか確認\r\n1. あれば削除、なければ次のステップ\r\n1. `aws cloudformation delete-stack --stack-name 'king-api-staging-bucardo-stack'`(先述の削除対象リソースのみが削除される)\r\n\r\n## ロールバック操作\r\n### bucardoの設定操作中に異常が起きた場合\r\n\r\nsync,relgroup,tables,dbgroup,dbのステップごとに削除したエントリを再度登録する\r\n```\r\nbucardo add ** ...\r\n```\r\n\r\n### ec2停止中\r\nec2を再起動する(起動テンプレートによりインスタンスストアボリュームは再構築される)\r\n```\r\naws ec2 start-instances --instance-ids i-0a30d63c9441cb1b3\r\n```\r\n\r\n### ec2_stack_delete時に異常が起きた場合\r\nEC2環境の再デプロイ\r\n```\r\ncd /king-cloudformation/king-api-aurora-cfn\r\n\r\nsource ./config/staging.env\r\n\r\naws cloudformation deploy \\\r\n    --stack-name $EC2_STACK_NAME \\\r\n    --template-file ./templates/king-api-ec2-bucardo.yml \\\r\n    --capabilities CAPABILITY_NAMED_IAM \\\r\n    --parameter-overrides \\\r\n    BucardoNameTag=$BUCARDO_EC2_NAME_TAG \\\r\n    BucardoEC2InstanceType=$BUCARDO_EC2_INSTANCE_TYPE \\\r\n    BucardoEC2EbsVolumeSize=$BUCARDO_EC2_EBS_VOLUME_SIZE \\\r\n    BucardoEC2ImageId=$BUCARDO_EC2_IMAGE_ID \\\r\n    EC2AccessIp=$EC2_ACCES_SIP \\\r\n    VpcCidr=$VPC_CIDR \\\r\n    ImportStackName=$AURORA_STACK_NAME\r\n```\r\n\r\n### 懸念は少ない\r\nだが、以前db-migration-test環境でEC2の削除ができた経緯もありロールバックは必要ない認識\r\n\r\n## 実行後の履歴\r\n\r\n### EC2ログイン\r\n\r\n```sh\r\nssh -i \"king-api-staging-bucardo-ec2.pem\" ubuntu@ec2-13-114-101-123.ap-northeast-1.compute.amazonaws.com\r\nWelcome to Ubuntu 22.04.1 LTS (GNU/Linux 5.15.0-1026-aws x86_64)\r\n\r\n * Documentation:  https://help.ubuntu.com\r\n * Management:     https://landscape.canonical.com\r\n * Support:        https://ubuntu.com/advantage\r\n\r\n  System information as of Thu Apr 27 05:04:58 UTC 2023\r\n\r\n  System load:  0.0                Processes:                136\r\n  Usage of /:   22.1% of 15.32GB   Users logged in:          0\r\n  Memory usage: 4%                 IPv4 address for docker0: 172.17.0.1\r\n  Swap usage:   0%                 IPv4 address for ens3:    172.35.3.221\r\n\r\n * Ubuntu Pro delivers the most comprehensive open source security and\r\n   compliance features.\r\n\r\n   https://ubuntu.com/aws/pro\r\n\r\n70 updates can be applied immediately.\r\nTo see these additional updates run: apt list --upgradable\r\n\r\n\r\n*** System restart required ***\r\nLast login: Tue Apr 25 22:57:01 2023 from 3.112.23.3\r\nubuntu@ip-172-35-3-221:~$\r\n```\r\n\r\n### Docker exec\r\n```sh\r\nsudo docker exec -it --user root 1bce13d6f8dd bash\r\nroot@1bce13d6f8dd:/#\r\n```\r\n\r\n### bucardoの設定削除(2〜5分ずつ実行)\r\n```sh\r\nroot@1bce13d6f8dd:/# bucardo remove sync sync_heroku_aws\r\nRemoved sync \"sync_heroku_aws\"\r\nNote: table triggers (if any) are not automatically removed!   # これは「ソースDBに同期用トリガが残りますよの意(既にHerokuDBは削除ずみ)\r\n\r\nroot@1bce13d6f8dd:/# bucardo remove relgroup herd_heroku_db\r\nRemoved relgroup \"herd_heroku_db\"\r\n\r\nroot@1bce13d6f8dd:/# bucardo remove all tables\r\nAre you sure you want to remove all tables? yes\r\nRemoved the following tables:\r\n  public.display_logs\r\n  public.logs\r\n  \r\nroot@1bce13d6f8dd:/# bucardo remove dbgroup dbs\r\nRemoved dbgroup \"dbs\"\r\n\r\nbucardo remove db aws_db\r\nRemoved database \"aws_db\"\r\n\r\nbucardo remove db heroku_db\r\nRemoved database \"heroku_db\"\r\n```\r\n\r\n### psqlプロセス停止(productionでは必要ない)\r\n```sh\r\nroot@1bce13d6f8dd:/# service postgresql stop\r\n * Stopping PostgreSQL 14 database server                     [ OK ]\r\nroot@1bce13d6f8dd:/# service --status-all\r\n [ - ]  dbus\r\n [ ? ]  hwclock.sh\r\n [ - ]  postgresql # 停止されている\r\n [ - ]  procps\r\n [ - ]  sysstat\r\n [ - ]  unattended-upgrades\r\n root@1bce13d6f8dd:/# ps -ax\r\n    PID TTY      STAT   TIME COMMAND\r\n      1 pts/0    Ss+    0:00 /bin/bash\r\n    513 pts/1    Ss+    0:00 sh\r\n    532 pts/2    Ss+    0:00 sh\r\n   1062 pts/3    Ss+    0:00 sh\r\n   7507 pts/4    Ss+    0:00 sh\r\n  53122 pts/5    Ss     0:00 bash\r\n  53135 pts/5    S+     0:00 /usr/lib/postgresql/14/bin/psql -p 5432 -U kingadmin -d kingapi -h king-api-staging.cluster-c\r\n  66596 pts/6    Ss+    0:00 bash\r\n  70215 pts/7    Ss     0:00 bash\r\n  70317 pts/7    R+     0:00 ps -ax\r\n```\r\n\r\nまだいるのでDB側から確認、以前lockが最新かどうか確認するクエリのままidleとなっているセッションがあったのでこれが該当する\r\n\r\n```sql\r\nkingapi=> select * from pg_stat_activity where application_name = 'psql';\r\n-[ RECORD 1 ]----+---------------------------------------------------------------\r\ndatid            | 16400\r\ndatname          | kingapi\r\npid              | 7261\r\nleader_pid       |\r\nusesysid         | 16399\r\nusename          | kingadmin\r\napplication_name | psql\r\nclient_addr      | 172.35.3.221\r\nclient_hostname  |\r\nclient_port      | 39218\r\nbackend_start    | 2023-04-21 06:42:14.469438+00\r\nxact_start       |\r\nquery_start      | 2023-04-21 06:42:56.950607+00\r\nstate_change     | 2023-04-21 06:42:56.952749+00\r\nwait_event_type  | Client\r\nwait_event       | ClientRead\r\nstate            | idle\r\nbackend_xid      |\r\nbackend_xmin     |\r\nquery_id         |\r\nquery            | select * from locks order by updated_at desc limit 1;\r\nbackend_type     | client backend\r\n-[ RECORD 2 ]----+---------------------------------------------------------------\r\ndatid            | 16400\r\ndatname          | kingapi\r\npid              | 29311\r\nleader_pid       |\r\nusesysid         | 16399\r\nusename          | kingadmin\r\napplication_name | psql\r\nclient_addr      | 172.35.3.221\r\nclient_hostname  |\r\nclient_port      | 55974\r\nbackend_start    | 2023-04-27 05:42:25.847252+00\r\nxact_start       | 2023-04-27 05:44:31.980124+00\r\nquery_start      | 2023-04-27 05:44:31.980124+00\r\nstate_change     | 2023-04-27 05:44:31.980126+00\r\nwait_event_type  |\r\nwait_event       |\r\nstate            | active\r\nbackend_xid      |\r\nbackend_xmin     | 3630608\r\nquery_id         | 6565524708528687601\r\nquery            | select * from pg_stat_activity where application_name = 'psql'+\r\n                 | ;\r\nbackend_type     | client backend\r\n```\r\n\r\nselectしているだけなので(なぜアイドルかは不明)特段影響はなさそうだが、Aurora側からセッションの切断を行う\r\n\r\n```sql\r\nkingapi=> SELECT pg_terminate_backend(7261);\r\n-[ RECORD 1 ]--------+--\r\npg_terminate_backend | t\r\n```\r\ntrueが帰ってきた(t)ので成功\r\n\r\n再度セッションの確認→psql接続は確認用のセッションのみとなった\r\n```sql\r\nkingapi=> select * from pg_stat_activity where application_name = 'psql'\r\n;\r\n-[ RECORD 1 ]----+---------------------------------------------------------------\r\ndatid            | 16400\r\ndatname          | kingapi\r\npid              | 29311\r\nleader_pid       |\r\nusesysid         | 16399\r\nusename          | kingadmin\r\napplication_name | psql\r\nclient_addr      | 172.35.3.221\r\nclient_hostname  |\r\nclient_port      | 55974\r\nbackend_start    | 2023-04-27 05:42:25.847252+00\r\nxact_start       | 2023-04-27 05:49:11.24868+00\r\nquery_start      | 2023-04-27 05:49:11.24868+00\r\nstate_change     | 2023-04-27 05:49:11.248682+00\r\nwait_event_type  |\r\nwait_event       |\r\nstate            | active\r\nbackend_xid      |\r\nbackend_xmin     | 3631051\r\nquery_id         | 6565524708528687601\r\nquery            | select * from pg_stat_activity where application_name = 'psql'+\r\n                 | ;\r\nbackend_type     | client backend\r\n```\r\n\r\n#### productionの場合、psqlプロセスがない\r\n```sh\r\nubuntu@ip-172-30-3-25:~$ sudo docker exec -it --user root 10cf28189a1f sh\r\n# ps -aux\r\nUSER         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND\r\npostgres       1  0.0  0.0   4624  3580 pts/0    Ss+  Apr17   0:00 /bin/bash\r\npostgres     145  0.0  0.0 215724 30488 ?        Ss   Apr17   0:18 /usr/lib/postgresql/14/bin/postgres -D /var/lib/postgre\r\npostgres     147  0.0  0.0 215856 12260 ?        Ss   Apr17   0:00 postgres: 14/main: checkpointer\r\npostgres     148  0.0  0.0 215724  9564 ?        Ss   Apr17   0:04 postgres: 14/main: background writer\r\npostgres     149  0.0  0.0 215724 11676 ?        Ss   Apr17   0:04 postgres: 14/main: walwriter\r\npostgres     150  0.0  0.0 216264  9996 ?        Ss   Apr17   0:09 postgres: 14/main: autovacuum launcher\r\npostgres     151  0.0  0.0  70460  6492 ?        Ss   Apr17   0:16 postgres: 14/main: stats collector\r\npostgres     152  0.0  0.0 216140  7676 ?        Ss   Apr17   0:00 postgres: 14/main: logical replication launcher\r\nroot        1701  0.0  0.0   2888  1060 pts/1    Ss+  Apr17   0:00 sh\r\nroot        1886  0.0  0.0   2888   988 pts/2    Ss+  Apr17   0:00 sh\r\nroot        2454  0.0  0.0   2888   992 pts/3    Ss+  Apr18   0:00 sh\r\nroot        2476  0.0  0.0   2888   984 pts/4    Ss+  Apr18   0:00 sh\r\nroot        2500  0.0  0.0   2888  1060 pts/5    Ss   Apr18   0:00 sh\r\nroot        2513  0.0  0.0   7316  3404 pts/5    S+   Apr18   3:52 top\r\nroot        4253  0.0  0.0   2888  1040 pts/7    Ss+  Apr18   0:00 sh\r\nroot        4413  0.0  0.0   2888   980 pts/9    Ss+  Apr18   0:00 sh\r\nroot       31003  0.6  0.0   2888   952 pts/6    Ss   06:18   0:00 sh\r\nroot       31009  0.0  0.0   7368  3048 pts/6    R+   06:18   0:00 ps -aux\r\n```\r\n\r\n影響を与える要素が消えたので次のステップへ\r\n\r\n### EC2インスタンスの停止\r\n\r\n```sh\r\naws ec2 stop-instances --instance-ids i-0a30d63c9441cb1b3\r\n{\r\n    \"StoppingInstances\": [\r\n        {\r\n            \"CurrentState\": {\r\n                \"Code\": 64,\r\n                \"Name\": \"stopping\"\r\n            },\r\n            \"InstanceId\": \"i-0a30d63c9441cb1b3\",\r\n            \"PreviousState\": {\r\n                \"Code\": 16,\r\n                \"Name\": \"running\"\r\n            }\r\n        }\r\n    ]\r\n}\r\n(END)\r\n\r\n```\r\n<img width=\"595\" alt=\"スクリーンショット 2023-04-27 15.02.04.png (23.8 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/27/136273/a37dc986-5c57-4a0e-a3aa-4712687d3b60.png\">\r\n\r\n一応CU確認(リモート解施錠、ユーザー名変更、リモート解施錠、履歴確認)→OK\r\n\r\n<img width=\"864\" alt=\"Screenshot_20230427-150340.png (206.2 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/27/136273/5650ab38-53bd-4336-88a5-4b2448397954.png\">\r\n\r\nCloudWatch→問題なし\r\n<img width=\"795\" alt=\"スクリーンショット 2023-04-27 15.07.04.png (36.1 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/27/136273/f317e3b5-63a4-4fb4-99f7-fd2f54381970.png\">\r\n\r\nPapertrail→問題なし\r\n<img width=\"680\" alt=\"スクリーンショット 2023-04-27 15.16.47.png (37.1 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/27/136273/3a70f916-71a9-4c31-abbc-661a29179530.png\">\r\n\r\n### private linkとEC2スタックの削除(private linkはstagingの場合存在していないが、本番同等の操作として検証にする)\r\n\r\n```\r\n# sugiyamasatoshi @ sugiyamasatoshinoMacBook-Pro in ~/king-cloudformation/king-api-aurora-cfn on git:hotfix/ec2-route-fix x [15:19:45]\r\n$ sh ./local_scripts/ec2_stack_delete.sh ./config/staging.env sl2-api-staging                                    15:19:45\r\nスタック名:king-api-staging-bucardo-stack\r\nPrivateLink Dyno名: sl2-api-staging\r\n[**入力]上記スタックを削除しますか？(y/n)y\r\n1.PrivateLinkの削除------------------------ # ここはprivate linkを用いていないためエラーが出る→期待動作です\r\n ›   Error: Couldn't find that add on.\r\n ›\r\n ›   Error ID: not_found\r\nVPCエンドポイント:\r\nPrivateLink/VPCエンドポイントがありません。以降の削除を続行します\r\n2.EC2スタックの削除------------------------\r\n```\r\n\r\n<img width=\"404\" alt=\"スクリーンショット 2023-04-27 15.22.04.png (22.9 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/27/136273/bc1bcdd0-d3d2-4cc5-9cd8-f156c20a2598.png\">\r\n\r\n削除完了\r\n\r\n<img width=\"595\" alt=\"スクリーンショット 2023-04-27 15.24.07.png (109.7 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/27/136273/42ec52f9-645e-41cb-91df-cb83694430d1.png\">\r\n\r\n### CU確認\r\nOK\r\n<img width=\"864\" alt=\"Screenshot (2023_04_27 15_26_10).png (194.2 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/27/136273/82ef77b9-c0ca-4b4e-a2a6-30d80e0061bc.png\">\r\n\r\n",
    "body_html": "<h2 data-sourcepos=\"1:1-1:12\" id=\"0-1-0\" name=\"0-1-0\"><a class=\"anchor\" id=\"実施日\" name=\"実施日\" href=\"#実施日\" data-position=\"0-1-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"実施日\"> &gt; 実施日</span></a>実施日</h2>\n<p data-sourcepos=\"3:1-3:9\">4/27(木)</p>\n<h2 data-sourcepos=\"6:1-6:24\" id=\"0-2-0\" name=\"0-2-0\"><a class=\"anchor\" id=\"STG環境影響範囲\" name=\"STG環境影響範囲\" href=\"#STG環境影響範囲\" data-position=\"0-2-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"STG環境影響範囲\"> &gt; STG環境影響範囲</span></a>STG環境影響範囲</h2>\n<ul data-sourcepos=\"7:1-9:0\">\n<li data-sourcepos=\"7:1-7:84\">EC2内Dockerコンテナでbucardoの設定にAuroraの接続情報が含まれる</li>\n<li data-sourcepos=\"8:1-9:0\">稼働中のAuroraの動作に影響するEC2スタックのリソースが削除されないか確認→下記で確認済み</li>\n</ul>\n<h2 data-sourcepos=\"10:1-10:27\" id=\"0-3-0\" name=\"0-3-0\"><a class=\"anchor\" id=\"削除対象リソース\" name=\"削除対象リソース\" href=\"#削除対象リソース\" data-position=\"0-3-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"削除対象リソース\"> &gt; 削除対象リソース</span></a>削除対象リソース</h2>\n<h3 data-sourcepos=\"12:1-12:34\" id=\"0-3-1\" name=\"0-3-1\"><a class=\"anchor\" id=\"king-api-staging-bucardo-stack\" name=\"king-api-staging-bucardo-stack\" href=\"#king-api-staging-bucardo-stack\" data-position=\"0-3-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"king-api-staging-bucardo-stack\"> &gt; king-api-staging-bucardo-stack</span></a>king-api-staging-bucardo-stack</h3>\n<ul data-sourcepos=\"14:1-26:0\">\n<li data-sourcepos=\"14:1-14:140\"><a href=\"https://ap-northeast-1.console.aws.amazon.com/ec2/home?region=ap-northeast-1#Instances:search=i-0a30d63c9441cb1b3\" target=\"_blank\" rel=\"noopener noreferrer\">EC2インスタンス</a></li>\n<li data-sourcepos=\"15:1-16:36\">EC2ルートテーブル(rtb-0095985c19a342cd1)\n<ul data-sourcepos=\"16:5-16:36\">\n<li data-sourcepos=\"16:5-16:36\">EC2のパブリックルート</li>\n</ul></li>\n<li data-sourcepos=\"17:1-17:140\"><a href=\"https://ap-northeast-1.console.aws.amazon.com/vpc/home?region=ap-northeast-1#subnets:search=subnet-0ddce66efa1483d93\" target=\"_blank\" rel=\"noopener noreferrer\">EC2サブネット</a></li>\n<li data-sourcepos=\"18:1-18:32\">EC2サブネット関連付け</li>\n<li data-sourcepos=\"19:1-20:128\">IAMプロフィール(ECRアクセス用)(ECR-Access-for-king-api-staging-bucardo-ec2)\n<ul data-sourcepos=\"20:5-20:128\">\n<li data-sourcepos=\"20:5-20:128\"><a href=\"https://ap-northeast-1.console.aws.amazon.com/iam/home?#/roles/ECR-Access-for-king-api-staging-bucardo-ec2\" target=\"_blank\" rel=\"noopener noreferrer\">IAMロール</a></li>\n</ul></li>\n<li data-sourcepos=\"21:1-21:217\">EC2起動テンプレート<a href=\"https://ap-northeast-1.console.aws.amazon.com/ec2/v2/home?region=ap-northeast-1#LaunchTemplateDetails:launchTemplateId=lt-0a609e4c0198906df\" target=\"_blank\" rel=\"noopener noreferrer\">king-api-staging-bucardo-ec2-install-template</a></li>\n<li data-sourcepos=\"22:1-22:47\">EC2キーペア(king-api-staging-bucardo-ec2)</li>\n<li data-sourcepos=\"23:1-23:164\"><a href=\"https://ap-northeast-1.console.aws.amazon.com/ec2/home?region=ap-northeast-1#SecurityGroup:groupId=sg-086bef993b9abd1c0\" target=\"_blank\" rel=\"noopener noreferrer\">EC2のSSHセキュリティグループ</a></li>\n<li data-sourcepos=\"24:1-24:121\">Auroraセキュリティグループ内のEC2→Auroraのセキュリティグループルール(sgr-0394704162de97bbe)</li>\n<li data-sourcepos=\"25:1-26:0\"><a href=\"https://ap-northeast-1.console.aws.amazon.com/ec2/home?region=ap-northeast-1#SecurityGroup:groupId=sg-0753d37514d41e5f2\" target=\"_blank\" rel=\"noopener noreferrer\">EC2からHerokuSTGDBへのセキュリティグループ(privatelink用なので利用せず)</a></li>\n</ul>\n<p data-sourcepos=\"27:1-27:146\">稼働中のAuroraに関係する部分は<code>Auroraセキュリティグループ内のEC2→Auroraのセキュリティグループルール</code>程度</p>\n<h2 data-sourcepos=\"29:1-29:15\" id=\"0-4-0\" name=\"0-4-0\"><a class=\"anchor\" id=\"状態確認\" name=\"状態確認\" href=\"#状態確認\" data-position=\"0-4-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"状態確認\"> &gt; 状態確認</span></a>状態確認</h2>\n<h3 data-sourcepos=\"30:1-30:72\" id=\"0-4-1\" name=\"0-4-1\"><a class=\"anchor\" id=\"king-api-staging-bucardo-stackのドリフト(CFn制御外の変更)\" name=\"king-api-staging-bucardo-stackのドリフト(CFn制御外の変更)\" href=\"#king-api-staging-bucardo-stackのドリフト(CFn制御外の変更)\" data-position=\"0-4-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"king-api-staging-bucardo-stackのドリフト(CFn制御外の変更)\"> &gt; king-api-staging-bucardo-stackのドリフト(CFn制御外の変更)</span></a>king-api-staging-bucardo-stackのドリフト(CFn制御外の変更)</h3>\n<p data-sourcepos=\"31:1-32:206\">なし<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/26/136273/e983e9d0-31e6-4d3f-8880-46ab02abd9c4.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"1594\" alt=\"スクリーンショット 2023-04-26 8.36.51.png (166.0 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/26/136273/e983e9d0-31e6-4d3f-8880-46ab02abd9c4.png\"></a></p>\n<h3 data-sourcepos=\"34:1-34:11\" id=\"0-4-2\" name=\"0-4-2\"><a class=\"anchor\" id=\"bucardo\" name=\"bucardo\" href=\"#bucardo\" data-position=\"0-4-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"bucardo\"> &gt; bucardo</span></a>bucardo</h3>\n<p data-sourcepos=\"35:1-36:31\">herokuから(移行時)4/3以降の反映がない状態で、理想的である<br>\n(herokudbは既に削除済み)</p>\n<div class=\"code-block\" data-sourcepos=\"37:1-57:3\"><div class=\"highlight\"><pre class=\"highlight plaintext\"><code>root@1bce13d6f8dd:/# bucardo status sync_heroku_aws\n======================================================================\nLast good                : Apr 03, 2023 06:47:54 (time to run: 1s)\nRows deleted/inserted    : 0 / 1\nSync name                : sync_heroku_aws\nCurrent state            : Good\nSource relgroup/database : herd_heroku_db / heroku_db\nTables in sync           : 2\nStatus                   : Active\nCheck time               : None\nOverdue time             : 00:00:00\nExpired time             : 00:00:00\nStayalive/Kidsalive      : Yes / Yes\nRebuild index            : No\nAutokick                 : Yes\nOnetimecopy              : No\nPost-copy analyze        : Yes\nLast error:              : \n======================================================================\n</code></pre></div></div>\n<h3 data-sourcepos=\"59:1-59:28\" id=\"0-4-3\" name=\"0-4-3\"><a class=\"anchor\" id=\"プロセス(4/25 12:56)\" name=\"プロセス(4/25 12:56)\" href=\"#プロセス(4/25 12:56)\" data-position=\"0-4-3\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"プロセス(4/25 12__colon__56)\"> &gt; プロセス(4/25 12__colon__56)</span></a>プロセス(4/25 12:56)</h3>\n<div class=\"code-block\" data-sourcepos=\"61:1-80:3\"><div class=\"highlight\"><pre class=\"highlight plaintext\"><code>root@1bce13d6f8dd:/# ps -aux\nUSER         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND\npostgres       1  0.0  0.0   4624  3652 pts/0    Ss+  Mar31   0:00 /bin/bash\npostgres     110  0.0  0.1 215724 30048 ?        Ss   Apr02   0:41 /usr/lib/postgresql/14/bin/postgres -D /var/lib/postgresql/14/main -c config_file=/etc/post\npostgres     112  0.0  0.0 215856 12300 ?        Ss   Apr02   0:00 postgres: 14/main: checkpointer \npostgres     113  0.0  0.0 215724  7040 ?        Ss   Apr02   0:13 postgres: 14/main: background writer \npostgres     114  0.0  0.0 215724 11716 ?        Ss   Apr02   0:13 postgres: 14/main: walwriter \npostgres     115  0.0  0.0 216264  9892 ?        Ss   Apr02   0:24 postgres: 14/main: autovacuum launcher \npostgres     116  0.0  0.0  70460  7364 ?        Ss   Apr02   0:42 postgres: 14/main: stats collector \npostgres     117  0.0  0.0 216140  7648 ?        Ss   Apr02   0:00 postgres: 14/main: logical replication launcher \nroot         513  0.0  0.0   2888  1004 pts/1    Ss+  Apr03   0:00 sh\nroot         532  0.0  0.0   2888  1060 pts/2    Ss+  Apr03   0:00 sh\nroot        1062  0.0  0.0   2888  1000 pts/3    Ss+  Apr03   0:00 sh\nroot        7507  0.0  0.0   2888   972 pts/4    Ss+  Apr05   0:00 sh\nroot       53122  0.0  0.0   4628  3864 pts/5    Ss   Apr21   0:00 bash\nroot       53135  0.0  0.0  19892 13060 pts/5    S+   Apr21   0:00 /usr/lib/postgresql/14/bin/psql -p 5432 -U kingadmin -d kingapi -h king-api-staging.cluster\nroot       64286  0.0  0.0   4624  3752 pts/6    Ss   03:53   0:00 bash\nroot       64303  0.0  0.0   7368  3152 pts/6    R+   03:55   0:00 ps -aux\n</code></pre></div></div>\n<p data-sourcepos=\"81:1-81:69\"><code>PID 110〜117</code>はbucardo dbに対するpostgresプロセスである</p>\n<p data-sourcepos=\"83:1-83:152\"><code>PID 53135</code>はstaging auroraに繋ぎにいってるように見えるのでkillする必要がありそうだが、現在何もしていないようだ</p>\n<div class=\"code-block\" data-sourcepos=\"85:1-138:3\"><div class=\"highlight\"><pre class=\"highlight plaintext\"><code>select usename,application_name from pg_stat_activity;\n-[ RECORD 1 ]----+---------------------------------\nusename          | \napplication_name | \n-[ RECORD 2 ]----+---------------------------------\nusename          | rdsadmin\napplication_name | \n-[ RECORD 3 ]----+---------------------------------\nusename          | rdsadmin\napplication_name | PostgreSQL JDBC Driver\n-[ RECORD 4 ]----+---------------------------------\nusename          | rdsadmin\napplication_name | PostgreSQL JDBC Driver\n-[ RECORD 5 ]----+---------------------------------\nusename          | kingadmin\napplication_name | puma: cluster worker 1: 12 [app]\n-[ RECORD 6 ]----+---------------------------------\nusename          | rdsadmin\napplication_name | PostgreSQL JDBC Driver\n-[ RECORD 7 ]----+---------------------------------\nusename          | rdsadmin\napplication_name | \n-[ RECORD 8 ]----+---------------------------------\nusename          | kingadmin\napplication_name | psql\n-[ RECORD 9 ]----+---------------------------------\nusename          | kingadmin\napplication_name | TablePlus\n-[ RECORD 10 ]---+---------------------------------\nusename          | kingadmin\napplication_name | puma: cluster worker 1: 12 [app]\n-[ RECORD 11 ]---+---------------------------------\nusename          | kingadmin\napplication_name | puma: cluster worker 0: 12 [app]\n-[ RECORD 12 ]---+---------------------------------\nusename          | kingadmin\napplication_name | psql(これを見る時の接続)\n-[ RECORD 13 ]---+---------------------------------\nusename          | \napplication_name | \n-[ RECORD 14 ]---+---------------------------------\nusename          | \napplication_name | \n-[ RECORD 15 ]---+---------------------------------\nusename          | \napplication_name | \n-[ RECORD 16 ]---+---------------------------------\nusename          | \napplication_name | \n-[ RECORD 17 ]---+---------------------------------\nusename          | \napplication_name |\n</code></pre></div></div>\n<h2 data-sourcepos=\"140:1-140:15\" id=\"0-5-0\" name=\"0-5-0\"><a class=\"anchor\" id=\"実行操作\" name=\"実行操作\" href=\"#実行操作\" data-position=\"0-5-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"実行操作\"> &gt; 実行操作</span></a>実行操作</h2>\n<h3 data-sourcepos=\"142:1-142:10\" id=\"0-5-1\" name=\"0-5-1\"><a class=\"anchor\" id=\"準備\" name=\"準備\" href=\"#準備\" data-position=\"0-5-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"準備\"> &gt; 準備</span></a>準備</h3>\n<ul data-sourcepos=\"143:1-145:0\" class=\"task-list\">\n<li data-sourcepos=\"143:1-143:37\" class=\"task-list-item\"><input type=\"checkbox\" class=\"task-list-item-checkbox\" data-item-position=\"0\" checked=\"\">papertrailを起動しておく</li>\n<li data-sourcepos=\"144:1-145:0\" class=\"task-list-item\"><input type=\"checkbox\" class=\"task-list-item-checkbox\" data-item-position=\"1\" checked=\"\">cloud watchのking-api-staging-auroraダッシュボードを開いておく(CPU、Connection周りを注視)</li>\n</ul>\n<h3 data-sourcepos=\"146:1-146:16\" id=\"0-5-2\" name=\"0-5-2\"><a class=\"anchor\" id=\"コマンド\" name=\"コマンド\" href=\"#コマンド\" data-position=\"0-5-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"コマンド\"> &gt; コマンド</span></a>コマンド</h3>\n<div class=\"code-block\" data-sourcepos=\"147:1-164:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>bash</div><div class=\"highlight\"><pre class=\"highlight shell\"><code><span class=\"c\"># EC2そのものを削除される前に念のためbucardoの設定項目ごとに正規手順で削除</span>\n<span class=\"o\">[</span>EC2-docker] bucardo remove <span class=\"nb\">sync </span>sync_heroku_aws <span class=\"c\"># 同期の削除</span>\n<span class=\"o\">[</span>EC2-docker] bucardo remove relgroup herd_heroku_db <span class=\"c\"># リレーショングループの削除</span>\n<span class=\"o\">[</span>EC2-docker] bucardo remove all tables <span class=\"c\"># 監視テーブル削除</span>\n<span class=\"o\">[</span>EC2-docker] bucardo remove dbgroup dbs <span class=\"c\"># 接続DBグループ削除</span>\n<span class=\"o\">[</span>EC2-docker] bucardo remove db aws_db <span class=\"c\"># Auroraの接続情報削除</span>\n<span class=\"o\">[</span>EC2-docker] bucardo remove db heroku_db <span class=\"c\"># HerokuDBの接続情報削除</span>\n\n<span class=\"c\"># 上記psqlプロセスの停止</span>\n<span class=\"o\">[</span>EC2-docker] service postgresql stop\n\n<span class=\"c\"># EC2の停止(インスタンスストアボリュームが揮発)</span>\n<span class=\"o\">[</span><span class=\"nb\">local</span><span class=\"o\">]</span> aws ec2 stop-instances <span class=\"nt\">--instance-ids</span> i-0a30d63c9441cb1b3\n\n<span class=\"c\"># private linkとEC2スタックの削除(private linkはstagingの場合存在していないが、本番同等の操作として検証にする)</span>\n<span class=\"o\">[</span><span class=\"nb\">local</span><span class=\"o\">]</span> sh ./local_scripts/ec2_stack_delete.sh ./config/staging.env sl2-api-staging\n</code></pre></div></div>\n<h3 data-sourcepos=\"166:1-166:12\" id=\"0-5-3\" name=\"0-5-3\"><a class=\"anchor\" id=\"CU確認\" name=\"CU確認\" href=\"#CU確認\" data-position=\"0-5-3\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"CU確認\"> &gt; CU確認</span></a>CU確認</h3>\n<p data-sourcepos=\"167:1-167:126\">StagingCUでリモート解施錠とログの確認、ユーザー名の変更を行いAuroraに対して更新動作をする</p>\n<h3 data-sourcepos=\"168:1-168:32\" id=\"0-5-4\" name=\"0-5-4\"><a class=\"anchor\" id=\"ec2_stack_delete.shの挙動\" name=\"ec2_stack_delete.shの挙動\" href=\"#ec2_stack_delete.shの挙動\" data-position=\"0-5-4\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"ec2_stack_delete.shの挙動\"> &gt; ec2_stack_delete.shの挙動</span></a>ec2_stack_delete.shの挙動</h3>\n<p data-sourcepos=\"169:1-169:76\"><a href=\"https://github.com/qrioinc/king-cloudformation\" target=\"_blank\" rel=\"noopener noreferrer\">github:king-cloudformation</a></p>\n<ol data-sourcepos=\"171:1-174:0\">\n<li data-sourcepos=\"171:1-171:32\">PrivateLinkがあるか確認</li>\n<li data-sourcepos=\"172:1-172:51\">あれば削除、なければ次のステップ</li>\n<li data-sourcepos=\"173:1-174:0\"><code>aws cloudformation delete-stack --stack-name 'king-api-staging-bucardo-stack'</code>(先述の削除対象リソースのみが削除される)</li>\n</ol>\n<h2 data-sourcepos=\"175:1-175:27\" id=\"0-6-0\" name=\"0-6-0\"><a class=\"anchor\" id=\"ロールバック操作\" name=\"ロールバック操作\" href=\"#ロールバック操作\" data-position=\"0-6-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"ロールバック操作\"> &gt; ロールバック操作</span></a>ロールバック操作</h2>\n<h3 data-sourcepos=\"176:1-176:56\" id=\"0-6-1\" name=\"0-6-1\"><a class=\"anchor\" id=\"bucardoの設定操作中に異常が起きた場合\" name=\"bucardoの設定操作中に異常が起きた場合\" href=\"#bucardoの設定操作中に異常が起きた場合\" data-position=\"0-6-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"bucardoの設定操作中に異常が起きた場合\"> &gt; bucardoの設定操作中に異常が起きた場合</span></a>bucardoの設定操作中に異常が起きた場合</h3>\n<p data-sourcepos=\"178:1-178:100\">sync,relgroup,tables,dbgroup,dbのステップごとに削除したエントリを再度登録する</p>\n<div class=\"code-block\" data-sourcepos=\"179:1-181:3\"><div class=\"highlight\"><pre class=\"highlight plaintext\"><code>bucardo add ** ...\n</code></pre></div></div>\n<h3 data-sourcepos=\"183:1-183:16\" id=\"0-6-2\" name=\"0-6-2\"><a class=\"anchor\" id=\"ec2停止中\" name=\"ec2停止中\" href=\"#ec2停止中\" data-position=\"0-6-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"ec2停止中\"> &gt; ec2停止中</span></a>ec2停止中</h3>\n<p data-sourcepos=\"184:1-184:119\">ec2を再起動する(起動テンプレートによりインスタンスストアボリュームは再構築される)</p>\n<div class=\"code-block\" data-sourcepos=\"185:1-187:3\"><div class=\"highlight\"><pre class=\"highlight plaintext\"><code>aws ec2 start-instances --instance-ids i-0a30d63c9441cb1b3\n</code></pre></div></div>\n<h3 data-sourcepos=\"189:1-189:50\" id=\"0-6-3\" name=\"0-6-3\"><a class=\"anchor\" id=\"ec2_stack_delete時に異常が起きた場合\" name=\"ec2_stack_delete時に異常が起きた場合\" href=\"#ec2_stack_delete時に異常が起きた場合\" data-position=\"0-6-3\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"ec2_stack_delete時に異常が起きた場合\"> &gt; ec2_stack_delete時に異常が起きた場合</span></a>ec2_stack_delete時に異常が起きた場合</h3>\n<p data-sourcepos=\"190:1-190:27\">EC2環境の再デプロイ</p>\n<div class=\"code-block\" data-sourcepos=\"191:1-208:3\"><div class=\"highlight\"><pre class=\"highlight plaintext\"><code>cd /king-cloudformation/king-api-aurora-cfn\n\nsource ./config/staging.env\n\naws cloudformation deploy \\\n    --stack-name $EC2_STACK_NAME \\\n    --template-file ./templates/king-api-ec2-bucardo.yml \\\n    --capabilities CAPABILITY_NAMED_IAM \\\n    --parameter-overrides \\\n    BucardoNameTag=$BUCARDO_EC2_NAME_TAG \\\n    BucardoEC2InstanceType=$BUCARDO_EC2_INSTANCE_TYPE \\\n    BucardoEC2EbsVolumeSize=$BUCARDO_EC2_EBS_VOLUME_SIZE \\\n    BucardoEC2ImageId=$BUCARDO_EC2_IMAGE_ID \\\n    EC2AccessIp=$EC2_ACCES_SIP \\\n    VpcCidr=$VPC_CIDR \\\n    ImportStackName=$AURORA_STACK_NAME\n</code></pre></div></div>\n<h3 data-sourcepos=\"210:1-210:22\" id=\"0-6-4\" name=\"0-6-4\"><a class=\"anchor\" id=\"懸念は少ない\" name=\"懸念は少ない\" href=\"#懸念は少ない\" data-position=\"0-6-4\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"懸念は少ない\"> &gt; 懸念は少ない</span></a>懸念は少ない</h3>\n<p data-sourcepos=\"211:1-211:119\">だが、以前db-migration-test環境でEC2の削除ができた経緯もありロールバックは必要ない認識</p>\n<h2 data-sourcepos=\"213:1-213:21\" id=\"0-7-0\" name=\"0-7-0\"><a class=\"anchor\" id=\"実行後の履歴\" name=\"実行後の履歴\" href=\"#実行後の履歴\" data-position=\"0-7-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"実行後の履歴\"> &gt; 実行後の履歴</span></a>実行後の履歴</h2>\n<h3 data-sourcepos=\"215:1-215:19\" id=\"0-7-1\" name=\"0-7-1\"><a class=\"anchor\" id=\"EC2ログイン\" name=\"EC2ログイン\" href=\"#EC2ログイン\" data-position=\"0-7-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"EC2ログイン\"> &gt; EC2ログイン</span></a>EC2ログイン</h3>\n<div class=\"code-block\" data-sourcepos=\"217:1-244:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>ssh <span class=\"nt\">-i</span> <span class=\"s2\">\"king-api-staging-bucardo-ec2.pem\"</span> ubuntu@ec2-13-114-101-123.ap-northeast-1.compute.amazonaws.com\nWelcome to Ubuntu 22.04.1 LTS <span class=\"o\">(</span>GNU/Linux 5.15.0-1026-aws x86_64<span class=\"o\">)</span>\n\n <span class=\"k\">*</span> Documentation:  https://help.ubuntu.com\n <span class=\"k\">*</span> Management:     https://landscape.canonical.com\n <span class=\"k\">*</span> Support:        https://ubuntu.com/advantage\n\n  System information as of Thu Apr 27 05:04:58 UTC 2023\n\n  System load:  0.0                Processes:                136\n  Usage of /:   22.1% of 15.32GB   Users logged <span class=\"k\">in</span>:          0\n  Memory usage: 4%                 IPv4 address <span class=\"k\">for </span>docker0: 172.17.0.1\n  Swap usage:   0%                 IPv4 address <span class=\"k\">for </span>ens3:    172.35.3.221\n\n <span class=\"k\">*</span> Ubuntu Pro delivers the most comprehensive open <span class=\"nb\">source </span>security and\n   compliance features.\n\n   https://ubuntu.com/aws/pro\n\n70 updates can be applied immediately.\nTo see these additional updates run: apt list <span class=\"nt\">--upgradable</span>\n\n\n<span class=\"k\">***</span> System restart required <span class=\"k\">***</span>\nLast login: Tue Apr 25 22:57:01 2023 from 3.112.23.3\nubuntu@ip-172-35-3-221:~<span class=\"err\">$</span>\n</code></pre></div></div>\n<h3 data-sourcepos=\"246:1-246:15\" id=\"0-7-2\" name=\"0-7-2\"><a class=\"anchor\" id=\"Docker exec\" name=\"Docker exec\" href=\"#Docker exec\" data-position=\"0-7-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"Docker exec\"> &gt; Docker exec</span></a>Docker exec</h3>\n<div class=\"code-block\" data-sourcepos=\"247:1-250:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code><span class=\"nb\">sudo </span>docker <span class=\"nb\">exec</span> <span class=\"nt\">-it</span> <span class=\"nt\">--user</span> root 1bce13d6f8dd bash\nroot@1bce13d6f8dd:/#\n</code></pre></div></div>\n<h3 data-sourcepos=\"252:1-252:48\" id=\"0-7-3\" name=\"0-7-3\"><a class=\"anchor\" id=\"bucardoの設定削除(2〜5分ずつ実行)\" name=\"bucardoの設定削除(2〜5分ずつ実行)\" href=\"#bucardoの設定削除(2〜5分ずつ実行)\" data-position=\"0-7-3\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"bucardoの設定削除(2〜5分ずつ実行)\"> &gt; bucardoの設定削除(2〜5分ずつ実行)</span></a>bucardoの設定削除(2〜5分ずつ実行)</h3>\n<div class=\"code-block\" data-sourcepos=\"253:1-275:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>root@1bce13d6f8dd:/# bucardo remove <span class=\"nb\">sync </span>sync_heroku_aws\nRemoved <span class=\"nb\">sync</span> <span class=\"s2\">\"sync_heroku_aws\"</span>\nNote: table triggers <span class=\"o\">(</span><span class=\"k\">if </span>any<span class=\"o\">)</span> are not automatically removed!   <span class=\"c\"># これは「ソースDBに同期用トリガが残りますよの意(既にHerokuDBは削除ずみ)</span>\n\nroot@1bce13d6f8dd:/# bucardo remove relgroup herd_heroku_db\nRemoved relgroup <span class=\"s2\">\"herd_heroku_db\"</span>\n\nroot@1bce13d6f8dd:/# bucardo remove all tables\nAre you sure you want to remove all tables? <span class=\"nb\">yes\n</span>Removed the following tables:\n  public.display_logs\n  public.logs\n  \nroot@1bce13d6f8dd:/# bucardo remove dbgroup dbs\nRemoved dbgroup <span class=\"s2\">\"dbs\"</span>\n\nbucardo remove db aws_db\nRemoved database <span class=\"s2\">\"aws_db\"</span>\n\nbucardo remove db heroku_db\nRemoved database <span class=\"s2\">\"heroku_db\"</span>\n</code></pre></div></div>\n<h3 data-sourcepos=\"277:1-277:56\" id=\"0-7-4\" name=\"0-7-4\"><a class=\"anchor\" id=\"psqlプロセス停止(productionでは必要ない)\" name=\"psqlプロセス停止(productionでは必要ない)\" href=\"#psqlプロセス停止(productionでは必要ない)\" data-position=\"0-7-4\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"psqlプロセス停止(productionでは必要ない)\"> &gt; psqlプロセス停止(productionでは必要ない)</span></a>psqlプロセス停止(productionでは必要ない)</h3>\n<div class=\"code-block\" data-sourcepos=\"278:1-300:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>root@1bce13d6f8dd:/# service postgresql stop\n <span class=\"k\">*</span> Stopping PostgreSQL 14 database server                     <span class=\"o\">[</span> OK <span class=\"o\">]</span>\nroot@1bce13d6f8dd:/# service <span class=\"nt\">--status-all</span>\n <span class=\"o\">[</span> - <span class=\"o\">]</span>  dbus\n <span class=\"o\">[</span> ? <span class=\"o\">]</span>  hwclock.sh\n <span class=\"o\">[</span> - <span class=\"o\">]</span>  postgresql <span class=\"c\"># 停止されている</span>\n <span class=\"o\">[</span> - <span class=\"o\">]</span>  procps\n <span class=\"o\">[</span> - <span class=\"o\">]</span>  sysstat\n <span class=\"o\">[</span> - <span class=\"o\">]</span>  unattended-upgrades\n root@1bce13d6f8dd:/# ps <span class=\"nt\">-ax</span>\n    PID TTY      STAT   TIME COMMAND\n      1 pts/0    Ss+    0:00 /bin/bash\n    513 pts/1    Ss+    0:00 sh\n    532 pts/2    Ss+    0:00 sh\n   1062 pts/3    Ss+    0:00 sh\n   7507 pts/4    Ss+    0:00 sh\n  53122 pts/5    Ss     0:00 bash\n  53135 pts/5    S+     0:00 /usr/lib/postgresql/14/bin/psql <span class=\"nt\">-p</span> 5432 <span class=\"nt\">-U</span> kingadmin <span class=\"nt\">-d</span> kingapi <span class=\"nt\">-h</span> king-api-staging.cluster-c\n  66596 pts/6    Ss+    0:00 bash\n  70215 pts/7    Ss     0:00 bash\n  70317 pts/7    R+     0:00 ps <span class=\"nt\">-ax</span>\n</code></pre></div></div>\n<p data-sourcepos=\"302:1-302:175\">まだいるのでDB側から確認、以前lockが最新かどうか確認するクエリのままidleとなっているセッションがあったのでこれが該当する</p>\n<div class=\"code-block\" data-sourcepos=\"304:1-353:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sql</div><div class=\"highlight\"><pre class=\"highlight sql\"><code><span class=\"n\">kingapi</span><span class=\"o\">=&gt;</span> <span class=\"k\">select</span> <span class=\"o\">*</span> <span class=\"k\">from</span> <span class=\"n\">pg_stat_activity</span> <span class=\"k\">where</span> <span class=\"n\">application_name</span> <span class=\"o\">=</span> <span class=\"s1\">'psql'</span><span class=\"p\">;</span>\n<span class=\"o\">-</span><span class=\"p\">[</span> <span class=\"n\">RECORD</span> <span class=\"mi\">1</span> <span class=\"p\">]</span><span class=\"c1\">----+---------------------------------------------------------------</span>\n<span class=\"n\">datid</span>            <span class=\"o\">|</span> <span class=\"mi\">16400</span>\n<span class=\"n\">datname</span>          <span class=\"o\">|</span> <span class=\"n\">kingapi</span>\n<span class=\"n\">pid</span>              <span class=\"o\">|</span> <span class=\"mi\">7261</span>\n<span class=\"n\">leader_pid</span>       <span class=\"o\">|</span>\n<span class=\"n\">usesysid</span>         <span class=\"o\">|</span> <span class=\"mi\">16399</span>\n<span class=\"n\">usename</span>          <span class=\"o\">|</span> <span class=\"n\">kingadmin</span>\n<span class=\"n\">application_name</span> <span class=\"o\">|</span> <span class=\"n\">psql</span>\n<span class=\"n\">client_addr</span>      <span class=\"o\">|</span> <span class=\"mi\">172</span><span class=\"p\">.</span><span class=\"mi\">35</span><span class=\"p\">.</span><span class=\"mi\">3</span><span class=\"p\">.</span><span class=\"mi\">221</span>\n<span class=\"n\">client_hostname</span>  <span class=\"o\">|</span>\n<span class=\"n\">client_port</span>      <span class=\"o\">|</span> <span class=\"mi\">39218</span>\n<span class=\"n\">backend_start</span>    <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">04</span><span class=\"o\">-</span><span class=\"mi\">21</span> <span class=\"mi\">06</span><span class=\"p\">:</span><span class=\"mi\">42</span><span class=\"p\">:</span><span class=\"mi\">14</span><span class=\"p\">.</span><span class=\"mi\">469438</span><span class=\"o\">+</span><span class=\"mi\">00</span>\n<span class=\"n\">xact_start</span>       <span class=\"o\">|</span>\n<span class=\"n\">query_start</span>      <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">04</span><span class=\"o\">-</span><span class=\"mi\">21</span> <span class=\"mi\">06</span><span class=\"p\">:</span><span class=\"mi\">42</span><span class=\"p\">:</span><span class=\"mi\">56</span><span class=\"p\">.</span><span class=\"mi\">950607</span><span class=\"o\">+</span><span class=\"mi\">00</span>\n<span class=\"n\">state_change</span>     <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">04</span><span class=\"o\">-</span><span class=\"mi\">21</span> <span class=\"mi\">06</span><span class=\"p\">:</span><span class=\"mi\">42</span><span class=\"p\">:</span><span class=\"mi\">56</span><span class=\"p\">.</span><span class=\"mi\">952749</span><span class=\"o\">+</span><span class=\"mi\">00</span>\n<span class=\"n\">wait_event_type</span>  <span class=\"o\">|</span> <span class=\"n\">Client</span>\n<span class=\"n\">wait_event</span>       <span class=\"o\">|</span> <span class=\"n\">ClientRead</span>\n<span class=\"k\">state</span>            <span class=\"o\">|</span> <span class=\"n\">idle</span>\n<span class=\"n\">backend_xid</span>      <span class=\"o\">|</span>\n<span class=\"n\">backend_xmin</span>     <span class=\"o\">|</span>\n<span class=\"n\">query_id</span>         <span class=\"o\">|</span>\n<span class=\"n\">query</span>            <span class=\"o\">|</span> <span class=\"k\">select</span> <span class=\"o\">*</span> <span class=\"k\">from</span> <span class=\"n\">locks</span> <span class=\"k\">order</span> <span class=\"k\">by</span> <span class=\"n\">updated_at</span> <span class=\"k\">desc</span> <span class=\"k\">limit</span> <span class=\"mi\">1</span><span class=\"p\">;</span>\n<span class=\"n\">backend_type</span>     <span class=\"o\">|</span> <span class=\"n\">client</span> <span class=\"n\">backend</span>\n<span class=\"o\">-</span><span class=\"p\">[</span> <span class=\"n\">RECORD</span> <span class=\"mi\">2</span> <span class=\"p\">]</span><span class=\"c1\">----+---------------------------------------------------------------</span>\n<span class=\"n\">datid</span>            <span class=\"o\">|</span> <span class=\"mi\">16400</span>\n<span class=\"n\">datname</span>          <span class=\"o\">|</span> <span class=\"n\">kingapi</span>\n<span class=\"n\">pid</span>              <span class=\"o\">|</span> <span class=\"mi\">29311</span>\n<span class=\"n\">leader_pid</span>       <span class=\"o\">|</span>\n<span class=\"n\">usesysid</span>         <span class=\"o\">|</span> <span class=\"mi\">16399</span>\n<span class=\"n\">usename</span>          <span class=\"o\">|</span> <span class=\"n\">kingadmin</span>\n<span class=\"n\">application_name</span> <span class=\"o\">|</span> <span class=\"n\">psql</span>\n<span class=\"n\">client_addr</span>      <span class=\"o\">|</span> <span class=\"mi\">172</span><span class=\"p\">.</span><span class=\"mi\">35</span><span class=\"p\">.</span><span class=\"mi\">3</span><span class=\"p\">.</span><span class=\"mi\">221</span>\n<span class=\"n\">client_hostname</span>  <span class=\"o\">|</span>\n<span class=\"n\">client_port</span>      <span class=\"o\">|</span> <span class=\"mi\">55974</span>\n<span class=\"n\">backend_start</span>    <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">04</span><span class=\"o\">-</span><span class=\"mi\">27</span> <span class=\"mi\">05</span><span class=\"p\">:</span><span class=\"mi\">42</span><span class=\"p\">:</span><span class=\"mi\">25</span><span class=\"p\">.</span><span class=\"mi\">847252</span><span class=\"o\">+</span><span class=\"mi\">00</span>\n<span class=\"n\">xact_start</span>       <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">04</span><span class=\"o\">-</span><span class=\"mi\">27</span> <span class=\"mi\">05</span><span class=\"p\">:</span><span class=\"mi\">44</span><span class=\"p\">:</span><span class=\"mi\">31</span><span class=\"p\">.</span><span class=\"mi\">980124</span><span class=\"o\">+</span><span class=\"mi\">00</span>\n<span class=\"n\">query_start</span>      <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">04</span><span class=\"o\">-</span><span class=\"mi\">27</span> <span class=\"mi\">05</span><span class=\"p\">:</span><span class=\"mi\">44</span><span class=\"p\">:</span><span class=\"mi\">31</span><span class=\"p\">.</span><span class=\"mi\">980124</span><span class=\"o\">+</span><span class=\"mi\">00</span>\n<span class=\"n\">state_change</span>     <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">04</span><span class=\"o\">-</span><span class=\"mi\">27</span> <span class=\"mi\">05</span><span class=\"p\">:</span><span class=\"mi\">44</span><span class=\"p\">:</span><span class=\"mi\">31</span><span class=\"p\">.</span><span class=\"mi\">980126</span><span class=\"o\">+</span><span class=\"mi\">00</span>\n<span class=\"n\">wait_event_type</span>  <span class=\"o\">|</span>\n<span class=\"n\">wait_event</span>       <span class=\"o\">|</span>\n<span class=\"k\">state</span>            <span class=\"o\">|</span> <span class=\"n\">active</span>\n<span class=\"n\">backend_xid</span>      <span class=\"o\">|</span>\n<span class=\"n\">backend_xmin</span>     <span class=\"o\">|</span> <span class=\"mi\">3630608</span>\n<span class=\"n\">query_id</span>         <span class=\"o\">|</span> <span class=\"mi\">6565524708528687601</span>\n<span class=\"n\">query</span>            <span class=\"o\">|</span> <span class=\"k\">select</span> <span class=\"o\">*</span> <span class=\"k\">from</span> <span class=\"n\">pg_stat_activity</span> <span class=\"k\">where</span> <span class=\"n\">application_name</span> <span class=\"o\">=</span> <span class=\"s1\">'psql'</span><span class=\"o\">+</span>\n                 <span class=\"o\">|</span> <span class=\"p\">;</span>\n<span class=\"n\">backend_type</span>     <span class=\"o\">|</span> <span class=\"n\">client</span> <span class=\"n\">backend</span>\n</code></pre></div></div>\n<p data-sourcepos=\"355:1-355:149\">selectしているだけなので(なぜアイドルかは不明)特段影響はなさそうだが、Aurora側からセッションの切断を行う</p>\n<div class=\"code-block\" data-sourcepos=\"357:1-361:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sql</div><div class=\"highlight\"><pre class=\"highlight sql\"><code><span class=\"n\">kingapi</span><span class=\"o\">=&gt;</span> <span class=\"k\">SELECT</span> <span class=\"n\">pg_terminate_backend</span><span class=\"p\">(</span><span class=\"mi\">7261</span><span class=\"p\">);</span>\n<span class=\"o\">-</span><span class=\"p\">[</span> <span class=\"n\">RECORD</span> <span class=\"mi\">1</span> <span class=\"p\">]</span><span class=\"c1\">--------+--</span>\n<span class=\"n\">pg_terminate_backend</span> <span class=\"o\">|</span> <span class=\"n\">t</span>\n</code></pre></div></div>\n<p data-sourcepos=\"362:1-362:37\">trueが帰ってきた(t)ので成功</p>\n<p data-sourcepos=\"364:1-364:91\">再度セッションの確認→psql接続は確認用のセッションのみとなった</p>\n<div class=\"code-block\" data-sourcepos=\"365:1-392:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sql</div><div class=\"highlight\"><pre class=\"highlight sql\"><code><span class=\"n\">kingapi</span><span class=\"o\">=&gt;</span> <span class=\"k\">select</span> <span class=\"o\">*</span> <span class=\"k\">from</span> <span class=\"n\">pg_stat_activity</span> <span class=\"k\">where</span> <span class=\"n\">application_name</span> <span class=\"o\">=</span> <span class=\"s1\">'psql'</span>\n<span class=\"p\">;</span>\n<span class=\"o\">-</span><span class=\"p\">[</span> <span class=\"n\">RECORD</span> <span class=\"mi\">1</span> <span class=\"p\">]</span><span class=\"c1\">----+---------------------------------------------------------------</span>\n<span class=\"n\">datid</span>            <span class=\"o\">|</span> <span class=\"mi\">16400</span>\n<span class=\"n\">datname</span>          <span class=\"o\">|</span> <span class=\"n\">kingapi</span>\n<span class=\"n\">pid</span>              <span class=\"o\">|</span> <span class=\"mi\">29311</span>\n<span class=\"n\">leader_pid</span>       <span class=\"o\">|</span>\n<span class=\"n\">usesysid</span>         <span class=\"o\">|</span> <span class=\"mi\">16399</span>\n<span class=\"n\">usename</span>          <span class=\"o\">|</span> <span class=\"n\">kingadmin</span>\n<span class=\"n\">application_name</span> <span class=\"o\">|</span> <span class=\"n\">psql</span>\n<span class=\"n\">client_addr</span>      <span class=\"o\">|</span> <span class=\"mi\">172</span><span class=\"p\">.</span><span class=\"mi\">35</span><span class=\"p\">.</span><span class=\"mi\">3</span><span class=\"p\">.</span><span class=\"mi\">221</span>\n<span class=\"n\">client_hostname</span>  <span class=\"o\">|</span>\n<span class=\"n\">client_port</span>      <span class=\"o\">|</span> <span class=\"mi\">55974</span>\n<span class=\"n\">backend_start</span>    <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">04</span><span class=\"o\">-</span><span class=\"mi\">27</span> <span class=\"mi\">05</span><span class=\"p\">:</span><span class=\"mi\">42</span><span class=\"p\">:</span><span class=\"mi\">25</span><span class=\"p\">.</span><span class=\"mi\">847252</span><span class=\"o\">+</span><span class=\"mi\">00</span>\n<span class=\"n\">xact_start</span>       <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">04</span><span class=\"o\">-</span><span class=\"mi\">27</span> <span class=\"mi\">05</span><span class=\"p\">:</span><span class=\"mi\">49</span><span class=\"p\">:</span><span class=\"mi\">11</span><span class=\"p\">.</span><span class=\"mi\">24868</span><span class=\"o\">+</span><span class=\"mi\">00</span>\n<span class=\"n\">query_start</span>      <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">04</span><span class=\"o\">-</span><span class=\"mi\">27</span> <span class=\"mi\">05</span><span class=\"p\">:</span><span class=\"mi\">49</span><span class=\"p\">:</span><span class=\"mi\">11</span><span class=\"p\">.</span><span class=\"mi\">24868</span><span class=\"o\">+</span><span class=\"mi\">00</span>\n<span class=\"n\">state_change</span>     <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">04</span><span class=\"o\">-</span><span class=\"mi\">27</span> <span class=\"mi\">05</span><span class=\"p\">:</span><span class=\"mi\">49</span><span class=\"p\">:</span><span class=\"mi\">11</span><span class=\"p\">.</span><span class=\"mi\">248682</span><span class=\"o\">+</span><span class=\"mi\">00</span>\n<span class=\"n\">wait_event_type</span>  <span class=\"o\">|</span>\n<span class=\"n\">wait_event</span>       <span class=\"o\">|</span>\n<span class=\"k\">state</span>            <span class=\"o\">|</span> <span class=\"n\">active</span>\n<span class=\"n\">backend_xid</span>      <span class=\"o\">|</span>\n<span class=\"n\">backend_xmin</span>     <span class=\"o\">|</span> <span class=\"mi\">3631051</span>\n<span class=\"n\">query_id</span>         <span class=\"o\">|</span> <span class=\"mi\">6565524708528687601</span>\n<span class=\"n\">query</span>            <span class=\"o\">|</span> <span class=\"k\">select</span> <span class=\"o\">*</span> <span class=\"k\">from</span> <span class=\"n\">pg_stat_activity</span> <span class=\"k\">where</span> <span class=\"n\">application_name</span> <span class=\"o\">=</span> <span class=\"s1\">'psql'</span><span class=\"o\">+</span>\n                 <span class=\"o\">|</span> <span class=\"p\">;</span>\n<span class=\"n\">backend_type</span>     <span class=\"o\">|</span> <span class=\"n\">client</span> <span class=\"n\">backend</span>\n</code></pre></div></div>\n<h4 data-sourcepos=\"394:1-394:52\">productionの場合、psqlプロセスがない</h4>\n<div class=\"code-block\" data-sourcepos=\"395:1-417:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>ubuntu@ip-172-30-3-25:~<span class=\"nv\">$ </span><span class=\"nb\">sudo </span>docker <span class=\"nb\">exec</span> <span class=\"nt\">-it</span> <span class=\"nt\">--user</span> root 10cf28189a1f sh\n<span class=\"c\"># ps -aux</span>\nUSER         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND\npostgres       1  0.0  0.0   4624  3580 pts/0    Ss+  Apr17   0:00 /bin/bash\npostgres     145  0.0  0.0 215724 30488 ?        Ss   Apr17   0:18 /usr/lib/postgresql/14/bin/postgres <span class=\"nt\">-D</span> /var/lib/postgre\npostgres     147  0.0  0.0 215856 12260 ?        Ss   Apr17   0:00 postgres: 14/main: checkpointer\npostgres     148  0.0  0.0 215724  9564 ?        Ss   Apr17   0:04 postgres: 14/main: background writer\npostgres     149  0.0  0.0 215724 11676 ?        Ss   Apr17   0:04 postgres: 14/main: walwriter\npostgres     150  0.0  0.0 216264  9996 ?        Ss   Apr17   0:09 postgres: 14/main: autovacuum launcher\npostgres     151  0.0  0.0  70460  6492 ?        Ss   Apr17   0:16 postgres: 14/main: stats collector\npostgres     152  0.0  0.0 216140  7676 ?        Ss   Apr17   0:00 postgres: 14/main: logical replication launcher\nroot        1701  0.0  0.0   2888  1060 pts/1    Ss+  Apr17   0:00 sh\nroot        1886  0.0  0.0   2888   988 pts/2    Ss+  Apr17   0:00 sh\nroot        2454  0.0  0.0   2888   992 pts/3    Ss+  Apr18   0:00 sh\nroot        2476  0.0  0.0   2888   984 pts/4    Ss+  Apr18   0:00 sh\nroot        2500  0.0  0.0   2888  1060 pts/5    Ss   Apr18   0:00 sh\nroot        2513  0.0  0.0   7316  3404 pts/5    S+   Apr18   3:52 top\nroot        4253  0.0  0.0   2888  1040 pts/7    Ss+  Apr18   0:00 sh\nroot        4413  0.0  0.0   2888   980 pts/9    Ss+  Apr18   0:00 sh\nroot       31003  0.6  0.0   2888   952 pts/6    Ss   06:18   0:00 sh\nroot       31009  0.0  0.0   7368  3048 pts/6    R+   06:18   0:00 ps <span class=\"nt\">-aux</span>\n</code></pre></div></div>\n<p data-sourcepos=\"419:1-419:63\">影響を与える要素が消えたので次のステップへ</p>\n<h3 data-sourcepos=\"421:1-421:34\" id=\"0-7-5\" name=\"0-7-5\"><a class=\"anchor\" id=\"EC2インスタンスの停止\" name=\"EC2インスタンスの停止\" href=\"#EC2インスタンスの停止\" data-position=\"0-7-5\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"EC2インスタンスの停止\"> &gt; EC2インスタンスの停止</span></a>EC2インスタンスの停止</h3>\n<div class=\"code-block\" data-sourcepos=\"423:1-442:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>aws ec2 stop-instances <span class=\"nt\">--instance-ids</span> i-0a30d63c9441cb1b3\n<span class=\"o\">{</span>\n    <span class=\"s2\">\"StoppingInstances\"</span>: <span class=\"o\">[</span>\n        <span class=\"o\">{</span>\n            <span class=\"s2\">\"CurrentState\"</span>: <span class=\"o\">{</span>\n                <span class=\"s2\">\"Code\"</span>: 64,\n                <span class=\"s2\">\"Name\"</span>: <span class=\"s2\">\"stopping\"</span>\n            <span class=\"o\">}</span>,\n            <span class=\"s2\">\"InstanceId\"</span>: <span class=\"s2\">\"i-0a30d63c9441cb1b3\"</span>,\n            <span class=\"s2\">\"PreviousState\"</span>: <span class=\"o\">{</span>\n                <span class=\"s2\">\"Code\"</span>: 16,\n                <span class=\"s2\">\"Name\"</span>: <span class=\"s2\">\"running\"</span>\n            <span class=\"o\">}</span>\n        <span class=\"o\">}</span>\n    <span class=\"o\">]</span>\n<span class=\"o\">}</span>\n<span class=\"o\">(</span>END<span class=\"o\">)</span>\n</code></pre></div></div>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/27/136273/a37dc986-5c57-4a0e-a3aa-4712687d3b60.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"595\" alt=\"スクリーンショット 2023-04-27 15.02.04.png (23.8 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/27/136273/a37dc986-5c57-4a0e-a3aa-4712687d3b60.png\"></a>\n<p data-sourcepos=\"445:1-445:105\">一応CU確認(リモート解施錠、ユーザー名変更、リモート解施錠、履歴確認)→OK</p>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/27/136273/5650ab38-53bd-4336-88a5-4b2448397954.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"864\" alt=\"Screenshot_20230427-150340.png (206.2 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/27/136273/5650ab38-53bd-4336-88a5-4b2448397954.png\"></a>\n<p data-sourcepos=\"449:1-450:205\">CloudWatch→問題なし<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/27/136273/f317e3b5-63a4-4fb4-99f7-fd2f54381970.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"795\" alt=\"スクリーンショット 2023-04-27 15.07.04.png (36.1 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/27/136273/f317e3b5-63a4-4fb4-99f7-fd2f54381970.png\"></a></p>\n<p data-sourcepos=\"452:1-453:205\">Papertrail→問題なし<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/27/136273/3a70f916-71a9-4c31-abbc-661a29179530.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"680\" alt=\"スクリーンショット 2023-04-27 15.16.47.png (37.1 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/27/136273/3a70f916-71a9-4c31-abbc-661a29179530.png\"></a></p>\n<h3 data-sourcepos=\"455:1-455:148\" id=\"0-7-6\" name=\"0-7-6\"><a class=\"anchor\" id=\"private linkとEC2スタックの削除(private linkはstagingの場合存在していないが、本番同等の操作として検証にする)\" name=\"private linkとEC2スタックの削除(private linkはstagingの場合存在していないが、本番同等の操作として検証にする)\" href=\"#private linkとEC2スタックの削除(private linkはstagingの場合存在していないが、本番同等の操作として検証にする)\" data-position=\"0-7-6\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"private linkとEC2スタックの削除(private linkはstagingの場合存在していないが、本番同等の操作として検証にする)\"> &gt; private linkとEC2スタックの削除(private linkはstagingの場合存在していないが、本番同等の操作として検証にする)</span></a>private linkとEC2スタックの削除(private linkはstagingの場合存在していないが、本番同等の操作として検証にする)</h3>\n<div class=\"code-block\" data-sourcepos=\"457:1-470:3\"><div class=\"highlight\"><pre class=\"highlight plaintext\"><code># sugiyamasatoshi @ sugiyamasatoshinoMacBook-Pro in ~/king-cloudformation/king-api-aurora-cfn on git:hotfix/ec2-route-fix x [15:19:45]\n$ sh ./local_scripts/ec2_stack_delete.sh ./config/staging.env sl2-api-staging                                    15:19:45\nスタック名:king-api-staging-bucardo-stack\nPrivateLink Dyno名: sl2-api-staging\n[**入力]上記スタックを削除しますか？(y/n)y\n1.PrivateLinkの削除------------------------ # ここはprivate linkを用いていないためエラーが出る→期待動作です\n ›   Error: Couldn't find that add on.\n ›\n ›   Error ID: not_found\nVPCエンドポイント:\nPrivateLink/VPCエンドポイントがありません。以降の削除を続行します\n2.EC2スタックの削除------------------------\n</code></pre></div></div>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/27/136273/bc1bcdd0-d3d2-4cc5-9cd8-f156c20a2598.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"404\" alt=\"スクリーンショット 2023-04-27 15.22.04.png (22.9 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/27/136273/bc1bcdd0-d3d2-4cc5-9cd8-f156c20a2598.png\"></a>\n<p data-sourcepos=\"474:1-474:12\">削除完了</p>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/27/136273/42ec52f9-645e-41cb-91df-cb83694430d1.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"595\" alt=\"スクリーンショット 2023-04-27 15.24.07.png (109.7 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/27/136273/42ec52f9-645e-41cb-91df-cb83694430d1.png\"></a>\n<h3 data-sourcepos=\"478:1-478:12\" id=\"0-7-7\" name=\"0-7-7\"><a class=\"anchor\" id=\"CU確認-1\" name=\"CU確認-1\" href=\"#CU確認-1\" data-position=\"0-7-7\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"CU確認\"> &gt; CU確認</span></a>CU確認</h3>\n<p data-sourcepos=\"479:1-480:191\">OK<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/27/136273/82ef77b9-c0ca-4b4e-a2a6-30d80e0061bc.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"864\" alt=\"Screenshot (2023_04_27 15_26_10).png (194.2 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/27/136273/82ef77b9-c0ca-4b4e-a2a6-30d80e0061bc.png\"></a></p>\n",
    "created_at": "2023-04-25T12:53:03+09:00",
    "message": "Update post.",
    "kind": "stock",
    "comments_count": 1,
    "tasks_count": 2,
    "done_tasks_count": 2,
    "url": "https://qrio.esa.io/posts/1637",
    "updated_at": "2023-07-18T10:49:46+09:00",
    "tags": [],
    "category": "Users/杉山/Database",
    "revision_number": 44,
    "created_by": {
      "myself": false,
      "name": "杉山聡",
      "screen_name": "satoshi_sugiyama",
      "icon": "https://img.esa.io/uploads/production/members/129432/icon/thumb_m_4589e2842b9d87757c7c9db07c45c00d.jpg"
    },
    "updated_by": {
      "myself": false,
      "name": "杉山聡",
      "screen_name": "satoshi_sugiyama",
      "icon": "https://img.esa.io/uploads/production/members/129432/icon/thumb_m_4589e2842b9d87757c7c9db07c45c00d.jpg"
    },
    "stargazers_count": 0,
    "watchers_count": 1,
    "star": false,
    "watch": false,
    "sharing_urls": null
  },
  {
    "number": 1636,
    "name": "STG旧HerokuDB削除手順と実施履歴",
    "full_name": "Users/杉山/Database/STG旧HerokuDB削除手順と実施履歴",
    "wip": false,
    "body_md": "# 移行後旧DBを削除する\r\n\r\nhttps://dashboard.heroku.com/apps/sl2-api-staging\r\n\r\n## DB情報\r\n\r\nOLD_DATABASE on sl2-api-staging\r\n[postgresql-vertical-91067](https://data.heroku.com/datastores/0628978d-782a-4ade-8d8b-9d2fe5ac33b6)\r\n\r\n## 削除操作\r\n```\r\nheroku addons:destroy postgresql-vertical91067 -a sl2-api-staging\r\n```\r\n\r\n## 削除後の挙動想定\r\n\r\nアプリ`sl2-api-staging`からHeroku Postgres Add-on削除\r\n↓\r\n環境変数`OLD_DATABASE_URL`が消える\r\n\r\n## 削除後動作検証\r\n\r\nStaging CUでリモート解施錠とログ確認、ユーザー名変更\r\n\r\n## サーバーアプリへの影響\r\n\r\n環境変数`OLD_DATABASE_URL`を参照していないため、ないと考えられる\r\n\r\n## ロールバック手段\r\n\r\n- Heroku Postgres Database Add-onを追加する\r\n    - OLD_DATABASE_URLとして\r\n- データをAurora Staging DBからdump\r\n    - dbstring=(`heroku config:get FOLLOWER_DATABASE_URL -a sl2-api-staging`)\r\n    - `pg_dump --format=custom --verbose \"${dbstring}\" > latest.dump\r\n- データをrestore\r\n    - dbstring=(`heroku config:get OLD_DATABASE_URL -a sl2-api-staging`)\r\n    - `pg_restore \"${dbstring}\" latest.dump\r\n\r\n## 実施ログ\r\n<img width=\"755\" alt=\"スクリーンショット 2023-04-24 16.10.52.png (65.5 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/24/136273/95c0956e-f845-4645-8b67-1620aef09eb1.png\">\r\n\r\n```\r\nheroku addons:destroy postgresql-vertical-91067 -a sl2-api-staging                                                                     16:14:06\r\n ▸    WARNING: Destructive Action\r\n ▸    This command will affect the app sl2-api-staging\r\n ▸    To proceed, type sl2-api-staging or re-run this command with --confirm sl2-api-staging\r\n\r\n> sl2-api-staging\r\nDestroying postgresql-vertical-91067 on ⬢ sl2-api-staging... done\r\n```\r\n<img width=\"748\" alt=\"スクリーンショット 2023-04-24 16.25.10.png (50.6 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/24/136273/dcbaa043-60ea-409f-8929-d9edffe897e7.png\">\r\n\r\nHeroku ログ\r\n```\r\n[OLD_DATABASE] [10-1]  sql_error_code = 00000 time_ms = \"2023-04-24 07:16:36.026 UTC\" pid=\"4\" proc_start_time=\"2023-04-21 20:17:06 UTC\" session_id=\"6442ef42.4\" vtid=\"\" tid=\"0\" log_line=\"12\" LOG:  database system is shut down\r\n```\r\n\r\n動作確認\r\nDB削除→satoshi.sugiyama@qrioinc.comというユーザー名で解施錠→ユーザー名変更→解施錠→ログ取得\r\n<img width=\"864\" alt=\"Screenshot (2023_04_24 16_20_23).png (229.8 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/24/136273/88b27352-2b06-4bec-98e5-bdb1bb541d03.png\">\r\n\r\n",
    "body_html": "<h1 data-sourcepos=\"1:1-1:31\" id=\"1-0-0\" name=\"1-0-0\"><a class=\"anchor\" id=\"移行後旧DBを削除する\" name=\"移行後旧DBを削除する\" href=\"#移行後旧DBを削除する\" data-position=\"1-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"移行後旧DBを削除する\"> &gt; 移行後旧DBを削除する</span></a>移行後旧DBを削除する</h1>\n<p data-sourcepos=\"3:1-3:49\"><a href=\"https://dashboard.heroku.com/apps/sl2-api-staging\" target=\"_blank\" rel=\"noopener noreferrer\">https://dashboard.heroku.com/apps/sl2-api-staging</a></p>\n<h2 data-sourcepos=\"5:1-5:11\" id=\"1-1-0\" name=\"1-1-0\"><a class=\"anchor\" id=\"DB情報\" name=\"DB情報\" href=\"#DB情報\" data-position=\"1-1-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"DB情報\"> &gt; DB情報</span></a>DB情報</h2>\n<p data-sourcepos=\"7:1-8:100\">OLD_DATABASE on sl2-api-staging<br>\n<a href=\"https://data.heroku.com/datastores/0628978d-782a-4ade-8d8b-9d2fe5ac33b6\" target=\"_blank\" rel=\"noopener noreferrer\">postgresql-vertical-91067</a></p>\n<h2 data-sourcepos=\"10:1-10:15\" id=\"1-2-0\" name=\"1-2-0\"><a class=\"anchor\" id=\"削除操作\" name=\"削除操作\" href=\"#削除操作\" data-position=\"1-2-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"削除操作\"> &gt; 削除操作</span></a>削除操作</h2>\n<div class=\"code-block\" data-sourcepos=\"11:1-13:3\"><div class=\"highlight\"><pre class=\"highlight plaintext\"><code>heroku addons:destroy postgresql-vertical91067 -a sl2-api-staging\n</code></pre></div></div>\n<h2 data-sourcepos=\"15:1-15:27\" id=\"1-3-0\" name=\"1-3-0\"><a class=\"anchor\" id=\"削除後の挙動想定\" name=\"削除後の挙動想定\" href=\"#削除後の挙動想定\" data-position=\"1-3-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"削除後の挙動想定\"> &gt; 削除後の挙動想定</span></a>削除後の挙動想定</h2>\n<p data-sourcepos=\"17:1-19:42\">アプリ<code>sl2-api-staging</code>からHeroku Postgres Add-on削除<br>\n↓<br>\n環境変数<code>OLD_DATABASE_URL</code>が消える</p>\n<h2 data-sourcepos=\"21:1-21:24\" id=\"1-4-0\" name=\"1-4-0\"><a class=\"anchor\" id=\"削除後動作検証\" name=\"削除後動作検証\" href=\"#削除後動作検証\" data-position=\"1-4-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"削除後動作検証\"> &gt; 削除後動作検証</span></a>削除後動作検証</h2>\n<p data-sourcepos=\"23:1-23:73\">Staging CUでリモート解施錠とログ確認、ユーザー名変更</p>\n<h2 data-sourcepos=\"25:1-25:36\" id=\"1-5-0\" name=\"1-5-0\"><a class=\"anchor\" id=\"サーバーアプリへの影響\" name=\"サーバーアプリへの影響\" href=\"#サーバーアプリへの影響\" data-position=\"1-5-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"サーバーアプリへの影響\"> &gt; サーバーアプリへの影響</span></a>サーバーアプリへの影響</h2>\n<p data-sourcepos=\"27:1-27:87\">環境変数<code>OLD_DATABASE_URL</code>を参照していないため、ないと考えられる</p>\n<h2 data-sourcepos=\"29:1-29:27\" id=\"1-6-0\" name=\"1-6-0\"><a class=\"anchor\" id=\"ロールバック手段\" name=\"ロールバック手段\" href=\"#ロールバック手段\" data-position=\"1-6-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"ロールバック手段\"> &gt; ロールバック手段</span></a>ロールバック手段</h2>\n<ul data-sourcepos=\"31:1-39:0\">\n<li data-sourcepos=\"31:1-32:31\">Heroku Postgres Database Add-onを追加する\n<ul data-sourcepos=\"32:5-32:31\">\n<li data-sourcepos=\"32:5-32:31\">OLD_DATABASE_URLとして</li>\n</ul></li>\n<li data-sourcepos=\"33:1-35:68\">データをAurora Staging DBからdump\n<ul data-sourcepos=\"34:5-35:68\">\n<li data-sourcepos=\"34:5-34:77\">dbstring=(<code>heroku config:get FOLLOWER_DATABASE_URL -a sl2-api-staging</code>)</li>\n<li data-sourcepos=\"35:5-35:68\">`pg_dump --format=custom --verbose \"${dbstring}\" &gt; latest.dump</li>\n</ul></li>\n<li data-sourcepos=\"36:1-39:0\">データをrestore\n<ul data-sourcepos=\"37:5-39:0\">\n<li data-sourcepos=\"37:5-37:72\">dbstring=(<code>heroku config:get OLD_DATABASE_URL -a sl2-api-staging</code>)</li>\n<li data-sourcepos=\"38:5-39:0\">`pg_restore \"${dbstring}\" latest.dump</li>\n</ul></li>\n</ul>\n<h2 data-sourcepos=\"40:1-40:15\" id=\"1-7-0\" name=\"1-7-0\"><a class=\"anchor\" id=\"実施ログ\" name=\"実施ログ\" href=\"#実施ログ\" data-position=\"1-7-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"実施ログ\"> &gt; 実施ログ</span></a>実施ログ</h2>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/24/136273/95c0956e-f845-4645-8b67-1620aef09eb1.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"755\" alt=\"スクリーンショット 2023-04-24 16.10.52.png (65.5 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/24/136273/95c0956e-f845-4645-8b67-1620aef09eb1.png\"></a>\n<div class=\"code-block\" data-sourcepos=\"43:1-51:3\"><div class=\"highlight\"><pre class=\"highlight plaintext\"><code>heroku addons:destroy postgresql-vertical-91067 -a sl2-api-staging                                                                     16:14:06\n ▸    WARNING: Destructive Action\n ▸    This command will affect the app sl2-api-staging\n ▸    To proceed, type sl2-api-staging or re-run this command with --confirm sl2-api-staging\n\n&gt; sl2-api-staging\nDestroying postgresql-vertical-91067 on ⬢ sl2-api-staging... done\n</code></pre></div></div>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/24/136273/dcbaa043-60ea-409f-8929-d9edffe897e7.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"748\" alt=\"スクリーンショット 2023-04-24 16.25.10.png (50.6 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/24/136273/dcbaa043-60ea-409f-8929-d9edffe897e7.png\"></a>\n<p data-sourcepos=\"54:1-54:13\">Heroku ログ</p>\n<div class=\"code-block\" data-sourcepos=\"55:1-57:3\"><div class=\"highlight\"><pre class=\"highlight plaintext\"><code>[OLD_DATABASE] [10-1]  sql_error_code = 00000 time_ms = \"2023-04-24 07:16:36.026 UTC\" pid=\"4\" proc_start_time=\"2023-04-21 20:17:06 UTC\" session_id=\"6442ef42.4\" vtid=\"\" tid=\"0\" log_line=\"12\" LOG:  database system is shut down\n</code></pre></div></div>\n<p data-sourcepos=\"59:1-61:191\">動作確認<br>\nDB削除→<a href=\"mailto:satoshi.sugiyama@qrioinc.com\" target=\"_blank\" rel=\"noopener noreferrer\">satoshi.sugiyama@qrioinc.com</a>というユーザー名で解施錠→ユーザー名変更→解施錠→ログ取得<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/24/136273/88b27352-2b06-4bec-98e5-bdb1bb541d03.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"864\" alt=\"Screenshot (2023_04_24 16_20_23).png (229.8 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/24/136273/88b27352-2b06-4bec-98e5-bdb1bb541d03.png\"></a></p>\n",
    "created_at": "2023-04-24T13:01:26+09:00",
    "message": "Update post.",
    "kind": "stock",
    "comments_count": 3,
    "tasks_count": 0,
    "done_tasks_count": 0,
    "url": "https://qrio.esa.io/posts/1636",
    "updated_at": "2023-07-18T10:49:28+09:00",
    "tags": [],
    "category": "Users/杉山/Database",
    "revision_number": 10,
    "created_by": {
      "myself": false,
      "name": "杉山聡",
      "screen_name": "satoshi_sugiyama",
      "icon": "https://img.esa.io/uploads/production/members/129432/icon/thumb_m_4589e2842b9d87757c7c9db07c45c00d.jpg"
    },
    "updated_by": {
      "myself": false,
      "name": "杉山聡",
      "screen_name": "satoshi_sugiyama",
      "icon": "https://img.esa.io/uploads/production/members/129432/icon/thumb_m_4589e2842b9d87757c7c9db07c45c00d.jpg"
    },
    "stargazers_count": 0,
    "watchers_count": 1,
    "star": false,
    "watch": false,
    "sharing_urls": null
  },
  {
    "number": 1470,
    "name": "SNC不具合調査2022-12-15",
    "full_name": "Users/杉山/その他/SNC不具合調査2022-12-15",
    "wip": false,
    "body_md": "## 事象\r\n\r\n> 下記のLock_idのLockについて、操作はできるもののログが施錠しか届いていないようです。\r\nQrioHub経由の解施錠になります。\r\nf4fc76d6-4412-bda3-5447-75879bc37d5c\r\n操作時間(本日12/15)\r\n7:49( 施錠ログは来ている)\r\n8:00 (施錠ログは来ている)\r\nお手数ですが、なぜ解錠ログが来ていないのか確認いただけますでしょうか？ \r\n\r\n[slack - dev_qrio-manoma-dev](https://qrioinc.slack.com/archives/C02EVM1HR6C/p1671066399077869)\r\n\r\nユーザーが確認したのは9:10頃、解錠ログが届いていないとのこと\r\n\r\n## わかっていること\r\n\r\n\r\n## 考慮\r\n\r\n```mermaid\r\nflowchart TD\r\n    A[解錠ログが届いておらず施錠ログのみが届いている]-->B{解錠は手動か}\r\n    B--YES-->C[次の施錠の際にログがアップされる\\nPOST u/logs]\r\n    C-->D{アップされたログは\\nDBへの書き込みと\\nSNCへの送信がなされる}\r\n    \r\n```\r\n\r\n## 調査\r\n\r\n### ログからの情報(先方からもらったlock_idをもとに)\r\n|key|value|備考|\r\n| - | - | - |\r\n|master_key_id|3fad3d50-7cea-4bb6-a543-ca4a869e6bfc| |\r\n|lock_id|F4FC76D6-4412-BDA3-5447-75879BC37D5C | 以降メインロックと呼びます|\r\n|sublock_id|7D5B383A-1102-61AF-A94B-64F9FCFC2DBC | 以降サブロックと呼びます|\r\n|master_user_id|ef8ad27d-7cc9-42bd-b3a1-91be65e4370c | |\r\n| user_id① | fc00cf66-501c-4492-bd11-bdb45c5e0258 |  |\r\n| key_id① | 5fb9aaa4-935d-4901-a0ba-986ea0223217 | 上記ユーザーに紐づく |\r\n| user_id② | 9b0b5cd4-60a4-4afb-8eb8-c3d59658b26d |  |\r\n| key_id② | b3fc3827-60ce-4ffe-8bde-e79172734bdc | 上記ユーザーに紐づく |\r\n|hub_id|b76a8b03-b4b2-464e-8ea6-52eaab4fcba2| |\r\n|ipaddress①|147.192.85.179| |\r\n|ipaddress②|126.254.232.139| |\r\n\r\n### 各ロックIDのDBのLogsテーブルの状態\r\n先方では受け取っていない解錠のログがDBには書き込まれている。\r\nログの生成時刻(created_at)は施錠と同時刻である\r\n\r\n\r\nクエリ\r\n```メインロックとサブロックのIDからlogsテーブル取得.sql\r\nSELECT *\r\nFROM logs\r\nWHERE lock_id IN ('7d5b383a-1102-61af-a94b-64f9fcfc2dbc',\r\n                  'f4fc76d6-4412-bda3-5447-75879bc37d5c')\r\nAND created_at BETWEEN '2022-12-14 22:00' AND '2022-12-15 00:00'\r\nORDER BY logged_at DESC\r\nLIMIT 50;\r\n\r\n\r\n```\r\n取得後、関係ない行は削った。\r\n**以下の表は時刻はUTC**\r\n\r\n概要|id|lock_id|lock_log_id|log_type|param1|param2|param3|logged_at|recordable_type|recordable_id|double_lock|on_upside|user_name|created_at|updated_at|\r\n|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|\r\nメインロック施錠|fbcafd7d-7e63-4f74-b333-0d4f353918a0|f4fc76d6-4412-bda3-5447-75879bc37d5c|6877|2|0|64|17|2022-12-14T23:00:04|MasterKey|3fad3d50-7cea-4bb6-a543-ca4a869e6bfc|True|True|たかひこ|2022-12-14T23:00:05.436|2022-12-14T23:00:05.436|\r\nサブロック施錠|d6a0cbd2-da8f-45da-ba6e-9da67ae2b8a3|7d5b383a-1102-61af-a94b-64f9fcfc2dbc|7005|2|0|66|17|2022-12-14T23:00:04|MasterKey|3fad3d50-7cea-4bb6-a543-ca4a869e6bfc|True|False|たかひこ|2022-12-14T23:00:05.409|2022-12-14T23:00:05.409|\r\nサブロック解錠|0196283a-f885-4ae1-9043-1dfa84a24e32|7d5b383a-1102-61af-a94b-64f9fcfc2dbc|7004|4|0|0|0|2022-12-14T22:59:49||00000000-0000-0000-0000-000000000000|True|False||2022-12-14T23:00:05.409|2022-12-14T23:00:05.409|\r\nメインロック解錠|1e7906c0-24f0-440e-b65b-a6b940eb2798|f4fc76d6-4412-bda3-5447-75879bc37d5c|6876|4|0|0|0|2022-12-14T22:59:48||00000000-0000-0000-0000-000000000000|True|True||2022-12-14T23:00:05.436|2022-12-14T23:00:05.436|\r\nサブロック施錠|d84df403-3ebe-4e6a-8f0f-75e5b8cb397e|7d5b383a-1102-61af-a94b-64f9fcfc2dbc|7003|2|0|66|18|2022-12-14T22:49:16|FamilyKey|b3fc3827-60ce-4ffe-8bde-e79172734bdc|True|False|あさみ|2022-12-14T22:49:18.329|2022-12-14T22:49:18.329|\r\nメインロック施錠|0eb0b233-eea9-40e7-9746-59562c1e5aed|f4fc76d6-4412-bda3-5447-75879bc37d5c|6875|2|0|64|18|2022-12-14T22:49:16|FamilyKey|b3fc3827-60ce-4ffe-8bde-e79172734bdc|True|True|あさみ|2022-12-14T22:49:18.311|2022-12-14T22:49:18.311|\r\nサブロック解錠|36080ace-f13d-4c3d-a627-9711d5529d7f|7d5b383a-1102-61af-a94b-64f9fcfc2dbc|7002|4|0|0|0|2022-12-14T22:48:47||00000000-0000-0000-0000-000000000000|True|False||2022-12-14T22:49:18.329|2022-12-14T22:49:18.329|\r\nメインロック解錠|beb7744c-8da2-491a-aae4-b7de716ae953|f4fc76d6-4412-bda3-5447-75879bc37d5c|6874|4|0|0|0|2022-12-14T22:48:46||00000000-0000-0000-0000-000000000000|True|True||2022-12-14T22:49:18.311|2022-12-14T22:49:18.311|\r\n\r\nlog_type = 2 :施錠\r\nlog_type = 4 : マニュアル解錠\r\n\r\n`lock_log_id`の6874と7002が届いていないと問題の解錠ログ\r\n\r\n### 上記created_atをもとに書き込みが行われる契機となったログを探す\r\n\r\nログの書き込みとwebhookの送信は~~Log.import_and_push()によるもの~~SyncLockStateJob\r\n以下の2APIでメソッドが呼ばれている。\r\n- GET h/commands/log\r\n- POST u/logs\r\n\r\n(BLEではなくhub経由での解施錠時にはh/commands/logに経由する)\r\n\r\n#### 周辺時間帯を各lock_idで検索\r\n\r\n**07:49 ユーザーの解施錠操作**\r\n\r\n<details>\r\n    <summary>logs</summary>\r\n\r\n```メインロック最新ログの取得.sh\r\nDec 15 07:49:13 sl2-api-production heroku/router\r\n    at=info\r\n    method=GET\r\n    path=\"/v1/u/logs/last_id?lock_id=F4FC76D6-4412-BDA3-5447-75879BC37D5C\"\r\n    host=sl2-api.qrioinc.com\r\n    request_id=b8ad8c26-d26e-9bae-309c-81817ff41379\r\n    fwd=\"147.192.85.179\"\r\n    dyno=web.2 connect=0ms service=28ms status=200 bytes=34 protocol=http tls_version=tls1.3\r\n```\r\n```hash取得.sh\r\nDec 15 07:49:13 sl2-api-production heroku/router\r\n    at=info method=GET\r\n    path=\"/v1/u/hash\"\r\n    host=sl2-api.qrioinc.com\r\n    request_id=7514400b-0e6a-b20e-824a-b33904d6653d\r\n    fwd=\"147.192.85.179\"\r\n    dyno=web.3 connect=0ms service=33ms status=304 bytes=0 protocol=http tls_version=tls1.3\r\n```\r\n```メインロック情報の更新.sh\r\nDec 15 07:49:15 sl2-api-production heroku/router\r\n    at=info\r\n    method=PATCH\r\n    path=\"/v1/u/locks/F4FC76D6-4412-BDA3-5447-75879BC37D5C\"\r\n    host=sl2-api.qrioinc.com\r\n    request_id=3c6301be-1808-5e94-8df6-cb1a4d41f0c7\r\n    fwd=\"147.192.85.179\"\r\n    dyno=web.3 connect=0ms service=26ms status=200 bytes=4 protocol=http tls_version=tls1.3\r\n```\r\n\r\n```サブロック情報の更新.sh\r\nDec 15 07:49:16 sl2-api-production heroku/router\r\n    at=info\r\n    method=PATCH\r\n    path=\"/v1/u/locks/7D5B383A-1102-61AF-A94B-64F9FCFC2DBC\"\r\n    host=sl2-api.qrioinc.com\r\n    request_id=890a8632-574e-edfc-874b-a35c9e4903f1\r\n    fwd=\"147.192.85.179\"\r\n    dyno=web.2 connect=0ms service=31ms status=200 bytes=4 protocol=http tls_version=tls1.3\r\n```\r\n```ログの登録①.sh\r\nDec 15 07:49:18 sl2-api-production heroku/router\r\n    at=info\r\n    method=POST\r\n    path=\"/v1/u/logs?is_app=true\"\r\n    host=sl2-api.qrioinc.com\r\n    request_id=c673ad91-53aa-4796-e1d2-7dc89d8bf221\r\n    fwd=\"147.192.85.179\"\r\n    dyno=web.2 connect=0ms service=135ms status=201 bytes=20 protocol=http tls_version=tls1.3\r\n```\r\n```ログの登録②.sh\r\nDec 15 07:49:18 sl2-api-production heroku/router\r\n    at=info\r\n    method=POST\r\n    path=\"/v1/u/logs?is_app=true\"\r\n    host=sl2-api.qrioinc.com\r\n    request_id=4c42a13f-19c4-7635-9d80-a107ae6e938e\r\n    fwd=\"147.192.85.179\"\r\n    dyno=web.3 connect=0ms service=141ms status=201 bytes=20 protocol=http tls_version=tls1.3\r\n```\r\n\r\n</details>\r\n\r\n**08:00 ユーザーの解施錠操作**\r\n\r\n\r\n<details>\r\n    <summary>logs</summary>\r\n\r\n```メインロック最新ログの取得.sh\r\nDec 15 08:00:01 sl2-api-production heroku/router\r\n    at=info\r\n    method=GET\r\n    path=\"/v1/u/logs/last_id?lock_id=F4FC76D6-4412-BDA3-5447-75879BC37D5C\"\r\n    host=sl2-api.qrioinc.com\r\n    request_id=aa864081-7fc2-9fc9-bbfa-eff67ea29598\r\n    fwd=\"147.192.85.179\"\r\n    dyno=web.2 connect=0ms service=34ms status=200 bytes=34 protocol=http tls_version=tls1.3\r\n```\r\n\r\n```hash取得.sh\r\nDec 15 08:00:01 sl2-api-production heroku/router\r\n    at=info\r\n    method=GET\r\n    path=\"/v1/u/hash\"\r\n    host=sl2-api.qrioinc.com\r\n    request_id=5340673d-e2c5-ce72-b152-485897febd2b\r\n    fwd=\"147.192.85.179\"\r\n    dyno=web.4 connect=0ms service=82ms status=304 bytes=0 protocol=http tls_version=tls1.3\r\n```\r\n```サブロック情報の更新.sh\r\nDec 15 08:00:03 sl2-api-production heroku/router\r\n    at=info\r\n    method=PATCH\r\n    path=\"/v1/u/locks/7D5B383A-1102-61AF-A94B-64F9FCFC2DBC\"\r\n    host=sl2-api.qrioinc.com\r\n    request_id=9aedc7a1-78fc-8455-fe04-a65292eb4e76\r\n    fwd=\"147.192.85.179\"\r\n    dyno=web.2 connect=0ms service=19ms status=200 bytes=4 protocol=http tls_version=tls1.3\r\n```\r\n\r\n```メインロック情報の更新.sh\r\nDec 15 08:00:03 sl2-api-production heroku/router\r\n    at=info\r\n    method=PATCH\r\n    path=\"/v1/u/locks/F4FC76D6-4412-BDA3-5447-75879BC37D5C\"\r\n    host=sl2-api.qrioinc.com\r\n    request_id=a3548e5e-b138-4159-ed57-8349c663d341\r\n    fwd=\"147.192.85.179\"\r\n    dyno=web.4 connect=0ms service=39ms status=200 bytes=4 protocol=http tls_version=tls1.3\r\n```\r\n```ログの登録①.sh\r\nDec 15 08:00:05 sl2-api-production heroku/router\r\n    at=info\r\n    method=POST\r\n    path=\"/v1/u/logs?is_app=true\"\r\n    host=sl2-api.qrioinc.com\r\n    request_id=3b6e609f-af18-a5df-06e2-f6af946696f9\r\n    fwd=\"147.192.85.179\"\r\n    dyno=web.2 connect=0ms service=100ms status=201 bytes=20 protocol=http tls_version=tls1.3\r\n```\r\n```ログの登録②.sh\r\nDec 15 08:00:05 sl2-api-production heroku/router\r\n    at=info\r\n    method=POST\r\n    path=\"/v1/u/logs?is_app=true\"\r\n    host=sl2-api.qrioinc.com\r\n    request_id=aa08e0b5-9e07-2840-728b-2fadc7466a61\r\n    fwd=\"147.192.85.179\"\r\n    dyno=web.4 connect=0ms service=182ms status=201 bytes=20 protocol=http tls_version=tls1.3\r\n```\r\n\r\n</details>\r\n\r\n**09:00 ユーザーのログ確認操作**\r\n\r\n\r\n<details>\r\n    <summary>logs</summary>\r\n\r\n```サブロックのログアップロード(hubから).sh\r\nDec 15 09:00:41 sl2-api-production heroku/router\r\n    at=info\r\n    method=GET\r\n    path=\"/v1/h/commands/log?lock_id=7d5b383a-1102-61af-a94b-64f9fcfc2dbc\r\n        &retry_count=3\r\n        &main_response=005e1b0000cc280043a6639a6300000000000000000000000000000000a8639a631a76bad5ec34f5b6f82473f19c76fd3cff32e8d583a9b038f7ff2324d36bb28cc0ac9c5843183e1f275e35270a1cd10fd276b9445d2811e221c8af7e50d0140e\"\r\n    host=sl2-api.qrioinc.com\r\n    request_id=036642a1-c63f-d223-56f7-4b494958cb8d\r\n    fwd=\"147.192.85.179\"\r\n    dyno=web.2 connect=0ms service=39ms status=200 bytes=2 protocol=http\r\n```\r\n```メインロックのログアップロード(hubから).sh\r\nDec 15 09:05:12 sl2-api-production heroku/router\r\n    at=info\r\n    method=GET\r\n    path=\"/v1/h/commands/log?lock_id=f4fc76d6-4412-bda3-5447-75879bc37d5c\r\n        &retry_count=3\r\n        &main_response=00de1a0000cc280030b5649a6300000000000000000000000000000000b7649a630c35ec62093efb1580320013beb29a7fb9a7da3a9c3c23cc58d843cf8b9caf92e89c7967065d5870089448db93746939d6f82c30a39ddccb2965d349eae38904\"\r\n    host=sl2-api.qrioinc.com\r\n    request_id=0bd8d4fb-4fa7-c51c-6b01-05610280577f\r\n    fwd=\"147.192.85.179\"\r\n    dyno=web.4 connect=0ms service=77ms status=200 bytes=460 protocol=http\r\n```\r\n\r\n</details>\r\n\r\n#### 9時頃 h/commands/logのmain_responseのparse\r\n9時台のhubからのgetリクエストパラメータをparseして、lock_log_idに該当するものを探す\r\n2件あるのは2ロックのため\r\n\r\n`ReadLogResponse.parse(モックlock, main_response).logs`\r\n\r\n**lock_log_id: 7006,6878が得られた**\r\n→それぞれ8:00の施錠と7:49の施錠の直後である\r\n→→ということは、これより前に施錠のログは記述されていた\r\n\r\n<details>\r\n    <summary>parse全文</summary>\r\n\r\n```sh\r\nhubからのリクエスト①\r\n[#<Log:0x00007fbb1d15b640\r\n  id: nil,\r\n  lock_id: \"00000000-0000-0000-1111-900000000001\",\r\n  lock_log_id: 7006,<-------------------------------------7006は08:00の施錠ログの直後\r\n  log_type: \"debug_door_position\",\r\n  param1: 40,\r\n  param2: 0,\r\n  param3: 67,\r\n  logged_at: Thu, 15 Dec 2022 00:00:38.000000000 UTC +00:00,\r\n  recordable_type: nil,\r\n  recordable_id: \"00000000-0000-0000-0000-000000000000\",\r\n  double_lock: true,\r\n  on_upside: true,\r\n  user_name: nil,\r\n  created_at: nil,\r\n  updated_at: nil,\r\n  knight_operation_type: nil>]\r\n```\r\n\r\n```sh\r\nhubからのリクエスト②\r\n[#<Log:0x00007fbb1d1faab0\r\n  id: nil,\r\n  lock_id: \"00000000-0000-0000-1111-900000000001\",\r\n  lock_log_id: 6878,<-------------------------------------6878は07:49の施錠ログの直後\r\n  log_type: \"debug_door_position\",\r\n  param1: 40,\r\n  param2: 0,\r\n  param3: 48,\r\n  logged_at: Thu, 15 Dec 2022 00:05:09.000000000 UTC +00:00,\r\n  recordable_type: nil,\r\n  recordable_id: \"00000000-0000-0000-0000-000000000000\",\r\n  double_lock: true,\r\n  on_upside: true,\r\n  user_name: nil,\r\n  created_at: nil,\r\n  updated_at: nil,\r\n  knight_operation_type: nil>]\r\n```\r\n\r\n</details>\r\n\r\n## 調査から推測\r\n\r\n- 上記4つのPOSTはBodyの中身がログ出力されていない\r\n- POSTリクエストを受けてAPIはログのDBへの書き込みとWebhook送信を行うが、WebhookのログはPapertrailでは見つからなかった\r\n- OneSignalのエラーが7:47頃出ていたが関係しているか？\r\n<img width=\"457\" alt=\"スクリーンショット 2022-12-15 21.57.50.png (168.8 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2022/12/15/136273/5b277a43-edcf-4d44-87a1-3fb7035de291.png\">\r\n\r\n## 施錠シーケンス洗い出し\r\n施錠コマンドの発行(manoma svから)\r\n```mermaid\r\nsequenceDiagram\r\n    manoma server ->> king-api: POST u/commands/close;\r\n    king-api -->>king-api: key_idをもとにkeyの検索;\r\n    king-api -->>king-api: 施錠コマンドの生成;\r\n    king-api -->>king-api: コマンド生成の権限チェック;\r\n    king-api -->>king-api: 施錠コマンドからコマンドログの生成;\r\n    king-api ->> king-DB: 施錠コマンドログのINSERT;\r\n    king-api ->> PubNub: 施錠コマンドのpublish;\r\n    king-api ->> manoma server: 施錠コマンドの送信の成功とコマンドidを返却;\r\n    PubNub ->> Qrio Hub: 施錠コマンドのpublish;\r\n    Qrio Hub -->> Qrio Lock: 施錠操作;\r\n    Qrio Lock -->> Qrio Hub: 操作結果;\r\n    Qrio Hub ->> king-api: 操作結果GET h/commands;\r\n    manoma server ->> king-api: GET u/commands?command_id={command_id};\r\n```\r\n\r\n```sql\r\nSELECT lock_webhook_tokens.id AS lid,\r\n       webhook_tokens.*\r\nFROM lock_webhook_tokens\r\nJOIN webhook_tokens ON lock_webhook_tokens.webhook_token_id = webhook_tokens.id\r\nWHERE lock_id IN ('F4FC76D6-4412-BDA3-5447-75879BC37D5C',\r\n                  '7D5B383A-1102-61AF-A94B-64F9FCFC2DBC');\r\n```\r\n\r\n\r\n\r\n解錠ログがSnc(manoma)側に届かない\r\n\r\n施錠ログは届いている\r\n→その施錠時にhub経由かBLEでlock内にあるログがking-apiに送信されるはず\r\n→hub経由での施錠ログがking-apiログ上にない\r\n→Command_logsも該当するリモートコマンドログがDBにない\r\n→POST u/commands/closeが履歴にない\r\n→BLEでの施錠である(スマホアプリかmanoma AIHGW)\r\n\r\nBLEでの施錠時、ログをDBに保管などするのは`POST u/logs`\r\n→Bodyが見られないので正しいlock_responseが届いているかは検証不可\r\n→DBに解錠と施錠のログ登録はある。登録時刻created_atも施錠時刻とほぼ同時\r\n→上記登録に係るメソッド`Log.import_and_push(logs)`はcastle/kagicanに送信している→×\r\n→`lock.tokens.each(&:sync_lock_state_job!) unless logs.all?(&:communication_error?)`\r\n→→lockの最終解施錠の状態を、lockの持つ各プラットフォームに送信している→×\r\n→`.try(:notification).try(:notify!)`はOneSignal経由で通知を送信している\r\n→lib/one_signalのnotify!ではfiltersに`user.id`を指定している\r\n\r\nHub経由でのログ登録リクエストは、7:49と8:00の施錠操作時点では届いていない\r\n→リモートコマンドログもDBにない\r\n→POST u/logsのlock_responseはログに出ていない\r\n→sync_lock_state_job!かtry(:notification).try(:notify!)のどちらかでこけている\r\n→webhookなのはsync_lock_state_job\r\n→invalid_grantなどのエラーが常時出ている",
    "body_html": "<h2 data-sourcepos=\"1:1-1:9\" id=\"0-1-0\" name=\"0-1-0\"><a class=\"anchor\" id=\"事象\" name=\"事象\" href=\"#事象\" data-position=\"0-1-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"事象\"> &gt; 事象</span></a>事象</h2>\n<blockquote data-sourcepos=\"3:1-9:106\">\n<p data-sourcepos=\"3:3-9:106\">下記のLock_idのLockについて、操作はできるもののログが施錠しか届いていないようです。<br>\nQrioHub経由の解施錠になります。<br>\nf4fc76d6-4412-bda3-5447-75879bc37d5c<br>\n操作時間(本日12/15)<br>\n7:49( 施錠ログは来ている)<br>\n8:00 (施錠ログは来ている)<br>\nお手数ですが、なぜ解錠ログが来ていないのか確認いただけますでしょうか？</p>\n</blockquote>\n<p data-sourcepos=\"11:1-11:95\"><a href=\"https://qrioinc.slack.com/archives/C02EVM1HR6C/p1671066399077869\" target=\"_blank\" rel=\"noopener noreferrer\">slack - dev_qrio-manoma-dev</a></p>\n<p data-sourcepos=\"13:1-13:88\">ユーザーが確認したのは9:10頃、解錠ログが届いていないとのこと</p>\n<h2 data-sourcepos=\"15:1-15:27\" id=\"0-2-0\" name=\"0-2-0\"><a class=\"anchor\" id=\"わかっていること\" name=\"わかっていること\" href=\"#わかっていること\" data-position=\"0-2-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"わかっていること\"> &gt; わかっていること</span></a>わかっていること</h2>\n<h2 data-sourcepos=\"18:1-18:9\" id=\"0-3-0\" name=\"0-3-0\"><a class=\"anchor\" id=\"考慮\" name=\"考慮\" href=\"#考慮\" data-position=\"0-3-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"考慮\"> &gt; 考慮</span></a>考慮</h2>\n<div class=\"code-block\" data-sourcepos=\"20:1-26:3\"><div class=\"mermaid\">flowchart TD\n    A[解錠ログが届いておらず施錠ログのみが届いている]--&gt;B{解錠は手動か}\n    B--YES--&gt;C[次の施錠の際にログがアップされる\\nPOST u/logs]\n    C--&gt;D{アップされたログは\\nDBへの書き込みと\\nSNCへの送信がなされる}\n    </div></div>\n<h2 data-sourcepos=\"28:1-28:9\" id=\"0-4-0\" name=\"0-4-0\"><a class=\"anchor\" id=\"調査\" name=\"調査\" href=\"#調査\" data-position=\"0-4-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"調査\"> &gt; 調査</span></a>調査</h2>\n<h3 data-sourcepos=\"30:1-30:70\" id=\"0-4-1\" name=\"0-4-1\"><a class=\"anchor\" id=\"ログからの情報(先方からもらったlock_idをもとに)\" name=\"ログからの情報(先方からもらったlock_idをもとに)\" href=\"#ログからの情報(先方からもらったlock_idをもとに)\" data-position=\"0-4-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"ログからの情報(先方からもらったlock_idをもとに)\"> &gt; ログからの情報(先方からもらったlock_idをもとに)</span></a>ログからの情報(先方からもらったlock_idをもとに)</h3>\n<table data-sourcepos=\"31:1-43:32\">\n<thead>\n<tr data-sourcepos=\"31:1-31:18\">\n<th data-sourcepos=\"31:2-31:4\">key</th>\n<th data-sourcepos=\"31:6-31:10\">value</th>\n<th data-sourcepos=\"31:12-31:17\">備考</th>\n</tr>\n</thead>\n<tbody>\n<tr data-sourcepos=\"33:1-33:54\">\n<td data-sourcepos=\"33:2-33:14\">master_key_id</td>\n<td data-sourcepos=\"33:16-33:51\">3fad3d50-7cea-4bb6-a543-ca4a869e6bfc</td>\n<td data-sourcepos=\"33:53-33:53\"></td>\n</tr>\n<tr data-sourcepos=\"34:1-34:88\">\n<td data-sourcepos=\"34:2-34:8\">lock_id</td>\n<td data-sourcepos=\"34:10-34:46\">F4FC76D6-4412-BDA3-5447-75879BC37D5C</td>\n<td data-sourcepos=\"34:48-34:87\">以降メインロックと呼びます</td>\n</tr>\n<tr data-sourcepos=\"35:1-35:88\">\n<td data-sourcepos=\"35:2-35:11\">sublock_id</td>\n<td data-sourcepos=\"35:13-35:49\">7D5B383A-1102-61AF-A94B-64F9FCFC2DBC</td>\n<td data-sourcepos=\"35:51-35:87\">以降サブロックと呼びます</td>\n</tr>\n<tr data-sourcepos=\"36:1-36:56\">\n<td data-sourcepos=\"36:2-36:15\">master_user_id</td>\n<td data-sourcepos=\"36:17-36:53\">ef8ad27d-7cc9-42bd-b3a1-91be65e4370c</td>\n<td data-sourcepos=\"36:55-36:55\"></td>\n</tr>\n<tr data-sourcepos=\"37:1-37:56\">\n<td data-sourcepos=\"37:2-37:13\">user_id①</td>\n<td data-sourcepos=\"37:15-37:52\">fc00cf66-501c-4492-bd11-bdb45c5e0258</td>\n<td data-sourcepos=\"37:54-37:55\"></td>\n</tr>\n<tr data-sourcepos=\"38:1-38:85\">\n<td data-sourcepos=\"38:2-38:12\">key_id①</td>\n<td data-sourcepos=\"38:14-38:51\">5fb9aaa4-935d-4901-a0ba-986ea0223217</td>\n<td data-sourcepos=\"38:53-38:84\">上記ユーザーに紐づく</td>\n</tr>\n<tr data-sourcepos=\"39:1-39:56\">\n<td data-sourcepos=\"39:2-39:13\">user_id②</td>\n<td data-sourcepos=\"39:15-39:52\">9b0b5cd4-60a4-4afb-8eb8-c3d59658b26d</td>\n<td data-sourcepos=\"39:54-39:55\"></td>\n</tr>\n<tr data-sourcepos=\"40:1-40:85\">\n<td data-sourcepos=\"40:2-40:12\">key_id②</td>\n<td data-sourcepos=\"40:14-40:51\">b3fc3827-60ce-4ffe-8bde-e79172734bdc</td>\n<td data-sourcepos=\"40:53-40:84\">上記ユーザーに紐づく</td>\n</tr>\n<tr data-sourcepos=\"41:1-41:47\">\n<td data-sourcepos=\"41:2-41:7\">hub_id</td>\n<td data-sourcepos=\"41:9-41:44\">b76a8b03-b4b2-464e-8ea6-52eaab4fcba2</td>\n<td data-sourcepos=\"41:46-41:46\"></td>\n</tr>\n<tr data-sourcepos=\"42:1-42:31\">\n<td data-sourcepos=\"42:2-42:13\">ipaddress①</td>\n<td data-sourcepos=\"42:15-42:28\">147.192.85.179</td>\n<td data-sourcepos=\"42:30-42:30\"></td>\n</tr>\n<tr data-sourcepos=\"43:1-43:32\">\n<td data-sourcepos=\"43:2-43:13\">ipaddress②</td>\n<td data-sourcepos=\"43:15-43:29\">126.254.232.139</td>\n<td data-sourcepos=\"43:31-43:31\"></td>\n</tr>\n</tbody>\n</table>\n<h3 data-sourcepos=\"45:1-45:51\" id=\"0-4-2\" name=\"0-4-2\"><a class=\"anchor\" id=\"各ロックIDのDBのLogsテーブルの状態\" name=\"各ロックIDのDBのLogsテーブルの状態\" href=\"#各ロックIDのDBのLogsテーブルの状態\" data-position=\"0-4-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"各ロックIDのDBのLogsテーブルの状態\"> &gt; 各ロックIDのDBのLogsテーブルの状態</span></a>各ロックIDのDBのLogsテーブルの状態</h3>\n<p data-sourcepos=\"46:1-47:63\">先方では受け取っていない解錠のログがDBには書き込まれている。<br>\nログの生成時刻(created_at)は施錠と同時刻である</p>\n<p data-sourcepos=\"50:1-50:9\">クエリ</p>\n<div class=\"code-block\" data-sourcepos=\"51:1-61:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>メインロックとサブロックのIDからlogsテーブル取得.sql</div><div class=\"highlight\"><pre class=\"highlight plsql\"><code><span class=\"kr\">SELECT</span> <span class=\"o\">*</span>\n<span class=\"kr\">FROM</span> <span class=\"n\">logs</span>\n<span class=\"kr\">WHERE</span> <span class=\"n\">lock_id</span> <span class=\"ow\">IN</span> <span class=\"p\">(</span><span class=\"o\">'</span><span class=\"s1\">7d5b383a-1102-61af-a94b-64f9fcfc2dbc</span><span class=\"o\">'</span><span class=\"p\">,</span>\n                  <span class=\"o\">'</span><span class=\"s1\">f4fc76d6-4412-bda3-5447-75879bc37d5c</span><span class=\"o\">'</span><span class=\"p\">)</span>\n<span class=\"ow\">AND</span> <span class=\"n\">created_at</span> <span class=\"ow\">BETWEEN</span> <span class=\"o\">'</span><span class=\"s1\">2022-12-14 22:00</span><span class=\"o\">'</span> <span class=\"ow\">AND</span> <span class=\"o\">'</span><span class=\"s1\">2022-12-15 00:00</span><span class=\"o\">'</span>\n<span class=\"kr\">ORDER</span> <span class=\"kr\">BY</span> <span class=\"n\">logged_at</span> <span class=\"kr\">DESC</span>\n<span class=\"k\">LIMIT</span> <span class=\"mi\">50</span><span class=\"p\">;</span>\n\n</code></pre></div></div>\n<p data-sourcepos=\"62:1-63:31\">取得後、関係ない行は削った。<br>\n<strong>以下の表は時刻はUTC</strong></p>\n<table data-sourcepos=\"65:1-74:229\">\n<thead>\n<tr data-sourcepos=\"65:1-65:154\">\n<th data-sourcepos=\"65:1-65:6\">概要</th>\n<th data-sourcepos=\"65:8-65:9\">id</th>\n<th data-sourcepos=\"65:11-65:17\">lock_id</th>\n<th data-sourcepos=\"65:19-65:29\">lock_log_id</th>\n<th data-sourcepos=\"65:31-65:38\">log_type</th>\n<th data-sourcepos=\"65:40-65:45\">param1</th>\n<th data-sourcepos=\"65:47-65:52\">param2</th>\n<th data-sourcepos=\"65:54-65:59\">param3</th>\n<th data-sourcepos=\"65:61-65:69\">logged_at</th>\n<th data-sourcepos=\"65:71-65:85\">recordable_type</th>\n<th data-sourcepos=\"65:87-65:99\">recordable_id</th>\n<th data-sourcepos=\"65:101-65:111\">double_lock</th>\n<th data-sourcepos=\"65:113-65:121\">on_upside</th>\n<th data-sourcepos=\"65:123-65:131\">user_name</th>\n<th data-sourcepos=\"65:133-65:142\">created_at</th>\n<th data-sourcepos=\"65:144-65:153\">updated_at</th>\n</tr>\n</thead>\n<tbody>\n<tr data-sourcepos=\"67:1-67:252\">\n<td data-sourcepos=\"67:1-67:24\">メインロック施錠</td>\n<td data-sourcepos=\"67:26-67:61\">fbcafd7d-7e63-4f74-b333-0d4f353918a0</td>\n<td data-sourcepos=\"67:63-67:98\">f4fc76d6-4412-bda3-5447-75879bc37d5c</td>\n<td data-sourcepos=\"67:100-67:103\">6877</td>\n<td data-sourcepos=\"67:105-67:105\">2</td>\n<td data-sourcepos=\"67:107-67:107\">0</td>\n<td data-sourcepos=\"67:109-67:110\">64</td>\n<td data-sourcepos=\"67:112-67:113\">17</td>\n<td data-sourcepos=\"67:115-67:133\">2022-12-14T23:00:04</td>\n<td data-sourcepos=\"67:135-67:143\">MasterKey</td>\n<td data-sourcepos=\"67:145-67:180\">3fad3d50-7cea-4bb6-a543-ca4a869e6bfc</td>\n<td data-sourcepos=\"67:182-67:185\">True</td>\n<td data-sourcepos=\"67:187-67:190\">True</td>\n<td data-sourcepos=\"67:192-67:203\">たかひこ</td>\n<td data-sourcepos=\"67:205-67:227\">2022-12-14T23:00:05.436</td>\n<td data-sourcepos=\"67:229-67:251\">2022-12-14T23:00:05.436</td>\n</tr>\n<tr data-sourcepos=\"68:1-68:250\">\n<td data-sourcepos=\"68:1-68:21\">サブロック施錠</td>\n<td data-sourcepos=\"68:23-68:58\">d6a0cbd2-da8f-45da-ba6e-9da67ae2b8a3</td>\n<td data-sourcepos=\"68:60-68:95\">7d5b383a-1102-61af-a94b-64f9fcfc2dbc</td>\n<td data-sourcepos=\"68:97-68:100\">7005</td>\n<td data-sourcepos=\"68:102-68:102\">2</td>\n<td data-sourcepos=\"68:104-68:104\">0</td>\n<td data-sourcepos=\"68:106-68:107\">66</td>\n<td data-sourcepos=\"68:109-68:110\">17</td>\n<td data-sourcepos=\"68:112-68:130\">2022-12-14T23:00:04</td>\n<td data-sourcepos=\"68:132-68:140\">MasterKey</td>\n<td data-sourcepos=\"68:142-68:177\">3fad3d50-7cea-4bb6-a543-ca4a869e6bfc</td>\n<td data-sourcepos=\"68:179-68:182\">True</td>\n<td data-sourcepos=\"68:184-68:188\">False</td>\n<td data-sourcepos=\"68:190-68:201\">たかひこ</td>\n<td data-sourcepos=\"68:203-68:225\">2022-12-14T23:00:05.409</td>\n<td data-sourcepos=\"68:227-68:249\">2022-12-14T23:00:05.409</td>\n</tr>\n<tr data-sourcepos=\"69:1-69:227\">\n<td data-sourcepos=\"69:1-69:21\">サブロック解錠</td>\n<td data-sourcepos=\"69:23-69:58\">0196283a-f885-4ae1-9043-1dfa84a24e32</td>\n<td data-sourcepos=\"69:60-69:95\">7d5b383a-1102-61af-a94b-64f9fcfc2dbc</td>\n<td data-sourcepos=\"69:97-69:100\">7004</td>\n<td data-sourcepos=\"69:102-69:102\">4</td>\n<td data-sourcepos=\"69:104-69:104\">0</td>\n<td data-sourcepos=\"69:106-69:106\">0</td>\n<td data-sourcepos=\"69:108-69:108\">0</td>\n<td data-sourcepos=\"69:110-69:128\">2022-12-14T22:59:49</td>\n<td data-sourcepos=\"69:130-69:129\"></td>\n<td data-sourcepos=\"69:131-69:166\">00000000-0000-0000-0000-000000000000</td>\n<td data-sourcepos=\"69:168-69:171\">True</td>\n<td data-sourcepos=\"69:173-69:177\">False</td>\n<td data-sourcepos=\"69:179-69:178\"></td>\n<td data-sourcepos=\"69:180-69:202\">2022-12-14T23:00:05.409</td>\n<td data-sourcepos=\"69:204-69:226\">2022-12-14T23:00:05.409</td>\n</tr>\n<tr data-sourcepos=\"70:1-70:229\">\n<td data-sourcepos=\"70:1-70:24\">メインロック解錠</td>\n<td data-sourcepos=\"70:26-70:61\">1e7906c0-24f0-440e-b65b-a6b940eb2798</td>\n<td data-sourcepos=\"70:63-70:98\">f4fc76d6-4412-bda3-5447-75879bc37d5c</td>\n<td data-sourcepos=\"70:100-70:103\">6876</td>\n<td data-sourcepos=\"70:105-70:105\">4</td>\n<td data-sourcepos=\"70:107-70:107\">0</td>\n<td data-sourcepos=\"70:109-70:109\">0</td>\n<td data-sourcepos=\"70:111-70:111\">0</td>\n<td data-sourcepos=\"70:113-70:131\">2022-12-14T22:59:48</td>\n<td data-sourcepos=\"70:133-70:132\"></td>\n<td data-sourcepos=\"70:134-70:169\">00000000-0000-0000-0000-000000000000</td>\n<td data-sourcepos=\"70:171-70:174\">True</td>\n<td data-sourcepos=\"70:176-70:179\">True</td>\n<td data-sourcepos=\"70:181-70:180\"></td>\n<td data-sourcepos=\"70:182-70:204\">2022-12-14T23:00:05.436</td>\n<td data-sourcepos=\"70:206-70:228\">2022-12-14T23:00:05.436</td>\n</tr>\n<tr data-sourcepos=\"71:1-71:247\">\n<td data-sourcepos=\"71:1-71:21\">サブロック施錠</td>\n<td data-sourcepos=\"71:23-71:58\">d84df403-3ebe-4e6a-8f0f-75e5b8cb397e</td>\n<td data-sourcepos=\"71:60-71:95\">7d5b383a-1102-61af-a94b-64f9fcfc2dbc</td>\n<td data-sourcepos=\"71:97-71:100\">7003</td>\n<td data-sourcepos=\"71:102-71:102\">2</td>\n<td data-sourcepos=\"71:104-71:104\">0</td>\n<td data-sourcepos=\"71:106-71:107\">66</td>\n<td data-sourcepos=\"71:109-71:110\">18</td>\n<td data-sourcepos=\"71:112-71:130\">2022-12-14T22:49:16</td>\n<td data-sourcepos=\"71:132-71:140\">FamilyKey</td>\n<td data-sourcepos=\"71:142-71:177\">b3fc3827-60ce-4ffe-8bde-e79172734bdc</td>\n<td data-sourcepos=\"71:179-71:182\">True</td>\n<td data-sourcepos=\"71:184-71:188\">False</td>\n<td data-sourcepos=\"71:190-71:198\">あさみ</td>\n<td data-sourcepos=\"71:200-71:222\">2022-12-14T22:49:18.329</td>\n<td data-sourcepos=\"71:224-71:246\">2022-12-14T22:49:18.329</td>\n</tr>\n<tr data-sourcepos=\"72:1-72:249\">\n<td data-sourcepos=\"72:1-72:24\">メインロック施錠</td>\n<td data-sourcepos=\"72:26-72:61\">0eb0b233-eea9-40e7-9746-59562c1e5aed</td>\n<td data-sourcepos=\"72:63-72:98\">f4fc76d6-4412-bda3-5447-75879bc37d5c</td>\n<td data-sourcepos=\"72:100-72:103\">6875</td>\n<td data-sourcepos=\"72:105-72:105\">2</td>\n<td data-sourcepos=\"72:107-72:107\">0</td>\n<td data-sourcepos=\"72:109-72:110\">64</td>\n<td data-sourcepos=\"72:112-72:113\">18</td>\n<td data-sourcepos=\"72:115-72:133\">2022-12-14T22:49:16</td>\n<td data-sourcepos=\"72:135-72:143\">FamilyKey</td>\n<td data-sourcepos=\"72:145-72:180\">b3fc3827-60ce-4ffe-8bde-e79172734bdc</td>\n<td data-sourcepos=\"72:182-72:185\">True</td>\n<td data-sourcepos=\"72:187-72:190\">True</td>\n<td data-sourcepos=\"72:192-72:200\">あさみ</td>\n<td data-sourcepos=\"72:202-72:224\">2022-12-14T22:49:18.311</td>\n<td data-sourcepos=\"72:226-72:248\">2022-12-14T22:49:18.311</td>\n</tr>\n<tr data-sourcepos=\"73:1-73:227\">\n<td data-sourcepos=\"73:1-73:21\">サブロック解錠</td>\n<td data-sourcepos=\"73:23-73:58\">36080ace-f13d-4c3d-a627-9711d5529d7f</td>\n<td data-sourcepos=\"73:60-73:95\">7d5b383a-1102-61af-a94b-64f9fcfc2dbc</td>\n<td data-sourcepos=\"73:97-73:100\">7002</td>\n<td data-sourcepos=\"73:102-73:102\">4</td>\n<td data-sourcepos=\"73:104-73:104\">0</td>\n<td data-sourcepos=\"73:106-73:106\">0</td>\n<td data-sourcepos=\"73:108-73:108\">0</td>\n<td data-sourcepos=\"73:110-73:128\">2022-12-14T22:48:47</td>\n<td data-sourcepos=\"73:130-73:129\"></td>\n<td data-sourcepos=\"73:131-73:166\">00000000-0000-0000-0000-000000000000</td>\n<td data-sourcepos=\"73:168-73:171\">True</td>\n<td data-sourcepos=\"73:173-73:177\">False</td>\n<td data-sourcepos=\"73:179-73:178\"></td>\n<td data-sourcepos=\"73:180-73:202\">2022-12-14T22:49:18.329</td>\n<td data-sourcepos=\"73:204-73:226\">2022-12-14T22:49:18.329</td>\n</tr>\n<tr data-sourcepos=\"74:1-74:229\">\n<td data-sourcepos=\"74:1-74:24\">メインロック解錠</td>\n<td data-sourcepos=\"74:26-74:61\">beb7744c-8da2-491a-aae4-b7de716ae953</td>\n<td data-sourcepos=\"74:63-74:98\">f4fc76d6-4412-bda3-5447-75879bc37d5c</td>\n<td data-sourcepos=\"74:100-74:103\">6874</td>\n<td data-sourcepos=\"74:105-74:105\">4</td>\n<td data-sourcepos=\"74:107-74:107\">0</td>\n<td data-sourcepos=\"74:109-74:109\">0</td>\n<td data-sourcepos=\"74:111-74:111\">0</td>\n<td data-sourcepos=\"74:113-74:131\">2022-12-14T22:48:46</td>\n<td data-sourcepos=\"74:133-74:132\"></td>\n<td data-sourcepos=\"74:134-74:169\">00000000-0000-0000-0000-000000000000</td>\n<td data-sourcepos=\"74:171-74:174\">True</td>\n<td data-sourcepos=\"74:176-74:179\">True</td>\n<td data-sourcepos=\"74:181-74:180\"></td>\n<td data-sourcepos=\"74:182-74:204\">2022-12-14T22:49:18.311</td>\n<td data-sourcepos=\"74:206-74:228\">2022-12-14T22:49:18.311</td>\n</tr>\n</tbody>\n</table>\n<p data-sourcepos=\"76:1-77:36\">log_type = 2 :施錠<br>\nlog_type = 4 : マニュアル解錠</p>\n<p data-sourcepos=\"79:1-79:72\"><code>lock_log_id</code>の6874と7002が届いていないと問題の解錠ログ</p>\n<h3 data-sourcepos=\"81:1-81:92\" id=\"0-4-3\" name=\"0-4-3\"><a class=\"anchor\" id=\"上記created_atをもとに書き込みが行われる契機となったログを探す\" name=\"上記created_atをもとに書き込みが行われる契機となったログを探す\" href=\"#上記created_atをもとに書き込みが行われる契機となったログを探す\" data-position=\"0-4-3\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"上記created_atをもとに書き込みが行われる契機となったログを探す\"> &gt; 上記created_atをもとに書き込みが行われる契機となったログを探す</span></a>上記created_atをもとに書き込みが行われる契機となったログを探す</h3>\n<p data-sourcepos=\"83:1-84:52\">ログの書き込みとwebhookの送信は<del>Log.import_and_push()によるもの</del>SyncLockStateJob<br>\n以下の2APIでメソッドが呼ばれている。</p>\n<ul data-sourcepos=\"85:1-87:0\">\n<li data-sourcepos=\"85:1-85:20\">GET h/commands/log</li>\n<li data-sourcepos=\"86:1-87:0\">POST u/logs</li>\n</ul>\n<p data-sourcepos=\"88:1-88:79\">(BLEではなくhub経由での解施錠時にはh/commands/logに経由する)</p>\n<h4 data-sourcepos=\"90:1-90:42\">周辺時間帯を各lock_idで検索</h4>\n<p data-sourcepos=\"92:1-92:40\"><strong>07:49 ユーザーの解施錠操作</strong></p>\n<details>\n    <summary>logs</summary>\n<div class=\"code-block\" data-sourcepos=\"97:1-106:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>メインロック最新ログの取得.sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>Dec 15 07:49:13 sl2-api-production heroku/router\n    <span class=\"nv\">at</span><span class=\"o\">=</span>info\n    <span class=\"nv\">method</span><span class=\"o\">=</span>GET\n    <span class=\"nv\">path</span><span class=\"o\">=</span><span class=\"s2\">\"/v1/u/logs/last_id?lock_id=F4FC76D6-4412-BDA3-5447-75879BC37D5C\"</span>\n    <span class=\"nv\">host</span><span class=\"o\">=</span>sl2-api.qrioinc.com\n    <span class=\"nv\">request_id</span><span class=\"o\">=</span>b8ad8c26-d26e-9bae-309c-81817ff41379\n    <span class=\"nv\">fwd</span><span class=\"o\">=</span><span class=\"s2\">\"147.192.85.179\"</span>\n    <span class=\"nv\">dyno</span><span class=\"o\">=</span>web.2 <span class=\"nv\">connect</span><span class=\"o\">=</span>0ms <span class=\"nv\">service</span><span class=\"o\">=</span>28ms <span class=\"nv\">status</span><span class=\"o\">=</span>200 <span class=\"nv\">bytes</span><span class=\"o\">=</span>34 <span class=\"nv\">protocol</span><span class=\"o\">=</span>http <span class=\"nv\">tls_version</span><span class=\"o\">=</span>tls1.3\n</code></pre></div></div>\n<div class=\"code-block\" data-sourcepos=\"107:1-115:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>hash取得.sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>Dec 15 07:49:13 sl2-api-production heroku/router\n    <span class=\"nv\">at</span><span class=\"o\">=</span>info <span class=\"nv\">method</span><span class=\"o\">=</span>GET\n    <span class=\"nv\">path</span><span class=\"o\">=</span><span class=\"s2\">\"/v1/u/hash\"</span>\n    <span class=\"nv\">host</span><span class=\"o\">=</span>sl2-api.qrioinc.com\n    <span class=\"nv\">request_id</span><span class=\"o\">=</span>7514400b-0e6a-b20e-824a-b33904d6653d\n    <span class=\"nv\">fwd</span><span class=\"o\">=</span><span class=\"s2\">\"147.192.85.179\"</span>\n    <span class=\"nv\">dyno</span><span class=\"o\">=</span>web.3 <span class=\"nv\">connect</span><span class=\"o\">=</span>0ms <span class=\"nv\">service</span><span class=\"o\">=</span>33ms <span class=\"nv\">status</span><span class=\"o\">=</span>304 <span class=\"nv\">bytes</span><span class=\"o\">=</span>0 <span class=\"nv\">protocol</span><span class=\"o\">=</span>http <span class=\"nv\">tls_version</span><span class=\"o\">=</span>tls1.3\n</code></pre></div></div>\n<div class=\"code-block\" data-sourcepos=\"116:1-125:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>メインロック情報の更新.sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>Dec 15 07:49:15 sl2-api-production heroku/router\n    <span class=\"nv\">at</span><span class=\"o\">=</span>info\n    <span class=\"nv\">method</span><span class=\"o\">=</span>PATCH\n    <span class=\"nv\">path</span><span class=\"o\">=</span><span class=\"s2\">\"/v1/u/locks/F4FC76D6-4412-BDA3-5447-75879BC37D5C\"</span>\n    <span class=\"nv\">host</span><span class=\"o\">=</span>sl2-api.qrioinc.com\n    <span class=\"nv\">request_id</span><span class=\"o\">=</span>3c6301be-1808-5e94-8df6-cb1a4d41f0c7\n    <span class=\"nv\">fwd</span><span class=\"o\">=</span><span class=\"s2\">\"147.192.85.179\"</span>\n    <span class=\"nv\">dyno</span><span class=\"o\">=</span>web.3 <span class=\"nv\">connect</span><span class=\"o\">=</span>0ms <span class=\"nv\">service</span><span class=\"o\">=</span>26ms <span class=\"nv\">status</span><span class=\"o\">=</span>200 <span class=\"nv\">bytes</span><span class=\"o\">=</span>4 <span class=\"nv\">protocol</span><span class=\"o\">=</span>http <span class=\"nv\">tls_version</span><span class=\"o\">=</span>tls1.3\n</code></pre></div></div>\n<div class=\"code-block\" data-sourcepos=\"127:1-136:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>サブロック情報の更新.sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>Dec 15 07:49:16 sl2-api-production heroku/router\n    <span class=\"nv\">at</span><span class=\"o\">=</span>info\n    <span class=\"nv\">method</span><span class=\"o\">=</span>PATCH\n    <span class=\"nv\">path</span><span class=\"o\">=</span><span class=\"s2\">\"/v1/u/locks/7D5B383A-1102-61AF-A94B-64F9FCFC2DBC\"</span>\n    <span class=\"nv\">host</span><span class=\"o\">=</span>sl2-api.qrioinc.com\n    <span class=\"nv\">request_id</span><span class=\"o\">=</span>890a8632-574e-edfc-874b-a35c9e4903f1\n    <span class=\"nv\">fwd</span><span class=\"o\">=</span><span class=\"s2\">\"147.192.85.179\"</span>\n    <span class=\"nv\">dyno</span><span class=\"o\">=</span>web.2 <span class=\"nv\">connect</span><span class=\"o\">=</span>0ms <span class=\"nv\">service</span><span class=\"o\">=</span>31ms <span class=\"nv\">status</span><span class=\"o\">=</span>200 <span class=\"nv\">bytes</span><span class=\"o\">=</span>4 <span class=\"nv\">protocol</span><span class=\"o\">=</span>http <span class=\"nv\">tls_version</span><span class=\"o\">=</span>tls1.3\n</code></pre></div></div>\n<div class=\"code-block\" data-sourcepos=\"137:1-146:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>ログの登録①.sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>Dec 15 07:49:18 sl2-api-production heroku/router\n    <span class=\"nv\">at</span><span class=\"o\">=</span>info\n    <span class=\"nv\">method</span><span class=\"o\">=</span>POST\n    <span class=\"nv\">path</span><span class=\"o\">=</span><span class=\"s2\">\"/v1/u/logs?is_app=true\"</span>\n    <span class=\"nv\">host</span><span class=\"o\">=</span>sl2-api.qrioinc.com\n    <span class=\"nv\">request_id</span><span class=\"o\">=</span>c673ad91-53aa-4796-e1d2-7dc89d8bf221\n    <span class=\"nv\">fwd</span><span class=\"o\">=</span><span class=\"s2\">\"147.192.85.179\"</span>\n    <span class=\"nv\">dyno</span><span class=\"o\">=</span>web.2 <span class=\"nv\">connect</span><span class=\"o\">=</span>0ms <span class=\"nv\">service</span><span class=\"o\">=</span>135ms <span class=\"nv\">status</span><span class=\"o\">=</span>201 <span class=\"nv\">bytes</span><span class=\"o\">=</span>20 <span class=\"nv\">protocol</span><span class=\"o\">=</span>http <span class=\"nv\">tls_version</span><span class=\"o\">=</span>tls1.3\n</code></pre></div></div>\n<div class=\"code-block\" data-sourcepos=\"147:1-156:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>ログの登録②.sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>Dec 15 07:49:18 sl2-api-production heroku/router\n    <span class=\"nv\">at</span><span class=\"o\">=</span>info\n    <span class=\"nv\">method</span><span class=\"o\">=</span>POST\n    <span class=\"nv\">path</span><span class=\"o\">=</span><span class=\"s2\">\"/v1/u/logs?is_app=true\"</span>\n    <span class=\"nv\">host</span><span class=\"o\">=</span>sl2-api.qrioinc.com\n    <span class=\"nv\">request_id</span><span class=\"o\">=</span>4c42a13f-19c4-7635-9d80-a107ae6e938e\n    <span class=\"nv\">fwd</span><span class=\"o\">=</span><span class=\"s2\">\"147.192.85.179\"</span>\n    <span class=\"nv\">dyno</span><span class=\"o\">=</span>web.3 <span class=\"nv\">connect</span><span class=\"o\">=</span>0ms <span class=\"nv\">service</span><span class=\"o\">=</span>141ms <span class=\"nv\">status</span><span class=\"o\">=</span>201 <span class=\"nv\">bytes</span><span class=\"o\">=</span>20 <span class=\"nv\">protocol</span><span class=\"o\">=</span>http <span class=\"nv\">tls_version</span><span class=\"o\">=</span>tls1.3\n</code></pre></div></div>\n</details>\n<p data-sourcepos=\"160:1-160:40\"><strong>08:00 ユーザーの解施錠操作</strong></p>\n<details>\n    <summary>logs</summary>\n<div class=\"code-block\" data-sourcepos=\"166:1-175:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>メインロック最新ログの取得.sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>Dec 15 08:00:01 sl2-api-production heroku/router\n    <span class=\"nv\">at</span><span class=\"o\">=</span>info\n    <span class=\"nv\">method</span><span class=\"o\">=</span>GET\n    <span class=\"nv\">path</span><span class=\"o\">=</span><span class=\"s2\">\"/v1/u/logs/last_id?lock_id=F4FC76D6-4412-BDA3-5447-75879BC37D5C\"</span>\n    <span class=\"nv\">host</span><span class=\"o\">=</span>sl2-api.qrioinc.com\n    <span class=\"nv\">request_id</span><span class=\"o\">=</span>aa864081-7fc2-9fc9-bbfa-eff67ea29598\n    <span class=\"nv\">fwd</span><span class=\"o\">=</span><span class=\"s2\">\"147.192.85.179\"</span>\n    <span class=\"nv\">dyno</span><span class=\"o\">=</span>web.2 <span class=\"nv\">connect</span><span class=\"o\">=</span>0ms <span class=\"nv\">service</span><span class=\"o\">=</span>34ms <span class=\"nv\">status</span><span class=\"o\">=</span>200 <span class=\"nv\">bytes</span><span class=\"o\">=</span>34 <span class=\"nv\">protocol</span><span class=\"o\">=</span>http <span class=\"nv\">tls_version</span><span class=\"o\">=</span>tls1.3\n</code></pre></div></div>\n<div class=\"code-block\" data-sourcepos=\"177:1-186:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>hash取得.sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>Dec 15 08:00:01 sl2-api-production heroku/router\n    <span class=\"nv\">at</span><span class=\"o\">=</span>info\n    <span class=\"nv\">method</span><span class=\"o\">=</span>GET\n    <span class=\"nv\">path</span><span class=\"o\">=</span><span class=\"s2\">\"/v1/u/hash\"</span>\n    <span class=\"nv\">host</span><span class=\"o\">=</span>sl2-api.qrioinc.com\n    <span class=\"nv\">request_id</span><span class=\"o\">=</span>5340673d-e2c5-ce72-b152-485897febd2b\n    <span class=\"nv\">fwd</span><span class=\"o\">=</span><span class=\"s2\">\"147.192.85.179\"</span>\n    <span class=\"nv\">dyno</span><span class=\"o\">=</span>web.4 <span class=\"nv\">connect</span><span class=\"o\">=</span>0ms <span class=\"nv\">service</span><span class=\"o\">=</span>82ms <span class=\"nv\">status</span><span class=\"o\">=</span>304 <span class=\"nv\">bytes</span><span class=\"o\">=</span>0 <span class=\"nv\">protocol</span><span class=\"o\">=</span>http <span class=\"nv\">tls_version</span><span class=\"o\">=</span>tls1.3\n</code></pre></div></div>\n<div class=\"code-block\" data-sourcepos=\"187:1-196:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>サブロック情報の更新.sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>Dec 15 08:00:03 sl2-api-production heroku/router\n    <span class=\"nv\">at</span><span class=\"o\">=</span>info\n    <span class=\"nv\">method</span><span class=\"o\">=</span>PATCH\n    <span class=\"nv\">path</span><span class=\"o\">=</span><span class=\"s2\">\"/v1/u/locks/7D5B383A-1102-61AF-A94B-64F9FCFC2DBC\"</span>\n    <span class=\"nv\">host</span><span class=\"o\">=</span>sl2-api.qrioinc.com\n    <span class=\"nv\">request_id</span><span class=\"o\">=</span>9aedc7a1-78fc-8455-fe04-a65292eb4e76\n    <span class=\"nv\">fwd</span><span class=\"o\">=</span><span class=\"s2\">\"147.192.85.179\"</span>\n    <span class=\"nv\">dyno</span><span class=\"o\">=</span>web.2 <span class=\"nv\">connect</span><span class=\"o\">=</span>0ms <span class=\"nv\">service</span><span class=\"o\">=</span>19ms <span class=\"nv\">status</span><span class=\"o\">=</span>200 <span class=\"nv\">bytes</span><span class=\"o\">=</span>4 <span class=\"nv\">protocol</span><span class=\"o\">=</span>http <span class=\"nv\">tls_version</span><span class=\"o\">=</span>tls1.3\n</code></pre></div></div>\n<div class=\"code-block\" data-sourcepos=\"198:1-207:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>メインロック情報の更新.sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>Dec 15 08:00:03 sl2-api-production heroku/router\n    <span class=\"nv\">at</span><span class=\"o\">=</span>info\n    <span class=\"nv\">method</span><span class=\"o\">=</span>PATCH\n    <span class=\"nv\">path</span><span class=\"o\">=</span><span class=\"s2\">\"/v1/u/locks/F4FC76D6-4412-BDA3-5447-75879BC37D5C\"</span>\n    <span class=\"nv\">host</span><span class=\"o\">=</span>sl2-api.qrioinc.com\n    <span class=\"nv\">request_id</span><span class=\"o\">=</span>a3548e5e-b138-4159-ed57-8349c663d341\n    <span class=\"nv\">fwd</span><span class=\"o\">=</span><span class=\"s2\">\"147.192.85.179\"</span>\n    <span class=\"nv\">dyno</span><span class=\"o\">=</span>web.4 <span class=\"nv\">connect</span><span class=\"o\">=</span>0ms <span class=\"nv\">service</span><span class=\"o\">=</span>39ms <span class=\"nv\">status</span><span class=\"o\">=</span>200 <span class=\"nv\">bytes</span><span class=\"o\">=</span>4 <span class=\"nv\">protocol</span><span class=\"o\">=</span>http <span class=\"nv\">tls_version</span><span class=\"o\">=</span>tls1.3\n</code></pre></div></div>\n<div class=\"code-block\" data-sourcepos=\"208:1-217:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>ログの登録①.sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>Dec 15 08:00:05 sl2-api-production heroku/router\n    <span class=\"nv\">at</span><span class=\"o\">=</span>info\n    <span class=\"nv\">method</span><span class=\"o\">=</span>POST\n    <span class=\"nv\">path</span><span class=\"o\">=</span><span class=\"s2\">\"/v1/u/logs?is_app=true\"</span>\n    <span class=\"nv\">host</span><span class=\"o\">=</span>sl2-api.qrioinc.com\n    <span class=\"nv\">request_id</span><span class=\"o\">=</span>3b6e609f-af18-a5df-06e2-f6af946696f9\n    <span class=\"nv\">fwd</span><span class=\"o\">=</span><span class=\"s2\">\"147.192.85.179\"</span>\n    <span class=\"nv\">dyno</span><span class=\"o\">=</span>web.2 <span class=\"nv\">connect</span><span class=\"o\">=</span>0ms <span class=\"nv\">service</span><span class=\"o\">=</span>100ms <span class=\"nv\">status</span><span class=\"o\">=</span>201 <span class=\"nv\">bytes</span><span class=\"o\">=</span>20 <span class=\"nv\">protocol</span><span class=\"o\">=</span>http <span class=\"nv\">tls_version</span><span class=\"o\">=</span>tls1.3\n</code></pre></div></div>\n<div class=\"code-block\" data-sourcepos=\"218:1-227:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>ログの登録②.sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>Dec 15 08:00:05 sl2-api-production heroku/router\n    <span class=\"nv\">at</span><span class=\"o\">=</span>info\n    <span class=\"nv\">method</span><span class=\"o\">=</span>POST\n    <span class=\"nv\">path</span><span class=\"o\">=</span><span class=\"s2\">\"/v1/u/logs?is_app=true\"</span>\n    <span class=\"nv\">host</span><span class=\"o\">=</span>sl2-api.qrioinc.com\n    <span class=\"nv\">request_id</span><span class=\"o\">=</span>aa08e0b5-9e07-2840-728b-2fadc7466a61\n    <span class=\"nv\">fwd</span><span class=\"o\">=</span><span class=\"s2\">\"147.192.85.179\"</span>\n    <span class=\"nv\">dyno</span><span class=\"o\">=</span>web.4 <span class=\"nv\">connect</span><span class=\"o\">=</span>0ms <span class=\"nv\">service</span><span class=\"o\">=</span>182ms <span class=\"nv\">status</span><span class=\"o\">=</span>201 <span class=\"nv\">bytes</span><span class=\"o\">=</span>20 <span class=\"nv\">protocol</span><span class=\"o\">=</span>http <span class=\"nv\">tls_version</span><span class=\"o\">=</span>tls1.3\n</code></pre></div></div>\n</details>\n<p data-sourcepos=\"231:1-231:43\"><strong>09:00 ユーザーのログ確認操作</strong></p>\n<details>\n    <summary>logs</summary>\n<div class=\"code-block\" data-sourcepos=\"237:1-248:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>サブロックのログアップロード(hubから).sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>Dec 15 09:00:41 sl2-api-production heroku/router\n    <span class=\"nv\">at</span><span class=\"o\">=</span>info\n    <span class=\"nv\">method</span><span class=\"o\">=</span>GET\n    <span class=\"nv\">path</span><span class=\"o\">=</span><span class=\"s2\">\"/v1/h/commands/log?lock_id=7d5b383a-1102-61af-a94b-64f9fcfc2dbc\n        &amp;retry_count=3\n        &amp;main_response=005e1b0000cc280043a6639a6300000000000000000000000000000000a8639a631a76bad5ec34f5b6f82473f19c76fd3cff32e8d583a9b038f7ff2324d36bb28cc0ac9c5843183e1f275e35270a1cd10fd276b9445d2811e221c8af7e50d0140e\"</span>\n    <span class=\"nv\">host</span><span class=\"o\">=</span>sl2-api.qrioinc.com\n    <span class=\"nv\">request_id</span><span class=\"o\">=</span>036642a1-c63f-d223-56f7-4b494958cb8d\n    <span class=\"nv\">fwd</span><span class=\"o\">=</span><span class=\"s2\">\"147.192.85.179\"</span>\n    <span class=\"nv\">dyno</span><span class=\"o\">=</span>web.2 <span class=\"nv\">connect</span><span class=\"o\">=</span>0ms <span class=\"nv\">service</span><span class=\"o\">=</span>39ms <span class=\"nv\">status</span><span class=\"o\">=</span>200 <span class=\"nv\">bytes</span><span class=\"o\">=</span>2 <span class=\"nv\">protocol</span><span class=\"o\">=</span>http\n</code></pre></div></div>\n<div class=\"code-block\" data-sourcepos=\"249:1-260:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>メインロックのログアップロード(hubから).sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>Dec 15 09:05:12 sl2-api-production heroku/router\n    <span class=\"nv\">at</span><span class=\"o\">=</span>info\n    <span class=\"nv\">method</span><span class=\"o\">=</span>GET\n    <span class=\"nv\">path</span><span class=\"o\">=</span><span class=\"s2\">\"/v1/h/commands/log?lock_id=f4fc76d6-4412-bda3-5447-75879bc37d5c\n        &amp;retry_count=3\n        &amp;main_response=00de1a0000cc280030b5649a6300000000000000000000000000000000b7649a630c35ec62093efb1580320013beb29a7fb9a7da3a9c3c23cc58d843cf8b9caf92e89c7967065d5870089448db93746939d6f82c30a39ddccb2965d349eae38904\"</span>\n    <span class=\"nv\">host</span><span class=\"o\">=</span>sl2-api.qrioinc.com\n    <span class=\"nv\">request_id</span><span class=\"o\">=</span>0bd8d4fb-4fa7-c51c-6b01-05610280577f\n    <span class=\"nv\">fwd</span><span class=\"o\">=</span><span class=\"s2\">\"147.192.85.179\"</span>\n    <span class=\"nv\">dyno</span><span class=\"o\">=</span>web.4 <span class=\"nv\">connect</span><span class=\"o\">=</span>0ms <span class=\"nv\">service</span><span class=\"o\">=</span>77ms <span class=\"nv\">status</span><span class=\"o\">=</span>200 <span class=\"nv\">bytes</span><span class=\"o\">=</span>460 <span class=\"nv\">protocol</span><span class=\"o\">=</span>http\n</code></pre></div></div>\n</details>\n<h4 data-sourcepos=\"264:1-264:51\">9時頃 h/commands/logのmain_responseのparse</h4>\n<p data-sourcepos=\"265:1-266:35\">9時台のhubからのgetリクエストパラメータをparseして、lock_log_idに該当するものを探す<br>\n2件あるのは2ロックのため</p>\n<p data-sourcepos=\"268:1-268:58\"><code>ReadLogResponse.parse(モックlock, main_response).logs</code></p>\n<p data-sourcepos=\"270:1-272:84\"><strong>lock_log_id: 7006,6878が得られた</strong><br>\n→それぞれ8:00の施錠と7:49の施錠の直後である<br>\n→→ということは、これより前に施錠のログは記述されていた</p>\n<details>\n    <summary>parse全文</summary>\n<div class=\"code-block\" data-sourcepos=\"277:1-296:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>hubからのリクエスト①\n<span class=\"o\">[</span><span class=\"c\">#&lt;Log:0x00007fbb1d15b640</span>\n  <span class=\"nb\">id</span>: nil,\n  lock_id: <span class=\"s2\">\"00000000-0000-0000-1111-900000000001\"</span>,\n  lock_log_id: 7006,&lt;<span class=\"nt\">-------------------------------------7006</span>は08:00の施錠ログの直後\n  log_type: <span class=\"s2\">\"debug_door_position\"</span>,\n  param1: 40,\n  param2: 0,\n  param3: 67,\n  logged_at: Thu, 15 Dec 2022 00:00:38.000000000 UTC +00:00,\n  recordable_type: nil,\n  recordable_id: <span class=\"s2\">\"00000000-0000-0000-0000-000000000000\"</span>,\n  double_lock: <span class=\"nb\">true</span>,\n  on_upside: <span class=\"nb\">true</span>,\n  user_name: nil,\n  created_at: nil,\n  updated_at: nil,\n  knight_operation_type: nil&gt;]\n</code></pre></div></div>\n<div class=\"code-block\" data-sourcepos=\"298:1-317:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>hubからのリクエスト②\n<span class=\"o\">[</span><span class=\"c\">#&lt;Log:0x00007fbb1d1faab0</span>\n  <span class=\"nb\">id</span>: nil,\n  lock_id: <span class=\"s2\">\"00000000-0000-0000-1111-900000000001\"</span>,\n  lock_log_id: 6878,&lt;<span class=\"nt\">-------------------------------------6878</span>は07:49の施錠ログの直後\n  log_type: <span class=\"s2\">\"debug_door_position\"</span>,\n  param1: 40,\n  param2: 0,\n  param3: 48,\n  logged_at: Thu, 15 Dec 2022 00:05:09.000000000 UTC +00:00,\n  recordable_type: nil,\n  recordable_id: <span class=\"s2\">\"00000000-0000-0000-0000-000000000000\"</span>,\n  double_lock: <span class=\"nb\">true</span>,\n  on_upside: <span class=\"nb\">true</span>,\n  user_name: nil,\n  created_at: nil,\n  updated_at: nil,\n  knight_operation_type: nil&gt;]\n</code></pre></div></div>\n</details>\n<h2 data-sourcepos=\"321:1-321:21\" id=\"0-5-0\" name=\"0-5-0\"><a class=\"anchor\" id=\"調査から推測\" name=\"調査から推測\" href=\"#調査から推測\" data-position=\"0-5-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"調査から推測\"> &gt; 調査から推測</span></a>調査から推測</h2>\n<ul data-sourcepos=\"323:1-325:72\">\n<li data-sourcepos=\"323:1-323:68\">上記4つのPOSTはBodyの中身がログ出力されていない</li>\n<li data-sourcepos=\"324:1-324:158\">POSTリクエストを受けてAPIはログのDBへの書き込みとWebhook送信を行うが、WebhookのログはPapertrailでは見つからなかった</li>\n<li data-sourcepos=\"325:1-325:72\">OneSignalのエラーが7:47頃出ていたが関係しているか？</li>\n</ul>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2022/12/15/136273/5b277a43-edcf-4d44-87a1-3fb7035de291.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"457\" alt=\"スクリーンショット 2022-12-15 21.57.50.png (168.8 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2022/12/15/136273/5b277a43-edcf-4d44-87a1-3fb7035de291.png\"></a>\n<h2 data-sourcepos=\"328:1-328:36\" id=\"0-6-0\" name=\"0-6-0\"><a class=\"anchor\" id=\"施錠シーケンス洗い出し\" name=\"施錠シーケンス洗い出し\" href=\"#施錠シーケンス洗い出し\" data-position=\"0-6-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"施錠シーケンス洗い出し\"> &gt; 施錠シーケンス洗い出し</span></a>施錠シーケンス洗い出し</h2>\n<p data-sourcepos=\"329:1-329:44\">施錠コマンドの発行(manoma svから)</p>\n<div class=\"code-block\" data-sourcepos=\"330:1-345:3\"><div class=\"mermaid\">sequenceDiagram\n    manoma server -&gt;&gt; king-api: POST u/commands/close;\n    king-api --&gt;&gt;king-api: key_idをもとにkeyの検索;\n    king-api --&gt;&gt;king-api: 施錠コマンドの生成;\n    king-api --&gt;&gt;king-api: コマンド生成の権限チェック;\n    king-api --&gt;&gt;king-api: 施錠コマンドからコマンドログの生成;\n    king-api -&gt;&gt; king-DB: 施錠コマンドログのINSERT;\n    king-api -&gt;&gt; PubNub: 施錠コマンドのpublish;\n    king-api -&gt;&gt; manoma server: 施錠コマンドの送信の成功とコマンドidを返却;\n    PubNub -&gt;&gt; Qrio Hub: 施錠コマンドのpublish;\n    Qrio Hub --&gt;&gt; Qrio Lock: 施錠操作;\n    Qrio Lock --&gt;&gt; Qrio Hub: 操作結果;\n    Qrio Hub -&gt;&gt; king-api: 操作結果GET h/commands;\n    manoma server -&gt;&gt; king-api: GET u/commands?command_id={command_id};</div></div>\n<div class=\"code-block\" data-sourcepos=\"347:1-354:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sql</div><div class=\"highlight\"><pre class=\"highlight sql\"><code><span class=\"k\">SELECT</span> <span class=\"n\">lock_webhook_tokens</span><span class=\"p\">.</span><span class=\"n\">id</span> <span class=\"k\">AS</span> <span class=\"n\">lid</span><span class=\"p\">,</span>\n       <span class=\"n\">webhook_tokens</span><span class=\"p\">.</span><span class=\"o\">*</span>\n<span class=\"k\">FROM</span> <span class=\"n\">lock_webhook_tokens</span>\n<span class=\"k\">JOIN</span> <span class=\"n\">webhook_tokens</span> <span class=\"k\">ON</span> <span class=\"n\">lock_webhook_tokens</span><span class=\"p\">.</span><span class=\"n\">webhook_token_id</span> <span class=\"o\">=</span> <span class=\"n\">webhook_tokens</span><span class=\"p\">.</span><span class=\"n\">id</span>\n<span class=\"k\">WHERE</span> <span class=\"n\">lock_id</span> <span class=\"k\">IN</span> <span class=\"p\">(</span><span class=\"s1\">'F4FC76D6-4412-BDA3-5447-75879BC37D5C'</span><span class=\"p\">,</span>\n                  <span class=\"s1\">'7D5B383A-1102-61AF-A94B-64F9FCFC2DBC'</span><span class=\"p\">);</span>\n</code></pre></div></div>\n<p data-sourcepos=\"358:1-358:44\">解錠ログがSnc(manoma)側に届かない</p>\n<p data-sourcepos=\"360:1-365:62\">施錠ログは届いている<br>\n→その施錠時にhub経由かBLEでlock内にあるログがking-apiに送信されるはず<br>\n→hub経由での施錠ログがking-apiログ上にない<br>\n→Command_logsも該当するリモートコマンドログがDBにない<br>\n→POST u/commands/closeが履歴にない<br>\n→BLEでの施錠である(スマホアプリかmanoma AIHGW)</p>\n<p data-sourcepos=\"367:1-374:73\">BLEでの施錠時、ログをDBに保管などするのは<code>POST u/logs</code><br>\n→Bodyが見られないので正しいlock_responseが届いているかは検証不可<br>\n→DBに解錠と施錠のログ登録はある。登録時刻created_atも施錠時刻とほぼ同時<br>\n→上記登録に係るメソッド<code>Log.import_and_push(logs)</code>はcastle/kagicanに送信している→×<br>\n→<code>lock.tokens.each(&amp;:sync_lock_state_job!) unless logs.all?(&amp;:communication_error?)</code><br>\n→→lockの最終解施錠の状態を、lockの持つ各プラットフォームに送信している→×<br>\n→<code>.try(:notification).try(:notify!)</code>はOneSignal経由で通知を送信している<br>\n→lib/one_signalのnotify!ではfiltersに<code>user.id</code>を指定している</p>\n<p data-sourcepos=\"376:1-381:55\">Hub経由でのログ登録リクエストは、7:49と8:00の施錠操作時点では届いていない<br>\n→リモートコマンドログもDBにない<br>\n→POST u/logsのlock_responseはログに出ていない<br>\n→sync_lock_state_job!かtry(:notification).try(:notify!)のどちらかでこけている<br>\n→webhookなのはsync_lock_state_job<br>\n→invalid_grantなどのエラーが常時出ている</p>\n",
    "created_at": "2022-12-15T21:58:11+09:00",
    "message": "Update post.",
    "kind": "flow",
    "comments_count": 1,
    "tasks_count": 0,
    "done_tasks_count": 0,
    "url": "https://qrio.esa.io/posts/1470",
    "updated_at": "2023-07-18T10:48:49+09:00",
    "tags": [],
    "category": "Users/杉山/その他",
    "revision_number": 6,
    "created_by": {
      "myself": false,
      "name": "杉山聡",
      "screen_name": "satoshi_sugiyama",
      "icon": "https://img.esa.io/uploads/production/members/129432/icon/thumb_m_4589e2842b9d87757c7c9db07c45c00d.jpg"
    },
    "updated_by": {
      "myself": false,
      "name": "杉山聡",
      "screen_name": "satoshi_sugiyama",
      "icon": "https://img.esa.io/uploads/production/members/129432/icon/thumb_m_4589e2842b9d87757c7c9db07c45c00d.jpg"
    },
    "stargazers_count": 0,
    "watchers_count": 1,
    "star": false,
    "watch": false,
    "sharing_urls": null
  },
  {
    "number": 1508,
    "name": "リモート解施錠シーケンス備忘録",
    "full_name": "Users/杉山/その他/リモート解施錠シーケンス備忘録",
    "wip": false,
    "body_md": "# リモート解錠シーケンス\r\n\r\n```mermaid\r\nsequenceDiagram\r\nautonumber\r\nCU->>King-api:解施錠リクエスト;\r\nNote right of CU: POST \"u/commands/open\";\r\nNote right of CU: body:KeyId;\r\nKing-api->>Database:key=find_key(params[:key_id]);\r\nDatabase->>King-api:key;\r\nKing-api->>King-api:command=LockCommand.open(key);\r\nKing-api->>King-api:authorize command, :create?;\r\nKing-api->>Database:command.create_log!;\r\nCU-->>PubNub:Subscribe開始;\r\nKing-api->>PubNub:succeeded=command.publish!;\r\nNote right of King-api: POST \"/publish/{pub_key}/{sub_key}/0/{channel}/0\";\r\nNote right of King-api: body:type, now, main, sub, url;\r\nKing-api->>CU:{ succeeded: succeeded, command_id: command.id };\r\nPubNub->>Hub:解施錠コマンド送信;\r\nNote right of PubNub: body:type, now, main, sub, url;\r\nHub->>Lock:BLE解施錠操作;\r\nLock->>Lock:lock_log_id + 1;\r\nLock-->Hub:アドバタイズ;\r\nrect rgba(255,255,127,255)\r\nHub->>King-api:パケット(lockのadvertise)送信;\r\nNote left of Hub: GET \"packets/packets\";\r\nNote left of Hub: 上記のbase URLはHub FWにハードコーディング;\r\nNote left of Hub: 自己環境ではHub FW書き換えが必要;\r\nKing-api->>King-api:packetのバリデーション;\r\nKing-api->>PubNub:ReadLogCommand.new.publish!;\r\nNote right of King-api:hex(TYPE_SINGLE, now, main, sub, url)\r\nPubNub->>Hub:ログ;\r\nNote right of PubNub:hex(TYPE_SINGLE, now, main, sub, url)\r\nHub->>King-api:ログ;\r\nNote left of Hub:\"GET h/commands/log\";\r\nNote left of Hub:hex(TYPE_SINGLE, now, main, sub, url)\r\nNote left of Hub:25で届いたurlに送る(API_SERVER_URL);\r\nKing-api->>King-api:ログ書き込み;\r\nend\r\nHub->>King-api:結果返信;\r\nNote left of Hub:GET \"h/commands/{command_id}/single?user_id・・・\";\r\nNote left of Hub:上記はKing-apiの環境変数API_URLを利用(③で受信しているURL);\r\nNote left of Hub:main_response/sub_responseを返却;\r\nKing-api->>Database:command=CommandLog.find(params[:user_id]);\r\nDatabase->>King-api:command;\r\nKing-api->>King-api:main_response=verify_response!;\r\nKing-api->>Database:command.update!(main_response);\r\nKing-api->>Database:user=user.find(user_id);\r\nDatabase->>King-api:user;\r\nKing-api->>PubNub:command.notification.publish!(user);\r\nNote right of King-api: POST \"/publish/{pub_key}/{sub_key}/0/{channel}/0\"\r\nNote right of King-api: main_response/sub_response ;\r\nPubNub->>CU:結果返信;\r\nNote left of PubNub: main_response/sub_response ;\r\nCU-->>PubNub:Subscribe終了;\r\n\r\n```\r\n\r\n忘れるな",
    "body_html": "<h1 data-sourcepos=\"1:1-1:35\" id=\"1-0-0\" name=\"1-0-0\"><a class=\"anchor\" id=\"リモート解錠シーケンス\" name=\"リモート解錠シーケンス\" href=\"#リモート解錠シーケンス\" data-position=\"1-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"リモート解錠シーケンス\"> &gt; リモート解錠シーケンス</span></a>リモート解錠シーケンス</h1>\n<div class=\"code-block\" data-sourcepos=\"3:1-57:3\"><div class=\"mermaid\">sequenceDiagram\nautonumber\nCU-&gt;&gt;King-api:解施錠リクエスト;\nNote right of CU: POST \"u/commands/open\";\nNote right of CU: body:KeyId;\nKing-api-&gt;&gt;Database:key=find_key(params[:key_id]);\nDatabase-&gt;&gt;King-api:key;\nKing-api-&gt;&gt;King-api:command=LockCommand.open(key);\nKing-api-&gt;&gt;King-api:authorize command, :create?;\nKing-api-&gt;&gt;Database:command.create_log!;\nCU--&gt;&gt;PubNub:Subscribe開始;\nKing-api-&gt;&gt;PubNub:succeeded=command.publish!;\nNote right of King-api: POST \"/publish/{pub_key}/{sub_key}/0/{channel}/0\";\nNote right of King-api: body:type, now, main, sub, url;\nKing-api-&gt;&gt;CU:{ succeeded: succeeded, command_id: command.id };\nPubNub-&gt;&gt;Hub:解施錠コマンド送信;\nNote right of PubNub: body:type, now, main, sub, url;\nHub-&gt;&gt;Lock:BLE解施錠操作;\nLock-&gt;&gt;Lock:lock_log_id + 1;\nLock--&gt;Hub:アドバタイズ;\nrect rgba(255,255,127,255)\nHub-&gt;&gt;King-api:パケット(lockのadvertise)送信;\nNote left of Hub: GET \"packets/packets\";\nNote left of Hub: 上記のbase URLはHub FWにハードコーディング;\nNote left of Hub: 自己環境ではHub FW書き換えが必要;\nKing-api-&gt;&gt;King-api:packetのバリデーション;\nKing-api-&gt;&gt;PubNub:ReadLogCommand.new.publish!;\nNote right of King-api:hex(TYPE_SINGLE, now, main, sub, url)\nPubNub-&gt;&gt;Hub:ログ;\nNote right of PubNub:hex(TYPE_SINGLE, now, main, sub, url)\nHub-&gt;&gt;King-api:ログ;\nNote left of Hub:\"GET h/commands/log\";\nNote left of Hub:hex(TYPE_SINGLE, now, main, sub, url)\nNote left of Hub:25で届いたurlに送る(API_SERVER_URL);\nKing-api-&gt;&gt;King-api:ログ書き込み;\nend\nHub-&gt;&gt;King-api:結果返信;\nNote left of Hub:GET \"h/commands/{command_id}/single?user_id・・・\";\nNote left of Hub:上記はKing-apiの環境変数API_URLを利用(③で受信しているURL);\nNote left of Hub:main_response/sub_responseを返却;\nKing-api-&gt;&gt;Database:command=CommandLog.find(params[:user_id]);\nDatabase-&gt;&gt;King-api:command;\nKing-api-&gt;&gt;King-api:main_response=verify_response!;\nKing-api-&gt;&gt;Database:command.update!(main_response);\nKing-api-&gt;&gt;Database:user=user.find(user_id);\nDatabase-&gt;&gt;King-api:user;\nKing-api-&gt;&gt;PubNub:command.notification.publish!(user);\nNote right of King-api: POST \"/publish/{pub_key}/{sub_key}/0/{channel}/0\"\nNote right of King-api: main_response/sub_response ;\nPubNub-&gt;&gt;CU:結果返信;\nNote left of PubNub: main_response/sub_response ;\nCU--&gt;&gt;PubNub:Subscribe終了;\n</div></div>\n<p data-sourcepos=\"59:1-59:12\">忘れるな</p>\n",
    "created_at": "2023-01-17T10:54:01+09:00",
    "message": "Update post.",
    "kind": "stock",
    "comments_count": 1,
    "tasks_count": 0,
    "done_tasks_count": 0,
    "url": "https://qrio.esa.io/posts/1508",
    "updated_at": "2023-07-18T10:48:03+09:00",
    "tags": [],
    "category": "Users/杉山/その他",
    "revision_number": 11,
    "created_by": {
      "myself": false,
      "name": "杉山聡",
      "screen_name": "satoshi_sugiyama",
      "icon": "https://img.esa.io/uploads/production/members/129432/icon/thumb_m_4589e2842b9d87757c7c9db07c45c00d.jpg"
    },
    "updated_by": {
      "myself": false,
      "name": "杉山聡",
      "screen_name": "satoshi_sugiyama",
      "icon": "https://img.esa.io/uploads/production/members/129432/icon/thumb_m_4589e2842b9d87757c7c9db07c45c00d.jpg"
    },
    "stargazers_count": 0,
    "watchers_count": 1,
    "star": false,
    "watch": false,
    "sharing_urls": null
  },
  {
    "number": 1626,
    "name": "production-aurora作成実施履歴",
    "full_name": "Users/杉山/Database/production-aurora作成実施履歴",
    "wip": false,
    "body_md": "# 手順書\r\nhttps://docs.google.com/spreadsheets/d/1W3DymCJ_ifiXtSUwVAjcl9tzPGfz5WE6bmnnwYL9Gbo/edit#gid=1297114524\r\n\r\n## 2_Herokuのbucardoスキーマ削除\r\n### 手順\r\nEC2から\r\n```sh\r\npsql -h vpce-07e26665ccbc39113-l2zl675x.vpce-svc-0de703034cbfc279a.ap-northeast-1.vpce.amazonaws.com \\\r\n    -p 5432 -d dncvsso7me9p6 -U ubev937lfpa1d3 -c \"DROP SCHEMA bucardo CASCADE;\"\r\n```\r\n\r\n### 実行後\r\n```sh\r\nNOTICE:  drop cascades to 29 other objects\r\nDETAIL:  drop cascades to function bucardo.bucardo_tablename_maker(text)\r\ndrop cascades to function bucardo.bucardo_tablename_maker(text,text)\r\ndrop cascades to function bucardo.bucardo_delta_names_helper()\r\ndrop cascades to function bucardo.bucardo_delta_check(text,text)\r\ndrop cascades to function bucardo.bucardo_note_truncation()\r\ndrop cascades to trigger bucardo_note_trunc_sync_heroku_aws on table display_logs\r\ndrop cascades to trigger bucardo_note_trunc_sync_heroku_aws on table logs\r\ndrop cascades to function bucardo.bucardo_compress_delta(text,text)\r\ndrop cascades to function bucardo.bucardo_compress_delta(text)\r\ndrop cascades to function bucardo.bucardo_compress_delta(oid)\r\ndrop cascades to function bucardo.bucardo_purge_delta_oid(text,oid)\r\ndrop cascades to function bucardo.bucardo_purge_delta(text)\r\ndrop cascades to function bucardo.bucardo_purge_sync_track(text)\r\ndrop cascades to function bucardo.bucardo_kick_sync_heroku_aws()\r\ndrop cascades to trigger bucardo_kick_sync_heroku_aws on table display_logs\r\ndrop cascades to trigger bucardo_kick_sync_heroku_aws on table logs\r\ndrop cascades to table bucardo.bucardo_delta_names\r\ndrop cascades to table bucardo.bucardo_delta_targets\r\ndrop cascades to table bucardo.bucardo_truncate_trigger\r\ndrop cascades to table bucardo.bucardo_truncate_trigger_log\r\ndrop cascades to table bucardo.bucardo_sequences\r\ndrop cascades to table bucardo.delta_public_display_logs\r\ndrop cascades to function bucardo.delta_public_display_logs()\r\ndrop cascades to table bucardo.track_public_display_logs\r\ndrop cascades to table bucardo.stage_public_display_logs\r\ndrop cascades to table bucardo.delta_public_logs\r\ndrop cascades to function bucardo.delta_public_logs()\r\ndrop cascades to table bucardo.track_public_logs\r\ndrop cascades to table bucardo.stage_public_logs\r\nDROP SCHEMA\r\n```\r\n\r\n## 3_auroraのインスタンスタイプ戻し\r\n\r\n### 手順\r\ndb.r5.24xlarge→db.r5.2xlarge\r\n\r\n### 実行後\r\n約10分で終わった\r\n\r\n<img width=\"806\" alt=\"スクリーンショット 2023-04-17 11.49.55.png (110.5 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/17/136273/4c003e49-23dc-4c46-acfd-577b69c063bc.png\">\r\n<img width=\"291\" alt=\"スクリーンショット 2023-04-17 11.51.03.png (16.2 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/17/136273/fcf93df6-2c0e-4940-af0c-963f5bfcc014.png\">\r\n<img width=\"1369\" alt=\"スクリーンショット 2023-04-17 12.03.48.png (48.1 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/17/136273/12a2e8f8-86d7-4ef4-a9d8-3456821071ba.png\">\r\n\r\n## 4_ドリフトチェックと対処\r\n\r\n### 手順\r\nドリフトの検出→必要であればリソースを戻す\r\n\r\n### 実行後\r\n\r\n#### bucardoスタック\r\n<img width=\"1245\" alt=\"スクリーンショット 2023-04-17 11.52.44.png (170.2 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/17/136273/fd998304-ec3b-4754-bf33-5fa8c1950412.png\">\r\n手動で追加したipを削除する\r\n<img width=\"1851\" alt=\"スクリーンショット 2023-04-17 11.53.10.png (107.4 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/17/136273/4d112956-2971-4027-b11e-386210c02c77.png\">\r\n\r\n<img width=\"1625\" alt=\"スクリーンショット 2023-04-17 11.53.40.png (186.9 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/17/136273/3f57b50e-50c8-44b1-81b6-c50787d94e9a.png\">\r\n\r\n#### auroraスタック\r\ncfn_deleteで修正できる範囲と認識しているのでOK\r\n<img width=\"1596\" alt=\"スクリーンショット 2023-04-17 12.08.04.png (211.1 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/17/136273/9bf6fe76-5e4c-4736-83ed-415df9e3cea8.png\">\r\n\r\n## 5_cloudformationのスタック削除\r\n\r\n### 手順\r\n```sh\r\nsh ./local_scripts/cfn_delete.sh ./config/production.env sl2-api-production\r\n```\r\n\r\n### 実行後\r\n```sh\r\nsh ./local_scripts/cfn_delete.sh ./config/production.env sl2-api-production                                                                                                           12:10:27\r\nスタック名:king-api-aurora-production-base-stack\r\nスタック名:king-api-production-bucardo-stack\r\n\r\n[**入力]上記スタックを削除しますか？(y/n)y\r\n0.事前準備------------------------\r\n1.PrivateLinkの削除------------------------\r\nVPCエンドポイント: vpce-07e26665ccbc39113 \r\nVPCエンドポイントの削除開始\r\n削除結果\r\n2.EC2スタックの削除------------------------\r\nking-api-production-bucardo-stackを削除しています...\r\nking-api-production-bucardo-stackの削除を待機しています...\r\nking-api-production-bucardo-stackの削除を待機しています...\r\nking-api-production-bucardo-stackの削除を待機しています...\r\n\r\nAn error occurred (ValidationError) when calling the DescribeStacks operation: Stack with id king-api-production-bucardo-stack does not exist\r\nking-api-production-bucardo-stackを削除しました\r\n3.VPCピアリングの削除------------------------\r\n4.Auroraスタックの削除------------------------\r\nking-api-aurora-production-base-stackを削除しています...\r\nking-api-aurora-production-base-stackの削除を待機しています...\r\nking-api-aurora-production-base-stackの削除を待機しています...\r\nking-api-aurora-production-base-stackの削除を待機しています...\r\nking-api-aurora-production-base-stackの削除を待機しています...\r\nking-api-aurora-production-base-stackの削除を待機しています...\r\nking-api-aurora-production-base-stackの削除を待機しています...\r\nking-api-aurora-production-base-stackの削除を待機しています...\r\nking-api-aurora-production-base-stackの削除を待機しています...\r\nking-api-aurora-production-base-stackの削除を待機しています...\r\nking-api-aurora-production-base-stackを削除しました\r\n```\r\n\r\n## PRDリソースの作成\r\n\r\n### 手順\r\n```sh\r\nsh ./local_scripts/01_cfn_deploy.sh ./config/production.env\r\n```\r\n\r\n### 実行後\r\n\r\n```sh\r\nsh ./local_scripts/01_cfn_deploy.sh ./config/production.env                                                                                                                           12:35:23\r\n---------------------------------\r\nCloudFormationへデプロイします。\r\n        01_cfn_deploy.sh\r\n---------------------------------\r\nmkdir: ./tmp: File exists\r\nスタック名:king-api-aurora-production-base-stack\r\nEC2 Bucardoスタック名: king-api-production-bucardo-stack\r\n\r\n[**入力]パラメータをインポートしますか？(y/n)y\r\nYES - パラメータの確認に進みます\r\n-------------入力終了------------\r\n- 入力内容の確認をします。\r\n---------------------------------\r\n- ベーススタック名(VPC/Aurora): king-api-aurora-production-base-stack\r\n- VPC名前タグ: king-api-aurora-production-vpc\r\n- VPC CIDR範囲: 172.30.0.0/16\r\n- Aurora データベース名: king-api-production\r\n- Aurora プライマリ名前タグ: king-api-production\r\n- Aurora レプリカ名前タグ: king-api-production-replica\r\n- Aurora インスタンスクラス: db.r5.2xlarge\r\n---------------------------------\r\n- EC2 Bucardoスタック名: king-api-production-bucardo-stack\r\n- EC2 Bucardoインスタンス名前タグ: king-api-production-bucardo-ec2\r\n- EC2 Bucardoインスタンスタイプ : i3.2xlarge\r\n- EC2 BucardoEBSボリュームサイズ: 64\r\n- EC2 BucardoイメージID: ami-0e2bf1ada70fd3f33\r\n- EC2 外部接続許可IPアドレス: 39.110.207.11/32\r\n---------------------------------\r\n---------------------------------\r\n[**入力] デプロイします。よろしいですか？(y/n): y\r\nYES - ベーススタックのデプロイを開始します。\r\n\r\nWaiting for changeset to be created..\r\nWaiting for stack create/update to complete\r\nSuccessfully created/updated stack - king-api-aurora-production-base-stack\r\nbucardoスタックのデプロイを開始します。\r\n\r\nWaiting for changeset to be created..\r\nWaiting for stack create/update to complete\r\nSuccessfully created/updated stack - king-api-production-bucardo-stack\r\nデプロイコマンドが終了しました。\r\n実行結果の確認をします\r\nベーススタック: king-api-aurora-production-base-stack\r\n状態: CREATE_COMPLETE\r\nEC2スタック: king-api-production-bucardo-stack\r\n状態: CREATE_COMPLETE\r\n確認が完了しました。作成成功です\r\n```\r\n\r\n## 8_Private Linkの作成\r\n\r\n### 手順\r\n```sh\r\nsh ./local_scripts/02_create_private_link.sh ./config/production.env sl2-api-production\r\n```\r\n\r\n### 実行後\r\n```sh\r\nsh ./local_scripts/02_create_private_link.sh ./config/production.env sl2-api-production                                                                                               13:13:29\r\n0.事前準備------------------------\r\nHeroku CLI data:privatelink インストール済み\r\n1.Heroku側のPrivateLinkエンドポイントの作成------------------------\r\nCreating privatelink endpoint... done\r\n\r\nService Name: com.amazonaws.vpce.ap-northeast-1.vpce-svc-0de703034cbfc279a\r\nStatus:       Operational\r\n\r\nThe privatelink endpoint is now being provisioned for postgresql-objective-43050.\r\nRun heroku data:privatelink:wait postgresql-objective-43050 --app sl2-api-production to check the creation process.\r\nWaiting for the privatelink endpoint to be provisioned... done\r\n2.AWS側VPCエンドポイントの作成------------------------\r\nvpce_state= pendingAcceptance\r\nPrivateLink用AWS VPCエンドポイントの作成が完了していません。1分後に再チェックします\r\nvpce_state= available\r\nmkdir: cred: File exists\r\nEC2からHeroku PostgresへのPrivate Linkが確立されました。\r\n3.HerokuDBへのPrivate接続情報取得------------------------\r\n※ 10分ほどでタイムアウトします。タイムアウトした場合は再度当スクリプトを実行してください。\r\n[heroku]PrivateLink用VPCエンドポイントの作成が完了していません。1分後に再チェックします\r\n※ 10分ほどでタイムアウトします。タイムアウトした場合は再度当スクリプトを実行してください。\r\n[heroku]PrivateLink用VPCエンドポイントの作成が完了していません。1分後に再チェックします\r\n※ 10分ほどでタイムアウトします。タイムアウトした場合は再度当スクリプトを実行してください。\r\n4.スクリプト全体の合否判定------------------------\r\nチェック項目1.Heroku側のPrivateLinkエンドポイントの作成\r\n- 成功\r\nチェック項目2.AWS側VPCエンドポイントの作成\r\n- 成功\r\nチェック項目3.HerokuDBへのPrivate接続情報取得\r\n- 成功\r\n総合判定\r\n全てのチェックが合格しました。\r\nスクリプトを終了します。\r\n```\r\n\r\n## 9_VPC Peeringの作成\r\n\r\n### 手順\r\n```sh\r\nsh ./local_scripts/03_create_vpc_peering.sh ./config/production.env\r\n```\r\n\r\n### 実行後\r\n```sh\r\nsh ./local_scripts/03_create_vpc_peering.sh ./config/production.env                                                                                                                   13:41:57\r\n0.事前準備------------------------\r\nHeroku Private Space情報の取得\r\n1.AWSでVPC Peeringを作成------------------------\r\n2.Heroku側にリクエストが届いているか確認------------------------\r\n※実行には5〜10分ほど時間がかかります(ループで確認します)\r\nHeroku側でVPC Peeringが検知できていません 1分後に再試行します\r\n3.Heroku側からピアリングの承諾------------------------\r\nAccepting and configuring peering connection pcx-015f321136da1a68f\r\n4.AWS Aurora RouteTableにルート追加------------------------\r\n5.スクリプト全体の合否判定------------------------\r\nチェック項目1.AWSでVPC Peeringを作成\r\nactive\r\n- 成功\r\nチェック項目2.Heroku側からピアリングの承諾\r\n +Heroku側でVPC Peeringリクエストが届いているか確認(実行項目の2と3)\r\n- 成功\r\nチェック項目3.AWS Aurora RouteTableにルート追加(実行項目の4)\r\n- 成功\r\n総合判定\r\n全てのチェックが合格しました。\r\nスクリプトを終了します。\r\n```\r\n\r\n## 10_EC2接続準備\r\n\r\n### 手順\r\n```sh\r\nsh ./local_scripts/04_ec2_login.sh ./config/production.env sl2-api-production\r\n```\r\n### 実行後\r\n```sh\r\nsh ./local_scripts/04_ec2_login.sh ./config/production.env sl2-api-production                                                                                                         13:57:21\r\n1.各DBの接続情報ファイルを作成------------------------\r\n2.EC2にDBの接続情報ファイルを送信------------------------\r\nThe authenticity of host 'ec2-52-197-147-182.ap-northeast-1.compute.amazonaws.com (52.197.147.182)' cant be established.\r\nED25519 key fingerprint is SHA256:h7nZIgJfpXhs646YwNBAhYXArbpjJExVuSOk0bPQnng.\r\nThis key is not known by any other names\r\nAre you sure you want to continue connecting (yes/no/[fingerprint])? yes\r\nWarning: Permanently added 'ec2-52-197-147-182.ap-northeast-1.compute.amazonaws.com' (ED25519) to the list of known hosts.\r\nking-api-production.env                                                                                                                                        100%  629    41.4KB/s   00:00    \r\n3.EC2にsshでログイン-------------------\r\nEC2(ec2-52-197-147-182.ap-northeast-1.compute.amazonaws.com)に[king-api-production.env]を送信しました。\r\n以後はsshにて接続し以下のコマンドを入力します。\r\n----1.--------------------------------------------------------\r\n[EC2] sudo docker ps\r\n出てきたCONTAINER_IDの値を格納すると楽です\r\ncontainer=************ (docker psの結果を*にコピペ)\r\n----2.--------------------------------------------------------\r\n(検証環境の場合)\r\nec2接続のみの場合は下記コマンドは不要です\r\n[EC2] sudo docker cp ~/king-api-cfn-test.env $container:/.\r\n----3.--------------------------------------------------------\r\n[EC2] sudo docker exec -it --user root $container sh \r\n----4.--------------------------------------------------------\r\nec2接続のみの場合は下記コマンドは不要です\r\n[Dockerコンテナ内] bash 05_table_migration_dump_restore.sh king-api-production.env\r\n----------------------------------------------\r\n以降sshにて接続されます。遷移後、上記コマンドを入力してください\r\nWelcome to Ubuntu 22.04.1 LTS (GNU/Linux 5.15.0-1026-aws x86_64)\r\n\r\n * Documentation:  https://help.ubuntu.com\r\n * Management:     https://landscape.canonical.com\r\n * Support:        https://ubuntu.com/advantage\r\n\r\n  System information as of Mon Apr 17 04:57:30 UTC 2023\r\n\r\n  System load:  0.080078125       Processes:                171\r\n  Usage of /:   4.3% of 61.84GB   Users logged in:          0\r\n  Memory usage: 1%                IPv4 address for docker0: 172.17.0.1\r\n  Swap usage:   0%                IPv4 address for ens3:    172.30.3.25\r\n\r\n\r\n106 updates can be applied immediately.\r\n55 of these updates are standard security updates.\r\nTo see these additional updates run: apt list --upgradable\r\n\r\n\r\nTo run a command as administrator (user \"root\"), use \"sudo <command>\".\r\nSee \"man sudo_root\" for details.\r\n\r\nubuntu@ip-172-30-3-25:~$\r\n```\r\n\r\n## 11_以下手順のパラメータを修正\r\n\r\n手順書のコマンドを修正する\r\n\r\nHerokuDBエンドポイント\r\n<img width=\"523\" alt=\"スクリーンショット 2023-04-17 14.05.55.png (61.7 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/17/136273/aec00340-aeb4-4353-80d1-1aa5ec3da34a.png\">\r\nAuroraパスワード\r\n<img width=\"525\" alt=\"スクリーンショット 2023-04-17 14.08.44.png (75.3 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/17/136273/dc9fd8d0-41b2-408c-9319-fd77249e8564.png\">\r\nコンテナID\r\n<img width=\"519\" alt=\"スクリーンショット 2023-04-17 14.10.07.png (59.0 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/17/136273/f0f8aa21-a767-4968-87f3-f05d79fcae3c.png\">\r\nEC2エンドポイント\r\n\r\n<img width=\"522\" alt=\"スクリーンショット 2023-04-17 14.10.59.png (64.1 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/17/136273/2c916282-3938-486c-9ee8-946b0dcc0538.png\">\r\n\r\n## 12_パラメータグループの作成\r\n\r\n前回のパラメータグループは削除してから再度作成しました\r\n\r\n### 手順\r\n\r\nパラメータグループ`king-api-production-parametergroup`をコピーし、名前を\r\n`king-api-production-parametergroup-session-replication-role-replica`にする。\r\n→`session_replication_role`の値を`replica`にして保存\r\n\r\n### 実行後\r\n\r\n<img width=\"1324\" alt=\"スクリーンショット 2023-04-17 14.14.53.png (61.2 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/17/136273/54fcb793-4d28-4648-adf1-afc455bcbf15.png\">\r\n<img width=\"1085\" alt=\"スクリーンショット 2023-04-17 14.16.00.png (94.2 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/17/136273/7dbb2301-0c8e-4e65-8583-271086781280.png\">\r\n<img width=\"1371\" alt=\"スクリーンショット 2023-04-17 14.16.21.png (95.6 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/17/136273/1186ca84-6c6f-4be8-a460-6af6eede643d.png\">\r\n\r\n## 13_事前準備(pemファイルの取得)\r\n\r\n### 手順\r\n\r\n```sh\r\nkey_pair_id=(`aws ec2 describe-key-pairs \\\r\n        --key-name king-api-production-bucardo-ec2 \\\r\n        --query \"KeyPairs[].KeyPairId\" \\\r\n        --output text`)\r\naws ssm get-parameter --name /ec2/keypair/$key_pair_id \\\r\n        --with-decryption --output text \\\r\n        --query \"Parameter.Value\" >king-api-production-bucardo-ec2.pem\r\nchmod 0600 king-api-production-bucardo-ec2.pem\r\n```\r\n### 実行後\r\n```sh\r\n-rw-------    1 sugiyamasatoshi  staff      1675  4 17 14:19 king-api-production-bucardo-ec2.pem\r\n```\r\n\r\n## 14_事前準備(count.shのコピー)\r\n\r\n### 手順\r\n```sh\r\n以下のスクリプトをcount.shとしておいておく\r\n#!/bin/bash\r\n\r\n# 配列を定義する\r\nmy_array=(\"active_storage_attachments\" \"active_storage_blobs\" \"active_storage_variant_records\" \"ar_internal_metadata\" \"autolock_schedules\" \"command_logs\" \"dailies\" \"delayed_jobs\" \"display_logs\" \"door_mode_changed_histories\" \"durations\" \"entrance_block_fob_keys\" \"entrance_block_knight_cards\" \"entrance_fob_keys\" \"entrance_invitations\" \"entrance_knight_keys\" \"entrance_knight_pins\" \"entrance_lock_settings\" \"entrance_locks\" \"entrance_master_keys\" \"entrance_resident_guest_keys\" \"entrance_resident_keys\" \"family_keys\" \"fob_keys\" \"fobs\" \"guest_keys\" \"hubs\" \"invitations\" \"json_web_keys\" \"knight_cards\" \"knight_commands\" \"knight_keys\" \"knight_logs\" \"knight_pins\" \"knights\" \"laresia_pins\" \"lock_settings\" \"lock_webhook_tokens\" \"locks\" \"logs\" \"managers\" \"master_keys\" \"mst_display_logs\" \"relationships\" \"resident_guest_keys\" \"resident_keys\" \"schema_migrations\" \"term_of_validities\" \"users\" \"webhook_tokens\" \"webhooks\" \"weeklies\" \"wena_keys\" \"wenas\")\r\n\r\n# 配列の要素を1つずつ表示する\r\nfor element in \"${my_array[@]}\"\r\ndo\r\n    echo \"# $element\"\r\n    echo \"heroku\"\r\n    psql -h vpce-0bed708f6ce21788a-f4tmby1p.vpce-svc-0de703034cbfc279a.ap-northeast-1.vpce.amazonaws.com -p 5432 -d dncvsso7me9p6 -U ubev937lfpa1d3 -c \"select count(*) from $element;\"\r\n    echo \"AWS\"\r\n    psql -h king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com -p 5432 -d kingapi -U kingadmin -c \"select count(*) from $element;\"\r\ndone\r\n```\r\n```sh\r\n> local\r\nscp -i \"king-api-production-bucardo-ec2.pem\" count.sh ubuntu@ec2-52-197-147-182.ap-northeast-1.compute.amazonaws.com:/home/ubuntu/\r\n\r\n> ec2\r\nsudo docker cp count.sh 10cf28189a1f:/\r\n```\r\n### 実行後\r\n```sh\r\n# sugiyamasatoshi @ sugiyamasatoshinoMacBook-Pro in ~ [14:19:12]\r\n$ touch count.sh                                                                          \r\n# sugiyamasatoshi @ sugiyamasatoshinoMacBook-Pro in ~ [14:21:52]\r\n$ vim count.sh\r\n```\r\n```vim\r\n#!/bin/bash\r\n\r\n# 配列を定義する\r\nmy_array=(\"active_storage_attachments\" \"active_storage_blobs\" \"active_storage_variant_records\" \"ar_internal_metadata\" \"autolock_schedules\" \"command_logs\" \"dailies\" \"delayed_jobs\" \"display_logs\" \"door_mode_changed_histories\" \"durations\" \"entrance_block_fob_keys\" \"entrance_block_knight_cards\" \"entrance_fob_keys\" \"entrance_invitations\" \"entrance_knight_keys\" \"entrance_knight_pins\" \"entrance_lock_settings\" \"entrance_locks\" \"entrance_master_keys\" \"entrance_resident_guest_keys\" \"entrance_resident_keys\" \"family_keys\" \"fob_keys\" \"fobs\" \"guest_keys\" \"hubs\" \"invitations\" \"json_web_keys\" \"knight_cards\" \"knight_commands\" \"knight_keys\" \"knight_logs\" \"knight_pins\" \"knights\" \"laresia_pins\" \"lock_settings\" \"lock_webhook_tokens\" \"locks\" \"logs\" \"managers\" \"master_keys\" \"mst_display_logs\" \"relationships\" \"resident_guest_keys\" \"resident_keys\" \"schema_migrations\" \"term_of_validities\" \"users\" \"webhook_tokens\" \"webhooks\" \"weeklies\" \"wena_keys\" \"wenas\")\r\n\r\n# 配列の要素を1つずつ表示する\r\nfor element in \"${my_array[@]}\"\r\ndo\r\n    echo \"# $element\"\r\n    echo \"heroku\"\r\n    psql -h vpce-0bed708f6ce21788a-f4tmby1p.vpce-svc-0de703034cbfc279a.ap-northeast-1.vpce.amazonaws.com -p 5432 -d dncvsso7me9p6 -U ubev937lfpa1d3 -c \"select count(*) from $element;\"\r\n    echo \"AWS\"\r\n    psql -h king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com -p 5432 -d kingapi -U kingadmin -c \"select count(*) from $element;\"\r\ndone\r\n\r\n~\r\n\"count.sh\" 15L, 1459B written\r\n```\r\n\r\n```sh\r\nscp -i \"king-api-production-bucardo-ec2.pem\" count.sh ubuntu@ec2-52-197-147-182.ap-northeast-1.compute.amazonaws.com:/home/ubuntu/\r\ncount.sh                              100% 1459    82.2KB/s   00:00\r\n\r\n\r\nssh -i \"king-api-production-bucardo-ec2.pem\" ubuntu@ec2-52-197-147-182.ap-northeast-1.compute.amazonaws.com\r\nWelcome to Ubuntu 22.04.1 LTS (GNU/Linux 5.15.0-1026-aws x86_64)\r\n\r\n * Documentation:  https://help.ubuntu.com\r\n * Management:     https://landscape.canonical.com\r\n * Support:        https://ubuntu.com/advantage\r\n\r\n  System information as of Mon Apr 17 05:23:22 UTC 2023\r\n\r\n  System load:  0.0390625         Processes:                172\r\n  Usage of /:   4.3% of 61.84GB   Users logged in:          1\r\n  Memory usage: 0%                IPv4 address for docker0: 172.17.0.1\r\n  Swap usage:   0%                IPv4 address for ens3:    172.30.3.25\r\n\r\n\r\n106 updates can be applied immediately.\r\n55 of these updates are standard security updates.\r\nTo see these additional updates run: apt list --upgradable\r\n\r\n\r\nLast login: Mon Apr 17 04:57:34 2023 from 138.64.85.180\r\nubuntu@ip-172-30-3-25:~$ ls -a\r\n.  ..  .bash_logout  .bashrc  .cache  .profile  .ssh  .sudo_as_admin_successful  count.sh  king-api-production.env\r\nubuntu@ip-172-30-3-25:~$ sudo docker cp count.sh 10cf28189a1f:/\r\nPreparing to copy...\r\nCopying to container - 3.072kB\r\nSuccessfully copied 3.072kB to 10cf28189a1f:/\r\nubuntu@ip-172-30-3-25:~$ sudo docker exec -it --user root  10cf28189a1f sh\r\n\r\n# ls -la\r\ntotal 24\r\ndrwxr-xr-x   1 root root   22 Apr 17 05:24 .\r\ndrwxr-xr-x   1 root root   22 Apr 17 05:24 ..\r\n-rwxr-xr-x   1 root root    0 Apr 17 03:59 .dockerenv\r\n-rw-r--r--   1 root root 2012 Feb 24 01:47 05_table_migration_dump_restore.sh\r\n-rw-r--r--   1 root root 1966 Feb 21 05:08 06_bucardo_setup.sh\r\n-rw-r--r--   1 root root 1398 Mar 13 12:09 07_data_dump_restore.sh\r\n-rw-r--r--   1 root root 1910 Mar 13 12:09 08_check_tables.sh\r\nlrwxrwxrwx   1 root root    7 Mar  1 02:03 bin -> usr/bin\r\ndrwxr-xr-x   2 root root    6 Apr 18  2022 boot\r\n-rw-r--r--   1 1000 1000 1459 Apr 17 05:23 count.sh\r\n-rw-r--r--   1 root root   97 Feb 20 05:56 create-bucardo-user.sql\r\ndrwxr-xr-x   5 root root  360 Apr 17 03:59 dev\r\ndrwxr-xr-x   1 root root   66 Apr 17 03:59 etc\r\ndrwxr-xr-x   2 root root    6 Apr 18  2022 home\r\nlrwxrwxrwx   1 root root    7 Mar  1 02:03 lib -> usr/lib\r\nlrwxrwxrwx   1 root root    9 Mar  1 02:03 lib32 -> usr/lib32\r\nlrwxrwxrwx   1 root root    9 Mar  1 02:03 lib64 -> usr/lib64\r\nlrwxrwxrwx   1 root root   10 Mar  1 02:03 libx32 -> usr/libx32\r\ndrwxr-xr-x   2 root root    6 Mar  1 02:03 media\r\ndrwxr-xr-x   2 root root    6 Mar  1 02:03 mnt\r\ndrwxr-xr-x   2 root root    6 Mar  1 02:03 opt\r\ndr-xr-xr-x 239 root root    0 Apr 17 03:59 proc\r\ndrwx------   2 root root   37 Mar  1 02:06 root\r\ndrwxr-xr-x   1 root root   24 Mar 14 01:04 run\r\nlrwxrwxrwx   1 root root    8 Mar  1 02:03 sbin -> usr/sbin\r\ndrwxr-xr-x   2 root root    6 Mar  1 02:03 srv\r\ndr-xr-xr-x  13 root root    0 Apr 17 03:59 sys\r\ndrwxrwxrwt   1 root root    6 Mar 14 01:04 tmp\r\ndrwxr-xr-x   1 root root   96 Mar  1 02:03 usr\r\ndrwxr-xr-x   1 root root   28 Mar  1 02:06 var\r\n# exit\r\nubuntu@ip-172-30-3-25:~$ exit\r\nlogout\r\nConnection to ec2-52-197-147-182.ap-northeast-1.compute.amazonaws.com closed.\r\n```\r\n\r\n## 15_事前準備(data_bkのコピー)\r\n\r\n### 手順\r\n```sh\r\n以下のスクリプトをdata_bk.shとしておいておく\r\n#!/bin/bash\r\n\r\nmkdir ./data_bk\r\n\r\n# logs\r\npsql -h vpce-0bed708f6ce21788a-f4tmby1p.vpce-svc-0de703034cbfc279a.ap-northeast-1.vpce.amazonaws.com -U ubev937lfpa1d3 -d dncvsso7me9p6 -c \"COPY (select * from logs where updated_at > (NOW() - interval '12 hours') order by updated_at desc) TO STDOUT WITH CSV HEADER;\" > ./data_bk/logs_heroku.csv\r\npsql -h king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com -U kingadmin -d kingapi -c \"COPY (select * from logs where updated_at > (NOW() - interval '12 hours') order by updated_at desc) TO STDOUT WITH CSV HEADER;\" > ./data_bk/logs_aws.csv\r\n\r\n# display_logs\r\npsql -h vpce-0bed708f6ce21788a-f4tmby1p.vpce-svc-0de703034cbfc279a.ap-northeast-1.vpce.amazonaws.com -U ubev937lfpa1d3 -d dncvsso7me9p6 -c \"COPY (select * from display_logs where created_at > (NOW() - interval '12 hours') order by created_at desc) TO STDOUT WITH CSV HEADER;\" > ./data_bk/display_logs_heroku.csv\r\npsql -h king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com -U kingadmin -d kingapi -c \"COPY (select * from display_logs where created_at > (NOW() - interval '12 hours') order by created_at desc) TO STDOUT WITH CSV HEADER;\" > ./data_bk/display_logs_aws.csv\r\n```\r\n```sh\r\n> local\r\nscp -i \"king-api-production-bucardo-ec2.pem\" data_bk.sh ubuntu@ec2-52-197-147-182.ap-northeast-1.compute.amazonaws.com:/home/ubuntu/\r\n\r\n> ec2\r\nsudo docker cp data_bk.sh 10cf28189a1f:/\r\n```\r\n\r\n### 実行後\r\n```sh\r\n# sugiyamasatoshi @ sugiyamasatoshinoMacBook-Pro in ~ [14:27:59] C:1\r\n$ touch data_bk.sh\r\n# sugiyamasatoshi @ sugiyamasatoshinoMacBook-Pro in ~ [14:28:04]\r\n$ vim data_bk.sh\r\n```\r\n```vim\r\n#!/bin/bash\r\n\r\nmkdir ./data_bk\r\n\r\n# logs\r\npsql -h vpce-0bed708f6ce21788a-f4tmby1p.vpce-svc-0de703034cbfc279a.ap-northeast-1.vpce.amazonaws.com -U ubev937lfpa1d3 -d dncvsso7me9p6 -c \"COPY (select * from logs where updated_at > (NOW() - interval '12 hours') order by updated_at desc) TO STDOUT WITH CSV HEADER;\" > ./data_bk/logs_heroku.csv\r\npsql -h king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com -U kingadmin -d kingapi -c \"COPY (select * from logs where updated_at > (NOW() - interval '12 hours') order by updated_at desc) TO STDOUT WITH CSV HEADER;\" > ./data_bk/logs_aws.csv\r\n\r\n# display_logs\r\npsql -h vpce-0bed708f6ce21788a-f4tmby1p.vpce-svc-0de703034cbfc279a.ap-northeast-1.vpce.amazonaws.com -U ubev937lfpa1d3 -d dncvsso7me9p6 -c \"COPY (select * from display_logs where created_at > (NOW() - interval '12 hours') order by created_at desc) TO STDOUT WITH CSV HEADER;\" > ./data_bk/display_logs_heroku.csv\r\npsql -h king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com -U kingadmin -d kingapi -c \"COPY (select * from display_logs where created_at > (NOW() - interval '12 hours') order by created_at desc) TO STDOUT WITH CSV HEADER;\" > ./data_bk/display_logs_aws.csv\r\n\r\n~\r\n\"data_bk.sh\" 12L, 1204B written\r\n```\r\n\r\n```sh\r\nscp -i \"king-api-production-bucardo-ec2.pem\" data_bk.sh ubuntu@ec2-52-197-147-182.ap-northeast-1.compute.amazonaws.com:/home/ubuntu/\r\ndata_bk.sh                          100% 1204    70.8KB/s   00:00\r\n\r\nssh -i \"king-api-production-bucardo-ec2.pem\" ubuntu@ec2-52-197-147-182.ap-northeast-1.compute.amazonaws.com                                                                         14:31:30\r\nWelcome to Ubuntu 22.04.1 LTS (GNU/Linux 5.15.0-1026-aws x86_64)\r\n\r\n * Documentation:  https://help.ubuntu.com\r\n * Management:     https://landscape.canonical.com\r\n * Support:        https://ubuntu.com/advantage\r\n\r\n  System information as of Mon Apr 17 05:32:32 UTC 2023\r\n\r\n  System load:  0.0               Processes:                175\r\n  Usage of /:   4.3% of 61.84GB   Users logged in:          0\r\n  Memory usage: 0%                IPv4 address for docker0: 172.17.0.1\r\n  Swap usage:   0%                IPv4 address for ens3:    172.30.3.25\r\n\r\n\r\n106 updates can be applied immediately.\r\n55 of these updates are standard security updates.\r\nTo see these additional updates run: apt list --upgradable\r\n\r\n\r\nLast login: Mon Apr 17 05:25:36 2023 from 138.64.85.180\r\nubuntu@ip-172-30-3-25:~$ sudo docker cp data_bk.sh 10cf28189a1f:/\r\nPreparing to copy...\r\nCopying to container - 3.072kB\r\nSuccessfully copied 3.072kB to 10cf28189a1f:/\r\n\r\nubuntu@ip-172-30-3-25:~$ sudo docker exec -it --user root  10cf28189a1f sh\r\n# ls -la\r\ntotal 28\r\ndrwxr-xr-x   1 root root   40 Apr 17 05:32 .\r\ndrwxr-xr-x   1 root root   40 Apr 17 05:32 ..\r\n-rwxr-xr-x   1 root root    0 Apr 17 03:59 .dockerenv\r\n-rw-r--r--   1 root root 2012 Feb 24 01:47 05_table_migration_dump_restore.sh\r\n-rw-r--r--   1 root root 1966 Feb 21 05:08 06_bucardo_setup.sh\r\n-rw-r--r--   1 root root 1398 Mar 13 12:09 07_data_dump_restore.sh\r\n-rw-r--r--   1 root root 1910 Mar 13 12:09 08_check_tables.sh\r\nlrwxrwxrwx   1 root root    7 Mar  1 02:03 bin -> usr/bin\r\ndrwxr-xr-x   2 root root    6 Apr 18  2022 boot\r\n-rw-r--r--   1 1000 1000 1459 Apr 17 05:23 count.sh\r\n-rw-r--r--   1 root root   97 Feb 20 05:56 create-bucardo-user.sql\r\n-rw-r--r--   1 1000 1000 1204 Apr 17 05:31 data_bk.sh\r\ndrwxr-xr-x   5 root root  360 Apr 17 03:59 dev\r\ndrwxr-xr-x   1 root root   66 Apr 17 03:59 etc\r\ndrwxr-xr-x   2 root root    6 Apr 18  2022 home\r\nlrwxrwxrwx   1 root root    7 Mar  1 02:03 lib -> usr/lib\r\nlrwxrwxrwx   1 root root    9 Mar  1 02:03 lib32 -> usr/lib32\r\nlrwxrwxrwx   1 root root    9 Mar  1 02:03 lib64 -> usr/lib64\r\nlrwxrwxrwx   1 root root   10 Mar  1 02:03 libx32 -> usr/libx32\r\ndrwxr-xr-x   2 root root    6 Mar  1 02:03 media\r\ndrwxr-xr-x   2 root root    6 Mar  1 02:03 mnt\r\ndrwxr-xr-x   2 root root    6 Mar  1 02:03 opt\r\ndr-xr-xr-x 240 root root    0 Apr 17 03:59 proc\r\ndrwx------   2 root root   37 Mar  1 02:06 root\r\ndrwxr-xr-x   1 root root   24 Mar 14 01:04 run\r\nlrwxrwxrwx   1 root root    8 Mar  1 02:03 sbin -> usr/sbin\r\ndrwxr-xr-x   2 root root    6 Mar  1 02:03 srv\r\ndr-xr-xr-x  13 root root    0 Apr 17 03:59 sys\r\ndrwxrwxrwt   1 root root    6 Mar 14 01:04 tmp\r\ndrwxr-xr-x   1 root root   96 Mar  1 02:03 usr\r\ndrwxr-xr-x   1 root root   28 Mar  1 02:06 var\r\n```\r\n\r\n## 16_テーブルスキーマのdumpとrestore\r\n\r\n### 手順\r\n```sh\r\nbash 05_table_migration_dump_restore.sh ./king-api-production.env\r\n```\r\n### 実行後\r\n\r\n<details>\r\n\r\n```sh\r\n# bash 05_table_migration_dump_restore.sh ./king-api-production.env\r\n1.pgpassの作成------------------------\r\n2.HerokuDBのテーブル情報のdump取得------------------------\r\npg_dump: last built-in OID is 16383\r\npg_dump: reading extensions\r\npg_dump: identifying extension members\r\npg_dump: reading schemas\r\npg_dump: reading user-defined tables\r\npg_dump: reading user-defined functions\r\npg_dump: reading user-defined types\r\npg_dump: reading procedural languages\r\npg_dump: reading user-defined aggregate functions\r\npg_dump: reading user-defined operators\r\npg_dump: reading user-defined access methods\r\npg_dump: reading user-defined operator classes\r\npg_dump: reading user-defined operator families\r\npg_dump: reading user-defined text search parsers\r\npg_dump: reading user-defined text search templates\r\npg_dump: reading user-defined text search dictionaries\r\npg_dump: reading user-defined text search configurations\r\npg_dump: reading user-defined foreign-data wrappers\r\npg_dump: reading user-defined foreign servers\r\npg_dump: reading default privileges\r\npg_dump: reading user-defined collations\r\npg_dump: reading user-defined conversions\r\npg_dump: reading type casts\r\npg_dump: reading transforms\r\npg_dump: reading table inheritance information\r\npg_dump: reading event triggers\r\npg_dump: finding extension tables\r\npg_dump: finding inheritance relationships\r\npg_dump: reading column info for interesting tables\r\npg_dump: finding the columns and types of table \"public.schema_migrations\"\r\npg_dump: finding the columns and types of table \"public.ar_internal_metadata\"\r\npg_dump: finding the columns and types of table \"public.locks\"\r\npg_dump: finding default expressions of table \"public.locks\"\r\npg_dump: finding the columns and types of table \"public.hubs\"\r\npg_dump: finding default expressions of table \"public.hubs\"\r\npg_dump: finding the columns and types of table \"public.fobs\"\r\npg_dump: finding default expressions of table \"public.fobs\"\r\npg_dump: finding the columns and types of table \"public.users\"\r\npg_dump: finding default expressions of table \"public.users\"\r\npg_dump: finding the columns and types of table \"public.master_keys\"\r\npg_dump: finding default expressions of table \"public.master_keys\"\r\npg_dump: finding the columns and types of table \"public.lock_settings\"\r\npg_dump: finding default expressions of table \"public.lock_settings\"\r\npg_dump: finding the columns and types of table \"public.term_of_validities\"\r\npg_dump: finding default expressions of table \"public.term_of_validities\"\r\npg_dump: finding the columns and types of table \"public.durations\"\r\npg_dump: finding default expressions of table \"public.durations\"\r\npg_dump: finding the columns and types of table \"public.dailies\"\r\npg_dump: finding default expressions of table \"public.dailies\"\r\npg_dump: finding the columns and types of table \"public.weeklies\"\r\npg_dump: finding default expressions of table \"public.weeklies\"\r\npg_dump: finding the columns and types of table \"public.family_keys\"\r\npg_dump: finding default expressions of table \"public.family_keys\"\r\npg_dump: finding the columns and types of table \"public.guest_keys\"\r\npg_dump: finding default expressions of table \"public.guest_keys\"\r\npg_dump: finding the columns and types of table \"public.fob_keys\"\r\npg_dump: finding default expressions of table \"public.fob_keys\"\r\npg_dump: finding the columns and types of table \"public.logs\"\r\npg_dump: finding default expressions of table \"public.logs\"\r\npg_dump: finding the columns and types of table \"public.invitations\"\r\npg_dump: finding default expressions of table \"public.invitations\"\r\npg_dump: finding the columns and types of table \"public.json_web_keys\"\r\npg_dump: finding default expressions of table \"public.json_web_keys\"\r\npg_dump: finding the columns and types of table \"public.command_logs\"\r\npg_dump: finding default expressions of table \"public.command_logs\"\r\npg_dump: finding the columns and types of table \"public.webhook_tokens\"\r\npg_dump: finding default expressions of table \"public.webhook_tokens\"\r\npg_dump: finding the columns and types of table \"public.lock_webhook_tokens\"\r\npg_dump: finding default expressions of table \"public.lock_webhook_tokens\"\r\npg_dump: finding the columns and types of table \"public.delayed_jobs\"\r\npg_dump: finding default expressions of table \"public.delayed_jobs\"\r\npg_dump: finding the columns and types of table \"public.managers\"\r\npg_dump: finding default expressions of table \"public.managers\"\r\npg_dump: finding the columns and types of table \"public.webhooks\"\r\npg_dump: finding default expressions of table \"public.webhooks\"\r\npg_dump: finding the columns and types of table \"public.autolock_schedules\"\r\npg_dump: finding default expressions of table \"public.autolock_schedules\"\r\npg_dump: finding the columns and types of table \"public.relationships\"\r\npg_dump: finding default expressions of table \"public.relationships\"\r\npg_dump: finding the columns and types of table \"public.wenas\"\r\npg_dump: finding default expressions of table \"public.wenas\"\r\npg_dump: finding the columns and types of table \"public.wena_keys\"\r\npg_dump: finding default expressions of table \"public.wena_keys\"\r\npg_dump: finding the columns and types of table \"public.knights\"\r\npg_dump: finding default expressions of table \"public.knights\"\r\npg_dump: finding the columns and types of table \"public.knight_keys\"\r\npg_dump: finding default expressions of table \"public.knight_keys\"\r\npg_dump: finding the columns and types of table \"public.knight_cards\"\r\npg_dump: finding default expressions of table \"public.knight_cards\"\r\npg_dump: finding the columns and types of table \"public.knight_pins\"\r\npg_dump: finding default expressions of table \"public.knight_pins\"\r\npg_dump: finding the columns and types of table \"public.knight_commands\"\r\npg_dump: finding default expressions of table \"public.knight_commands\"\r\npg_dump: finding the columns and types of table \"public.knight_logs\"\r\npg_dump: finding default expressions of table \"public.knight_logs\"\r\npg_dump: finding the columns and types of table \"public.entrance_locks\"\r\npg_dump: finding default expressions of table \"public.entrance_locks\"\r\npg_dump: finding the columns and types of table \"public.entrance_master_keys\"\r\npg_dump: finding default expressions of table \"public.entrance_master_keys\"\r\npg_dump: finding the columns and types of table \"public.entrance_lock_settings\"\r\npg_dump: finding default expressions of table \"public.entrance_lock_settings\"\r\npg_dump: finding the columns and types of table \"public.entrance_knight_keys\"\r\npg_dump: finding default expressions of table \"public.entrance_knight_keys\"\r\npg_dump: finding the columns and types of table \"public.entrance_knight_pins\"\r\npg_dump: finding default expressions of table \"public.entrance_knight_pins\"\r\npg_dump: finding the columns and types of table \"public.resident_keys\"\r\npg_dump: finding default expressions of table \"public.resident_keys\"\r\npg_dump: finding the columns and types of table \"public.entrance_resident_keys\"\r\npg_dump: finding default expressions of table \"public.entrance_resident_keys\"\r\npg_dump: finding the columns and types of table \"public.entrance_invitations\"\r\npg_dump: finding default expressions of table \"public.entrance_invitations\"\r\npg_dump: finding the columns and types of table \"public.resident_guest_keys\"\r\npg_dump: finding default expressions of table \"public.resident_guest_keys\"\r\npg_dump: finding the columns and types of table \"public.entrance_resident_guest_keys\"\r\npg_dump: finding default expressions of table \"public.entrance_resident_guest_keys\"\r\npg_dump: finding the columns and types of table \"public.entrance_fob_keys\"\r\npg_dump: finding default expressions of table \"public.entrance_fob_keys\"\r\npg_dump: finding the columns and types of table \"public.mst_display_logs\"\r\npg_dump: finding default expressions of table \"public.mst_display_logs\"\r\npg_dump: finding the columns and types of table \"public.display_logs\"\r\npg_dump: finding default expressions of table \"public.display_logs\"\r\npg_dump: finding the columns and types of table \"public.door_mode_changed_histories\"\r\npg_dump: finding default expressions of table \"public.door_mode_changed_histories\"\r\npg_dump: finding the columns and types of table \"public.entrance_block_knight_cards\"\r\npg_dump: finding default expressions of table \"public.entrance_block_knight_cards\"\r\npg_dump: finding the columns and types of table \"public.entrance_block_fob_keys\"\r\npg_dump: finding default expressions of table \"public.entrance_block_fob_keys\"\r\npg_dump: finding the columns and types of table \"public.active_storage_blobs\"\r\npg_dump: finding default expressions of table \"public.active_storage_blobs\"\r\npg_dump: finding the columns and types of table \"public.active_storage_attachments\"\r\npg_dump: finding default expressions of table \"public.active_storage_attachments\"\r\npg_dump: finding the columns and types of table \"public.active_storage_variant_records\"\r\npg_dump: finding default expressions of table \"public.active_storage_variant_records\"\r\npg_dump: finding the columns and types of table \"public.pg_stat_statements_info\"\r\npg_dump: finding the columns and types of table \"public.pg_stat_statements\"\r\npg_dump: finding the columns and types of table \"public.laresia_pins\"\r\npg_dump: finding default expressions of table \"public.laresia_pins\"\r\npg_dump: flagging inherited columns in subtables\r\npg_dump: reading indexes\r\npg_dump: reading indexes for table \"public.schema_migrations\"\r\npg_dump: reading indexes for table \"public.ar_internal_metadata\"\r\npg_dump: reading indexes for table \"public.locks\"\r\npg_dump: reading indexes for table \"public.hubs\"\r\npg_dump: reading indexes for table \"public.fobs\"\r\npg_dump: reading indexes for table \"public.users\"\r\npg_dump: reading indexes for table \"public.master_keys\"\r\npg_dump: reading indexes for table \"public.lock_settings\"\r\npg_dump: reading indexes for table \"public.term_of_validities\"\r\npg_dump: reading indexes for table \"public.durations\"\r\npg_dump: reading indexes for table \"public.dailies\"\r\npg_dump: reading indexes for table \"public.weeklies\"\r\npg_dump: reading indexes for table \"public.family_keys\"\r\npg_dump: reading indexes for table \"public.guest_keys\"\r\npg_dump: reading indexes for table \"public.fob_keys\"\r\npg_dump: reading indexes for table \"public.logs\"\r\npg_dump: reading indexes for table \"public.invitations\"\r\npg_dump: reading indexes for table \"public.json_web_keys\"\r\npg_dump: reading indexes for table \"public.command_logs\"\r\npg_dump: reading indexes for table \"public.webhook_tokens\"\r\npg_dump: reading indexes for table \"public.lock_webhook_tokens\"\r\npg_dump: reading indexes for table \"public.delayed_jobs\"\r\npg_dump: reading indexes for table \"public.managers\"\r\npg_dump: reading indexes for table \"public.webhooks\"\r\npg_dump: reading indexes for table \"public.autolock_schedules\"\r\npg_dump: reading indexes for table \"public.relationships\"\r\npg_dump: reading indexes for table \"public.wenas\"\r\npg_dump: reading indexes for table \"public.wena_keys\"\r\npg_dump: reading indexes for table \"public.knights\"\r\npg_dump: reading indexes for table \"public.knight_keys\"\r\npg_dump: reading indexes for table \"public.knight_cards\"\r\npg_dump: reading indexes for table \"public.knight_pins\"\r\npg_dump: reading indexes for table \"public.knight_commands\"\r\npg_dump: reading indexes for table \"public.knight_logs\"\r\npg_dump: reading indexes for table \"public.entrance_locks\"\r\npg_dump: reading indexes for table \"public.entrance_master_keys\"\r\npg_dump: reading indexes for table \"public.entrance_lock_settings\"\r\npg_dump: reading indexes for table \"public.entrance_knight_keys\"\r\npg_dump: reading indexes for table \"public.entrance_knight_pins\"\r\npg_dump: reading indexes for table \"public.resident_keys\"\r\npg_dump: reading indexes for table \"public.entrance_resident_keys\"\r\npg_dump: reading indexes for table \"public.entrance_invitations\"\r\npg_dump: reading indexes for table \"public.resident_guest_keys\"\r\npg_dump: reading indexes for table \"public.entrance_resident_guest_keys\"\r\npg_dump: reading indexes for table \"public.entrance_fob_keys\"\r\npg_dump: reading indexes for table \"public.mst_display_logs\"\r\npg_dump: reading indexes for table \"public.display_logs\"\r\npg_dump: reading indexes for table \"public.door_mode_changed_histories\"\r\npg_dump: reading indexes for table \"public.entrance_block_knight_cards\"\r\npg_dump: reading indexes for table \"public.entrance_block_fob_keys\"\r\npg_dump: reading indexes for table \"public.active_storage_blobs\"\r\npg_dump: reading indexes for table \"public.active_storage_attachments\"\r\npg_dump: reading indexes for table \"public.active_storage_variant_records\"\r\npg_dump: reading indexes for table \"public.laresia_pins\"\r\npg_dump: flagging indexes in partitioned tables\r\npg_dump: reading extended statistics\r\npg_dump: reading constraints\r\npg_dump: reading foreign key constraints for table \"public.locks\"\r\npg_dump: reading foreign key constraints for table \"public.hubs\"\r\npg_dump: reading foreign key constraints for table \"public.fobs\"\r\npg_dump: reading foreign key constraints for table \"public.users\"\r\npg_dump: reading foreign key constraints for table \"public.master_keys\"\r\npg_dump: reading foreign key constraints for table \"public.lock_settings\"\r\npg_dump: reading foreign key constraints for table \"public.term_of_validities\"\r\npg_dump: reading foreign key constraints for table \"public.durations\"\r\npg_dump: reading foreign key constraints for table \"public.dailies\"\r\npg_dump: reading foreign key constraints for table \"public.weeklies\"\r\npg_dump: reading foreign key constraints for table \"public.family_keys\"\r\npg_dump: reading foreign key constraints for table \"public.guest_keys\"\r\npg_dump: reading foreign key constraints for table \"public.fob_keys\"\r\npg_dump: reading foreign key constraints for table \"public.logs\"\r\npg_dump: reading foreign key constraints for table \"public.invitations\"\r\npg_dump: reading foreign key constraints for table \"public.command_logs\"\r\npg_dump: reading foreign key constraints for table \"public.webhook_tokens\"\r\npg_dump: reading foreign key constraints for table \"public.lock_webhook_tokens\"\r\npg_dump: reading foreign key constraints for table \"public.managers\"\r\npg_dump: reading foreign key constraints for table \"public.webhooks\"\r\npg_dump: reading foreign key constraints for table \"public.autolock_schedules\"\r\npg_dump: reading foreign key constraints for table \"public.relationships\"\r\npg_dump: reading foreign key constraints for table \"public.wenas\"\r\npg_dump: reading foreign key constraints for table \"public.wena_keys\"\r\npg_dump: reading foreign key constraints for table \"public.knights\"\r\npg_dump: reading foreign key constraints for table \"public.knight_keys\"\r\npg_dump: reading foreign key constraints for table \"public.knight_cards\"\r\npg_dump: reading foreign key constraints for table \"public.knight_pins\"\r\npg_dump: reading foreign key constraints for table \"public.knight_logs\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_locks\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_master_keys\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_lock_settings\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_knight_keys\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_knight_pins\"\r\npg_dump: reading foreign key constraints for table \"public.resident_keys\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_resident_keys\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_invitations\"\r\npg_dump: reading foreign key constraints for table \"public.resident_guest_keys\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_resident_guest_keys\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_fob_keys\"\r\npg_dump: reading foreign key constraints for table \"public.mst_display_logs\"\r\npg_dump: reading foreign key constraints for table \"public.display_logs\"\r\npg_dump: reading foreign key constraints for table \"public.door_mode_changed_histories\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_block_knight_cards\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_block_fob_keys\"\r\npg_dump: reading foreign key constraints for table \"public.active_storage_blobs\"\r\npg_dump: reading foreign key constraints for table \"public.active_storage_attachments\"\r\npg_dump: reading foreign key constraints for table \"public.active_storage_variant_records\"\r\npg_dump: reading foreign key constraints for table \"public.laresia_pins\"\r\npg_dump: reading triggers\r\npg_dump: reading triggers for table \"public.locks\"\r\npg_dump: reading triggers for table \"public.hubs\"\r\npg_dump: reading triggers for table \"public.fobs\"\r\npg_dump: reading triggers for table \"public.users\"\r\npg_dump: reading triggers for table \"public.master_keys\"\r\npg_dump: reading triggers for table \"public.lock_settings\"\r\npg_dump: reading triggers for table \"public.term_of_validities\"\r\npg_dump: reading triggers for table \"public.durations\"\r\npg_dump: reading triggers for table \"public.dailies\"\r\npg_dump: reading triggers for table \"public.weeklies\"\r\npg_dump: reading triggers for table \"public.family_keys\"\r\npg_dump: reading triggers for table \"public.guest_keys\"\r\npg_dump: reading triggers for table \"public.fob_keys\"\r\npg_dump: reading triggers for table \"public.logs\"\r\npg_dump: reading triggers for table \"public.invitations\"\r\npg_dump: reading triggers for table \"public.command_logs\"\r\npg_dump: reading triggers for table \"public.webhook_tokens\"\r\npg_dump: reading triggers for table \"public.lock_webhook_tokens\"\r\npg_dump: reading triggers for table \"public.managers\"\r\npg_dump: reading triggers for table \"public.webhooks\"\r\npg_dump: reading triggers for table \"public.autolock_schedules\"\r\npg_dump: reading triggers for table \"public.relationships\"\r\npg_dump: reading triggers for table \"public.wenas\"\r\npg_dump: reading triggers for table \"public.wena_keys\"\r\npg_dump: reading triggers for table \"public.knights\"\r\npg_dump: reading triggers for table \"public.knight_keys\"\r\npg_dump: reading triggers for table \"public.knight_cards\"\r\npg_dump: reading triggers for table \"public.knight_pins\"\r\npg_dump: reading triggers for table \"public.knight_logs\"\r\npg_dump: reading triggers for table \"public.entrance_locks\"\r\npg_dump: reading triggers for table \"public.entrance_master_keys\"\r\npg_dump: reading triggers for table \"public.entrance_lock_settings\"\r\npg_dump: reading triggers for table \"public.entrance_knight_keys\"\r\npg_dump: reading triggers for table \"public.entrance_knight_pins\"\r\npg_dump: reading triggers for table \"public.resident_keys\"\r\npg_dump: reading triggers for table \"public.entrance_resident_keys\"\r\npg_dump: reading triggers for table \"public.entrance_invitations\"\r\npg_dump: reading triggers for table \"public.resident_guest_keys\"\r\npg_dump: reading triggers for table \"public.entrance_resident_guest_keys\"\r\npg_dump: reading triggers for table \"public.entrance_fob_keys\"\r\npg_dump: reading triggers for table \"public.mst_display_logs\"\r\npg_dump: reading triggers for table \"public.display_logs\"\r\npg_dump: reading triggers for table \"public.door_mode_changed_histories\"\r\npg_dump: reading triggers for table \"public.entrance_block_knight_cards\"\r\npg_dump: reading triggers for table \"public.entrance_block_fob_keys\"\r\npg_dump: reading triggers for table \"public.active_storage_blobs\"\r\npg_dump: reading triggers for table \"public.active_storage_attachments\"\r\npg_dump: reading triggers for table \"public.active_storage_variant_records\"\r\npg_dump: reading triggers for table \"public.laresia_pins\"\r\npg_dump: reading rewrite rules\r\npg_dump: reading policies\r\npg_dump: reading row-level security policies\r\npg_dump: reading publications\r\npg_dump: reading publication membership\r\npg_dump: reading subscriptions\r\npg_dump: reading dependency data\r\npg_dump: saving encoding = UTF8\r\npg_dump: saving standard_conforming_strings = on\r\npg_dump: saving search_path =\r\npg_dump: saving database definition\r\n3.AuroraDBへのテーブル情報の流入------------------------\r\npg_restore: connecting to database for restore\r\npg_restore: creating SCHEMA \"heroku_ext\"\r\npg_restore: while PROCESSING TOC:\r\npg_restore: from TOC entry 7; 2615 16404 SCHEMA heroku_ext postgres\r\npg_restore: error: could not execute query: ERROR:  role \"postgres\" does not exist\r\nCommand was: ALTER SCHEMA heroku_ext OWNER TO postgres;\r\n\r\npg_restore: creating EXTENSION \"pg_stat_statements\"\r\npg_restore: creating COMMENT \"EXTENSION pg_stat_statements\"\r\npg_restore: creating EXTENSION \"pgcrypto\"\r\npg_restore: creating COMMENT \"EXTENSION pgcrypto\"\r\npg_restore: creating TYPE \"public.command_log_remote_source_type\"\r\npg_restore: from TOC entry 987; 1247 37274655 TYPE command_log_remote_source_type ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: ALTER TYPE public.command_log_remote_source_type OWNER TO ubev937lfpa1d3;\r\n\r\npg_restore: creating TYPE \"public.display_log_lock_position\"\r\npg_restore: from TOC entry 925; 1247 25078842 TYPE display_log_lock_position ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: ALTER TYPE public.display_log_lock_position OWNER TO ubev937lfpa1d3;\r\n\r\npg_restore: creating TYPE \"public.display_log_open_close_type\"\r\npg_restore: from TOC entry 928; 1247 25078822 TYPE display_log_open_close_type ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: ALTER TYPE public.display_log_open_close_type OWNER TO ubev937lfpa1d3;\r\n\r\npg_restore: creating TYPE \"public.door_mode_changed_history_door_mode\"\r\npg_restore: from TOC entry 931; 1247 25632191 TYPE door_mode_changed_history_door_mode ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: ALTER TYPE public.door_mode_changed_history_door_mode OWNER TO ubev937lfpa1d3;\r\n\r\npg_restore: creating TYPE \"public.knight_command_remote_source_type\"\r\npg_restore: from TOC entry 1050; 1247 37274664 TYPE knight_command_remote_source_type ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: ALTER TYPE public.knight_command_remote_source_type OWNER TO ubev937lfpa1d3;\r\n\r\npg_restore: creating TYPE \"public.mst_display_log_open_close_type\"\r\npg_restore: from TOC entry 934; 1247 25078852 TYPE mst_display_log_open_close_type ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: ALTER TYPE public.mst_display_log_open_close_type OWNER TO ubev937lfpa1d3;\r\n\r\npg_restore: creating TYPE \"public.mst_display_log_operation_type\"\r\npg_restore: from TOC entry 937; 1247 25078870 TYPE mst_display_log_operation_type ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: ALTER TYPE public.mst_display_log_operation_type OWNER TO ubev937lfpa1d3;\r\n\r\npg_restore: creating TABLE \"public.active_storage_attachments\"\r\npg_restore: from TOC entry 267; 1259 30048268 TABLE active_storage_attachments ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: ALTER TABLE public.active_storage_attachments OWNER TO ubev937lfpa1d3;\r\n\r\npg_restore: creating SEQUENCE \"public.active_storage_attachments_id_seq\"\r\npg_restore: from TOC entry 266; 1259 30048266 SEQUENCE active_storage_attachments_id_seq ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: ALTER TABLE public.active_storage_attachments_id_seq OWNER TO ubev937lfpa1d3;\r\n\r\npg_restore: creating SEQUENCE OWNED BY \"public.active_storage_attachments_id_seq\"\r\npg_restore: creating TABLE \"public.active_storage_blobs\"\r\npg_restore: from TOC entry 265; 1259 30048256 TABLE active_storage_blobs ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: ALTER TABLE public.active_storage_blobs OWNER TO ubev937lfpa1d3;\r\n\r\npg_restore: creating SEQUENCE \"public.active_storage_blobs_id_seq\"\r\npg_restore: from TOC entry 264; 1259 30048254 SEQUENCE active_storage_blobs_id_seq ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: ALTER TABLE public.active_storage_blobs_id_seq OWNER TO ubev937lfpa1d3;\r\n\r\npg_restore: creating SEQUENCE OWNED BY \"public.active_storage_blobs_id_seq\"\r\npg_restore: creating TABLE \"public.active_storage_variant_records\"\r\npg_restore: from TOC entry 269; 1259 30048286 TABLE active_storage_variant_records ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: ALTER TABLE public.active_storage_variant_records OWNER TO ubev937lfpa1d3;\r\n\r\npg_restore: creating SEQUENCE \"public.active_storage_variant_records_id_seq\"\r\npg_restore: from TOC entry 268; 1259 30048284 SEQUENCE active_storage_variant_records_id_seq ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: ALTER TABLE public.active_storage_variant_records_id_seq OWNER TO ubev937lfpa1d3;\r\n\r\npg_restore: creating SEQUENCE OWNED BY \"public.active_storage_variant_records_id_seq\"\r\npg_restore: creating TABLE \"public.ar_internal_metadata\"\r\npg_restore: from TOC entry 213; 1259 17060 TABLE ar_internal_metadata ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: ALTER TABLE public.ar_internal_metadata OWNER TO ubev937lfpa1d3;\r\n\r\npg_restore: creating TABLE \"public.autolock_schedules\"\r\npg_restore: from TOC entry 238; 1259 1033455 TABLE autolock_schedules ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: ALTER TABLE public.autolock_schedules OWNER TO ubev937lfpa1d3;\r\n\r\npg_restore: creating TABLE \"public.command_logs\"\r\npg_restore: from TOC entry 231; 1259 25728 TABLE command_logs ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: ALTER TABLE public.command_logs OWNER TO ubev937lfpa1d3;\r\n\r\npg_restore: creating COMMENT \"public.COLUMN command_logs.notification_id\"\r\npg_restore: creating COMMENT \"public.COLUMN command_logs.remote_source_type\"\r\npg_restore: creating TABLE \"public.dailies\"\r\npg_restore: from TOC entry 222; 1259 17224 TABLE dailies ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: ALTER TABLE public.dailies OWNER TO ubev937lfpa1d3;\r\n\r\npg_restore: creating TABLE \"public.delayed_jobs\"\r\npg_restore: from TOC entry 235; 1259 42626 TABLE delayed_jobs ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: ALTER TABLE public.delayed_jobs OWNER TO ubev937lfpa1d3;\r\n\r\npg_restore: creating SEQUENCE \"public.delayed_jobs_id_seq\"\r\npg_restore: from TOC entry 234; 1259 42624 SEQUENCE delayed_jobs_id_seq ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: ALTER TABLE public.delayed_jobs_id_seq OWNER TO ubev937lfpa1d3;\r\n\r\npg_restore: creating SEQUENCE OWNED BY \"public.delayed_jobs_id_seq\"\r\npg_restore: creating TABLE \"public.display_logs\"\r\npg_restore: from TOC entry 260; 1259 25078792 TABLE display_logs ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: ALTER TABLE public.display_logs OWNER TO ubev937lfpa1d3;\r\n\r\npg_restore: creating COMMENT \"public.COLUMN display_logs.open_close_type\"\r\npg_restore: creating COMMENT \"public.COLUMN display_logs.lock_position\"\r\npg_restore: creating TABLE \"public.door_mode_changed_histories\"\r\npg_restore: from TOC entry 261; 1259 25632195 TABLE door_mode_changed_histories ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: ALTER TABLE public.door_mode_changed_histories OWNER TO ubev937lfpa1d3;\r\n\r\npg_restore: creating COMMENT \"public.COLUMN door_mode_changed_histories.door_mode\"\r\npg_restore: creating TABLE \"public.durations\"\r\npg_restore: from TOC entry 221; 1259 17209 TABLE durations ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: ALTER TABLE public.durations OWNER TO ubev937lfpa1d3;\r\n\r\npg_restore: creating TABLE \"public.entrance_block_fob_keys\"\r\npg_restore: from TOC entry 263; 1259 27960646 TABLE entrance_block_fob_keys ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: ALTER TABLE public.entrance_block_fob_keys OWNER TO ubev937lfpa1d3;\r\n\r\npg_restore: creating COMMENT \"public.COLUMN entrance_block_fob_keys.fob_type\"\r\npg_restore: creating TABLE \"public.entrance_block_knight_cards\"\r\npg_restore: from TOC entry 262; 1259 27960623 TABLE entrance_block_knight_cards ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: ALTER TABLE public.entrance_block_knight_cards OWNER TO ubev937lfpa1d3;\r\n\r\npg_restore: creating TABLE \"public.entrance_fob_keys\"\r\npg_restore: from TOC entry 258; 1259 25078765 TABLE entrance_fob_keys ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: ALTER TABLE public.entrance_fob_keys OWNER TO ubev937lfpa1d3;\r\n\r\npg_restore: creating TABLE \"public.entrance_invitations\"\r\npg_restore: from TOC entry 255; 1259 25078663 TABLE entrance_invitations ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: ALTER TABLE public.entrance_invitations OWNER TO ubev937lfpa1d3;\r\n\r\npg_restore: creating TABLE \"public.entrance_knight_keys\"\r\npg_restore: from TOC entry 251; 1259 25078580 TABLE entrance_knight_keys ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: ALTER TABLE public.entrance_knight_keys OWNER TO ubev937lfpa1d3;\r\n\r\npg_restore: creating TABLE \"public.entrance_knight_pins\"\r\npg_restore: from TOC entry 252; 1259 25078598 TABLE entrance_knight_pins ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: ALTER TABLE public.entrance_knight_pins OWNER TO ubev937lfpa1d3;\r\n\r\npg_restore: creating TABLE \"public.entrance_lock_settings\"\r\npg_restore: from TOC entry 250; 1259 25078559 TABLE entrance_lock_settings ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: ALTER TABLE public.entrance_lock_settings OWNER TO ubev937lfpa1d3;\r\n\r\npg_restore: creating TABLE \"public.entrance_locks\"\r\npg_restore: from TOC entry 248; 1259 25078530 TABLE entrance_locks ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: ALTER TABLE public.entrance_locks OWNER TO ubev937lfpa1d3;\r\n\r\npg_restore: creating TABLE \"public.entrance_master_keys\"\r\npg_restore: from TOC entry 249; 1259 25078541 TABLE entrance_master_keys ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: ALTER TABLE public.entrance_master_keys OWNER TO ubev937lfpa1d3;\r\n\r\npg_restore: creating TABLE \"public.entrance_resident_guest_keys\"\r\npg_restore: from TOC entry 257; 1259 25078711 TABLE entrance_resident_guest_keys ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: ALTER TABLE public.entrance_resident_guest_keys OWNER TO ubev937lfpa1d3;\r\n\r\npg_restore: creating TABLE \"public.entrance_resident_keys\"\r\npg_restore: from TOC entry 254; 1259 25078633 TABLE entrance_resident_keys ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: ALTER TABLE public.entrance_resident_keys OWNER TO ubev937lfpa1d3;\r\n\r\npg_restore: creating TABLE \"public.family_keys\"\r\npg_restore: from TOC entry 224; 1259 17255 TABLE family_keys ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: ALTER TABLE public.family_keys OWNER TO ubev937lfpa1d3;\r\n\r\npg_restore: creating TABLE \"public.fob_keys\"\r\npg_restore: from TOC entry 226; 1259 17300 TABLE fob_keys ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: ALTER TABLE public.fob_keys OWNER TO ubev937lfpa1d3;\r\n\r\npg_restore: creating TABLE \"public.fobs\"\r\npg_restore: from TOC entry 216; 1259 17131 TABLE fobs ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: ALTER TABLE public.fobs OWNER TO ubev937lfpa1d3;\r\n\r\npg_restore: creating TABLE \"public.guest_keys\"\r\npg_restore: from TOC entry 225; 1259 17274 TABLE guest_keys ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: ALTER TABLE public.guest_keys OWNER TO ubev937lfpa1d3;\r\n\r\npg_restore: creating TABLE \"public.hubs\"\r\npg_restore: from TOC entry 215; 1259 17121 TABLE hubs ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: ALTER TABLE public.hubs OWNER TO ubev937lfpa1d3;\r\n\r\npg_restore: creating COMMENT \"public.COLUMN hubs.is_roomon_manager_hub\"\r\npg_restore: creating TABLE \"public.invitations\"\r\npg_restore: from TOC entry 228; 1259 17342 TABLE invitations ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: ALTER TABLE public.invitations OWNER TO ubev937lfpa1d3;\r\n\r\npg_restore: creating TABLE \"public.json_web_keys\"\r\npg_restore: from TOC entry 230; 1259 24740 TABLE json_web_keys ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: ALTER TABLE public.json_web_keys OWNER TO ubev937lfpa1d3;\r\n\r\npg_restore: creating SEQUENCE \"public.json_web_keys_id_seq\"\r\npg_restore: from TOC entry 229; 1259 24738 SEQUENCE json_web_keys_id_seq ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: ALTER TABLE public.json_web_keys_id_seq OWNER TO ubev937lfpa1d3;\r\n\r\npg_restore: creating SEQUENCE OWNED BY \"public.json_web_keys_id_seq\"\r\npg_restore: creating TABLE \"public.knight_cards\"\r\npg_restore: from TOC entry 244; 1259 21622037 TABLE knight_cards ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: ALTER TABLE public.knight_cards OWNER TO ubev937lfpa1d3;\r\n\r\npg_restore: creating TABLE \"public.knight_commands\"\r\npg_restore: from TOC entry 246; 1259 21622178 TABLE knight_commands ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: ALTER TABLE public.knight_commands OWNER TO ubev937lfpa1d3;\r\n\r\npg_restore: creating COMMENT \"public.COLUMN knight_commands.notification_id\"\r\npg_restore: creating COMMENT \"public.COLUMN knight_commands.remote_source_type\"\r\npg_restore: creating TABLE \"public.knight_keys\"\r\npg_restore: from TOC entry 243; 1259 21622019 TABLE knight_keys ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: ALTER TABLE public.knight_keys OWNER TO ubev937lfpa1d3;\r\n\r\npg_restore: creating TABLE \"public.knight_logs\"\r\npg_restore: from TOC entry 247; 1259 25078486 TABLE knight_logs ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: ALTER TABLE public.knight_logs OWNER TO ubev937lfpa1d3;\r\n\r\npg_restore: creating TABLE \"public.knight_pins\"\r\npg_restore: from TOC entry 245; 1259 21622125 TABLE knight_pins ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: ALTER TABLE public.knight_pins OWNER TO ubev937lfpa1d3;\r\n\r\npg_restore: creating TABLE \"public.knights\"\r\npg_restore: from TOC entry 242; 1259 21622003 TABLE knights ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: ALTER TABLE public.knights OWNER TO ubev937lfpa1d3;\r\n\r\npg_restore: creating COMMENT \"public.COLUMN knights.model_id\"\r\npg_restore: creating COMMENT \"public.COLUMN knights.mode\"\r\npg_restore: creating COMMENT \"public.COLUMN knights.relay_on_seconds\"\r\npg_restore: creating COMMENT \"public.COLUMN knights.remote_setting_mode_adv_interval\"\r\npg_restore: creating TABLE \"public.laresia_pins\"\r\npg_restore: from TOC entry 272; 1259 37274638 TABLE laresia_pins ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: ALTER TABLE public.laresia_pins OWNER TO ubev937lfpa1d3;\r\n\r\npg_restore: creating TABLE \"public.lock_settings\"\r\npg_restore: from TOC entry 219; 1259 17169 TABLE lock_settings ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: ALTER TABLE public.lock_settings OWNER TO ubev937lfpa1d3;\r\n\r\npg_restore: creating TABLE \"public.lock_webhook_tokens\"\r\npg_restore: from TOC entry 233; 1259 25846 TABLE lock_webhook_tokens ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: ALTER TABLE public.lock_webhook_tokens OWNER TO ubev937lfpa1d3;\r\n\r\npg_restore: creating TABLE \"public.locks\"\r\npg_restore: from TOC entry 214; 1259 17105 TABLE locks ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: ALTER TABLE public.locks OWNER TO ubev937lfpa1d3;\r\n\r\npg_restore: creating COMMENT \"public.COLUMN locks.model_id\"\r\npg_restore: creating TABLE \"public.logs\"\r\npg_restore: from TOC entry 227; 1259 17324 TABLE logs ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: ALTER TABLE public.logs OWNER TO ubev937lfpa1d3;\r\n\r\npg_restore: creating TABLE \"public.managers\"\r\npg_restore: from TOC entry 236; 1259 143560 TABLE managers ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: ALTER TABLE public.managers OWNER TO ubev937lfpa1d3;\r\n\r\npg_restore: creating TABLE \"public.master_keys\"\r\npg_restore: from TOC entry 218; 1259 17151 TABLE master_keys ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: ALTER TABLE public.master_keys OWNER TO ubev937lfpa1d3;\r\n\r\npg_restore: creating TABLE \"public.mst_display_logs\"\r\npg_restore: from TOC entry 259; 1259 25078783 TABLE mst_display_logs ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: ALTER TABLE public.mst_display_logs OWNER TO ubev937lfpa1d3;\r\n\r\npg_restore: creating COMMENT \"public.COLUMN mst_display_logs.open_close_type\"\r\npg_restore: creating COMMENT \"public.COLUMN mst_display_logs.operation_type\"\r\npg_restore: creating TABLE \"public.relationships\"\r\npg_restore: from TOC entry 239; 1259 1186274 TABLE relationships ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: ALTER TABLE public.relationships OWNER TO ubev937lfpa1d3;\r\n\r\npg_restore: creating TABLE \"public.resident_guest_keys\"\r\npg_restore: from TOC entry 256; 1259 25078687 TABLE resident_guest_keys ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: ALTER TABLE public.resident_guest_keys OWNER TO ubev937lfpa1d3;\r\n\r\npg_restore: creating TABLE \"public.resident_keys\"\r\npg_restore: from TOC entry 253; 1259 25078615 TABLE resident_keys ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: ALTER TABLE public.resident_keys OWNER TO ubev937lfpa1d3;\r\n\r\npg_restore: creating TABLE \"public.schema_migrations\"\r\npg_restore: from TOC entry 212; 1259 17052 TABLE schema_migrations ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: ALTER TABLE public.schema_migrations OWNER TO ubev937lfpa1d3;\r\n\r\npg_restore: creating TABLE \"public.term_of_validities\"\r\npg_restore: from TOC entry 220; 1259 17197 TABLE term_of_validities ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: ALTER TABLE public.term_of_validities OWNER TO ubev937lfpa1d3;\r\n\r\npg_restore: creating TABLE \"public.users\"\r\npg_restore: from TOC entry 217; 1259 17141 TABLE users ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: ALTER TABLE public.users OWNER TO ubev937lfpa1d3;\r\n\r\npg_restore: creating TABLE \"public.webhook_tokens\"\r\npg_restore: from TOC entry 232; 1259 25830 TABLE webhook_tokens ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: ALTER TABLE public.webhook_tokens OWNER TO ubev937lfpa1d3;\r\n\r\npg_restore: creating TABLE \"public.webhooks\"\r\npg_restore: from TOC entry 237; 1259 223477 TABLE webhooks ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: ALTER TABLE public.webhooks OWNER TO ubev937lfpa1d3;\r\n\r\npg_restore: creating TABLE \"public.weeklies\"\r\npg_restore: from TOC entry 223; 1259 17236 TABLE weeklies ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: ALTER TABLE public.weeklies OWNER TO ubev937lfpa1d3;\r\n\r\npg_restore: creating TABLE \"public.wena_keys\"\r\npg_restore: from TOC entry 241; 1259 5549250 TABLE wena_keys ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: ALTER TABLE public.wena_keys OWNER TO ubev937lfpa1d3;\r\n\r\npg_restore: creating TABLE \"public.wenas\"\r\npg_restore: from TOC entry 240; 1259 5549240 TABLE wenas ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: ALTER TABLE public.wenas OWNER TO ubev937lfpa1d3;\r\n\r\npg_restore: creating COMMENT \"public.COLUMN wenas.wena_type\"\r\npg_restore: creating DEFAULT \"public.active_storage_attachments id\"\r\npg_restore: creating DEFAULT \"public.active_storage_blobs id\"\r\npg_restore: creating DEFAULT \"public.active_storage_variant_records id\"\r\npg_restore: creating DEFAULT \"public.delayed_jobs id\"\r\npg_restore: creating DEFAULT \"public.json_web_keys id\"\r\npg_restore: creating CONSTRAINT \"public.active_storage_attachments active_storage_attachments_pkey\"\r\npg_restore: creating CONSTRAINT \"public.active_storage_blobs active_storage_blobs_pkey\"\r\npg_restore: creating CONSTRAINT \"public.active_storage_variant_records active_storage_variant_records_pkey\"\r\npg_restore: creating CONSTRAINT \"public.ar_internal_metadata ar_internal_metadata_pkey\"\r\npg_restore: creating CONSTRAINT \"public.autolock_schedules autolock_schedules_pkey\"\r\npg_restore: creating CONSTRAINT \"public.command_logs command_logs_pkey\"\r\npg_restore: creating CONSTRAINT \"public.dailies dailies_pkey\"\r\npg_restore: creating CONSTRAINT \"public.delayed_jobs delayed_jobs_pkey\"\r\npg_restore: creating CONSTRAINT \"public.display_logs display_logs_pkey\"\r\npg_restore: creating CONSTRAINT \"public.door_mode_changed_histories door_mode_changed_histories_pkey\"\r\npg_restore: creating CONSTRAINT \"public.durations durations_pkey\"\r\npg_restore: creating CONSTRAINT \"public.entrance_block_fob_keys entrance_block_fob_keys_pkey\"\r\npg_restore: creating CONSTRAINT \"public.entrance_block_knight_cards entrance_block_knight_cards_pkey\"\r\npg_restore: creating CONSTRAINT \"public.entrance_fob_keys entrance_fob_keys_pkey\"\r\npg_restore: creating CONSTRAINT \"public.entrance_invitations entrance_invitations_pkey\"\r\npg_restore: creating CONSTRAINT \"public.entrance_knight_keys entrance_knight_keys_pkey\"\r\npg_restore: creating CONSTRAINT \"public.entrance_knight_pins entrance_knight_pins_pkey\"\r\npg_restore: creating CONSTRAINT \"public.entrance_lock_settings entrance_lock_settings_pkey\"\r\npg_restore: creating CONSTRAINT \"public.entrance_locks entrance_locks_pkey\"\r\npg_restore: creating CONSTRAINT \"public.entrance_master_keys entrance_master_keys_pkey\"\r\npg_restore: creating CONSTRAINT \"public.entrance_resident_guest_keys entrance_resident_guest_keys_pkey\"\r\npg_restore: creating CONSTRAINT \"public.entrance_resident_keys entrance_resident_keys_pkey\"\r\npg_restore: creating CONSTRAINT \"public.family_keys family_keys_pkey\"\r\npg_restore: creating CONSTRAINT \"public.fob_keys fob_keys_pkey\"\r\npg_restore: creating CONSTRAINT \"public.fobs fobs_pkey\"\r\npg_restore: creating CONSTRAINT \"public.guest_keys guest_keys_pkey\"\r\npg_restore: creating CONSTRAINT \"public.hubs hubs_pkey\"\r\npg_restore: creating CONSTRAINT \"public.invitations invitations_pkey\"\r\npg_restore: creating CONSTRAINT \"public.json_web_keys json_web_keys_pkey\"\r\npg_restore: creating CONSTRAINT \"public.knight_cards knight_cards_pkey\"\r\npg_restore: creating CONSTRAINT \"public.knight_commands knight_commands_pkey\"\r\npg_restore: creating CONSTRAINT \"public.knight_keys knight_keys_pkey\"\r\npg_restore: creating CONSTRAINT \"public.knight_logs knight_logs_pkey\"\r\npg_restore: creating CONSTRAINT \"public.knight_pins knight_pins_pkey\"\r\npg_restore: creating CONSTRAINT \"public.knights knights_pkey\"\r\npg_restore: creating CONSTRAINT \"public.laresia_pins laresia_pins_pkey\"\r\npg_restore: creating CONSTRAINT \"public.lock_settings lock_settings_pkey\"\r\npg_restore: creating CONSTRAINT \"public.lock_webhook_tokens lock_webhook_tokens_pkey\"\r\npg_restore: creating CONSTRAINT \"public.locks locks_pkey\"\r\npg_restore: creating CONSTRAINT \"public.logs logs_pkey\"\r\npg_restore: creating CONSTRAINT \"public.managers managers_pkey\"\r\npg_restore: creating CONSTRAINT \"public.master_keys master_keys_pkey\"\r\npg_restore: creating CONSTRAINT \"public.mst_display_logs mst_display_logs_pkey\"\r\npg_restore: creating CONSTRAINT \"public.relationships relationships_pkey\"\r\npg_restore: creating CONSTRAINT \"public.resident_guest_keys resident_guest_keys_pkey\"\r\npg_restore: creating CONSTRAINT \"public.resident_keys resident_keys_pkey\"\r\npg_restore: creating CONSTRAINT \"public.schema_migrations schema_migrations_pkey\"\r\npg_restore: creating CONSTRAINT \"public.term_of_validities term_of_validities_pkey\"\r\npg_restore: creating CONSTRAINT \"public.users users_pkey\"\r\npg_restore: creating CONSTRAINT \"public.webhook_tokens webhook_tokens_pkey\"\r\npg_restore: creating CONSTRAINT \"public.webhooks webhooks_pkey\"\r\npg_restore: creating CONSTRAINT \"public.weeklies weeklies_pkey\"\r\npg_restore: creating CONSTRAINT \"public.wena_keys wena_keys_pkey\"\r\npg_restore: creating CONSTRAINT \"public.wenas wenas_pkey\"\r\npg_restore: creating INDEX \"public.delayed_jobs_priority\"\r\npg_restore: creating INDEX \"public.index_active_storage_attachments_on_blob_id\"\r\npg_restore: creating INDEX \"public.index_active_storage_attachments_uniqueness\"\r\npg_restore: creating INDEX \"public.index_active_storage_blobs_on_key\"\r\npg_restore: creating INDEX \"public.index_active_storage_variant_records_uniqueness\"\r\npg_restore: creating INDEX \"public.index_autolock_schedules_on_disable_hour\"\r\npg_restore: creating INDEX \"public.index_autolock_schedules_on_enable_hour\"\r\npg_restore: creating INDEX \"public.index_autolock_schedules_on_master_key_id\"\r\npg_restore: creating INDEX \"public.index_command_logs_on_hub_id\"\r\npg_restore: creating INDEX \"public.index_command_logs_on_lock_id\"\r\npg_restore: creating INDEX \"public.index_dailies_on_term_of_validity_id\"\r\npg_restore: creating INDEX \"public.index_display_logs_on_logged_at\"\r\npg_restore: creating INDEX \"public.index_display_logs_on_master_key_id\"\r\npg_restore: creating INDEX \"public.index_display_logs_on_mst_display_log_id\"\r\npg_restore: creating INDEX \"public.index_door_mode_changed_histories_on_master_key_id\"\r\npg_restore: creating INDEX \"public.index_durations_on_term_of_validity_id\"\r\npg_restore: creating INDEX \"public.index_entrance_block_fob_keys_on_entrance_fob_key_id\"\r\npg_restore: creating INDEX \"public.index_entrance_block_fob_keys_on_entrance_master_key_id\"\r\npg_restore: creating INDEX \"public.index_entrance_block_fob_keys_on_fob_id\"\r\npg_restore: creating INDEX \"public.index_entrance_block_knight_cards_on_entrance_knight_key_id\"\r\npg_restore: creating INDEX \"public.index_entrance_block_knight_cards_on_knight_card_id\"\r\npg_restore: creating INDEX \"public.index_entrance_fob_keys_on_entrance_master_key_id\"\r\npg_restore: creating INDEX \"public.index_entrance_fob_keys_on_fob_key_id\"\r\npg_restore: creating INDEX \"public.index_entrance_invitations_on_entrance_master_key_id\"\r\npg_restore: creating INDEX \"public.index_entrance_invitations_on_invitation_id\"\r\npg_restore: creating INDEX \"public.index_entrance_knight_keys_on_entrance_master_key_id\"\r\npg_restore: creating INDEX \"public.index_entrance_knight_keys_on_knight_id\"\r\npg_restore: creating INDEX \"public.index_entrance_knight_pins_on_entrance_knight_key_id\"\r\npg_restore: creating INDEX \"public.index_entrance_knight_pins_on_entrance_knight_key_id_and_pin\"\r\npg_restore: creating INDEX \"public.index_entrance_lock_settings_on_entrance_master_key_id\"\r\npg_restore: creating INDEX \"public.index_entrance_lock_settings_on_hub_id\"\r\npg_restore: creating INDEX \"public.index_entrance_locks_on_serial_no\"\r\npg_restore: creating INDEX \"public.index_entrance_master_keys_on_entrance_lock_id\"\r\npg_restore: creating INDEX \"public.index_entrance_master_keys_on_user_id\"\r\npg_restore: creating INDEX \"public.index_entrance_resident_guest_keys_on_entrance_master_key_id\"\r\npg_restore: creating INDEX \"public.index_entrance_resident_guest_keys_on_resident_guest_key_id\"\r\npg_restore: creating INDEX \"public.index_entrance_resident_keys_on_entrance_master_key_id\"\r\npg_restore: creating INDEX \"public.index_entrance_resident_keys_on_resident_key_id\"\r\npg_restore: creating INDEX \"public.index_family_keys_on_master_key_id\"\r\npg_restore: creating INDEX \"public.index_family_keys_on_master_key_id_and_user_id\"\r\npg_restore: creating INDEX \"public.index_family_keys_on_user_id\"\r\npg_restore: creating INDEX \"public.index_fob_keys_on_fob_id\"\r\npg_restore: creating INDEX \"public.index_fob_keys_on_master_key_id\"\r\npg_restore: creating INDEX \"public.index_fobs_on_serial_no_and_fob_type\"\r\npg_restore: creating INDEX \"public.index_guest_keys_on_master_key_id\"\r\npg_restore: creating INDEX \"public.index_guest_keys_on_term_of_validity_id\"\r\npg_restore: creating INDEX \"public.index_guest_keys_on_user_id\"\r\npg_restore: creating INDEX \"public.index_hubs_on_serial_no\"\r\npg_restore: creating INDEX \"public.index_invitations_on_master_key_id\"\r\npg_restore: creating INDEX \"public.index_invitations_on_term_of_validity_id\"\r\npg_restore: creating INDEX \"public.index_invitations_on_user_id\"\r\npg_restore: creating INDEX \"public.index_json_web_keys_on_kid\"\r\npg_restore: creating INDEX \"public.index_knight_cards_on_display_serial_no\"\r\npg_restore: creating INDEX \"public.index_knight_cards_on_knight_key_id\"\r\npg_restore: creating INDEX \"public.index_knight_cards_on_knight_key_id_and_idm\"\r\npg_restore: creating INDEX \"public.index_knight_commands_on_hub_id\"\r\npg_restore: creating INDEX \"public.index_knight_commands_on_knight_id\"\r\npg_restore: creating INDEX \"public.index_knight_keys_on_knight_id\"\r\npg_restore: creating INDEX \"public.index_knight_keys_on_master_key_id\"\r\npg_restore: creating INDEX \"public.index_knight_logs_on_knight_id\"\r\npg_restore: creating INDEX \"public.index_knight_logs_on_knight_id_and_knight_log_id\"\r\npg_restore: creating INDEX \"public.index_knight_pins_on_knight_key_id\"\r\npg_restore: creating INDEX \"public.index_knight_pins_on_knight_key_id_and_pin\"\r\npg_restore: creating INDEX \"public.index_knights_on_serial_no_and_model_id\"\r\npg_restore: creating INDEX \"public.index_laresia_pins_on_master_key_id\"\r\npg_restore: creating INDEX \"public.index_lock_settings_on_hub_id\"\r\npg_restore: creating INDEX \"public.index_lock_settings_on_master_key_id\"\r\npg_restore: creating INDEX \"public.index_lock_settings_on_sub_lock_id\"\r\npg_restore: creating INDEX \"public.index_lock_webhook_tokens_on_lock_id\"\r\npg_restore: creating INDEX \"public.index_lock_webhook_tokens_on_lock_id_and_webhook_token_id\"\r\npg_restore: creating INDEX \"public.index_lock_webhook_tokens_on_webhook_token_id\"\r\npg_restore: creating INDEX \"public.index_locks_on_serial_no_and_model_id\"\r\npg_restore: creating INDEX \"public.index_logs_on_lock_id\"\r\npg_restore: creating INDEX \"public.index_logs_on_lock_id_and_lock_log_id\"\r\npg_restore: creating INDEX \"public.index_logs_on_lock_id_and_logged_at\"\r\npg_restore: creating INDEX \"public.index_logs_on_recordable_type_and_recordable_id\"\r\npg_restore: creating INDEX \"public.index_managers_on_user_id\"\r\npg_restore: creating INDEX \"public.index_master_keys_on_lock_id\"\r\npg_restore: creating INDEX \"public.index_master_keys_on_user_id\"\r\npg_restore: creating INDEX \"public.index_relationships_on_follow_id\"\r\npg_restore: creating INDEX \"public.index_relationships_on_user_id\"\r\npg_restore: creating INDEX \"public.index_relationships_on_user_id_and_follow_id\"\r\npg_restore: creating INDEX \"public.index_resident_guest_keys_on_master_key_id\"\r\npg_restore: creating INDEX \"public.index_resident_guest_keys_on_term_of_validity_id\"\r\npg_restore: creating INDEX \"public.index_resident_guest_keys_on_user_id\"\r\npg_restore: creating INDEX \"public.index_resident_keys_on_master_key_id\"\r\npg_restore: creating INDEX \"public.index_resident_keys_on_user_id\"\r\npg_restore: creating INDEX \"public.index_term_of_validities_on_master_key_id\"\r\npg_restore: creating INDEX \"public.index_users_on_auth0_id\"\r\npg_restore: creating INDEX \"public.index_webhook_tokens_on_user_id\"\r\npg_restore: creating INDEX \"public.index_webhook_tokens_on_user_id_and_platform\"\r\npg_restore: creating INDEX \"public.index_webhooks_on_master_key_id\"\r\npg_restore: creating INDEX \"public.index_webhooks_on_master_key_id_and_payload_url\"\r\npg_restore: creating INDEX \"public.index_weeklies_on_term_of_validity_id\"\r\npg_restore: creating INDEX \"public.index_wena_keys_on_master_key_id\"\r\npg_restore: creating INDEX \"public.index_wena_keys_on_wena_id\"\r\npg_restore: creating INDEX \"public.index_wenas_on_serial_no\"\r\npg_restore: creating INDEX \"public.unique_idx_e_b_k_c_on_entrance_knight_key_id_and_encrypted_idm\"\r\npg_restore: creating FK CONSTRAINT \"public.command_logs fk_rails_014f6a2546\"\r\npg_restore: creating FK CONSTRAINT \"public.laresia_pins fk_rails_0169d87320\"\r\npg_restore: creating FK CONSTRAINT \"public.knight_keys fk_rails_021cf26662\"\r\npg_restore: creating FK CONSTRAINT \"public.knight_cards fk_rails_0456909398\"\r\npg_restore: creating FK CONSTRAINT \"public.master_keys fk_rails_0704a51e19\"\r\npg_restore: creating FK CONSTRAINT \"public.durations fk_rails_09e2ff6011\"\r\npg_restore: creating FK CONSTRAINT \"public.entrance_resident_guest_keys fk_rails_0e04b9b004\"\r\npg_restore: creating FK CONSTRAINT \"public.webhook_tokens fk_rails_0e442b724e\"\r\npg_restore: creating FK CONSTRAINT \"public.fob_keys fk_rails_10751d7ff3\"\r\npg_restore: creating FK CONSTRAINT \"public.managers fk_rails_1306270b4d\"\r\npg_restore: creating FK CONSTRAINT \"public.lock_settings fk_rails_14b5845605\"\r\npg_restore: creating FK CONSTRAINT \"public.entrance_invitations fk_rails_1cd45ae85f\"\r\npg_restore: creating FK CONSTRAINT \"public.resident_guest_keys fk_rails_264f594299\"\r\npg_restore: creating FK CONSTRAINT \"public.master_keys fk_rails_2ce43857fe\"\r\npg_restore: creating FK CONSTRAINT \"public.invitations fk_rails_392831049d\"\r\npg_restore: creating FK CONSTRAINT \"public.entrance_fob_keys fk_rails_3baf99c215\"\r\npg_restore: creating FK CONSTRAINT \"public.guest_keys fk_rails_423d4bed43\"\r\npg_restore: creating FK CONSTRAINT \"public.command_logs fk_rails_479d47afa1\"\r\npg_restore: creating FK CONSTRAINT \"public.door_mode_changed_histories fk_rails_49b0247336\"\r\npg_restore: creating FK CONSTRAINT \"public.webhooks fk_rails_4ed36f717c\"\r\npg_restore: creating FK CONSTRAINT \"public.guest_keys fk_rails_511d97b2e6\"\r\npg_restore: creating FK CONSTRAINT \"public.entrance_lock_settings fk_rails_51210f8c81\"\r\npg_restore: creating FK CONSTRAINT \"public.family_keys fk_rails_51c51759a6\"\r\npg_restore: creating FK CONSTRAINT \"public.display_logs fk_rails_59cca4309c\"\r\npg_restore: creating FK CONSTRAINT \"public.family_keys fk_rails_60c83f8be9\"\r\npg_restore: creating FK CONSTRAINT \"public.guest_keys fk_rails_6c5179c7f7\"\r\npg_restore: creating FK CONSTRAINT \"public.display_logs fk_rails_6d35c11a37\"\r\npg_restore: creating FK CONSTRAINT \"public.entrance_block_fob_keys fk_rails_73c502cbb2\"\r\npg_restore: creating FK CONSTRAINT \"public.resident_guest_keys fk_rails_79146fb483\"\r\npg_restore: creating FK CONSTRAINT \"public.entrance_resident_keys fk_rails_7e4b69180e\"\r\npg_restore: creating FK CONSTRAINT \"public.invitations fk_rails_7eae413fe6\"\r\npg_restore: creating FK CONSTRAINT \"public.dailies fk_rails_82a55d246d\"\r\npg_restore: creating FK CONSTRAINT \"public.knight_keys fk_rails_85a7a025e9\"\r\npg_restore: creating FK CONSTRAINT \"public.lock_settings fk_rails_8bb146ac2a\"\r\npg_restore: creating FK CONSTRAINT \"public.lock_webhook_tokens fk_rails_8fba90749d\"\r\npg_restore: creating FK CONSTRAINT \"public.entrance_block_fob_keys fk_rails_919d63f111\"\r\npg_restore: creating FK CONSTRAINT \"public.lock_webhook_tokens fk_rails_95203493c9\"\r\npg_restore: creating FK CONSTRAINT \"public.resident_guest_keys fk_rails_9539b5c88f\"\r\npg_restore: creating FK CONSTRAINT \"public.active_storage_variant_records fk_rails_993965df05\"\r\npg_restore: creating FK CONSTRAINT \"public.entrance_invitations fk_rails_9992af7a62\"\r\npg_restore: creating FK CONSTRAINT \"public.wena_keys fk_rails_99ec462bd1\"\r\npg_restore: creating FK CONSTRAINT \"public.fob_keys fk_rails_9b950aa82f\"\r\npg_restore: creating FK CONSTRAINT \"public.entrance_lock_settings fk_rails_9befedd7c2\"\r\npg_restore: creating FK CONSTRAINT \"public.autolock_schedules fk_rails_a0e63f0c58\"\r\npg_restore: creating FK CONSTRAINT \"public.relationships fk_rails_a3d77c3b00\"\r\npg_restore: creating FK CONSTRAINT \"public.entrance_block_fob_keys fk_rails_a403765376\"\r\npg_restore: creating FK CONSTRAINT \"public.entrance_resident_keys fk_rails_a5035d381f\"\r\npg_restore: creating FK CONSTRAINT \"public.entrance_knight_keys fk_rails_a635401c41\"\r\npg_restore: creating FK CONSTRAINT \"public.knight_pins fk_rails_a64ee923a2\"\r\npg_restore: creating FK CONSTRAINT \"public.entrance_fob_keys fk_rails_af780e48bc\"\r\npg_restore: creating FK CONSTRAINT \"public.resident_keys fk_rails_b0fd978d66\"\r\npg_restore: creating FK CONSTRAINT \"public.entrance_resident_guest_keys fk_rails_b6ec476525\"\r\npg_restore: creating FK CONSTRAINT \"public.entrance_knight_pins fk_rails_b7c2bfe16b\"\r\npg_restore: creating FK CONSTRAINT \"public.entrance_master_keys fk_rails_b86cbd1481\"\r\npg_restore: creating FK CONSTRAINT \"public.relationships fk_rails_be1f05b3d7\"\r\npg_restore: creating FK CONSTRAINT \"public.lock_settings fk_rails_c004fa487a\"\r\npg_restore: creating FK CONSTRAINT \"public.term_of_validities fk_rails_c0c932f574\"\r\npg_restore: creating FK CONSTRAINT \"public.active_storage_attachments fk_rails_c3b3935057\"\r\npg_restore: creating FK CONSTRAINT \"public.entrance_master_keys fk_rails_cf36d974ef\"\r\npg_restore: creating FK CONSTRAINT \"public.wena_keys fk_rails_d5ecae402c\"\r\npg_restore: creating FK CONSTRAINT \"public.weeklies fk_rails_d7ff067ab0\"\r\npg_restore: creating FK CONSTRAINT \"public.knight_logs fk_rails_ded551fbb4\"\r\npg_restore: creating FK CONSTRAINT \"public.resident_keys fk_rails_dfe4427a9d\"\r\npg_restore: creating FK CONSTRAINT \"public.entrance_block_knight_cards fk_rails_e8410af2ce\"\r\npg_restore: creating FK CONSTRAINT \"public.logs fk_rails_ef0f5cfa81\"\r\npg_restore: creating FK CONSTRAINT \"public.entrance_knight_keys fk_rails_f404f37ec9\"\r\npg_restore: creating FK CONSTRAINT \"public.entrance_block_knight_cards fk_rails_f6a259853d\"\r\npg_restore: creating FK CONSTRAINT \"public.invitations fk_rails_f87be4c20b\"\r\npg_restore: creating ACL \"SCHEMA heroku_ext\"\r\npg_restore: from TOC entry 4966; 0 0 ACL SCHEMA heroku_ext postgres\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: GRANT USAGE ON SCHEMA heroku_ext TO ubev937lfpa1d3 WITH GRANT OPTION;\r\n\r\n\r\npg_restore: creating ACL \"SCHEMA public\"\r\npg_restore: from TOC entry 4967; 0 0 ACL SCHEMA public ubev937lfpa1d3\r\npg_restore: error: could not execute query: ERROR:  role \"postgres\" does not exist\r\nCommand was: REVOKE ALL ON SCHEMA public FROM postgres;\r\nREVOKE ALL ON SCHEMA public FROM PUBLIC;\r\nGRANT ALL ON SCHEMA public TO ubev937lfpa1d3;\r\nGRANT ALL ON SCHEMA public TO PUBLIC;\r\n\r\n\r\npg_restore: creating ACL \"public.FUNCTION pg_stat_statements_reset(userid oid, dbid oid, queryid bigint)\"\r\npg_restore: from TOC entry 4970; 0 0 ACL FUNCTION pg_stat_statements_reset(userid oid, dbid oid, queryid bigint) postgres\r\npg_restore: error: could not execute query: ERROR:  role \"ubev937lfpa1d3\" does not exist\r\nCommand was: GRANT ALL ON FUNCTION public.pg_stat_statements_reset(userid oid, dbid oid, queryid bigint) TO ubev937lfpa1d3;\r\n\r\n\r\npg_restore: warning: errors ignored on restore: 70\r\nテーブル数の一致確認\r\nherokuのテーブル数: (61 rows)\r\nauroraのテーブル数: (61 rows)\r\nテーブル数が一致しました。\r\n```\r\n</details>\r\n\r\n```抜粋.sh\r\nテーブル数の一致確認\r\nherokuのテーブル数: (61 rows)\r\nauroraのテーブル数: (61 rows)\r\nテーブル数が一致しました。\r\n```\r\n\r\n## 17_Bucardoの設定、~~データプールの開始~~\r\n\r\n### 手順\r\n```sh\r\nmkdir ~/../var/run/bucardo\r\nmkdir ~/../var/log/bucardo\r\n\r\necho \"local   all             postgres                                trust\" >> ~/../etc/postgresql/14/main/pg_hba.conf\r\necho \"local   all             bucardo                                 trust\" >> ~/../etc/postgresql/14/main/pg_hba.conf\r\n\r\nsed -i -e \"s/peer/trust/\" ~/../etc/postgresql/14/main/pg_hba.conf\r\n\r\nservice postgresql stop\r\nservice postgresql start\r\n\r\nbucardo install\r\n\r\nbucardo add db heroku_db dbhost=vpce-0bed708f6ce21788a-f4tmby1p.vpce-svc-0de703034cbfc279a.ap-northeast-1.vpce.amazonaws.com dbport=5432 dbname=dncvsso7me9p6 dbuser=ubev937lfpa1d3 dbpass=p009c5cb0136e7cea41f9b8792f9fb171dc1c8b0e764f49e2d3f3cc5bec32368f\r\n\r\nbucardo add db aws_db dbhost=king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com dbport=5432 dbname=kingapi dbuser=kingadmin dbpass=m3hkFJq4gkRVAZvY5Z1FkT7LeKtnjJSl\r\n\r\n# グループ作成\r\nbucardo add dbgroup dbs heroku_db:source aws_db:target\r\n\r\n# プールするデータテーブルの指定\r\nbucardo add table logs display_logs herd=herd_heroku_db db=heroku_db\r\n```\r\n### 実行後\r\n\r\n```sh\r\n# mkdir ~/../var/run/bucardo\r\n\r\n# mkdir ~/../var/log/bucardo\r\n\r\n# echo \"local   all             postgres                                trust\" >> ~/../etc/postgresql/14/main/pg_hba.conf\r\n# echo \"local   all             bucardo                                 trust\" >> ~/../etc/postgresql/14/main/pg_hba.conf\r\n\r\n# sed -i -e \"s/peer/trust/\" ~/../etc/postgresql/14/main/pg_hba.conf\r\n\r\n# service postgresql stop\r\n * Stopping PostgreSQL 14 database server                           [ OK ]\r\n \r\n# service postgresql start\r\n * Starting PostgreSQL 14 database server                           [ OK ]\r\n\r\n\r\n# bucardo install\r\nThis will install the bucardo database into an existing Postgres cluster.\r\nPostgres must have been compiled with Perl support,\r\nand you must connect as a superuser\r\n\r\nCurrent connection settings:\r\n1. Host:           <none>\r\n2. Port:           5432\r\n3. User:           bucardo\r\n4. Database:       bucardo\r\n5. PID directory:  /var/run/bucardo\r\nEnter a number to change it, P to proceed, or Q to quit: P\r\n\r\nAttempting to create and populate the bucardo database and schema\r\nDatabase creation is complete\r\n\r\nUpdated configuration setting \"piddir\"\r\nInstallation is now complete.\r\nIf you see errors or need help, please email bucardo-general@bucardo.org\r\n\r\nYou may want to check over the configuration variables next, by running:\r\nbucardo show all\r\nChange any setting by using: bucardo set foo=bar\r\n\r\n# bucardo add db heroku_db dbhost=vpce-0bed708f6ce21788a-f4tmby1p.vpce-svc-0de703034cbfc279a.ap-northeast-1.vpce.amazonaws.com dbport=5432 dbname=dncvsso7me9p6 dbuser=ubev937lfpa1d3 dbpass=p009c5cb0136e7cea41f9b8792f9fb171dc1c8b0e764f49e2d3f3cc5bec32368f\r\nAdded database \"heroku_db\"\r\n\r\n# bucardo add db aws_db dbhost=king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com dbport=5432 dbname=kingapi dbuser=kingadmin dbpass=m3hkFJq4gkRVAZvY5Z1FkT7LeKtnjJSl\r\nAdded database \"aws_db\"\r\n\r\n# bucardo add dbgroup dbs heroku_db:source aws_db:target\r\nCreated dbgroup \"dbs\"\r\nAdded database \"heroku_db\" to dbgroup \"dbs\" as source\r\nAdded database \"aws_db\" to dbgroup \"dbs\" as target\r\n\r\n# bucardo add table logs display_logs herd=herd_heroku_db db=heroku_db\r\nAdded the following tables or sequences:\r\n  public.display_logs\r\n  public.logs\r\nCreated the relgroup named \"herd_heroku_db\"\r\nThe following tables or sequences are now part of the relgroup \"herd_heroku_db\":\r\n  public.display_logs\r\n  public.logs\r\n```\r\n### 確認\r\nbucardoの各種設定が反映されているかどうか\r\n```sh\r\n# bucardo list db\r\nDatabase: aws_db     Status: active  Conn: psql -p 5432 -U kingadmin -d kingapi -h king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com\r\nDatabase: heroku_db  Status: active  Conn: psql -p 5432 -U ubev937lfpa1d3 -d dncvsso7me9p6 -h vpce-0bed708f6ce21788a-f4tmby1p.vpce-svc-0de703034cbfc279a.ap-northeast-1.vpce.amazonaws.com\r\n# bucardo list dbgroup\r\ndbgroup: dbs  Members: aws_db:target heroku_db:source\r\n# bucardo list relgroup\r\nRelgroup: herd_heroku_db  DB: heroku_db  Members: public.display_logs, public.logs\r\n# bucardo list table\r\n2. Table: public.display_logs  DB: heroku_db  PK: id (uuid)\r\n1. Table: public.logs          DB: heroku_db  PK: id (uuid)\r\n```\r\n\r\n## 18_インスタンスタイプ変更\r\n### 手順\r\nコンソールでライターインスタンスを選択しdb.r5.24xlargeを選択\r\nすぐに適用\r\nリーダーと入れ替わるので、フェイルオーバーをしてライターインスタンスとして復帰させる\r\n### 実行後\r\n\r\nインスタンスタイプ変更\r\n<img width=\"779\" alt=\"スクリーンショット 2023-04-17 14.57.14.png (112.1 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/17/136273/2c16e0cc-0639-4b23-a07d-58fa760c377a.png\">\r\n5分後:変更中(リーダーに格下げされた)\r\n<img width=\"1351\" alt=\"スクリーンショット 2023-04-17 15.02.41.png (47.3 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/17/136273/576319d5-89e2-43e9-a725-3f07a2b241b7.png\">\r\nさらに4分後:Configuring-enhanced-monitoring\r\n<img width=\"1506\" alt=\"スクリーンショット 2023-04-17 15.06.17.png (50.8 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/17/136273/9e2fadc8-4b11-433f-b34d-4d8193c32bb7.png\">\r\nさらに4分後:Storage-optimization\r\n<img width=\"1411\" alt=\"スクリーンショット 2023-04-17 15.10.29.png (49.4 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/17/136273/b1fe4277-6e27-4252-b4ad-6aac42aaadf8.png\">\r\nさらに9分後:利用可能になった\r\n<img width=\"1338\" alt=\"スクリーンショット 2023-04-17 15.19.31.png (48.5 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/17/136273/530061d2-2182-430d-9d8c-6ccc3ad5c1b6.png\">\r\nここでフェイルオーバーを行い、リーダーとライターを入れ替える(移行に使うのはライター)\r\n<img width=\"816\" alt=\"スクリーンショット 2023-04-17 15.22.13.png (29.5 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/17/136273/fc99b4ed-80d6-4a62-ad5d-90a6324f6b2b.png\">\r\nフェイルオーバーから3分後、入れ替わって利用可能に\r\n<img width=\"1347\" alt=\"スクリーンショット 2023-04-17 15.24.45.png (48.8 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/17/136273/86334a0e-5760-401f-b633-9e3a6fb75bc9.png\">\r\n\r\n\r\n\r\n## 最後に確認\r\n- Dockerコンテナが起きていなかった問題\r\n    - 手順通りに実施したところきちんとdockerコンテナが起きていた\r\n ```sh\r\nubuntu@ip-172-30-3-25:~$ sudo docker ps\r\nCONTAINER ID   IMAGE                                                                          COMMAND       CREATED       STATUS       PORTS      NAMES\r\n10cf28189a1f   931243214056.dkr.ecr.ap-northeast-1.amazonaws.com/king-api-cfn-bucardo-image   \"/bin/bash\"   2 hours ago   Up 2 hours   5432/tcp   objective_banach\r\n ```\r\n- psql疎通確認\r\n\r\n```Aurora.sh\r\npsql -h king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com -U kingadmin -d kingapi -p 5432\r\npsql (14.7 (Ubuntu 14.7-0ubuntu0.22.04.1), server 14.5)\r\nSSL connection (protocol: TLSv1.2, cipher: AES128-SHA256, bits: 128, compression: off)\r\nType \"help\" for help.\r\n\r\nkingapi=>\r\n```\r\n```Heroku.sh\r\npsql -h vpce-0bed708f6ce21788a-f4tmby1p.vpce-svc-0de703034cbfc279a.ap-northeast-1.vpce.amazonaws.com -d dncvsso7me9p6 -U ubev937lfpa1d3 -p 5432\r\npsql (14.7 (Ubuntu 14.7-0ubuntu0.22.04.1), server 14.6 (Ubuntu 14.6-1.pgdg20.04+1))\r\nSSL connection (protocol: TLSv1.3, cipher: TLS_AES_256_GCM_SHA384, bits: 256, compression: off)\r\nType \"help\" for help.\r\n\r\ndncvsso7me9p6=>\r\n```\r\n",
    "body_html": "<h1 data-sourcepos=\"1:1-1:11\" id=\"1-0-0\" name=\"1-0-0\"><a class=\"anchor\" id=\"手順書\" name=\"手順書\" href=\"#手順書\" data-position=\"1-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"手順書\"> &gt; 手順書</span></a>手順書</h1>\n<p data-sourcepos=\"2:1-2:103\"><a href=\"https://docs.google.com/spreadsheets/d/1W3DymCJ_ifiXtSUwVAjcl9tzPGfz5WE6bmnnwYL9Gbo/edit#gid=1297114524\" target=\"_blank\" rel=\"noopener noreferrer\">https://docs.google.com/spreadsheets/d/1W3DymCJ_ifiXtSUwVAjcl9tzPGfz5WE6bmnnwYL9Gbo/edit#gid=1297114524</a></p>\n<h2 data-sourcepos=\"4:1-4:39\" id=\"1-1-0\" name=\"1-1-0\"><a class=\"anchor\" id=\"2_Herokuのbucardoスキーマ削除\" name=\"2_Herokuのbucardoスキーマ削除\" href=\"#2_Herokuのbucardoスキーマ削除\" data-position=\"1-1-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"2_Herokuのbucardoスキーマ削除\"> &gt; 2_Herokuのbucardoスキーマ削除</span></a>2_Herokuのbucardoスキーマ削除</h2>\n<h3 data-sourcepos=\"5:1-5:10\" id=\"1-1-1\" name=\"1-1-1\"><a class=\"anchor\" id=\"手順\" name=\"手順\" href=\"#手順\" data-position=\"1-1-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"手順\"> &gt; 手順</span></a>手順</h3>\n<p data-sourcepos=\"6:1-6:9\">EC2から</p>\n<div class=\"code-block\" data-sourcepos=\"7:1-10:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>psql <span class=\"nt\">-h</span> vpce-07e26665ccbc39113-l2zl675x.vpce-svc-0de703034cbfc279a.ap-northeast-1.vpce.amazonaws.com <span class=\"se\">\\</span>\n    <span class=\"nt\">-p</span> 5432 <span class=\"nt\">-d</span> dncvsso7me9p6 <span class=\"nt\">-U</span> ubev937lfpa1d3 <span class=\"nt\">-c</span> <span class=\"s2\">\"DROP SCHEMA bucardo CASCADE;\"</span>\n</code></pre></div></div>\n<h3 data-sourcepos=\"12:1-12:13\" id=\"1-1-2\" name=\"1-1-2\"><a class=\"anchor\" id=\"実行後\" name=\"実行後\" href=\"#実行後\" data-position=\"1-1-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"実行後\"> &gt; 実行後</span></a>実行後</h3>\n<div class=\"code-block\" data-sourcepos=\"13:1-45:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>NOTICE:  drop cascades to 29 other objects\nDETAIL:  drop cascades to <span class=\"k\">function </span>bucardo.bucardo_tablename_maker<span class=\"o\">(</span>text<span class=\"o\">)</span>\ndrop cascades to <span class=\"k\">function </span>bucardo.bucardo_tablename_maker<span class=\"o\">(</span>text,text<span class=\"o\">)</span>\ndrop cascades to <span class=\"k\">function </span>bucardo.bucardo_delta_names_helper<span class=\"o\">()</span>\ndrop cascades to <span class=\"k\">function </span>bucardo.bucardo_delta_check<span class=\"o\">(</span>text,text<span class=\"o\">)</span>\ndrop cascades to <span class=\"k\">function </span>bucardo.bucardo_note_truncation<span class=\"o\">()</span>\ndrop cascades to trigger bucardo_note_trunc_sync_heroku_aws on table display_logs\ndrop cascades to trigger bucardo_note_trunc_sync_heroku_aws on table logs\ndrop cascades to <span class=\"k\">function </span>bucardo.bucardo_compress_delta<span class=\"o\">(</span>text,text<span class=\"o\">)</span>\ndrop cascades to <span class=\"k\">function </span>bucardo.bucardo_compress_delta<span class=\"o\">(</span>text<span class=\"o\">)</span>\ndrop cascades to <span class=\"k\">function </span>bucardo.bucardo_compress_delta<span class=\"o\">(</span>oid<span class=\"o\">)</span>\ndrop cascades to <span class=\"k\">function </span>bucardo.bucardo_purge_delta_oid<span class=\"o\">(</span>text,oid<span class=\"o\">)</span>\ndrop cascades to <span class=\"k\">function </span>bucardo.bucardo_purge_delta<span class=\"o\">(</span>text<span class=\"o\">)</span>\ndrop cascades to <span class=\"k\">function </span>bucardo.bucardo_purge_sync_track<span class=\"o\">(</span>text<span class=\"o\">)</span>\ndrop cascades to <span class=\"k\">function </span>bucardo.bucardo_kick_sync_heroku_aws<span class=\"o\">()</span>\ndrop cascades to trigger bucardo_kick_sync_heroku_aws on table display_logs\ndrop cascades to trigger bucardo_kick_sync_heroku_aws on table logs\ndrop cascades to table bucardo.bucardo_delta_names\ndrop cascades to table bucardo.bucardo_delta_targets\ndrop cascades to table bucardo.bucardo_truncate_trigger\ndrop cascades to table bucardo.bucardo_truncate_trigger_log\ndrop cascades to table bucardo.bucardo_sequences\ndrop cascades to table bucardo.delta_public_display_logs\ndrop cascades to <span class=\"k\">function </span>bucardo.delta_public_display_logs<span class=\"o\">()</span>\ndrop cascades to table bucardo.track_public_display_logs\ndrop cascades to table bucardo.stage_public_display_logs\ndrop cascades to table bucardo.delta_public_logs\ndrop cascades to <span class=\"k\">function </span>bucardo.delta_public_logs<span class=\"o\">()</span>\ndrop cascades to table bucardo.track_public_logs\ndrop cascades to table bucardo.stage_public_logs\nDROP SCHEMA\n</code></pre></div></div>\n<h2 data-sourcepos=\"47:1-47:47\" id=\"1-2-0\" name=\"1-2-0\"><a class=\"anchor\" id=\"3_auroraのインスタンスタイプ戻し\" name=\"3_auroraのインスタンスタイプ戻し\" href=\"#3_auroraのインスタンスタイプ戻し\" data-position=\"1-2-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"3_auroraのインスタンスタイプ戻し\"> &gt; 3_auroraのインスタンスタイプ戻し</span></a>3_auroraのインスタンスタイプ戻し</h2>\n<h3 data-sourcepos=\"49:1-49:10\" id=\"1-2-1\" name=\"1-2-1\"><a class=\"anchor\" id=\"手順-1\" name=\"手順-1\" href=\"#手順-1\" data-position=\"1-2-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"手順\"> &gt; 手順</span></a>手順</h3>\n<p data-sourcepos=\"50:1-50:30\">db.r5.24xlarge→db.r5.2xlarge</p>\n<h3 data-sourcepos=\"52:1-52:13\" id=\"1-2-2\" name=\"1-2-2\"><a class=\"anchor\" id=\"実行後-1\" name=\"実行後-1\" href=\"#実行後-1\" data-position=\"1-2-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"実行後\"> &gt; 実行後</span></a>実行後</h3>\n<p data-sourcepos=\"53:1-53:23\">約10分で終わった</p>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/17/136273/4c003e49-23dc-4c46-acfd-577b69c063bc.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"806\" alt=\"スクリーンショット 2023-04-17 11.49.55.png (110.5 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/17/136273/4c003e49-23dc-4c46-acfd-577b69c063bc.png\"></a>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/17/136273/fcf93df6-2c0e-4940-af0c-963f5bfcc014.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"291\" alt=\"スクリーンショット 2023-04-17 11.51.03.png (16.2 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/17/136273/fcf93df6-2c0e-4940-af0c-963f5bfcc014.png\"></a>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/17/136273/12a2e8f8-86d7-4ef4-a9d8-3456821071ba.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"1369\" alt=\"スクリーンショット 2023-04-17 12.03.48.png (48.1 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/17/136273/12a2e8f8-86d7-4ef4-a9d8-3456821071ba.png\"></a>\n<h2 data-sourcepos=\"59:1-59:38\" id=\"1-3-0\" name=\"1-3-0\"><a class=\"anchor\" id=\"4_ドリフトチェックと対処\" name=\"4_ドリフトチェックと対処\" href=\"#4_ドリフトチェックと対処\" data-position=\"1-3-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"4_ドリフトチェックと対処\"> &gt; 4_ドリフトチェックと対処</span></a>4_ドリフトチェックと対処</h2>\n<h3 data-sourcepos=\"61:1-61:10\" id=\"1-3-1\" name=\"1-3-1\"><a class=\"anchor\" id=\"手順-2\" name=\"手順-2\" href=\"#手順-2\" data-position=\"1-3-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"手順\"> &gt; 手順</span></a>手順</h3>\n<p data-sourcepos=\"62:1-62:63\">ドリフトの検出→必要であればリソースを戻す</p>\n<h3 data-sourcepos=\"64:1-64:13\" id=\"1-3-2\" name=\"1-3-2\"><a class=\"anchor\" id=\"実行後-2\" name=\"実行後-2\" href=\"#実行後-2\" data-position=\"1-3-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"実行後\"> &gt; 実行後</span></a>実行後</h3>\n<h4 data-sourcepos=\"66:1-66:24\">bucardoスタック</h4>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/17/136273/fd998304-ec3b-4754-bf33-5fa8c1950412.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"1245\" alt=\"スクリーンショット 2023-04-17 11.52.44.png (170.2 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/17/136273/fd998304-ec3b-4754-bf33-5fa8c1950412.png\"></a>\n手動で追加したipを削除する\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/17/136273/4d112956-2971-4027-b11e-386210c02c77.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"1851\" alt=\"スクリーンショット 2023-04-17 11.53.10.png (107.4 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/17/136273/4d112956-2971-4027-b11e-386210c02c77.png\"></a>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/17/136273/3f57b50e-50c8-44b1-81b6-c50787d94e9a.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"1625\" alt=\"スクリーンショット 2023-04-17 11.53.40.png (186.9 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/17/136273/3f57b50e-50c8-44b1-81b6-c50787d94e9a.png\"></a>\n<h4 data-sourcepos=\"73:1-73:23\">auroraスタック</h4>\n<p data-sourcepos=\"74:1-75:207\">cfn_deleteで修正できる範囲と認識しているのでOK<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/17/136273/9bf6fe76-5e4c-4736-83ed-415df9e3cea8.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"1596\" alt=\"スクリーンショット 2023-04-17 12.08.04.png (211.1 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/17/136273/9bf6fe76-5e4c-4736-83ed-415df9e3cea8.png\"></a></p>\n<h2 data-sourcepos=\"77:1-77:40\" id=\"1-4-0\" name=\"1-4-0\"><a class=\"anchor\" id=\"5_cloudformationのスタック削除\" name=\"5_cloudformationのスタック削除\" href=\"#5_cloudformationのスタック削除\" data-position=\"1-4-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"5_cloudformationのスタック削除\"> &gt; 5_cloudformationのスタック削除</span></a>5_cloudformationのスタック削除</h2>\n<h3 data-sourcepos=\"79:1-79:10\" id=\"1-4-1\" name=\"1-4-1\"><a class=\"anchor\" id=\"手順-3\" name=\"手順-3\" href=\"#手順-3\" data-position=\"1-4-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"手順\"> &gt; 手順</span></a>手順</h3>\n<div class=\"code-block\" data-sourcepos=\"80:1-82:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>sh ./local_scripts/cfn_delete.sh ./config/production.env sl2-api-production\n</code></pre></div></div>\n<h3 data-sourcepos=\"84:1-84:13\" id=\"1-4-2\" name=\"1-4-2\"><a class=\"anchor\" id=\"実行後-3\" name=\"実行後-3\" href=\"#実行後-3\" data-position=\"1-4-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"実行後\"> &gt; 実行後</span></a>実行後</h3>\n<div class=\"code-block\" data-sourcepos=\"85:1-117:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>sh ./local_scripts/cfn_delete.sh ./config/production.env sl2-api-production                                                                                                           12:10:27\nスタック名:king-api-aurora-production-base-stack\nスタック名:king-api-production-bucardo-stack\n\n<span class=\"o\">[</span><span class=\"k\">**</span>入力]上記スタックを削除しますか？<span class=\"o\">(</span>y/n<span class=\"o\">)</span>y\n0.事前準備------------------------\n1.PrivateLinkの削除------------------------\nVPCエンドポイント: vpce-07e26665ccbc39113 \nVPCエンドポイントの削除開始\n削除結果\n2.EC2スタックの削除------------------------\nking-api-production-bucardo-stackを削除しています...\nking-api-production-bucardo-stackの削除を待機しています...\nking-api-production-bucardo-stackの削除を待機しています...\nking-api-production-bucardo-stackの削除を待機しています...\n\nAn error occurred <span class=\"o\">(</span>ValidationError<span class=\"o\">)</span> when calling the DescribeStacks operation: Stack with <span class=\"nb\">id </span>king-api-production-bucardo-stack does not exist\nking-api-production-bucardo-stackを削除しました\n3.VPCピアリングの削除------------------------\n4.Auroraスタックの削除------------------------\nking-api-aurora-production-base-stackを削除しています...\nking-api-aurora-production-base-stackの削除を待機しています...\nking-api-aurora-production-base-stackの削除を待機しています...\nking-api-aurora-production-base-stackの削除を待機しています...\nking-api-aurora-production-base-stackの削除を待機しています...\nking-api-aurora-production-base-stackの削除を待機しています...\nking-api-aurora-production-base-stackの削除を待機しています...\nking-api-aurora-production-base-stackの削除を待機しています...\nking-api-aurora-production-base-stackの削除を待機しています...\nking-api-aurora-production-base-stackの削除を待機しています...\nking-api-aurora-production-base-stackを削除しました\n</code></pre></div></div>\n<h2 data-sourcepos=\"119:1-119:27\" id=\"1-5-0\" name=\"1-5-0\"><a class=\"anchor\" id=\"PRDリソースの作成\" name=\"PRDリソースの作成\" href=\"#PRDリソースの作成\" data-position=\"1-5-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"PRDリソースの作成\"> &gt; PRDリソースの作成</span></a>PRDリソースの作成</h2>\n<h3 data-sourcepos=\"121:1-121:10\" id=\"1-5-1\" name=\"1-5-1\"><a class=\"anchor\" id=\"手順-4\" name=\"手順-4\" href=\"#手順-4\" data-position=\"1-5-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"手順\"> &gt; 手順</span></a>手順</h3>\n<div class=\"code-block\" data-sourcepos=\"122:1-124:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>sh ./local_scripts/01_cfn_deploy.sh ./config/production.env\n</code></pre></div></div>\n<h3 data-sourcepos=\"126:1-126:13\" id=\"1-5-2\" name=\"1-5-2\"><a class=\"anchor\" id=\"実行後-4\" name=\"実行後-4\" href=\"#実行後-4\" data-position=\"1-5-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"実行後\"> &gt; 実行後</span></a>実行後</h3>\n<div class=\"code-block\" data-sourcepos=\"128:1-177:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>sh ./local_scripts/01_cfn_deploy.sh ./config/production.env                                                                                                                           12:35:23\n<span class=\"nt\">---------------------------------</span>\nCloudFormationへデプロイします。\n        01_cfn_deploy.sh\n<span class=\"nt\">---------------------------------</span>\n<span class=\"nb\">mkdir</span>: ./tmp: File exists\nスタック名:king-api-aurora-production-base-stack\nEC2 Bucardoスタック名: king-api-production-bucardo-stack\n\n<span class=\"o\">[</span><span class=\"k\">**</span>入力]パラメータをインポートしますか？<span class=\"o\">(</span>y/n<span class=\"o\">)</span>y\nYES - パラメータの確認に進みます\n<span class=\"nt\">-------------</span>入力終了------------\n- 入力内容の確認をします。\n<span class=\"nt\">---------------------------------</span>\n- ベーススタック名<span class=\"o\">(</span>VPC/Aurora<span class=\"o\">)</span>: king-api-aurora-production-base-stack\n- VPC名前タグ: king-api-aurora-production-vpc\n- VPC CIDR範囲: 172.30.0.0/16\n- Aurora データベース名: king-api-production\n- Aurora プライマリ名前タグ: king-api-production\n- Aurora レプリカ名前タグ: king-api-production-replica\n- Aurora インスタンスクラス: db.r5.2xlarge\n<span class=\"nt\">---------------------------------</span>\n- EC2 Bucardoスタック名: king-api-production-bucardo-stack\n- EC2 Bucardoインスタンス名前タグ: king-api-production-bucardo-ec2\n- EC2 Bucardoインスタンスタイプ : i3.2xlarge\n- EC2 BucardoEBSボリュームサイズ: 64\n- EC2 BucardoイメージID: ami-0e2bf1ada70fd3f33\n- EC2 外部接続許可IPアドレス: 39.110.207.11/32\n<span class=\"nt\">---------------------------------</span>\n<span class=\"nt\">---------------------------------</span>\n<span class=\"o\">[</span><span class=\"k\">**</span>入力] デプロイします。よろしいですか？<span class=\"o\">(</span>y/n<span class=\"o\">)</span>: y\nYES - ベーススタックのデプロイを開始します。\n\nWaiting <span class=\"k\">for </span>changeset to be created..\nWaiting <span class=\"k\">for </span>stack create/update to <span class=\"nb\">complete\n</span>Successfully created/updated stack - king-api-aurora-production-base-stack\nbucardoスタックのデプロイを開始します。\n\nWaiting <span class=\"k\">for </span>changeset to be created..\nWaiting <span class=\"k\">for </span>stack create/update to <span class=\"nb\">complete\n</span>Successfully created/updated stack - king-api-production-bucardo-stack\nデプロイコマンドが終了しました。\n実行結果の確認をします\nベーススタック: king-api-aurora-production-base-stack\n状態: CREATE_COMPLETE\nEC2スタック: king-api-production-bucardo-stack\n状態: CREATE_COMPLETE\n確認が完了しました。作成成功です\n</code></pre></div></div>\n<h2 data-sourcepos=\"179:1-179:26\" id=\"1-6-0\" name=\"1-6-0\"><a class=\"anchor\" id=\"8_Private Linkの作成\" name=\"8_Private Linkの作成\" href=\"#8_Private Linkの作成\" data-position=\"1-6-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"8_Private Linkの作成\"> &gt; 8_Private Linkの作成</span></a>8_Private Linkの作成</h2>\n<h3 data-sourcepos=\"181:1-181:10\" id=\"1-6-1\" name=\"1-6-1\"><a class=\"anchor\" id=\"手順-5\" name=\"手順-5\" href=\"#手順-5\" data-position=\"1-6-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"手順\"> &gt; 手順</span></a>手順</h3>\n<div class=\"code-block\" data-sourcepos=\"182:1-184:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>sh ./local_scripts/02_create_private_link.sh ./config/production.env sl2-api-production\n</code></pre></div></div>\n<h3 data-sourcepos=\"186:1-186:13\" id=\"1-6-2\" name=\"1-6-2\"><a class=\"anchor\" id=\"実行後-5\" name=\"実行後-5\" href=\"#実行後-5\" data-position=\"1-6-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"実行後\"> &gt; 実行後</span></a>実行後</h3>\n<div class=\"code-block\" data-sourcepos=\"187:1-222:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>sh ./local_scripts/02_create_private_link.sh ./config/production.env sl2-api-production                                                                                               13:13:29\n0.事前準備------------------------\nHeroku CLI data:privatelink インストール済み\n1.Heroku側のPrivateLinkエンドポイントの作成------------------------\nCreating privatelink endpoint... <span class=\"k\">done\n\n</span>Service Name: com.amazonaws.vpce.ap-northeast-1.vpce-svc-0de703034cbfc279a\nStatus:       Operational\n\nThe privatelink endpoint is now being provisioned <span class=\"k\">for </span>postgresql-objective-43050.\nRun heroku data:privatelink:wait postgresql-objective-43050 <span class=\"nt\">--app</span> sl2-api-production to check the creation process.\nWaiting <span class=\"k\">for </span>the privatelink endpoint to be provisioned... <span class=\"k\">done\n</span>2.AWS側VPCエンドポイントの作成------------------------\n<span class=\"nv\">vpce_state</span><span class=\"o\">=</span> pendingAcceptance\nPrivateLink用AWS VPCエンドポイントの作成が完了していません。1分後に再チェックします\n<span class=\"nv\">vpce_state</span><span class=\"o\">=</span> available\n<span class=\"nb\">mkdir</span>: cred: File exists\nEC2からHeroku PostgresへのPrivate Linkが確立されました。\n3.HerokuDBへのPrivate接続情報取得------------------------\n※ 10分ほどでタイムアウトします。タイムアウトした場合は再度当スクリプトを実行してください。\n<span class=\"o\">[</span>heroku]PrivateLink用VPCエンドポイントの作成が完了していません。1分後に再チェックします\n※ 10分ほどでタイムアウトします。タイムアウトした場合は再度当スクリプトを実行してください。\n<span class=\"o\">[</span>heroku]PrivateLink用VPCエンドポイントの作成が完了していません。1分後に再チェックします\n※ 10分ほどでタイムアウトします。タイムアウトした場合は再度当スクリプトを実行してください。\n4.スクリプト全体の合否判定------------------------\nチェック項目1.Heroku側のPrivateLinkエンドポイントの作成\n- 成功\nチェック項目2.AWS側VPCエンドポイントの作成\n- 成功\nチェック項目3.HerokuDBへのPrivate接続情報取得\n- 成功\n総合判定\n全てのチェックが合格しました。\nスクリプトを終了します。\n</code></pre></div></div>\n<h2 data-sourcepos=\"224:1-224:25\" id=\"1-7-0\" name=\"1-7-0\"><a class=\"anchor\" id=\"9_VPC Peeringの作成\" name=\"9_VPC Peeringの作成\" href=\"#9_VPC Peeringの作成\" data-position=\"1-7-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"9_VPC Peeringの作成\"> &gt; 9_VPC Peeringの作成</span></a>9_VPC Peeringの作成</h2>\n<h3 data-sourcepos=\"226:1-226:10\" id=\"1-7-1\" name=\"1-7-1\"><a class=\"anchor\" id=\"手順-6\" name=\"手順-6\" href=\"#手順-6\" data-position=\"1-7-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"手順\"> &gt; 手順</span></a>手順</h3>\n<div class=\"code-block\" data-sourcepos=\"227:1-229:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>sh ./local_scripts/03_create_vpc_peering.sh ./config/production.env\n</code></pre></div></div>\n<h3 data-sourcepos=\"231:1-231:13\" id=\"1-7-2\" name=\"1-7-2\"><a class=\"anchor\" id=\"実行後-6\" name=\"実行後-6\" href=\"#実行後-6\" data-position=\"1-7-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"実行後\"> &gt; 実行後</span></a>実行後</h3>\n<div class=\"code-block\" data-sourcepos=\"232:1-255:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>sh ./local_scripts/03_create_vpc_peering.sh ./config/production.env                                                                                                                   13:41:57\n0.事前準備------------------------\nHeroku Private Space情報の取得\n1.AWSでVPC Peeringを作成------------------------\n2.Heroku側にリクエストが届いているか確認------------------------\n※実行には5〜10分ほど時間がかかります<span class=\"o\">(</span>ループで確認します<span class=\"o\">)</span>\nHeroku側でVPC Peeringが検知できていません 1分後に再試行します\n3.Heroku側からピアリングの承諾------------------------\nAccepting and configuring peering connection pcx-015f321136da1a68f\n4.AWS Aurora RouteTableにルート追加------------------------\n5.スクリプト全体の合否判定------------------------\nチェック項目1.AWSでVPC Peeringを作成\nactive\n- 成功\nチェック項目2.Heroku側からピアリングの承諾\n +Heroku側でVPC Peeringリクエストが届いているか確認<span class=\"o\">(</span>実行項目の2と3<span class=\"o\">)</span>\n- 成功\nチェック項目3.AWS Aurora RouteTableにルート追加<span class=\"o\">(</span>実行項目の4<span class=\"o\">)</span>\n- 成功\n総合判定\n全てのチェックが合格しました。\nスクリプトを終了します。\n</code></pre></div></div>\n<h2 data-sourcepos=\"257:1-257:21\" id=\"1-8-0\" name=\"1-8-0\"><a class=\"anchor\" id=\"10_EC2接続準備\" name=\"10_EC2接続準備\" href=\"#10_EC2接続準備\" data-position=\"1-8-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"10_EC2接続準備\"> &gt; 10_EC2接続準備</span></a>10_EC2接続準備</h2>\n<h3 data-sourcepos=\"259:1-259:10\" id=\"1-8-1\" name=\"1-8-1\"><a class=\"anchor\" id=\"手順-7\" name=\"手順-7\" href=\"#手順-7\" data-position=\"1-8-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"手順\"> &gt; 手順</span></a>手順</h3>\n<div class=\"code-block\" data-sourcepos=\"260:1-262:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>sh ./local_scripts/04_ec2_login.sh ./config/production.env sl2-api-production\n</code></pre></div></div>\n<h3 data-sourcepos=\"263:1-263:13\" id=\"1-8-2\" name=\"1-8-2\"><a class=\"anchor\" id=\"実行後-7\" name=\"実行後-7\" href=\"#実行後-7\" data-position=\"1-8-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"実行後\"> &gt; 実行後</span></a>実行後</h3>\n<div class=\"code-block\" data-sourcepos=\"264:1-315:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>sh ./local_scripts/04_ec2_login.sh ./config/production.env sl2-api-production                                                                                                         13:57:21\n1.各DBの接続情報ファイルを作成------------------------\n2.EC2にDBの接続情報ファイルを送信------------------------\nThe authenticity of host <span class=\"s1\">'ec2-52-197-147-182.ap-northeast-1.compute.amazonaws.com (52.197.147.182)'</span> cant be established.\nED25519 key fingerprint is SHA256:h7nZIgJfpXhs646YwNBAhYXArbpjJExVuSOk0bPQnng.\nThis key is not known by any other names\nAre you sure you want to <span class=\"k\">continue </span>connecting <span class=\"o\">(</span><span class=\"nb\">yes</span>/no/[fingerprint]<span class=\"o\">)</span>? <span class=\"nb\">yes\n</span>Warning: Permanently added <span class=\"s1\">'ec2-52-197-147-182.ap-northeast-1.compute.amazonaws.com'</span> <span class=\"o\">(</span>ED25519<span class=\"o\">)</span> to the list of known hosts.\nking-api-production.env                                                                                                                                        100%  629    41.4KB/s   00:00    \n3.EC2にsshでログイン-------------------\nEC2<span class=\"o\">(</span>ec2-52-197-147-182.ap-northeast-1.compute.amazonaws.com<span class=\"o\">)</span>に[king-api-production.env]を送信しました。\n以後はsshにて接続し以下のコマンドを入力します。\n<span class=\"nt\">----1</span>.--------------------------------------------------------\n<span class=\"o\">[</span>EC2] <span class=\"nb\">sudo </span>docker ps\n出てきたCONTAINER_IDの値を格納すると楽です\n<span class=\"nv\">container</span><span class=\"o\">=</span><span class=\"k\">************</span> <span class=\"o\">(</span>docker psの結果を<span class=\"k\">*</span>にコピペ<span class=\"o\">)</span>\n<span class=\"nt\">----2</span>.--------------------------------------------------------\n<span class=\"o\">(</span>検証環境の場合<span class=\"o\">)</span>\nec2接続のみの場合は下記コマンドは不要です\n<span class=\"o\">[</span>EC2] <span class=\"nb\">sudo </span>docker <span class=\"nb\">cp</span> ~/king-api-cfn-test.env <span class=\"nv\">$container</span>:/.\n<span class=\"nt\">----3</span>.--------------------------------------------------------\n<span class=\"o\">[</span>EC2] <span class=\"nb\">sudo </span>docker <span class=\"nb\">exec</span> <span class=\"nt\">-it</span> <span class=\"nt\">--user</span> root <span class=\"nv\">$container</span> sh \n<span class=\"nt\">----4</span>.--------------------------------------------------------\nec2接続のみの場合は下記コマンドは不要です\n<span class=\"o\">[</span>Dockerコンテナ内] bash 05_table_migration_dump_restore.sh king-api-production.env\n<span class=\"nt\">----------------------------------------------</span>\n以降sshにて接続されます。遷移後、上記コマンドを入力してください\nWelcome to Ubuntu 22.04.1 LTS <span class=\"o\">(</span>GNU/Linux 5.15.0-1026-aws x86_64<span class=\"o\">)</span>\n\n <span class=\"k\">*</span> Documentation:  https://help.ubuntu.com\n <span class=\"k\">*</span> Management:     https://landscape.canonical.com\n <span class=\"k\">*</span> Support:        https://ubuntu.com/advantage\n\n  System information as of Mon Apr 17 04:57:30 UTC 2023\n\n  System load:  0.080078125       Processes:                171\n  Usage of /:   4.3% of 61.84GB   Users logged <span class=\"k\">in</span>:          0\n  Memory usage: 1%                IPv4 address <span class=\"k\">for </span>docker0: 172.17.0.1\n  Swap usage:   0%                IPv4 address <span class=\"k\">for </span>ens3:    172.30.3.25\n\n\n106 updates can be applied immediately.\n55 of these updates are standard security updates.\nTo see these additional updates run: apt list <span class=\"nt\">--upgradable</span>\n\n\nTo run a <span class=\"nb\">command </span>as administrator <span class=\"o\">(</span>user <span class=\"s2\">\"root\"</span><span class=\"o\">)</span>, use <span class=\"s2\">\"sudo &lt;command&gt;\"</span><span class=\"nb\">.</span>\nSee <span class=\"s2\">\"man sudo_root\"</span> <span class=\"k\">for </span>details.\n\nubuntu@ip-172-30-3-25:~<span class=\"err\">$</span>\n</code></pre></div></div>\n<h2 data-sourcepos=\"317:1-317:45\" id=\"1-9-0\" name=\"1-9-0\"><a class=\"anchor\" id=\"11_以下手順のパラメータを修正\" name=\"11_以下手順のパラメータを修正\" href=\"#11_以下手順のパラメータを修正\" data-position=\"1-9-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"11_以下手順のパラメータを修正\"> &gt; 11_以下手順のパラメータを修正</span></a>11_以下手順のパラメータを修正</h2>\n<p data-sourcepos=\"319:1-319:39\">手順書のコマンドを修正する</p>\n<p data-sourcepos=\"321:1-327:24\">HerokuDBエンドポイント<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/17/136273/aec00340-aeb4-4353-80d1-1aa5ec3da34a.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"523\" alt=\"スクリーンショット 2023-04-17 14.05.55.png (61.7 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/17/136273/aec00340-aeb4-4353-80d1-1aa5ec3da34a.png\"></a><br>\nAuroraパスワード<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/17/136273/dc9fd8d0-41b2-408c-9319-fd77249e8564.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"525\" alt=\"スクリーンショット 2023-04-17 14.08.44.png (75.3 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/17/136273/dc9fd8d0-41b2-408c-9319-fd77249e8564.png\"></a><br>\nコンテナID<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/17/136273/f0f8aa21-a767-4968-87f3-f05d79fcae3c.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"519\" alt=\"スクリーンショット 2023-04-17 14.10.07.png (59.0 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/17/136273/f0f8aa21-a767-4968-87f3-f05d79fcae3c.png\"></a><br>\nEC2エンドポイント</p>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/17/136273/2c916282-3938-486c-9ee8-946b0dcc0538.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"522\" alt=\"スクリーンショット 2023-04-17 14.10.59.png (64.1 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/17/136273/2c916282-3938-486c-9ee8-946b0dcc0538.png\"></a>\n<h2 data-sourcepos=\"331:1-331:42\" id=\"1-10-0\" name=\"1-10-0\"><a class=\"anchor\" id=\"12_パラメータグループの作成\" name=\"12_パラメータグループの作成\" href=\"#12_パラメータグループの作成\" data-position=\"1-10-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"12_パラメータグループの作成\"> &gt; 12_パラメータグループの作成</span></a>12_パラメータグループの作成</h2>\n<p data-sourcepos=\"333:1-333:81\">前回のパラメータグループは削除してから再度作成しました</p>\n<h3 data-sourcepos=\"335:1-335:10\" id=\"1-10-1\" name=\"1-10-1\"><a class=\"anchor\" id=\"手順-8\" name=\"手順-8\" href=\"#手順-8\" data-position=\"1-10-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"手順\"> &gt; 手順</span></a>手順</h3>\n<p data-sourcepos=\"337:1-339:62\">パラメータグループ<code>king-api-production-parametergroup</code>をコピーし、名前を<br>\n<code>king-api-production-parametergroup-session-replication-role-replica</code>にする。<br>\n→<code>session_replication_role</code>の値を<code>replica</code>にして保存</p>\n<h3 data-sourcepos=\"341:1-341:13\" id=\"1-10-2\" name=\"1-10-2\"><a class=\"anchor\" id=\"実行後-8\" name=\"実行後-8\" href=\"#実行後-8\" data-position=\"1-10-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"実行後\"> &gt; 実行後</span></a>実行後</h3>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/17/136273/54fcb793-4d28-4648-adf1-afc455bcbf15.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"1324\" alt=\"スクリーンショット 2023-04-17 14.14.53.png (61.2 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/17/136273/54fcb793-4d28-4648-adf1-afc455bcbf15.png\"></a>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/17/136273/7dbb2301-0c8e-4e65-8583-271086781280.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"1085\" alt=\"スクリーンショット 2023-04-17 14.16.00.png (94.2 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/17/136273/7dbb2301-0c8e-4e65-8583-271086781280.png\"></a>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/17/136273/1186ca84-6c6f-4be8-a460-6af6eede643d.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"1371\" alt=\"スクリーンショット 2023-04-17 14.16.21.png (95.6 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/17/136273/1186ca84-6c6f-4be8-a460-6af6eede643d.png\"></a>\n<h2 data-sourcepos=\"347:1-347:44\" id=\"1-11-0\" name=\"1-11-0\"><a class=\"anchor\" id=\"13_事前準備(pemファイルの取得)\" name=\"13_事前準備(pemファイルの取得)\" href=\"#13_事前準備(pemファイルの取得)\" data-position=\"1-11-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"13_事前準備(pemファイルの取得)\"> &gt; 13_事前準備(pemファイルの取得)</span></a>13_事前準備(pemファイルの取得)</h2>\n<h3 data-sourcepos=\"349:1-349:10\" id=\"1-11-1\" name=\"1-11-1\"><a class=\"anchor\" id=\"手順-9\" name=\"手順-9\" href=\"#手順-9\" data-position=\"1-11-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"手順\"> &gt; 手順</span></a>手順</h3>\n<div class=\"code-block\" data-sourcepos=\"351:1-360:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code><span class=\"nv\">key_pair_id</span><span class=\"o\">=(</span><span class=\"sb\">`</span>aws ec2 describe-key-pairs <span class=\"se\">\\</span>\n        <span class=\"nt\">--key-name</span> king-api-production-bucardo-ec2 <span class=\"se\">\\</span>\n        <span class=\"nt\">--query</span> <span class=\"s2\">\"KeyPairs[].KeyPairId\"</span> <span class=\"se\">\\</span>\n        <span class=\"nt\">--output</span> text<span class=\"sb\">`</span><span class=\"o\">)</span>\naws ssm get-parameter <span class=\"nt\">--name</span> /ec2/keypair/<span class=\"nv\">$key_pair_id</span> <span class=\"se\">\\</span>\n        <span class=\"nt\">--with-decryption</span> <span class=\"nt\">--output</span> text <span class=\"se\">\\</span>\n        <span class=\"nt\">--query</span> <span class=\"s2\">\"Parameter.Value\"</span> <span class=\"o\">&gt;</span>king-api-production-bucardo-ec2.pem\n<span class=\"nb\">chmod </span>0600 king-api-production-bucardo-ec2.pem\n</code></pre></div></div>\n<h3 data-sourcepos=\"361:1-361:13\" id=\"1-11-2\" name=\"1-11-2\"><a class=\"anchor\" id=\"実行後-9\" name=\"実行後-9\" href=\"#実行後-9\" data-position=\"1-11-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"実行後\"> &gt; 実行後</span></a>実行後</h3>\n<div class=\"code-block\" data-sourcepos=\"362:1-364:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code><span class=\"nt\">-rw-------</span>    1 sugiyamasatoshi  staff      1675  4 17 14:19 king-api-production-bucardo-ec2.pem\n</code></pre></div></div>\n<h2 data-sourcepos=\"366:1-366:40\" id=\"1-12-0\" name=\"1-12-0\"><a class=\"anchor\" id=\"14_事前準備(count.shのコピー)\" name=\"14_事前準備(count.shのコピー)\" href=\"#14_事前準備(count.shのコピー)\" data-position=\"1-12-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"14_事前準備(count.shのコピー)\"> &gt; 14_事前準備(count.shのコピー)</span></a>14_事前準備(count.shのコピー)</h2>\n<h3 data-sourcepos=\"368:1-368:10\" id=\"1-12-1\" name=\"1-12-1\"><a class=\"anchor\" id=\"手順-10\" name=\"手順-10\" href=\"#手順-10\" data-position=\"1-12-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"手順\"> &gt; 手順</span></a>手順</h3>\n<div class=\"code-block\" data-sourcepos=\"369:1-385:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight plaintext\"><code>以下のスクリプトをcount.shとしておいておく\n#!/bin/bash\n\n# 配列を定義する\nmy_array=(\"active_storage_attachments\" \"active_storage_blobs\" \"active_storage_variant_records\" \"ar_internal_metadata\" \"autolock_schedules\" \"command_logs\" \"dailies\" \"delayed_jobs\" \"display_logs\" \"door_mode_changed_histories\" \"durations\" \"entrance_block_fob_keys\" \"entrance_block_knight_cards\" \"entrance_fob_keys\" \"entrance_invitations\" \"entrance_knight_keys\" \"entrance_knight_pins\" \"entrance_lock_settings\" \"entrance_locks\" \"entrance_master_keys\" \"entrance_resident_guest_keys\" \"entrance_resident_keys\" \"family_keys\" \"fob_keys\" \"fobs\" \"guest_keys\" \"hubs\" \"invitations\" \"json_web_keys\" \"knight_cards\" \"knight_commands\" \"knight_keys\" \"knight_logs\" \"knight_pins\" \"knights\" \"laresia_pins\" \"lock_settings\" \"lock_webhook_tokens\" \"locks\" \"logs\" \"managers\" \"master_keys\" \"mst_display_logs\" \"relationships\" \"resident_guest_keys\" \"resident_keys\" \"schema_migrations\" \"term_of_validities\" \"users\" \"webhook_tokens\" \"webhooks\" \"weeklies\" \"wena_keys\" \"wenas\")\n\n# 配列の要素を1つずつ表示する\nfor element in \"${my_array[@]}\"\ndo\n    echo \"# $element\"\n    echo \"heroku\"\n    psql -h vpce-0bed708f6ce21788a-f4tmby1p.vpce-svc-0de703034cbfc279a.ap-northeast-1.vpce.amazonaws.com -p 5432 -d dncvsso7me9p6 -U ubev937lfpa1d3 -c \"select count(*) from $element;\"\n    echo \"AWS\"\n    psql -h king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com -p 5432 -d kingapi -U kingadmin -c \"select count(*) from $element;\"\ndone\n</code></pre></div></div>\n<div class=\"code-block\" data-sourcepos=\"386:1-392:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code><span class=\"o\">&gt;</span> <span class=\"nb\">local\n</span>scp <span class=\"nt\">-i</span> <span class=\"s2\">\"king-api-production-bucardo-ec2.pem\"</span> count.sh ubuntu@ec2-52-197-147-182.ap-northeast-1.compute.amazonaws.com:/home/ubuntu/\n\n<span class=\"o\">&gt;</span> ec2\n<span class=\"nb\">sudo </span>docker <span class=\"nb\">cp </span>count.sh 10cf28189a1f:/\n</code></pre></div></div>\n<h3 data-sourcepos=\"393:1-393:13\" id=\"1-12-2\" name=\"1-12-2\"><a class=\"anchor\" id=\"実行後-10\" name=\"実行後-10\" href=\"#実行後-10\" data-position=\"1-12-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"実行後\"> &gt; 実行後</span></a>実行後</h3>\n<div class=\"code-block\" data-sourcepos=\"394:1-399:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code><span class=\"c\"># sugiyamasatoshi @ sugiyamasatoshinoMacBook-Pro in ~ [14:19:12]</span>\n<span class=\"nv\">$ </span><span class=\"nb\">touch </span>count.sh                                                                          \n<span class=\"c\"># sugiyamasatoshi @ sugiyamasatoshinoMacBook-Pro in ~ [14:21:52]</span>\n<span class=\"nv\">$ </span>vim count.sh\n</code></pre></div></div>\n<div class=\"code-block\" data-sourcepos=\"400:1-418:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>vim</div><div class=\"highlight\"><pre class=\"highlight plaintext\"><code>#!/bin/bash\n\n# 配列を定義する\nmy_array=(\"active_storage_attachments\" \"active_storage_blobs\" \"active_storage_variant_records\" \"ar_internal_metadata\" \"autolock_schedules\" \"command_logs\" \"dailies\" \"delayed_jobs\" \"display_logs\" \"door_mode_changed_histories\" \"durations\" \"entrance_block_fob_keys\" \"entrance_block_knight_cards\" \"entrance_fob_keys\" \"entrance_invitations\" \"entrance_knight_keys\" \"entrance_knight_pins\" \"entrance_lock_settings\" \"entrance_locks\" \"entrance_master_keys\" \"entrance_resident_guest_keys\" \"entrance_resident_keys\" \"family_keys\" \"fob_keys\" \"fobs\" \"guest_keys\" \"hubs\" \"invitations\" \"json_web_keys\" \"knight_cards\" \"knight_commands\" \"knight_keys\" \"knight_logs\" \"knight_pins\" \"knights\" \"laresia_pins\" \"lock_settings\" \"lock_webhook_tokens\" \"locks\" \"logs\" \"managers\" \"master_keys\" \"mst_display_logs\" \"relationships\" \"resident_guest_keys\" \"resident_keys\" \"schema_migrations\" \"term_of_validities\" \"users\" \"webhook_tokens\" \"webhooks\" \"weeklies\" \"wena_keys\" \"wenas\")\n\n# 配列の要素を1つずつ表示する\nfor element in \"${my_array[@]}\"\ndo\n    echo \"# $element\"\n    echo \"heroku\"\n    psql -h vpce-0bed708f6ce21788a-f4tmby1p.vpce-svc-0de703034cbfc279a.ap-northeast-1.vpce.amazonaws.com -p 5432 -d dncvsso7me9p6 -U ubev937lfpa1d3 -c \"select count(*) from $element;\"\n    echo \"AWS\"\n    psql -h king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com -p 5432 -d kingapi -U kingadmin -c \"select count(*) from $element;\"\ndone\n\n~\n\"count.sh\" 15L, 1459B written\n</code></pre></div></div>\n<div class=\"code-block\" data-sourcepos=\"420:1-490:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>scp <span class=\"nt\">-i</span> <span class=\"s2\">\"king-api-production-bucardo-ec2.pem\"</span> count.sh ubuntu@ec2-52-197-147-182.ap-northeast-1.compute.amazonaws.com:/home/ubuntu/\ncount.sh                              100% 1459    82.2KB/s   00:00\n\n\nssh <span class=\"nt\">-i</span> <span class=\"s2\">\"king-api-production-bucardo-ec2.pem\"</span> ubuntu@ec2-52-197-147-182.ap-northeast-1.compute.amazonaws.com\nWelcome to Ubuntu 22.04.1 LTS <span class=\"o\">(</span>GNU/Linux 5.15.0-1026-aws x86_64<span class=\"o\">)</span>\n\n <span class=\"k\">*</span> Documentation:  https://help.ubuntu.com\n <span class=\"k\">*</span> Management:     https://landscape.canonical.com\n <span class=\"k\">*</span> Support:        https://ubuntu.com/advantage\n\n  System information as of Mon Apr 17 05:23:22 UTC 2023\n\n  System load:  0.0390625         Processes:                172\n  Usage of /:   4.3% of 61.84GB   Users logged <span class=\"k\">in</span>:          1\n  Memory usage: 0%                IPv4 address <span class=\"k\">for </span>docker0: 172.17.0.1\n  Swap usage:   0%                IPv4 address <span class=\"k\">for </span>ens3:    172.30.3.25\n\n\n106 updates can be applied immediately.\n55 of these updates are standard security updates.\nTo see these additional updates run: apt list <span class=\"nt\">--upgradable</span>\n\n\nLast login: Mon Apr 17 04:57:34 2023 from 138.64.85.180\nubuntu@ip-172-30-3-25:~<span class=\"nv\">$ </span><span class=\"nb\">ls</span> <span class=\"nt\">-a</span>\n<span class=\"nb\">.</span>  ..  .bash_logout  .bashrc  .cache  .profile  .ssh  .sudo_as_admin_successful  count.sh  king-api-production.env\nubuntu@ip-172-30-3-25:~<span class=\"nv\">$ </span><span class=\"nb\">sudo </span>docker <span class=\"nb\">cp </span>count.sh 10cf28189a1f:/\nPreparing to copy...\nCopying to container - 3.072kB\nSuccessfully copied 3.072kB to 10cf28189a1f:/\nubuntu@ip-172-30-3-25:~<span class=\"nv\">$ </span><span class=\"nb\">sudo </span>docker <span class=\"nb\">exec</span> <span class=\"nt\">-it</span> <span class=\"nt\">--user</span> root  10cf28189a1f sh\n\n<span class=\"c\"># ls -la</span>\ntotal 24\ndrwxr-xr-x   1 root root   22 Apr 17 05:24 <span class=\"nb\">.</span>\ndrwxr-xr-x   1 root root   22 Apr 17 05:24 ..\n<span class=\"nt\">-rwxr-xr-x</span>   1 root root    0 Apr 17 03:59 .dockerenv\n<span class=\"nt\">-rw-r--r--</span>   1 root root 2012 Feb 24 01:47 05_table_migration_dump_restore.sh\n<span class=\"nt\">-rw-r--r--</span>   1 root root 1966 Feb 21 05:08 06_bucardo_setup.sh\n<span class=\"nt\">-rw-r--r--</span>   1 root root 1398 Mar 13 12:09 07_data_dump_restore.sh\n<span class=\"nt\">-rw-r--r--</span>   1 root root 1910 Mar 13 12:09 08_check_tables.sh\nlrwxrwxrwx   1 root root    7 Mar  1 02:03 bin -&gt; usr/bin\ndrwxr-xr-x   2 root root    6 Apr 18  2022 boot\n<span class=\"nt\">-rw-r--r--</span>   1 1000 1000 1459 Apr 17 05:23 count.sh\n<span class=\"nt\">-rw-r--r--</span>   1 root root   97 Feb 20 05:56 create-bucardo-user.sql\ndrwxr-xr-x   5 root root  360 Apr 17 03:59 dev\ndrwxr-xr-x   1 root root   66 Apr 17 03:59 etc\ndrwxr-xr-x   2 root root    6 Apr 18  2022 home\nlrwxrwxrwx   1 root root    7 Mar  1 02:03 lib -&gt; usr/lib\nlrwxrwxrwx   1 root root    9 Mar  1 02:03 lib32 -&gt; usr/lib32\nlrwxrwxrwx   1 root root    9 Mar  1 02:03 lib64 -&gt; usr/lib64\nlrwxrwxrwx   1 root root   10 Mar  1 02:03 libx32 -&gt; usr/libx32\ndrwxr-xr-x   2 root root    6 Mar  1 02:03 media\ndrwxr-xr-x   2 root root    6 Mar  1 02:03 mnt\ndrwxr-xr-x   2 root root    6 Mar  1 02:03 opt\ndr-xr-xr-x 239 root root    0 Apr 17 03:59 proc\ndrwx------   2 root root   37 Mar  1 02:06 root\ndrwxr-xr-x   1 root root   24 Mar 14 01:04 run\nlrwxrwxrwx   1 root root    8 Mar  1 02:03 sbin -&gt; usr/sbin\ndrwxr-xr-x   2 root root    6 Mar  1 02:03 srv\ndr-xr-xr-x  13 root root    0 Apr 17 03:59 sys\ndrwxrwxrwt   1 root root    6 Mar 14 01:04 tmp\ndrwxr-xr-x   1 root root   96 Mar  1 02:03 usr\ndrwxr-xr-x   1 root root   28 Mar  1 02:06 var\n<span class=\"c\"># exit</span>\nubuntu@ip-172-30-3-25:~<span class=\"nv\">$ </span><span class=\"nb\">exit\nlogout\n</span>Connection to ec2-52-197-147-182.ap-northeast-1.compute.amazonaws.com closed.\n</code></pre></div></div>\n<h2 data-sourcepos=\"492:1-492:39\" id=\"1-13-0\" name=\"1-13-0\"><a class=\"anchor\" id=\"15_事前準備(data_bkのコピー)\" name=\"15_事前準備(data_bkのコピー)\" href=\"#15_事前準備(data_bkのコピー)\" data-position=\"1-13-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"15_事前準備(data_bkのコピー)\"> &gt; 15_事前準備(data_bkのコピー)</span></a>15_事前準備(data_bkのコピー)</h2>\n<h3 data-sourcepos=\"494:1-494:10\" id=\"1-13-1\" name=\"1-13-1\"><a class=\"anchor\" id=\"手順-11\" name=\"手順-11\" href=\"#手順-11\" data-position=\"1-13-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"手順\"> &gt; 手順</span></a>手順</h3>\n<div class=\"code-block\" data-sourcepos=\"495:1-508:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>以下のスクリプトをdata_bk.shとしておいておく\n<span class=\"c\">#!/bin/bash</span>\n\n<span class=\"nb\">mkdir</span> ./data_bk\n\n<span class=\"c\"># logs</span>\npsql <span class=\"nt\">-h</span> vpce-0bed708f6ce21788a-f4tmby1p.vpce-svc-0de703034cbfc279a.ap-northeast-1.vpce.amazonaws.com <span class=\"nt\">-U</span> ubev937lfpa1d3 <span class=\"nt\">-d</span> dncvsso7me9p6 <span class=\"nt\">-c</span> <span class=\"s2\">\"COPY (select * from logs where updated_at &gt; (NOW() - interval '12 hours') order by updated_at desc) TO STDOUT WITH CSV HEADER;\"</span> <span class=\"o\">&gt;</span> ./data_bk/logs_heroku.csv\npsql <span class=\"nt\">-h</span> king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com <span class=\"nt\">-U</span> kingadmin <span class=\"nt\">-d</span> kingapi <span class=\"nt\">-c</span> <span class=\"s2\">\"COPY (select * from logs where updated_at &gt; (NOW() - interval '12 hours') order by updated_at desc) TO STDOUT WITH CSV HEADER;\"</span> <span class=\"o\">&gt;</span> ./data_bk/logs_aws.csv\n\n<span class=\"c\"># display_logs</span>\npsql <span class=\"nt\">-h</span> vpce-0bed708f6ce21788a-f4tmby1p.vpce-svc-0de703034cbfc279a.ap-northeast-1.vpce.amazonaws.com <span class=\"nt\">-U</span> ubev937lfpa1d3 <span class=\"nt\">-d</span> dncvsso7me9p6 <span class=\"nt\">-c</span> <span class=\"s2\">\"COPY (select * from display_logs where created_at &gt; (NOW() - interval '12 hours') order by created_at desc) TO STDOUT WITH CSV HEADER;\"</span> <span class=\"o\">&gt;</span> ./data_bk/display_logs_heroku.csv\npsql <span class=\"nt\">-h</span> king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com <span class=\"nt\">-U</span> kingadmin <span class=\"nt\">-d</span> kingapi <span class=\"nt\">-c</span> <span class=\"s2\">\"COPY (select * from display_logs where created_at &gt; (NOW() - interval '12 hours') order by created_at desc) TO STDOUT WITH CSV HEADER;\"</span> <span class=\"o\">&gt;</span> ./data_bk/display_logs_aws.csv\n</code></pre></div></div>\n<div class=\"code-block\" data-sourcepos=\"509:1-515:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code><span class=\"o\">&gt;</span> <span class=\"nb\">local\n</span>scp <span class=\"nt\">-i</span> <span class=\"s2\">\"king-api-production-bucardo-ec2.pem\"</span> data_bk.sh ubuntu@ec2-52-197-147-182.ap-northeast-1.compute.amazonaws.com:/home/ubuntu/\n\n<span class=\"o\">&gt;</span> ec2\n<span class=\"nb\">sudo </span>docker <span class=\"nb\">cp </span>data_bk.sh 10cf28189a1f:/\n</code></pre></div></div>\n<h3 data-sourcepos=\"517:1-517:13\" id=\"1-13-2\" name=\"1-13-2\"><a class=\"anchor\" id=\"実行後-11\" name=\"実行後-11\" href=\"#実行後-11\" data-position=\"1-13-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"実行後\"> &gt; 実行後</span></a>実行後</h3>\n<div class=\"code-block\" data-sourcepos=\"518:1-523:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code><span class=\"c\"># sugiyamasatoshi @ sugiyamasatoshinoMacBook-Pro in ~ [14:27:59] C:1</span>\n<span class=\"nv\">$ </span><span class=\"nb\">touch </span>data_bk.sh\n<span class=\"c\"># sugiyamasatoshi @ sugiyamasatoshinoMacBook-Pro in ~ [14:28:04]</span>\n<span class=\"nv\">$ </span>vim data_bk.sh\n</code></pre></div></div>\n<div class=\"code-block\" data-sourcepos=\"524:1-539:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>vim</div><div class=\"highlight\"><pre class=\"highlight viml\"><code>#<span class=\"p\">!</span><span class=\"sr\">/bin/</span>bash\n\n<span class=\"nb\">mkdir</span> <span class=\"p\">.</span>/data_bk\n\n# logs\npsql <span class=\"p\">-</span><span class=\"k\">h</span> vpce<span class=\"m\">-0</span>bed708f6ce21788a<span class=\"p\">-</span>f4tmby1p<span class=\"p\">.</span>vpce<span class=\"p\">-</span>svc<span class=\"m\">-0</span>de703034cbfc279a<span class=\"p\">.</span>ap<span class=\"p\">-</span>northeast<span class=\"m\">-1</span><span class=\"p\">.</span>vpce<span class=\"p\">.</span>amazonaws<span class=\"p\">.</span><span class=\"k\">com</span> <span class=\"p\">-</span>U ubev937lfpa1d3 <span class=\"p\">-</span><span class=\"k\">d</span> dncvsso7me9p6 <span class=\"p\">-</span><span class=\"k\">c</span> <span class=\"s2\">\"COPY (select * from logs where updated_at &gt; (NOW() - interval '12 hours') order by updated_at desc) TO STDOUT WITH CSV HEADER;\"</span> <span class=\"p\">&gt;</span> <span class=\"p\">.</span><span class=\"sr\">/data_bk/</span>logs_heroku<span class=\"p\">.</span>csv\npsql <span class=\"p\">-</span><span class=\"k\">h</span> king<span class=\"p\">-</span>api<span class=\"p\">-</span>production<span class=\"p\">.</span>cluster<span class=\"p\">-</span>cucbox6dvi64<span class=\"p\">.</span>ap<span class=\"p\">-</span>northeast<span class=\"m\">-1</span><span class=\"p\">.</span>rds<span class=\"p\">.</span>amazonaws<span class=\"p\">.</span><span class=\"k\">com</span> <span class=\"p\">-</span>U kingadmin <span class=\"p\">-</span><span class=\"k\">d</span> kingapi <span class=\"p\">-</span><span class=\"k\">c</span> <span class=\"s2\">\"COPY (select * from logs where updated_at &gt; (NOW() - interval '12 hours') order by updated_at desc) TO STDOUT WITH CSV HEADER;\"</span> <span class=\"p\">&gt;</span> <span class=\"p\">.</span><span class=\"sr\">/data_bk/</span>logs_aws<span class=\"p\">.</span>csv\n\n# display_logs\npsql <span class=\"p\">-</span><span class=\"k\">h</span> vpce<span class=\"m\">-0</span>bed708f6ce21788a<span class=\"p\">-</span>f4tmby1p<span class=\"p\">.</span>vpce<span class=\"p\">-</span>svc<span class=\"m\">-0</span>de703034cbfc279a<span class=\"p\">.</span>ap<span class=\"p\">-</span>northeast<span class=\"m\">-1</span><span class=\"p\">.</span>vpce<span class=\"p\">.</span>amazonaws<span class=\"p\">.</span><span class=\"k\">com</span> <span class=\"p\">-</span>U ubev937lfpa1d3 <span class=\"p\">-</span><span class=\"k\">d</span> dncvsso7me9p6 <span class=\"p\">-</span><span class=\"k\">c</span> <span class=\"s2\">\"COPY (select * from display_logs where created_at &gt; (NOW() - interval '12 hours') order by created_at desc) TO STDOUT WITH CSV HEADER;\"</span> <span class=\"p\">&gt;</span> <span class=\"p\">.</span><span class=\"sr\">/data_bk/</span>display_logs_heroku<span class=\"p\">.</span>csv\npsql <span class=\"p\">-</span><span class=\"k\">h</span> king<span class=\"p\">-</span>api<span class=\"p\">-</span>production<span class=\"p\">.</span>cluster<span class=\"p\">-</span>cucbox6dvi64<span class=\"p\">.</span>ap<span class=\"p\">-</span>northeast<span class=\"m\">-1</span><span class=\"p\">.</span>rds<span class=\"p\">.</span>amazonaws<span class=\"p\">.</span><span class=\"k\">com</span> <span class=\"p\">-</span>U kingadmin <span class=\"p\">-</span><span class=\"k\">d</span> kingapi <span class=\"p\">-</span><span class=\"k\">c</span> <span class=\"s2\">\"COPY (select * from display_logs where created_at &gt; (NOW() - interval '12 hours') order by created_at desc) TO STDOUT WITH CSV HEADER;\"</span> <span class=\"p\">&gt;</span> <span class=\"p\">.</span><span class=\"sr\">/data_bk/</span>display_logs_aws<span class=\"p\">.</span>csv\n\n<span class=\"p\">~</span>\n<span class=\"c\">\"data_bk.sh\" 12L, 1204B written</span>\n</code></pre></div></div>\n<div class=\"code-block\" data-sourcepos=\"541:1-605:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>scp <span class=\"nt\">-i</span> <span class=\"s2\">\"king-api-production-bucardo-ec2.pem\"</span> data_bk.sh ubuntu@ec2-52-197-147-182.ap-northeast-1.compute.amazonaws.com:/home/ubuntu/\ndata_bk.sh                          100% 1204    70.8KB/s   00:00\n\nssh <span class=\"nt\">-i</span> <span class=\"s2\">\"king-api-production-bucardo-ec2.pem\"</span> ubuntu@ec2-52-197-147-182.ap-northeast-1.compute.amazonaws.com                                                                         14:31:30\nWelcome to Ubuntu 22.04.1 LTS <span class=\"o\">(</span>GNU/Linux 5.15.0-1026-aws x86_64<span class=\"o\">)</span>\n\n <span class=\"k\">*</span> Documentation:  https://help.ubuntu.com\n <span class=\"k\">*</span> Management:     https://landscape.canonical.com\n <span class=\"k\">*</span> Support:        https://ubuntu.com/advantage\n\n  System information as of Mon Apr 17 05:32:32 UTC 2023\n\n  System load:  0.0               Processes:                175\n  Usage of /:   4.3% of 61.84GB   Users logged <span class=\"k\">in</span>:          0\n  Memory usage: 0%                IPv4 address <span class=\"k\">for </span>docker0: 172.17.0.1\n  Swap usage:   0%                IPv4 address <span class=\"k\">for </span>ens3:    172.30.3.25\n\n\n106 updates can be applied immediately.\n55 of these updates are standard security updates.\nTo see these additional updates run: apt list <span class=\"nt\">--upgradable</span>\n\n\nLast login: Mon Apr 17 05:25:36 2023 from 138.64.85.180\nubuntu@ip-172-30-3-25:~<span class=\"nv\">$ </span><span class=\"nb\">sudo </span>docker <span class=\"nb\">cp </span>data_bk.sh 10cf28189a1f:/\nPreparing to copy...\nCopying to container - 3.072kB\nSuccessfully copied 3.072kB to 10cf28189a1f:/\n\nubuntu@ip-172-30-3-25:~<span class=\"nv\">$ </span><span class=\"nb\">sudo </span>docker <span class=\"nb\">exec</span> <span class=\"nt\">-it</span> <span class=\"nt\">--user</span> root  10cf28189a1f sh\n<span class=\"c\"># ls -la</span>\ntotal 28\ndrwxr-xr-x   1 root root   40 Apr 17 05:32 <span class=\"nb\">.</span>\ndrwxr-xr-x   1 root root   40 Apr 17 05:32 ..\n<span class=\"nt\">-rwxr-xr-x</span>   1 root root    0 Apr 17 03:59 .dockerenv\n<span class=\"nt\">-rw-r--r--</span>   1 root root 2012 Feb 24 01:47 05_table_migration_dump_restore.sh\n<span class=\"nt\">-rw-r--r--</span>   1 root root 1966 Feb 21 05:08 06_bucardo_setup.sh\n<span class=\"nt\">-rw-r--r--</span>   1 root root 1398 Mar 13 12:09 07_data_dump_restore.sh\n<span class=\"nt\">-rw-r--r--</span>   1 root root 1910 Mar 13 12:09 08_check_tables.sh\nlrwxrwxrwx   1 root root    7 Mar  1 02:03 bin -&gt; usr/bin\ndrwxr-xr-x   2 root root    6 Apr 18  2022 boot\n<span class=\"nt\">-rw-r--r--</span>   1 1000 1000 1459 Apr 17 05:23 count.sh\n<span class=\"nt\">-rw-r--r--</span>   1 root root   97 Feb 20 05:56 create-bucardo-user.sql\n<span class=\"nt\">-rw-r--r--</span>   1 1000 1000 1204 Apr 17 05:31 data_bk.sh\ndrwxr-xr-x   5 root root  360 Apr 17 03:59 dev\ndrwxr-xr-x   1 root root   66 Apr 17 03:59 etc\ndrwxr-xr-x   2 root root    6 Apr 18  2022 home\nlrwxrwxrwx   1 root root    7 Mar  1 02:03 lib -&gt; usr/lib\nlrwxrwxrwx   1 root root    9 Mar  1 02:03 lib32 -&gt; usr/lib32\nlrwxrwxrwx   1 root root    9 Mar  1 02:03 lib64 -&gt; usr/lib64\nlrwxrwxrwx   1 root root   10 Mar  1 02:03 libx32 -&gt; usr/libx32\ndrwxr-xr-x   2 root root    6 Mar  1 02:03 media\ndrwxr-xr-x   2 root root    6 Mar  1 02:03 mnt\ndrwxr-xr-x   2 root root    6 Mar  1 02:03 opt\ndr-xr-xr-x 240 root root    0 Apr 17 03:59 proc\ndrwx------   2 root root   37 Mar  1 02:06 root\ndrwxr-xr-x   1 root root   24 Mar 14 01:04 run\nlrwxrwxrwx   1 root root    8 Mar  1 02:03 sbin -&gt; usr/sbin\ndrwxr-xr-x   2 root root    6 Mar  1 02:03 srv\ndr-xr-xr-x  13 root root    0 Apr 17 03:59 sys\ndrwxrwxrwt   1 root root    6 Mar 14 01:04 tmp\ndrwxr-xr-x   1 root root   96 Mar  1 02:03 usr\ndrwxr-xr-x   1 root root   28 Mar  1 02:06 var\n</code></pre></div></div>\n<h2 data-sourcepos=\"607:1-607:47\" id=\"1-14-0\" name=\"1-14-0\"><a class=\"anchor\" id=\"16_テーブルスキーマのdumpとrestore\" name=\"16_テーブルスキーマのdumpとrestore\" href=\"#16_テーブルスキーマのdumpとrestore\" data-position=\"1-14-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"16_テーブルスキーマのdumpとrestore\"> &gt; 16_テーブルスキーマのdumpとrestore</span></a>16_テーブルスキーマのdumpとrestore</h2>\n<h3 data-sourcepos=\"609:1-609:10\" id=\"1-14-1\" name=\"1-14-1\"><a class=\"anchor\" id=\"手順-12\" name=\"手順-12\" href=\"#手順-12\" data-position=\"1-14-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"手順\"> &gt; 手順</span></a>手順</h3>\n<div class=\"code-block\" data-sourcepos=\"610:1-612:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>bash 05_table_migration_dump_restore.sh ./king-api-production.env\n</code></pre></div></div>\n<h3 data-sourcepos=\"613:1-613:13\" id=\"1-14-2\" name=\"1-14-2\"><a class=\"anchor\" id=\"実行後-12\" name=\"実行後-12\" href=\"#実行後-12\" data-position=\"1-14-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"実行後\"> &gt; 実行後</span></a>実行後</h3>\n<details>\n<div class=\"code-block\" data-sourcepos=\"617:1-1542:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code><span class=\"c\"># bash 05_table_migration_dump_restore.sh ./king-api-production.env</span>\n1.pgpassの作成------------------------\n2.HerokuDBのテーブル情報のdump取得------------------------\npg_dump: last built-in OID is 16383\npg_dump: reading extensions\npg_dump: identifying extension members\npg_dump: reading schemas\npg_dump: reading user-defined tables\npg_dump: reading user-defined functions\npg_dump: reading user-defined types\npg_dump: reading procedural languages\npg_dump: reading user-defined aggregate functions\npg_dump: reading user-defined operators\npg_dump: reading user-defined access methods\npg_dump: reading user-defined operator classes\npg_dump: reading user-defined operator families\npg_dump: reading user-defined text search parsers\npg_dump: reading user-defined text search templates\npg_dump: reading user-defined text search dictionaries\npg_dump: reading user-defined text search configurations\npg_dump: reading user-defined foreign-data wrappers\npg_dump: reading user-defined foreign servers\npg_dump: reading default privileges\npg_dump: reading user-defined collations\npg_dump: reading user-defined conversions\npg_dump: reading <span class=\"nb\">type </span>casts\npg_dump: reading transforms\npg_dump: reading table inheritance information\npg_dump: reading event triggers\npg_dump: finding extension tables\npg_dump: finding inheritance relationships\npg_dump: reading column info <span class=\"k\">for </span>interesting tables\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.schema_migrations\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.ar_internal_metadata\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.locks\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.locks\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.hubs\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.hubs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.fobs\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.fobs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.users\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.users\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.master_keys\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.master_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.lock_settings\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.lock_settings\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.term_of_validities\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.term_of_validities\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.durations\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.durations\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.dailies\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.dailies\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.weeklies\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.weeklies\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.family_keys\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.family_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.guest_keys\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.guest_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.fob_keys\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.fob_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.logs\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.logs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.invitations\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.invitations\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.json_web_keys\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.json_web_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.command_logs\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.command_logs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.webhook_tokens\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.webhook_tokens\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.lock_webhook_tokens\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.lock_webhook_tokens\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.delayed_jobs\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.delayed_jobs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.managers\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.managers\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.webhooks\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.webhooks\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.autolock_schedules\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.autolock_schedules\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.relationships\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.relationships\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.wenas\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.wenas\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.wena_keys\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.wena_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.knights\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.knights\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.knight_keys\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.knight_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.knight_cards\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.knight_cards\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.knight_pins\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.knight_pins\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.knight_commands\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.knight_commands\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.knight_logs\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.knight_logs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.entrance_locks\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.entrance_locks\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.entrance_master_keys\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.entrance_master_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.entrance_lock_settings\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.entrance_lock_settings\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.entrance_knight_keys\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.entrance_knight_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.entrance_knight_pins\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.entrance_knight_pins\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.resident_keys\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.resident_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.entrance_resident_keys\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.entrance_resident_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.entrance_invitations\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.entrance_invitations\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.resident_guest_keys\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.resident_guest_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.entrance_resident_guest_keys\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.entrance_resident_guest_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.entrance_fob_keys\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.entrance_fob_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.mst_display_logs\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.mst_display_logs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.display_logs\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.display_logs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.door_mode_changed_histories\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.door_mode_changed_histories\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.entrance_block_knight_cards\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.entrance_block_knight_cards\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.entrance_block_fob_keys\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.entrance_block_fob_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.active_storage_blobs\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.active_storage_blobs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.active_storage_attachments\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.active_storage_attachments\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.active_storage_variant_records\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.active_storage_variant_records\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.pg_stat_statements_info\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.pg_stat_statements\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.laresia_pins\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.laresia_pins\"</span>\npg_dump: flagging inherited columns <span class=\"k\">in </span>subtables\npg_dump: reading indexes\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.schema_migrations\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.ar_internal_metadata\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.locks\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.hubs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.fobs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.users\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.master_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.lock_settings\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.term_of_validities\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.durations\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.dailies\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.weeklies\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.family_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.guest_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.fob_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.logs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.invitations\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.json_web_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.command_logs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.webhook_tokens\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.lock_webhook_tokens\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.delayed_jobs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.managers\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.webhooks\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.autolock_schedules\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.relationships\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.wenas\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.wena_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.knights\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_cards\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_pins\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_commands\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_logs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_locks\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_master_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_lock_settings\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_knight_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_knight_pins\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.resident_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_resident_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_invitations\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.resident_guest_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_resident_guest_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_fob_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.mst_display_logs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.display_logs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.door_mode_changed_histories\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_block_knight_cards\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_block_fob_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.active_storage_blobs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.active_storage_attachments\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.active_storage_variant_records\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.laresia_pins\"</span>\npg_dump: flagging indexes <span class=\"k\">in </span>partitioned tables\npg_dump: reading extended statistics\npg_dump: reading constraints\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.locks\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.hubs\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.fobs\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.users\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.master_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.lock_settings\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.term_of_validities\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.durations\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.dailies\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.weeklies\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.family_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.guest_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.fob_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.logs\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.invitations\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.command_logs\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.webhook_tokens\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.lock_webhook_tokens\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.managers\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.webhooks\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.autolock_schedules\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.relationships\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.wenas\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.wena_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.knights\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_cards\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_pins\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_logs\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_locks\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_master_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_lock_settings\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_knight_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_knight_pins\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.resident_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_resident_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_invitations\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.resident_guest_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_resident_guest_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_fob_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.mst_display_logs\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.display_logs\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.door_mode_changed_histories\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_block_knight_cards\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_block_fob_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.active_storage_blobs\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.active_storage_attachments\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.active_storage_variant_records\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.laresia_pins\"</span>\npg_dump: reading triggers\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.locks\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.hubs\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.fobs\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.users\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.master_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.lock_settings\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.term_of_validities\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.durations\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.dailies\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.weeklies\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.family_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.guest_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.fob_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.logs\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.invitations\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.command_logs\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.webhook_tokens\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.lock_webhook_tokens\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.managers\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.webhooks\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.autolock_schedules\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.relationships\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.wenas\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.wena_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.knights\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_cards\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_pins\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_logs\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_locks\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_master_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_lock_settings\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_knight_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_knight_pins\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.resident_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_resident_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_invitations\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.resident_guest_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_resident_guest_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_fob_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.mst_display_logs\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.display_logs\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.door_mode_changed_histories\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_block_knight_cards\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_block_fob_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.active_storage_blobs\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.active_storage_attachments\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.active_storage_variant_records\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.laresia_pins\"</span>\npg_dump: reading rewrite rules\npg_dump: reading policies\npg_dump: reading row-level security policies\npg_dump: reading publications\npg_dump: reading publication membership\npg_dump: reading subscriptions\npg_dump: reading dependency data\npg_dump: saving encoding <span class=\"o\">=</span> UTF8\npg_dump: saving standard_conforming_strings <span class=\"o\">=</span> on\npg_dump: saving search_path <span class=\"o\">=</span>\npg_dump: saving database definition\n3.AuroraDBへのテーブル情報の流入------------------------\npg_restore: connecting to database <span class=\"k\">for </span>restore\npg_restore: creating SCHEMA <span class=\"s2\">\"heroku_ext\"</span>\npg_restore: <span class=\"k\">while </span>PROCESSING TOC:\npg_restore: from TOC entry 7<span class=\"p\">;</span> 2615 16404 SCHEMA heroku_ext postgres\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"postgres\"</span> does not exist\nCommand was: ALTER SCHEMA heroku_ext OWNER TO postgres<span class=\"p\">;</span>\n\npg_restore: creating EXTENSION <span class=\"s2\">\"pg_stat_statements\"</span>\npg_restore: creating COMMENT <span class=\"s2\">\"EXTENSION pg_stat_statements\"</span>\npg_restore: creating EXTENSION <span class=\"s2\">\"pgcrypto\"</span>\npg_restore: creating COMMENT <span class=\"s2\">\"EXTENSION pgcrypto\"</span>\npg_restore: creating TYPE <span class=\"s2\">\"public.command_log_remote_source_type\"</span>\npg_restore: from TOC entry 987<span class=\"p\">;</span> 1247 37274655 TYPE command_log_remote_source_type ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: ALTER TYPE public.command_log_remote_source_type OWNER TO ubev937lfpa1d3<span class=\"p\">;</span>\n\npg_restore: creating TYPE <span class=\"s2\">\"public.display_log_lock_position\"</span>\npg_restore: from TOC entry 925<span class=\"p\">;</span> 1247 25078842 TYPE display_log_lock_position ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: ALTER TYPE public.display_log_lock_position OWNER TO ubev937lfpa1d3<span class=\"p\">;</span>\n\npg_restore: creating TYPE <span class=\"s2\">\"public.display_log_open_close_type\"</span>\npg_restore: from TOC entry 928<span class=\"p\">;</span> 1247 25078822 TYPE display_log_open_close_type ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: ALTER TYPE public.display_log_open_close_type OWNER TO ubev937lfpa1d3<span class=\"p\">;</span>\n\npg_restore: creating TYPE <span class=\"s2\">\"public.door_mode_changed_history_door_mode\"</span>\npg_restore: from TOC entry 931<span class=\"p\">;</span> 1247 25632191 TYPE door_mode_changed_history_door_mode ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: ALTER TYPE public.door_mode_changed_history_door_mode OWNER TO ubev937lfpa1d3<span class=\"p\">;</span>\n\npg_restore: creating TYPE <span class=\"s2\">\"public.knight_command_remote_source_type\"</span>\npg_restore: from TOC entry 1050<span class=\"p\">;</span> 1247 37274664 TYPE knight_command_remote_source_type ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: ALTER TYPE public.knight_command_remote_source_type OWNER TO ubev937lfpa1d3<span class=\"p\">;</span>\n\npg_restore: creating TYPE <span class=\"s2\">\"public.mst_display_log_open_close_type\"</span>\npg_restore: from TOC entry 934<span class=\"p\">;</span> 1247 25078852 TYPE mst_display_log_open_close_type ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: ALTER TYPE public.mst_display_log_open_close_type OWNER TO ubev937lfpa1d3<span class=\"p\">;</span>\n\npg_restore: creating TYPE <span class=\"s2\">\"public.mst_display_log_operation_type\"</span>\npg_restore: from TOC entry 937<span class=\"p\">;</span> 1247 25078870 TYPE mst_display_log_operation_type ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: ALTER TYPE public.mst_display_log_operation_type OWNER TO ubev937lfpa1d3<span class=\"p\">;</span>\n\npg_restore: creating TABLE <span class=\"s2\">\"public.active_storage_attachments\"</span>\npg_restore: from TOC entry 267<span class=\"p\">;</span> 1259 30048268 TABLE active_storage_attachments ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: ALTER TABLE public.active_storage_attachments OWNER TO ubev937lfpa1d3<span class=\"p\">;</span>\n\npg_restore: creating SEQUENCE <span class=\"s2\">\"public.active_storage_attachments_id_seq\"</span>\npg_restore: from TOC entry 266<span class=\"p\">;</span> 1259 30048266 SEQUENCE active_storage_attachments_id_seq ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: ALTER TABLE public.active_storage_attachments_id_seq OWNER TO ubev937lfpa1d3<span class=\"p\">;</span>\n\npg_restore: creating SEQUENCE OWNED BY <span class=\"s2\">\"public.active_storage_attachments_id_seq\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.active_storage_blobs\"</span>\npg_restore: from TOC entry 265<span class=\"p\">;</span> 1259 30048256 TABLE active_storage_blobs ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: ALTER TABLE public.active_storage_blobs OWNER TO ubev937lfpa1d3<span class=\"p\">;</span>\n\npg_restore: creating SEQUENCE <span class=\"s2\">\"public.active_storage_blobs_id_seq\"</span>\npg_restore: from TOC entry 264<span class=\"p\">;</span> 1259 30048254 SEQUENCE active_storage_blobs_id_seq ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: ALTER TABLE public.active_storage_blobs_id_seq OWNER TO ubev937lfpa1d3<span class=\"p\">;</span>\n\npg_restore: creating SEQUENCE OWNED BY <span class=\"s2\">\"public.active_storage_blobs_id_seq\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.active_storage_variant_records\"</span>\npg_restore: from TOC entry 269<span class=\"p\">;</span> 1259 30048286 TABLE active_storage_variant_records ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: ALTER TABLE public.active_storage_variant_records OWNER TO ubev937lfpa1d3<span class=\"p\">;</span>\n\npg_restore: creating SEQUENCE <span class=\"s2\">\"public.active_storage_variant_records_id_seq\"</span>\npg_restore: from TOC entry 268<span class=\"p\">;</span> 1259 30048284 SEQUENCE active_storage_variant_records_id_seq ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: ALTER TABLE public.active_storage_variant_records_id_seq OWNER TO ubev937lfpa1d3<span class=\"p\">;</span>\n\npg_restore: creating SEQUENCE OWNED BY <span class=\"s2\">\"public.active_storage_variant_records_id_seq\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.ar_internal_metadata\"</span>\npg_restore: from TOC entry 213<span class=\"p\">;</span> 1259 17060 TABLE ar_internal_metadata ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: ALTER TABLE public.ar_internal_metadata OWNER TO ubev937lfpa1d3<span class=\"p\">;</span>\n\npg_restore: creating TABLE <span class=\"s2\">\"public.autolock_schedules\"</span>\npg_restore: from TOC entry 238<span class=\"p\">;</span> 1259 1033455 TABLE autolock_schedules ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: ALTER TABLE public.autolock_schedules OWNER TO ubev937lfpa1d3<span class=\"p\">;</span>\n\npg_restore: creating TABLE <span class=\"s2\">\"public.command_logs\"</span>\npg_restore: from TOC entry 231<span class=\"p\">;</span> 1259 25728 TABLE command_logs ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: ALTER TABLE public.command_logs OWNER TO ubev937lfpa1d3<span class=\"p\">;</span>\n\npg_restore: creating COMMENT <span class=\"s2\">\"public.COLUMN command_logs.notification_id\"</span>\npg_restore: creating COMMENT <span class=\"s2\">\"public.COLUMN command_logs.remote_source_type\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.dailies\"</span>\npg_restore: from TOC entry 222<span class=\"p\">;</span> 1259 17224 TABLE dailies ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: ALTER TABLE public.dailies OWNER TO ubev937lfpa1d3<span class=\"p\">;</span>\n\npg_restore: creating TABLE <span class=\"s2\">\"public.delayed_jobs\"</span>\npg_restore: from TOC entry 235<span class=\"p\">;</span> 1259 42626 TABLE delayed_jobs ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: ALTER TABLE public.delayed_jobs OWNER TO ubev937lfpa1d3<span class=\"p\">;</span>\n\npg_restore: creating SEQUENCE <span class=\"s2\">\"public.delayed_jobs_id_seq\"</span>\npg_restore: from TOC entry 234<span class=\"p\">;</span> 1259 42624 SEQUENCE delayed_jobs_id_seq ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: ALTER TABLE public.delayed_jobs_id_seq OWNER TO ubev937lfpa1d3<span class=\"p\">;</span>\n\npg_restore: creating SEQUENCE OWNED BY <span class=\"s2\">\"public.delayed_jobs_id_seq\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.display_logs\"</span>\npg_restore: from TOC entry 260<span class=\"p\">;</span> 1259 25078792 TABLE display_logs ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: ALTER TABLE public.display_logs OWNER TO ubev937lfpa1d3<span class=\"p\">;</span>\n\npg_restore: creating COMMENT <span class=\"s2\">\"public.COLUMN display_logs.open_close_type\"</span>\npg_restore: creating COMMENT <span class=\"s2\">\"public.COLUMN display_logs.lock_position\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.door_mode_changed_histories\"</span>\npg_restore: from TOC entry 261<span class=\"p\">;</span> 1259 25632195 TABLE door_mode_changed_histories ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: ALTER TABLE public.door_mode_changed_histories OWNER TO ubev937lfpa1d3<span class=\"p\">;</span>\n\npg_restore: creating COMMENT <span class=\"s2\">\"public.COLUMN door_mode_changed_histories.door_mode\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.durations\"</span>\npg_restore: from TOC entry 221<span class=\"p\">;</span> 1259 17209 TABLE durations ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: ALTER TABLE public.durations OWNER TO ubev937lfpa1d3<span class=\"p\">;</span>\n\npg_restore: creating TABLE <span class=\"s2\">\"public.entrance_block_fob_keys\"</span>\npg_restore: from TOC entry 263<span class=\"p\">;</span> 1259 27960646 TABLE entrance_block_fob_keys ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: ALTER TABLE public.entrance_block_fob_keys OWNER TO ubev937lfpa1d3<span class=\"p\">;</span>\n\npg_restore: creating COMMENT <span class=\"s2\">\"public.COLUMN entrance_block_fob_keys.fob_type\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.entrance_block_knight_cards\"</span>\npg_restore: from TOC entry 262<span class=\"p\">;</span> 1259 27960623 TABLE entrance_block_knight_cards ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: ALTER TABLE public.entrance_block_knight_cards OWNER TO ubev937lfpa1d3<span class=\"p\">;</span>\n\npg_restore: creating TABLE <span class=\"s2\">\"public.entrance_fob_keys\"</span>\npg_restore: from TOC entry 258<span class=\"p\">;</span> 1259 25078765 TABLE entrance_fob_keys ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: ALTER TABLE public.entrance_fob_keys OWNER TO ubev937lfpa1d3<span class=\"p\">;</span>\n\npg_restore: creating TABLE <span class=\"s2\">\"public.entrance_invitations\"</span>\npg_restore: from TOC entry 255<span class=\"p\">;</span> 1259 25078663 TABLE entrance_invitations ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: ALTER TABLE public.entrance_invitations OWNER TO ubev937lfpa1d3<span class=\"p\">;</span>\n\npg_restore: creating TABLE <span class=\"s2\">\"public.entrance_knight_keys\"</span>\npg_restore: from TOC entry 251<span class=\"p\">;</span> 1259 25078580 TABLE entrance_knight_keys ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: ALTER TABLE public.entrance_knight_keys OWNER TO ubev937lfpa1d3<span class=\"p\">;</span>\n\npg_restore: creating TABLE <span class=\"s2\">\"public.entrance_knight_pins\"</span>\npg_restore: from TOC entry 252<span class=\"p\">;</span> 1259 25078598 TABLE entrance_knight_pins ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: ALTER TABLE public.entrance_knight_pins OWNER TO ubev937lfpa1d3<span class=\"p\">;</span>\n\npg_restore: creating TABLE <span class=\"s2\">\"public.entrance_lock_settings\"</span>\npg_restore: from TOC entry 250<span class=\"p\">;</span> 1259 25078559 TABLE entrance_lock_settings ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: ALTER TABLE public.entrance_lock_settings OWNER TO ubev937lfpa1d3<span class=\"p\">;</span>\n\npg_restore: creating TABLE <span class=\"s2\">\"public.entrance_locks\"</span>\npg_restore: from TOC entry 248<span class=\"p\">;</span> 1259 25078530 TABLE entrance_locks ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: ALTER TABLE public.entrance_locks OWNER TO ubev937lfpa1d3<span class=\"p\">;</span>\n\npg_restore: creating TABLE <span class=\"s2\">\"public.entrance_master_keys\"</span>\npg_restore: from TOC entry 249<span class=\"p\">;</span> 1259 25078541 TABLE entrance_master_keys ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: ALTER TABLE public.entrance_master_keys OWNER TO ubev937lfpa1d3<span class=\"p\">;</span>\n\npg_restore: creating TABLE <span class=\"s2\">\"public.entrance_resident_guest_keys\"</span>\npg_restore: from TOC entry 257<span class=\"p\">;</span> 1259 25078711 TABLE entrance_resident_guest_keys ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: ALTER TABLE public.entrance_resident_guest_keys OWNER TO ubev937lfpa1d3<span class=\"p\">;</span>\n\npg_restore: creating TABLE <span class=\"s2\">\"public.entrance_resident_keys\"</span>\npg_restore: from TOC entry 254<span class=\"p\">;</span> 1259 25078633 TABLE entrance_resident_keys ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: ALTER TABLE public.entrance_resident_keys OWNER TO ubev937lfpa1d3<span class=\"p\">;</span>\n\npg_restore: creating TABLE <span class=\"s2\">\"public.family_keys\"</span>\npg_restore: from TOC entry 224<span class=\"p\">;</span> 1259 17255 TABLE family_keys ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: ALTER TABLE public.family_keys OWNER TO ubev937lfpa1d3<span class=\"p\">;</span>\n\npg_restore: creating TABLE <span class=\"s2\">\"public.fob_keys\"</span>\npg_restore: from TOC entry 226<span class=\"p\">;</span> 1259 17300 TABLE fob_keys ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: ALTER TABLE public.fob_keys OWNER TO ubev937lfpa1d3<span class=\"p\">;</span>\n\npg_restore: creating TABLE <span class=\"s2\">\"public.fobs\"</span>\npg_restore: from TOC entry 216<span class=\"p\">;</span> 1259 17131 TABLE fobs ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: ALTER TABLE public.fobs OWNER TO ubev937lfpa1d3<span class=\"p\">;</span>\n\npg_restore: creating TABLE <span class=\"s2\">\"public.guest_keys\"</span>\npg_restore: from TOC entry 225<span class=\"p\">;</span> 1259 17274 TABLE guest_keys ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: ALTER TABLE public.guest_keys OWNER TO ubev937lfpa1d3<span class=\"p\">;</span>\n\npg_restore: creating TABLE <span class=\"s2\">\"public.hubs\"</span>\npg_restore: from TOC entry 215<span class=\"p\">;</span> 1259 17121 TABLE hubs ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: ALTER TABLE public.hubs OWNER TO ubev937lfpa1d3<span class=\"p\">;</span>\n\npg_restore: creating COMMENT <span class=\"s2\">\"public.COLUMN hubs.is_roomon_manager_hub\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.invitations\"</span>\npg_restore: from TOC entry 228<span class=\"p\">;</span> 1259 17342 TABLE invitations ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: ALTER TABLE public.invitations OWNER TO ubev937lfpa1d3<span class=\"p\">;</span>\n\npg_restore: creating TABLE <span class=\"s2\">\"public.json_web_keys\"</span>\npg_restore: from TOC entry 230<span class=\"p\">;</span> 1259 24740 TABLE json_web_keys ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: ALTER TABLE public.json_web_keys OWNER TO ubev937lfpa1d3<span class=\"p\">;</span>\n\npg_restore: creating SEQUENCE <span class=\"s2\">\"public.json_web_keys_id_seq\"</span>\npg_restore: from TOC entry 229<span class=\"p\">;</span> 1259 24738 SEQUENCE json_web_keys_id_seq ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: ALTER TABLE public.json_web_keys_id_seq OWNER TO ubev937lfpa1d3<span class=\"p\">;</span>\n\npg_restore: creating SEQUENCE OWNED BY <span class=\"s2\">\"public.json_web_keys_id_seq\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.knight_cards\"</span>\npg_restore: from TOC entry 244<span class=\"p\">;</span> 1259 21622037 TABLE knight_cards ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: ALTER TABLE public.knight_cards OWNER TO ubev937lfpa1d3<span class=\"p\">;</span>\n\npg_restore: creating TABLE <span class=\"s2\">\"public.knight_commands\"</span>\npg_restore: from TOC entry 246<span class=\"p\">;</span> 1259 21622178 TABLE knight_commands ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: ALTER TABLE public.knight_commands OWNER TO ubev937lfpa1d3<span class=\"p\">;</span>\n\npg_restore: creating COMMENT <span class=\"s2\">\"public.COLUMN knight_commands.notification_id\"</span>\npg_restore: creating COMMENT <span class=\"s2\">\"public.COLUMN knight_commands.remote_source_type\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.knight_keys\"</span>\npg_restore: from TOC entry 243<span class=\"p\">;</span> 1259 21622019 TABLE knight_keys ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: ALTER TABLE public.knight_keys OWNER TO ubev937lfpa1d3<span class=\"p\">;</span>\n\npg_restore: creating TABLE <span class=\"s2\">\"public.knight_logs\"</span>\npg_restore: from TOC entry 247<span class=\"p\">;</span> 1259 25078486 TABLE knight_logs ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: ALTER TABLE public.knight_logs OWNER TO ubev937lfpa1d3<span class=\"p\">;</span>\n\npg_restore: creating TABLE <span class=\"s2\">\"public.knight_pins\"</span>\npg_restore: from TOC entry 245<span class=\"p\">;</span> 1259 21622125 TABLE knight_pins ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: ALTER TABLE public.knight_pins OWNER TO ubev937lfpa1d3<span class=\"p\">;</span>\n\npg_restore: creating TABLE <span class=\"s2\">\"public.knights\"</span>\npg_restore: from TOC entry 242<span class=\"p\">;</span> 1259 21622003 TABLE knights ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: ALTER TABLE public.knights OWNER TO ubev937lfpa1d3<span class=\"p\">;</span>\n\npg_restore: creating COMMENT <span class=\"s2\">\"public.COLUMN knights.model_id\"</span>\npg_restore: creating COMMENT <span class=\"s2\">\"public.COLUMN knights.mode\"</span>\npg_restore: creating COMMENT <span class=\"s2\">\"public.COLUMN knights.relay_on_seconds\"</span>\npg_restore: creating COMMENT <span class=\"s2\">\"public.COLUMN knights.remote_setting_mode_adv_interval\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.laresia_pins\"</span>\npg_restore: from TOC entry 272<span class=\"p\">;</span> 1259 37274638 TABLE laresia_pins ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: ALTER TABLE public.laresia_pins OWNER TO ubev937lfpa1d3<span class=\"p\">;</span>\n\npg_restore: creating TABLE <span class=\"s2\">\"public.lock_settings\"</span>\npg_restore: from TOC entry 219<span class=\"p\">;</span> 1259 17169 TABLE lock_settings ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: ALTER TABLE public.lock_settings OWNER TO ubev937lfpa1d3<span class=\"p\">;</span>\n\npg_restore: creating TABLE <span class=\"s2\">\"public.lock_webhook_tokens\"</span>\npg_restore: from TOC entry 233<span class=\"p\">;</span> 1259 25846 TABLE lock_webhook_tokens ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: ALTER TABLE public.lock_webhook_tokens OWNER TO ubev937lfpa1d3<span class=\"p\">;</span>\n\npg_restore: creating TABLE <span class=\"s2\">\"public.locks\"</span>\npg_restore: from TOC entry 214<span class=\"p\">;</span> 1259 17105 TABLE locks ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: ALTER TABLE public.locks OWNER TO ubev937lfpa1d3<span class=\"p\">;</span>\n\npg_restore: creating COMMENT <span class=\"s2\">\"public.COLUMN locks.model_id\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.logs\"</span>\npg_restore: from TOC entry 227<span class=\"p\">;</span> 1259 17324 TABLE logs ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: ALTER TABLE public.logs OWNER TO ubev937lfpa1d3<span class=\"p\">;</span>\n\npg_restore: creating TABLE <span class=\"s2\">\"public.managers\"</span>\npg_restore: from TOC entry 236<span class=\"p\">;</span> 1259 143560 TABLE managers ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: ALTER TABLE public.managers OWNER TO ubev937lfpa1d3<span class=\"p\">;</span>\n\npg_restore: creating TABLE <span class=\"s2\">\"public.master_keys\"</span>\npg_restore: from TOC entry 218<span class=\"p\">;</span> 1259 17151 TABLE master_keys ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: ALTER TABLE public.master_keys OWNER TO ubev937lfpa1d3<span class=\"p\">;</span>\n\npg_restore: creating TABLE <span class=\"s2\">\"public.mst_display_logs\"</span>\npg_restore: from TOC entry 259<span class=\"p\">;</span> 1259 25078783 TABLE mst_display_logs ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: ALTER TABLE public.mst_display_logs OWNER TO ubev937lfpa1d3<span class=\"p\">;</span>\n\npg_restore: creating COMMENT <span class=\"s2\">\"public.COLUMN mst_display_logs.open_close_type\"</span>\npg_restore: creating COMMENT <span class=\"s2\">\"public.COLUMN mst_display_logs.operation_type\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.relationships\"</span>\npg_restore: from TOC entry 239<span class=\"p\">;</span> 1259 1186274 TABLE relationships ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: ALTER TABLE public.relationships OWNER TO ubev937lfpa1d3<span class=\"p\">;</span>\n\npg_restore: creating TABLE <span class=\"s2\">\"public.resident_guest_keys\"</span>\npg_restore: from TOC entry 256<span class=\"p\">;</span> 1259 25078687 TABLE resident_guest_keys ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: ALTER TABLE public.resident_guest_keys OWNER TO ubev937lfpa1d3<span class=\"p\">;</span>\n\npg_restore: creating TABLE <span class=\"s2\">\"public.resident_keys\"</span>\npg_restore: from TOC entry 253<span class=\"p\">;</span> 1259 25078615 TABLE resident_keys ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: ALTER TABLE public.resident_keys OWNER TO ubev937lfpa1d3<span class=\"p\">;</span>\n\npg_restore: creating TABLE <span class=\"s2\">\"public.schema_migrations\"</span>\npg_restore: from TOC entry 212<span class=\"p\">;</span> 1259 17052 TABLE schema_migrations ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: ALTER TABLE public.schema_migrations OWNER TO ubev937lfpa1d3<span class=\"p\">;</span>\n\npg_restore: creating TABLE <span class=\"s2\">\"public.term_of_validities\"</span>\npg_restore: from TOC entry 220<span class=\"p\">;</span> 1259 17197 TABLE term_of_validities ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: ALTER TABLE public.term_of_validities OWNER TO ubev937lfpa1d3<span class=\"p\">;</span>\n\npg_restore: creating TABLE <span class=\"s2\">\"public.users\"</span>\npg_restore: from TOC entry 217<span class=\"p\">;</span> 1259 17141 TABLE <span class=\"nb\">users </span>ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: ALTER TABLE public.users OWNER TO ubev937lfpa1d3<span class=\"p\">;</span>\n\npg_restore: creating TABLE <span class=\"s2\">\"public.webhook_tokens\"</span>\npg_restore: from TOC entry 232<span class=\"p\">;</span> 1259 25830 TABLE webhook_tokens ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: ALTER TABLE public.webhook_tokens OWNER TO ubev937lfpa1d3<span class=\"p\">;</span>\n\npg_restore: creating TABLE <span class=\"s2\">\"public.webhooks\"</span>\npg_restore: from TOC entry 237<span class=\"p\">;</span> 1259 223477 TABLE webhooks ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: ALTER TABLE public.webhooks OWNER TO ubev937lfpa1d3<span class=\"p\">;</span>\n\npg_restore: creating TABLE <span class=\"s2\">\"public.weeklies\"</span>\npg_restore: from TOC entry 223<span class=\"p\">;</span> 1259 17236 TABLE weeklies ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: ALTER TABLE public.weeklies OWNER TO ubev937lfpa1d3<span class=\"p\">;</span>\n\npg_restore: creating TABLE <span class=\"s2\">\"public.wena_keys\"</span>\npg_restore: from TOC entry 241<span class=\"p\">;</span> 1259 5549250 TABLE wena_keys ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: ALTER TABLE public.wena_keys OWNER TO ubev937lfpa1d3<span class=\"p\">;</span>\n\npg_restore: creating TABLE <span class=\"s2\">\"public.wenas\"</span>\npg_restore: from TOC entry 240<span class=\"p\">;</span> 1259 5549240 TABLE wenas ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: ALTER TABLE public.wenas OWNER TO ubev937lfpa1d3<span class=\"p\">;</span>\n\npg_restore: creating COMMENT <span class=\"s2\">\"public.COLUMN wenas.wena_type\"</span>\npg_restore: creating DEFAULT <span class=\"s2\">\"public.active_storage_attachments id\"</span>\npg_restore: creating DEFAULT <span class=\"s2\">\"public.active_storage_blobs id\"</span>\npg_restore: creating DEFAULT <span class=\"s2\">\"public.active_storage_variant_records id\"</span>\npg_restore: creating DEFAULT <span class=\"s2\">\"public.delayed_jobs id\"</span>\npg_restore: creating DEFAULT <span class=\"s2\">\"public.json_web_keys id\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.active_storage_attachments active_storage_attachments_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.active_storage_blobs active_storage_blobs_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.active_storage_variant_records active_storage_variant_records_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.ar_internal_metadata ar_internal_metadata_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.autolock_schedules autolock_schedules_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.command_logs command_logs_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.dailies dailies_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.delayed_jobs delayed_jobs_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.display_logs display_logs_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.door_mode_changed_histories door_mode_changed_histories_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.durations durations_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.entrance_block_fob_keys entrance_block_fob_keys_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.entrance_block_knight_cards entrance_block_knight_cards_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.entrance_fob_keys entrance_fob_keys_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.entrance_invitations entrance_invitations_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.entrance_knight_keys entrance_knight_keys_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.entrance_knight_pins entrance_knight_pins_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.entrance_lock_settings entrance_lock_settings_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.entrance_locks entrance_locks_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.entrance_master_keys entrance_master_keys_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.entrance_resident_guest_keys entrance_resident_guest_keys_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.entrance_resident_keys entrance_resident_keys_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.family_keys family_keys_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.fob_keys fob_keys_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.fobs fobs_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.guest_keys guest_keys_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.hubs hubs_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.invitations invitations_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.json_web_keys json_web_keys_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.knight_cards knight_cards_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.knight_commands knight_commands_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.knight_keys knight_keys_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.knight_logs knight_logs_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.knight_pins knight_pins_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.knights knights_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.laresia_pins laresia_pins_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.lock_settings lock_settings_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.lock_webhook_tokens lock_webhook_tokens_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.locks locks_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.logs logs_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.managers managers_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.master_keys master_keys_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.mst_display_logs mst_display_logs_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.relationships relationships_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.resident_guest_keys resident_guest_keys_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.resident_keys resident_keys_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.schema_migrations schema_migrations_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.term_of_validities term_of_validities_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.users users_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.webhook_tokens webhook_tokens_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.webhooks webhooks_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.weeklies weeklies_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.wena_keys wena_keys_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.wenas wenas_pkey\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.delayed_jobs_priority\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_active_storage_attachments_on_blob_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_active_storage_attachments_uniqueness\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_active_storage_blobs_on_key\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_active_storage_variant_records_uniqueness\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_autolock_schedules_on_disable_hour\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_autolock_schedules_on_enable_hour\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_autolock_schedules_on_master_key_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_command_logs_on_hub_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_command_logs_on_lock_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_dailies_on_term_of_validity_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_display_logs_on_logged_at\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_display_logs_on_master_key_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_display_logs_on_mst_display_log_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_door_mode_changed_histories_on_master_key_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_durations_on_term_of_validity_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_entrance_block_fob_keys_on_entrance_fob_key_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_entrance_block_fob_keys_on_entrance_master_key_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_entrance_block_fob_keys_on_fob_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_entrance_block_knight_cards_on_entrance_knight_key_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_entrance_block_knight_cards_on_knight_card_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_entrance_fob_keys_on_entrance_master_key_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_entrance_fob_keys_on_fob_key_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_entrance_invitations_on_entrance_master_key_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_entrance_invitations_on_invitation_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_entrance_knight_keys_on_entrance_master_key_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_entrance_knight_keys_on_knight_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_entrance_knight_pins_on_entrance_knight_key_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_entrance_knight_pins_on_entrance_knight_key_id_and_pin\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_entrance_lock_settings_on_entrance_master_key_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_entrance_lock_settings_on_hub_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_entrance_locks_on_serial_no\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_entrance_master_keys_on_entrance_lock_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_entrance_master_keys_on_user_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_entrance_resident_guest_keys_on_entrance_master_key_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_entrance_resident_guest_keys_on_resident_guest_key_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_entrance_resident_keys_on_entrance_master_key_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_entrance_resident_keys_on_resident_key_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_family_keys_on_master_key_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_family_keys_on_master_key_id_and_user_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_family_keys_on_user_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_fob_keys_on_fob_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_fob_keys_on_master_key_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_fobs_on_serial_no_and_fob_type\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_guest_keys_on_master_key_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_guest_keys_on_term_of_validity_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_guest_keys_on_user_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_hubs_on_serial_no\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_invitations_on_master_key_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_invitations_on_term_of_validity_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_invitations_on_user_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_json_web_keys_on_kid\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_knight_cards_on_display_serial_no\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_knight_cards_on_knight_key_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_knight_cards_on_knight_key_id_and_idm\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_knight_commands_on_hub_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_knight_commands_on_knight_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_knight_keys_on_knight_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_knight_keys_on_master_key_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_knight_logs_on_knight_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_knight_logs_on_knight_id_and_knight_log_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_knight_pins_on_knight_key_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_knight_pins_on_knight_key_id_and_pin\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_knights_on_serial_no_and_model_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_laresia_pins_on_master_key_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_lock_settings_on_hub_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_lock_settings_on_master_key_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_lock_settings_on_sub_lock_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_lock_webhook_tokens_on_lock_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_lock_webhook_tokens_on_lock_id_and_webhook_token_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_lock_webhook_tokens_on_webhook_token_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_locks_on_serial_no_and_model_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_logs_on_lock_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_logs_on_lock_id_and_lock_log_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_logs_on_lock_id_and_logged_at\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_logs_on_recordable_type_and_recordable_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_managers_on_user_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_master_keys_on_lock_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_master_keys_on_user_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_relationships_on_follow_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_relationships_on_user_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_relationships_on_user_id_and_follow_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_resident_guest_keys_on_master_key_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_resident_guest_keys_on_term_of_validity_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_resident_guest_keys_on_user_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_resident_keys_on_master_key_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_resident_keys_on_user_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_term_of_validities_on_master_key_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_users_on_auth0_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_webhook_tokens_on_user_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_webhook_tokens_on_user_id_and_platform\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_webhooks_on_master_key_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_webhooks_on_master_key_id_and_payload_url\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_weeklies_on_term_of_validity_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_wena_keys_on_master_key_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_wena_keys_on_wena_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_wenas_on_serial_no\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.unique_idx_e_b_k_c_on_entrance_knight_key_id_and_encrypted_idm\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.command_logs fk_rails_014f6a2546\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.laresia_pins fk_rails_0169d87320\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.knight_keys fk_rails_021cf26662\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.knight_cards fk_rails_0456909398\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.master_keys fk_rails_0704a51e19\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.durations fk_rails_09e2ff6011\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.entrance_resident_guest_keys fk_rails_0e04b9b004\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.webhook_tokens fk_rails_0e442b724e\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.fob_keys fk_rails_10751d7ff3\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.managers fk_rails_1306270b4d\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.lock_settings fk_rails_14b5845605\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.entrance_invitations fk_rails_1cd45ae85f\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.resident_guest_keys fk_rails_264f594299\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.master_keys fk_rails_2ce43857fe\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.invitations fk_rails_392831049d\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.entrance_fob_keys fk_rails_3baf99c215\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.guest_keys fk_rails_423d4bed43\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.command_logs fk_rails_479d47afa1\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.door_mode_changed_histories fk_rails_49b0247336\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.webhooks fk_rails_4ed36f717c\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.guest_keys fk_rails_511d97b2e6\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.entrance_lock_settings fk_rails_51210f8c81\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.family_keys fk_rails_51c51759a6\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.display_logs fk_rails_59cca4309c\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.family_keys fk_rails_60c83f8be9\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.guest_keys fk_rails_6c5179c7f7\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.display_logs fk_rails_6d35c11a37\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.entrance_block_fob_keys fk_rails_73c502cbb2\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.resident_guest_keys fk_rails_79146fb483\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.entrance_resident_keys fk_rails_7e4b69180e\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.invitations fk_rails_7eae413fe6\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.dailies fk_rails_82a55d246d\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.knight_keys fk_rails_85a7a025e9\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.lock_settings fk_rails_8bb146ac2a\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.lock_webhook_tokens fk_rails_8fba90749d\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.entrance_block_fob_keys fk_rails_919d63f111\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.lock_webhook_tokens fk_rails_95203493c9\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.resident_guest_keys fk_rails_9539b5c88f\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.active_storage_variant_records fk_rails_993965df05\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.entrance_invitations fk_rails_9992af7a62\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.wena_keys fk_rails_99ec462bd1\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.fob_keys fk_rails_9b950aa82f\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.entrance_lock_settings fk_rails_9befedd7c2\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.autolock_schedules fk_rails_a0e63f0c58\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.relationships fk_rails_a3d77c3b00\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.entrance_block_fob_keys fk_rails_a403765376\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.entrance_resident_keys fk_rails_a5035d381f\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.entrance_knight_keys fk_rails_a635401c41\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.knight_pins fk_rails_a64ee923a2\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.entrance_fob_keys fk_rails_af780e48bc\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.resident_keys fk_rails_b0fd978d66\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.entrance_resident_guest_keys fk_rails_b6ec476525\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.entrance_knight_pins fk_rails_b7c2bfe16b\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.entrance_master_keys fk_rails_b86cbd1481\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.relationships fk_rails_be1f05b3d7\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.lock_settings fk_rails_c004fa487a\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.term_of_validities fk_rails_c0c932f574\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.active_storage_attachments fk_rails_c3b3935057\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.entrance_master_keys fk_rails_cf36d974ef\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.wena_keys fk_rails_d5ecae402c\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.weeklies fk_rails_d7ff067ab0\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.knight_logs fk_rails_ded551fbb4\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.resident_keys fk_rails_dfe4427a9d\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.entrance_block_knight_cards fk_rails_e8410af2ce\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.logs fk_rails_ef0f5cfa81\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.entrance_knight_keys fk_rails_f404f37ec9\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.entrance_block_knight_cards fk_rails_f6a259853d\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.invitations fk_rails_f87be4c20b\"</span>\npg_restore: creating ACL <span class=\"s2\">\"SCHEMA heroku_ext\"</span>\npg_restore: from TOC entry 4966<span class=\"p\">;</span> 0 0 ACL SCHEMA heroku_ext postgres\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: GRANT USAGE ON SCHEMA heroku_ext TO ubev937lfpa1d3 WITH GRANT OPTION<span class=\"p\">;</span>\n\n\npg_restore: creating ACL <span class=\"s2\">\"SCHEMA public\"</span>\npg_restore: from TOC entry 4967<span class=\"p\">;</span> 0 0 ACL SCHEMA public ubev937lfpa1d3\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"postgres\"</span> does not exist\nCommand was: REVOKE ALL ON SCHEMA public FROM postgres<span class=\"p\">;</span>\nREVOKE ALL ON SCHEMA public FROM PUBLIC<span class=\"p\">;</span>\nGRANT ALL ON SCHEMA public TO ubev937lfpa1d3<span class=\"p\">;</span>\nGRANT ALL ON SCHEMA public TO PUBLIC<span class=\"p\">;</span>\n\n\npg_restore: creating ACL <span class=\"s2\">\"public.FUNCTION pg_stat_statements_reset(userid oid, dbid oid, queryid bigint)\"</span>\npg_restore: from TOC entry 4970<span class=\"p\">;</span> 0 0 ACL FUNCTION pg_stat_statements_reset<span class=\"o\">(</span>userid oid, dbid oid, queryid bigint<span class=\"o\">)</span> postgres\npg_restore: error: could not execute query: ERROR:  role <span class=\"s2\">\"ubev937lfpa1d3\"</span> does not exist\nCommand was: GRANT ALL ON FUNCTION public.pg_stat_statements_reset<span class=\"o\">(</span>userid oid, dbid oid, queryid bigint<span class=\"o\">)</span> TO ubev937lfpa1d3<span class=\"p\">;</span>\n\n\npg_restore: warning: errors ignored on restore: 70\nテーブル数の一致確認\nherokuのテーブル数: <span class=\"o\">(</span>61 rows<span class=\"o\">)</span>\nauroraのテーブル数: <span class=\"o\">(</span>61 rows<span class=\"o\">)</span>\nテーブル数が一致しました。\n</code></pre></div></div>\n</details>\n<div class=\"code-block\" data-sourcepos=\"1545:1-1550:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>抜粋.sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>テーブル数の一致確認\nherokuのテーブル数: <span class=\"o\">(</span>61 rows<span class=\"o\">)</span>\nauroraのテーブル数: <span class=\"o\">(</span>61 rows<span class=\"o\">)</span>\nテーブル数が一致しました。\n</code></pre></div></div>\n<h2 data-sourcepos=\"1552:1-1552:56\" id=\"1-15-0\" name=\"1-15-0\"><a class=\"anchor\" id=\"17_Bucardoの設定、データプールの開始\" name=\"17_Bucardoの設定、データプールの開始\" href=\"#17_Bucardoの設定、データプールの開始\" data-position=\"1-15-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"17_Bucardoの設定、データプールの開始\"> &gt; 17_Bucardoの設定、データプールの開始</span></a>17_Bucardoの設定、<del>データプールの開始</del></h2>\n<h3 data-sourcepos=\"1554:1-1554:10\" id=\"1-15-1\" name=\"1-15-1\"><a class=\"anchor\" id=\"手順-13\" name=\"手順-13\" href=\"#手順-13\" data-position=\"1-15-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"手順\"> &gt; 手順</span></a>手順</h3>\n<div class=\"code-block\" data-sourcepos=\"1555:1-1578:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code><span class=\"nb\">mkdir</span> ~/../var/run/bucardo\n<span class=\"nb\">mkdir</span> ~/../var/log/bucardo\n\n<span class=\"nb\">echo</span> <span class=\"s2\">\"local   all             postgres                                trust\"</span> <span class=\"o\">&gt;&gt;</span> ~/../etc/postgresql/14/main/pg_hba.conf\n<span class=\"nb\">echo</span> <span class=\"s2\">\"local   all             bucardo                                 trust\"</span> <span class=\"o\">&gt;&gt;</span> ~/../etc/postgresql/14/main/pg_hba.conf\n\n<span class=\"nb\">sed</span> <span class=\"nt\">-i</span> <span class=\"nt\">-e</span> <span class=\"s2\">\"s/peer/trust/\"</span> ~/../etc/postgresql/14/main/pg_hba.conf\n\nservice postgresql stop\nservice postgresql start\n\nbucardo <span class=\"nb\">install\n\n</span>bucardo add db heroku_db <span class=\"nv\">dbhost</span><span class=\"o\">=</span>vpce-0bed708f6ce21788a-f4tmby1p.vpce-svc-0de703034cbfc279a.ap-northeast-1.vpce.amazonaws.com <span class=\"nv\">dbport</span><span class=\"o\">=</span>5432 <span class=\"nv\">dbname</span><span class=\"o\">=</span>dncvsso7me9p6 <span class=\"nv\">dbuser</span><span class=\"o\">=</span>ubev937lfpa1d3 <span class=\"nv\">dbpass</span><span class=\"o\">=</span>p009c5cb0136e7cea41f9b8792f9fb171dc1c8b0e764f49e2d3f3cc5bec32368f\n\nbucardo add db aws_db <span class=\"nv\">dbhost</span><span class=\"o\">=</span>king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com <span class=\"nv\">dbport</span><span class=\"o\">=</span>5432 <span class=\"nv\">dbname</span><span class=\"o\">=</span>kingapi <span class=\"nv\">dbuser</span><span class=\"o\">=</span>kingadmin <span class=\"nv\">dbpass</span><span class=\"o\">=</span>m3hkFJq4gkRVAZvY5Z1FkT7LeKtnjJSl\n\n<span class=\"c\"># グループ作成</span>\nbucardo add dbgroup dbs heroku_db:source aws_db:target\n\n<span class=\"c\"># プールするデータテーブルの指定</span>\nbucardo add table logs display_logs <span class=\"nv\">herd</span><span class=\"o\">=</span>herd_heroku_db <span class=\"nv\">db</span><span class=\"o\">=</span>heroku_db\n</code></pre></div></div>\n<h3 data-sourcepos=\"1579:1-1579:13\" id=\"1-15-2\" name=\"1-15-2\"><a class=\"anchor\" id=\"実行後-13\" name=\"実行後-13\" href=\"#実行後-13\" data-position=\"1-15-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"実行後\"> &gt; 実行後</span></a>実行後</h3>\n<div class=\"code-block\" data-sourcepos=\"1581:1-1641:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code><span class=\"c\"># mkdir ~/../var/run/bucardo</span>\n\n<span class=\"c\"># mkdir ~/../var/log/bucardo</span>\n\n<span class=\"c\"># echo \"local   all             postgres                                trust\" &gt;&gt; ~/../etc/postgresql/14/main/pg_hba.conf</span>\n<span class=\"c\"># echo \"local   all             bucardo                                 trust\" &gt;&gt; ~/../etc/postgresql/14/main/pg_hba.conf</span>\n\n<span class=\"c\"># sed -i -e \"s/peer/trust/\" ~/../etc/postgresql/14/main/pg_hba.conf</span>\n\n<span class=\"c\"># service postgresql stop</span>\n <span class=\"k\">*</span> Stopping PostgreSQL 14 database server                           <span class=\"o\">[</span> OK <span class=\"o\">]</span>\n \n<span class=\"c\"># service postgresql start</span>\n <span class=\"k\">*</span> Starting PostgreSQL 14 database server                           <span class=\"o\">[</span> OK <span class=\"o\">]</span>\n\n\n<span class=\"c\"># bucardo install</span>\nThis will <span class=\"nb\">install </span>the bucardo database into an existing Postgres cluster.\nPostgres must have been compiled with Perl support,\nand you must connect as a superuser\n\nCurrent connection settings:\n1. Host:           &lt;none&gt;\n2. Port:           5432\n3. User:           bucardo\n4. Database:       bucardo\n5. PID directory:  /var/run/bucardo\nEnter a number to change it, P to proceed, or Q to quit: P\n\nAttempting to create and populate the bucardo database and schema\nDatabase creation is <span class=\"nb\">complete\n\n</span>Updated configuration setting <span class=\"s2\">\"piddir\"</span>\nInstallation is now complete.\nIf you see errors or need <span class=\"nb\">help</span>, please email bucardo-general@bucardo.org\n\nYou may want to check over the configuration variables next, by running:\nbucardo show all\nChange any setting by using: bucardo <span class=\"nb\">set </span><span class=\"nv\">foo</span><span class=\"o\">=</span>bar\n\n<span class=\"c\"># bucardo add db heroku_db dbhost=vpce-0bed708f6ce21788a-f4tmby1p.vpce-svc-0de703034cbfc279a.ap-northeast-1.vpce.amazonaws.com dbport=5432 dbname=dncvsso7me9p6 dbuser=ubev937lfpa1d3 dbpass=p009c5cb0136e7cea41f9b8792f9fb171dc1c8b0e764f49e2d3f3cc5bec32368f</span>\nAdded database <span class=\"s2\">\"heroku_db\"</span>\n\n<span class=\"c\"># bucardo add db aws_db dbhost=king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com dbport=5432 dbname=kingapi dbuser=kingadmin dbpass=m3hkFJq4gkRVAZvY5Z1FkT7LeKtnjJSl</span>\nAdded database <span class=\"s2\">\"aws_db\"</span>\n\n<span class=\"c\"># bucardo add dbgroup dbs heroku_db:source aws_db:target</span>\nCreated dbgroup <span class=\"s2\">\"dbs\"</span>\nAdded database <span class=\"s2\">\"heroku_db\"</span> to dbgroup <span class=\"s2\">\"dbs\"</span> as <span class=\"nb\">source\n</span>Added database <span class=\"s2\">\"aws_db\"</span> to dbgroup <span class=\"s2\">\"dbs\"</span> as target\n\n<span class=\"c\"># bucardo add table logs display_logs herd=herd_heroku_db db=heroku_db</span>\nAdded the following tables or sequences:\n  public.display_logs\n  public.logs\nCreated the relgroup named <span class=\"s2\">\"herd_heroku_db\"</span>\nThe following tables or sequences are now part of the relgroup <span class=\"s2\">\"herd_heroku_db\"</span>:\n  public.display_logs\n  public.logs\n</code></pre></div></div>\n<h3 data-sourcepos=\"1642:1-1642:10\" id=\"1-15-3\" name=\"1-15-3\"><a class=\"anchor\" id=\"確認\" name=\"確認\" href=\"#確認\" data-position=\"1-15-3\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"確認\"> &gt; 確認</span></a>確認</h3>\n<p data-sourcepos=\"1643:1-1643:58\">bucardoの各種設定が反映されているかどうか</p>\n<div class=\"code-block\" data-sourcepos=\"1644:1-1655:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code><span class=\"c\"># bucardo list db</span>\nDatabase: aws_db     Status: active  Conn: psql <span class=\"nt\">-p</span> 5432 <span class=\"nt\">-U</span> kingadmin <span class=\"nt\">-d</span> kingapi <span class=\"nt\">-h</span> king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com\nDatabase: heroku_db  Status: active  Conn: psql <span class=\"nt\">-p</span> 5432 <span class=\"nt\">-U</span> ubev937lfpa1d3 <span class=\"nt\">-d</span> dncvsso7me9p6 <span class=\"nt\">-h</span> vpce-0bed708f6ce21788a-f4tmby1p.vpce-svc-0de703034cbfc279a.ap-northeast-1.vpce.amazonaws.com\n<span class=\"c\"># bucardo list dbgroup</span>\ndbgroup: dbs  Members: aws_db:target heroku_db:source\n<span class=\"c\"># bucardo list relgroup</span>\nRelgroup: herd_heroku_db  DB: heroku_db  Members: public.display_logs, public.logs\n<span class=\"c\"># bucardo list table</span>\n2. Table: public.display_logs  DB: heroku_db  PK: <span class=\"nb\">id</span> <span class=\"o\">(</span>uuid<span class=\"o\">)</span>\n1. Table: public.logs          DB: heroku_db  PK: <span class=\"nb\">id</span> <span class=\"o\">(</span>uuid<span class=\"o\">)</span>\n</code></pre></div></div>\n<h2 data-sourcepos=\"1657:1-1657:39\" id=\"1-16-0\" name=\"1-16-0\"><a class=\"anchor\" id=\"18_インスタンスタイプ変更\" name=\"18_インスタンスタイプ変更\" href=\"#18_インスタンスタイプ変更\" data-position=\"1-16-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"18_インスタンスタイプ変更\"> &gt; 18_インスタンスタイプ変更</span></a>18_インスタンスタイプ変更</h2>\n<h3 data-sourcepos=\"1658:1-1658:10\" id=\"1-16-1\" name=\"1-16-1\"><a class=\"anchor\" id=\"手順-14\" name=\"手順-14\" href=\"#手順-14\" data-position=\"1-16-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"手順\"> &gt; 手順</span></a>手順</h3>\n<p data-sourcepos=\"1659:1-1661:126\">コンソールでライターインスタンスを選択しdb.r5.24xlargeを選択<br>\nすぐに適用<br>\nリーダーと入れ替わるので、フェイルオーバーをしてライターインスタンスとして復帰させる</p>\n<h3 data-sourcepos=\"1662:1-1662:13\" id=\"1-16-2\" name=\"1-16-2\"><a class=\"anchor\" id=\"実行後-14\" name=\"実行後-14\" href=\"#実行後-14\" data-position=\"1-16-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"実行後\"> &gt; 実行後</span></a>実行後</h3>\n<p data-sourcepos=\"1664:1-1677:206\">インスタンスタイプ変更<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/17/136273/2c16e0cc-0639-4b23-a07d-58fa760c377a.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"779\" alt=\"スクリーンショット 2023-04-17 14.57.14.png (112.1 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/17/136273/2c16e0cc-0639-4b23-a07d-58fa760c377a.png\"></a><br>\n5分後:変更中(リーダーに格下げされた)<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/17/136273/576319d5-89e2-43e9-a725-3f07a2b241b7.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"1351\" alt=\"スクリーンショット 2023-04-17 15.02.41.png (47.3 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/17/136273/576319d5-89e2-43e9-a725-3f07a2b241b7.png\"></a><br>\nさらに4分後:Configuring-enhanced-monitoring<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/17/136273/9e2fadc8-4b11-433f-b34d-4d8193c32bb7.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"1506\" alt=\"スクリーンショット 2023-04-17 15.06.17.png (50.8 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/17/136273/9e2fadc8-4b11-433f-b34d-4d8193c32bb7.png\"></a><br>\nさらに4分後:Storage-optimization<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/17/136273/b1fe4277-6e27-4252-b4ad-6aac42aaadf8.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"1411\" alt=\"スクリーンショット 2023-04-17 15.10.29.png (49.4 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/17/136273/b1fe4277-6e27-4252-b4ad-6aac42aaadf8.png\"></a><br>\nさらに9分後:利用可能になった<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/17/136273/530061d2-2182-430d-9d8c-6ccc3ad5c1b6.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"1338\" alt=\"スクリーンショット 2023-04-17 15.19.31.png (48.5 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/17/136273/530061d2-2182-430d-9d8c-6ccc3ad5c1b6.png\"></a><br>\nここでフェイルオーバーを行い、リーダーとライターを入れ替える(移行に使うのはライター)<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/17/136273/fc99b4ed-80d6-4a62-ad5d-90a6324f6b2b.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"816\" alt=\"スクリーンショット 2023-04-17 15.22.13.png (29.5 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/17/136273/fc99b4ed-80d6-4a62-ad5d-90a6324f6b2b.png\"></a><br>\nフェイルオーバーから3分後、入れ替わって利用可能に<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/17/136273/86334a0e-5760-401f-b633-9e3a6fb75bc9.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"1347\" alt=\"スクリーンショット 2023-04-17 15.24.45.png (48.8 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/17/136273/86334a0e-5760-401f-b633-9e3a6fb75bc9.png\"></a></p>\n<h2 data-sourcepos=\"1681:1-1681:18\" id=\"1-17-0\" name=\"1-17-0\"><a class=\"anchor\" id=\"最後に確認\" name=\"最後に確認\" href=\"#最後に確認\" data-position=\"1-17-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"最後に確認\"> &gt; 最後に確認</span></a>最後に確認</h2>\n<ul data-sourcepos=\"1682:1-1683:90\">\n<li data-sourcepos=\"1682:1-1683:90\">Dockerコンテナが起きていなかった問題\n<ul data-sourcepos=\"1683:5-1683:90\">\n<li data-sourcepos=\"1683:5-1683:90\">手順通りに実施したところきちんとdockerコンテナが起きていた</li>\n</ul></li>\n</ul>\n<div class=\"code-block\" data-sourcepos=\"1684:2-1688:4\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>ubuntu@ip-172-30-3-25:~<span class=\"nv\">$ </span><span class=\"nb\">sudo </span>docker ps\nCONTAINER ID   IMAGE                                                                          COMMAND       CREATED       STATUS       PORTS      NAMES\n10cf28189a1f   931243214056.dkr.ecr.ap-northeast-1.amazonaws.com/king-api-cfn-bucardo-image   <span class=\"s2\">\"/bin/bash\"</span>   2 hours ago   Up 2 hours   5432/tcp   objective_banach\n</code></pre></div></div>\n<ul data-sourcepos=\"1689:1-1690:0\">\n<li data-sourcepos=\"1689:1-1690:0\">psql疎通確認</li>\n</ul>\n<div class=\"code-block\" data-sourcepos=\"1691:1-1698:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>Aurora.sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>psql <span class=\"nt\">-h</span> king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com <span class=\"nt\">-U</span> kingadmin <span class=\"nt\">-d</span> kingapi <span class=\"nt\">-p</span> 5432\npsql <span class=\"o\">(</span>14.7 <span class=\"o\">(</span>Ubuntu 14.7-0ubuntu0.22.04.1<span class=\"o\">)</span>, server 14.5<span class=\"o\">)</span>\nSSL connection <span class=\"o\">(</span>protocol: TLSv1.2, cipher: AES128-SHA256, bits: 128, compression: off<span class=\"o\">)</span>\nType <span class=\"s2\">\"help\"</span> <span class=\"k\">for </span>help.\n\n<span class=\"nv\">kingapi</span><span class=\"o\">=&gt;</span>\n</code></pre></div></div>\n<div class=\"code-block\" data-sourcepos=\"1699:1-1706:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>Heroku.sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>psql <span class=\"nt\">-h</span> vpce-0bed708f6ce21788a-f4tmby1p.vpce-svc-0de703034cbfc279a.ap-northeast-1.vpce.amazonaws.com <span class=\"nt\">-d</span> dncvsso7me9p6 <span class=\"nt\">-U</span> ubev937lfpa1d3 <span class=\"nt\">-p</span> 5432\npsql <span class=\"o\">(</span>14.7 <span class=\"o\">(</span>Ubuntu 14.7-0ubuntu0.22.04.1<span class=\"o\">)</span>, server 14.6 <span class=\"o\">(</span>Ubuntu 14.6-1.pgdg20.04+1<span class=\"o\">))</span>\nSSL connection <span class=\"o\">(</span>protocol: TLSv1.3, cipher: TLS_AES_256_GCM_SHA384, bits: 256, compression: off<span class=\"o\">)</span>\nType <span class=\"s2\">\"help\"</span> <span class=\"k\">for </span>help.\n\n<span class=\"nv\">dncvsso7me9p6</span><span class=\"o\">=&gt;</span>\n</code></pre></div></div>\n",
    "created_at": "2023-04-17T11:48:17+09:00",
    "message": "Update post.",
    "kind": "stock",
    "comments_count": 0,
    "tasks_count": 0,
    "done_tasks_count": 0,
    "url": "https://qrio.esa.io/posts/1626",
    "updated_at": "2023-07-18T10:47:41+09:00",
    "tags": [],
    "category": "Users/杉山/Database",
    "revision_number": 17,
    "created_by": {
      "myself": false,
      "name": "杉山聡",
      "screen_name": "satoshi_sugiyama",
      "icon": "https://img.esa.io/uploads/production/members/129432/icon/thumb_m_4589e2842b9d87757c7c9db07c45c00d.jpg"
    },
    "updated_by": {
      "myself": false,
      "name": "杉山聡",
      "screen_name": "satoshi_sugiyama",
      "icon": "https://img.esa.io/uploads/production/members/129432/icon/thumb_m_4589e2842b9d87757c7c9db07c45c00d.jpg"
    },
    "stargazers_count": 0,
    "watchers_count": 1,
    "star": false,
    "watch": false,
    "sharing_urls": null
  },
  {
    "number": 1563,
    "name": "StagingDynoコスト",
    "full_name": "Users/杉山/Database/StagingDynoコスト",
    "wip": false,
    "body_md": "## これは\r\n\r\nKing-apiのAurora移行起因でroomon-api、sirius-apiのStaging環境をPrivateSpaceに移動させたことによるコスト増分と再度接続方法の見直し\r\n\r\n## 接続\r\n\r\n|  | 通常dyno Staging環境(旧) | PrivateSpaceStaging環境(現行) |\r\n| -------- | -------- | -------- |\r\n| dynoのIPアドレス | グローバルかつ動的 | ローカルかつ静的 |\r\n| AuroraKingDBとの接続 | HerokuKingDBと同様インターネット経由 | VPC Peering経由でプライベートに接続 |\r\n| 懸念事項 | AuroraKingDBのセキュリティ低下(パブリックアクセスをONにする必要がある) | KingDBのAurora移行によるコストインパクトを阻害する |\r\n\r\n## 消費dyno units比較\r\n変動したdynoのみ記述\r\n\r\n- customer-staging\r\n    - web(standard1x→PrivateM)(1→10)\r\n- roomon-dev\r\n    - web(standard1x→PrivateM)(1→10)\r\n- sirius-api-staging\r\n    - web (standard1x→PrivateS)(1→5)\r\n    - worker(standard1x→PrivateS)(1→5)\r\n\r\n旧common runtimeとの比較を表にする\r\n1dyno=5,000円として\r\n今後の容量増加を見据えてProdのDB容量が1TB〜1.6TBまでの試算\r\n\r\n| Staging=3,000IOPSで月内160時間の場合 | 旧構成 |  現Private-M構成 | Private-Sにした場合|\r\n| -------- | -------- | -------- | -------- |\r\n| 月消費units | 4 | 30 | 20 |\r\n|日本円に直すと| 20,000 | 150,000 | 100,000 |\r\n| dyno差額 | 0 | 130,000 | 80,000 |\r\n| [DBコスト効果(ドル/月)prod1TBオーバー(stg高)](https://qrio.esa.io/posts/1493#%E6%AF%94%E8%BC%83%E8%A1%A8) | -2,555.0684 | -2,555.0684 | -2,555.0684 |\r\n| [DBコスト効果(円/月)prod1TBオーバー(stg高)](https://qrio.esa.io/posts/1493#%E6%AF%94%E8%BC%83%E8%A1%A8) | -339,890.53 | -339,890.53 |-339,890.53 |\r\n| dyno差額打ち消し | -339,890.53 | -209,890.53 | -259890.53 |\r\n| 年間コスト効果(円/年) | -4,078,686.36 | -2,518,686.36 | -3,118,686.36 |\r\n\r\n| Staging=3,000IOPSで月内20時間の場合 | 旧構成 |  現Private-M構成 | Private-Sにした場合|\r\n| -------- | -------- | -------- | -------- |\r\n| 月消費units | 4 | 30 | 20 |\r\n|日本円に直すと| 20,000 | 150,000 | 100,000 |\r\n| dyno差額 | 0 | 130,000 | 80,000 |\r\n| [DBコスト効果(ドル/月)prod1TBオーバー(stg低)](https://qrio.esa.io/posts/1493#%E6%AF%94%E8%BC%83%E8%A1%A8) | -2,785.1566| -2,785.1566 | -2,785.1566 |\r\n| [DBコスト効果(円/月)prod1TBオーバー(stg低)](https://qrio.esa.io/posts/1493#%E6%AF%94%E8%BC%83%E8%A1%A8) | -370,345.06 | -370,345.06 | -370,345.06 | \r\n| dyno差額打ち消し | -370,345.06 | -240,345.06 | -290,345.06 |\r\n| 年間コスト効果(円/年) | -4,444,140.72 | -2,884,140.72 | -3,484,140.72 |\r\n\r\n\r\n**dyno unitsが契約数からはみ出たら上記dyno差額が発生する**\r\n→ただ、現状利用分は両チーム合計で224 \r\n\r\n上限は260なので、はみ出なさそう？\r\n\r\n<img width=\"1432\" alt=\"スクリーンショット 2023-01-10 12.48.09.png (133.0 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/03/17/136273/9b9dbf5c-910d-4322-aabc-248fe0d63c07.png\">\r\n\r\n→→**だが来期契約の見積もりに現在の使用数が影響する？？？**\r\n\r\n## プラン下げ施策\r\n\r\n<details>\r\n\r\n<summary>全アプリプラン一覧</summary>\r\n\r\n```\r\nandfactory-api-document\r\nNo dynos on ⬢ andfactory-api-document\r\n-------------------------------------\r\ndotd-api-document\r\nNo dynos on ⬢ dotd-api-document\r\n-------------------------------------\r\nekey-generator\r\n=== web (Standard-1X): java -Dserver.port=$PORT $JAVA_OPTS -jar build/libs/*.jar (1)\r\nweb.1: up 2023/03/16 12:55:39 +0900 (~ 8h ago)\r\n\r\n-------------------------------------\r\nencored-japan-api-document\r\nNo dynos on ⬢ encored-japan-api-document\r\n-------------------------------------\r\nkddi-api-document\r\nNo dynos on ⬢ kddi-api-document\r\n-------------------------------------\r\nke-hi-production\r\n=== web (Standard-1X): bin/rails server -p $PORT -e $RAILS_ENV (4)\r\nweb.1: up 2023/03/16 15:02:56 +0900 (~ 6h ago)\r\nweb.2: up 2023/03/16 16:45:57 +0900 (~ 4h ago)\r\nweb.3: up 2023/03/16 14:43:16 +0900 (~ 6h ago)\r\nweb.4: up 2023/03/16 16:21:34 +0900 (~ 4h ago)\r\n\r\n=== worker (Standard-1X): bundle exec sidekiq -C config/sidekiq.yml (2)\r\nworker.1: up 2023/03/16 16:32:39 +0900 (~ 4h ago)\r\nworker.2: up 2023/03/16 14:07:34 +0900 (~ 7h ago)\r\n\r\n-------------------------------------\r\nke-hi-staging\r\n=== web (Standard-1X): bin/proximo rails server -p $PORT -e $RAILS_ENV (1)\r\nweb.1: up 2023/03/16 06:11:18 +0900 (~ 15h ago)\r\n\r\n=== worker (Standard-1X): bin/proximo bundle exec sidekiq -C config/sidekiq.yml (1)\r\nworker.1: up 2023/03/16 06:11:15 +0900 (~ 15h ago)\r\n\r\n-------------------------------------\r\nkehi-ope\r\nNo dynos on ⬢ kehi-ope\r\n-------------------------------------\r\nking-btob-api-document\r\nNo dynos on ⬢ king-btob-api-document\r\n-------------------------------------\r\nmaster-data-production\r\nNo dynos on ⬢ master-data-production\r\n-------------------------------------\r\nmaster-data-staging\r\n=== web (Standard-2X): bin/rails server -p ${PORT:-5000} -e $RAILS_ENV (1)\r\nweb.1: up 2023/03/16 16:10:56 +0900 (~ 5h ago)\r\n\r\n-------------------------------------\r\nnature-api-document\r\n=== web (Standard-1X): node index.js (1)\r\nweb.1: up 2023/03/16 08:34:28 +0900 (~ 12h ago)\r\n\r\n-------------------------------------\r\nplanis-api-document\r\nNo dynos on ⬢ planis-api-document\r\n-------------------------------------\r\nqb-api-production\r\n=== web (Performance-M): bin/rails server -p ${PORT:-5000} -e $RAILS_ENV (2)\r\nweb.1: up 2023/03/16 02:12:04 +0900 (~ 19h ago)\r\nweb.2: up 2023/03/16 02:21:21 +0900 (~ 18h ago)\r\n\r\n-------------------------------------\r\nqb-api-staging\r\n=== web (Standard-1X): bin/rails server -p ${PORT:-5000} -e $RAILS_ENV (1)\r\nweb.1: up 2023/03/16 09:51:55 +0900 (~ 11h ago)\r\n\r\n-------------------------------------\r\nqb-auth-production\r\n=== web (Standard-1X): bin/rails server -p $PORT -e $RAILS_ENV (2)\r\nweb.1: up 2023/03/16 05:33:57 +0900 (~ 15h ago)\r\nweb.2: up 2023/03/16 06:55:35 +0900 (~ 14h ago)\r\n\r\n=== worker (Standard-1X): bundle exec sidekiq -C config/sidekiq.yml (1)\r\nworker.1: up 2023/03/16 07:55:00 +0900 (~ 13h ago)\r\n\r\n-------------------------------------\r\nqb-auth-staging\r\n=== web (Standard-1X): bin/rails server -p $PORT -e $RAILS_ENV (1)\r\nweb.1: up 2023/03/16 09:51:54 +0900 (~ 11h ago)\r\n\r\n=== worker (Standard-1X): bundle exec sidekiq -C config/sidekiq.yml (1)\r\nworker.1: up 2023/03/16 09:51:51 +0900 (~ 11h ago)\r\n\r\n-------------------------------------\r\nqriolock-document\r\nNo dynos on ⬢ qriolock-document\r\n-------------------------------------\r\nsecual-api-document\r\nNo dynos on ⬢ secual-api-document\r\n-------------------------------------\r\nsimely-production\r\n=== web (Standard-1X): bin/rails server -p ${PORT:-5000} -e $RAILS_ENV (1)\r\nweb.1: up 2023/03/16 15:14:28 +0900 (~ 6h ago)\r\n\r\n-------------------------------------\r\nsimely-staging\r\nNo dynos on ⬢ simely-staging\r\n-------------------------------------\r\nsmartlock-api-production\r\n=== web (Performance-M): ./docker-entrypoint.sh (2)\r\nweb.1: up 2023/03/16 12:26:06 +0900 (~ 8h ago)\r\nweb.2: up 2023/03/15 21:55:08 +0900 (~ 23h ago)\r\n\r\n-------------------------------------\r\nsmartlock-api-staging\r\n=== web (Standard-1X): ./docker-entrypoint.sh (1)\r\nweb.1: up 2023/03/16 13:09:36 +0900 (~ 8h ago)\r\n\r\n-------------------------------------\r\nsmartlock-ekey-production\r\n=== web (Standard-1X): bin/rails server -p $PORT -e $RAILS_ENV (3)\r\nweb.1: up 2023/03/16 05:05:31 +0900 (~ 16h ago)\r\nweb.2: up 2023/03/16 05:05:30 +0900 (~ 16h ago)\r\nweb.3: up 2023/03/16 05:05:29 +0900 (~ 16h ago)\r\n\r\n-------------------------------------\r\nsmartlock-ekey-staging\r\nNo dynos on ⬢ smartlock-ekey-staging\r\n-------------------------------------\r\nsmarttag-server-production\r\n=== web (Standard-1X): newrelic-admin run-program python app.py (2)\r\nweb.1: up 2023/03/16 12:24:10 +0900 (~ 8h ago)\r\nweb.2: up 2023/03/16 15:34:40 +0900 (~ 5h ago)\r\n\r\n-------------------------------------\r\nsmarttag-server-staging\r\nNo dynos on ⬢ smarttag-server-staging\r\n-------------------------------------\r\nsomc-api-document\r\n=== web (Standard-1X): node index.js (1)\r\nweb.1: up 2023/03/16 14:23:19 +0900 (~ 6h ago)\r\n\r\n-------------------------------------\r\nstaging-king-api-document\r\nNo dynos on ⬢ staging-king-api-document\r\n-------------------------------------\r\nsupenavi-api-document\r\nNo dynos on ⬢ supenavi-api-document\r\n-------------------------------------\r\ncastle-api-production\r\n=== web (Private-S): yarn start (2)\r\nweb.1: up 2023/03/16 03:15:24 +0900 (~ 18h ago)\r\nweb.2: up 2023/03/16 00:45:46 +0900 (~ 20h ago)\r\n\r\n-------------------------------------\r\ncastle-api-staging\r\n=== web (Standard-2X): yarn start (1)\r\nweb.1: up 2023/03/16 14:35:30 +0900 (~ 6h ago)\r\n\r\n-------------------------------------\r\ncastle-console-production\r\n=== web (Private-S): yarn start (2)\r\nweb.1: up 2023/03/16 04:32:57 +0900 (~ 16h ago)\r\nweb.2: up 2023/03/15 23:53:43 +0900 (~ 21h ago)\r\n\r\n-------------------------------------\r\ncastle-console-staging\r\n=== web (Standard-2X): yarn start (1)\r\nweb.1: up 2023/03/16 15:04:26 +0900 (~ 6h ago)\r\n\r\n-------------------------------------\r\ncastle-ope\r\n=== web (Private-S): npm start (1)\r\nweb.1: up 2023/03/16 02:46:34 +0900 (~ 18h ago)\r\n\r\n-------------------------------------\r\ncastle-ope-staging\r\nNo dynos on ⬢ castle-ope-staging\r\n-------------------------------------\r\ncustomer-support-api-prod\r\n=== web (Private-M): npm start (1)\r\nweb.1: up 2023/03/16 03:23:11 +0900 (~ 17h ago)\r\n\r\n-------------------------------------\r\ncustomer-support-api-staging\r\n=== web (Private-M): npm start (1)\r\nweb.1: up 2023/03/15 18:52:29 +0900\r\n\r\n-------------------------------------\r\nprod-king-ope\r\n=== web (Private-S): npm start (1)\r\nweb.1: up 2023/03/15 22:58:42 +0900 (~ 22h ago)\r\n\r\n-------------------------------------\r\nroomon-api-dev\r\n=== web (Private-M): npm start (1)\r\nweb.1: up 2023/03/15 20:18:54 +0900\r\n\r\n-------------------------------------\r\nroomon-api-dev-old\r\nNo dynos on ⬢ roomon-api-dev-old\r\n-------------------------------------\r\nroomon-api-production\r\n=== web (Private-M): npm start (2)\r\nweb.1: up 2023/03/16 01:39:25 +0900 (~ 19h ago)\r\nweb.2: up 2023/03/16 06:50:02 +0900 (~ 14h ago)\r\n\r\n-------------------------------------\r\nroomon-api-staging\r\n=== web (Private-M): npm start (1)\r\nweb.1: up 2023/03/16 18:37:39 +0900 (~ 2h ago)\r\n\r\n-------------------------------------\r\nroomon-api-sucre-dev\r\n=== web (Standard-1X): npm start (1)\r\nweb.1: up 2023/03/16 07:57:21 +0900 (~ 13h ago)\r\n\r\n-------------------------------------\r\nroomon-api-sucre-staging\r\n=== web (Standard-1X): npm start (1)\r\nweb.1: up 2023/03/16 18:33:25 +0900 (~ 2h ago)\r\n\r\n-------------------------------------\r\nsirius-api-production\r\n=== web (Private-S): bundle exec puma -C config/puma.rb (2)\r\nweb.1: up 2023/03/16 05:45:12 +0900 (~ 15h ago)\r\nweb.2: up 2023/03/16 07:34:54 +0900 (~ 13h ago)\r\n\r\n=== worker (Private-S): bundle exec sidekiq -C config/sidekiq.yml (1)\r\nworker.1: up 2023/03/16 07:37:00 +0900 (~ 13h ago)\r\n\r\n-------------------------------------\r\nsirius-api-staging\r\n=== web (Private-S): bundle exec puma -C config/puma.rb (1)\r\nweb.1: up 2023/03/16 12:35:08 +0900 (~ 8h ago)\r\n\r\n=== worker (Private-S): bundle exec sidekiq -C config/sidekiq.yml (1)\r\nworker.1: up 2023/03/16 12:35:15 +0900 (~ 8h ago)\r\n\r\n-------------------------------------\r\nsirius-api-stg-before-pri-spa\r\nNo dynos on ⬢ sirius-api-stg-before-pri-spa\r\n-------------------------------------\r\nsirius-api-v3-staging\r\n=== web (Standard-2X): bundle exec puma -C config/puma.rb (1)\r\nweb.1: up 2023/03/16 16:10:07 +0900 (~ 5h ago)\r\n\r\n=== worker (Standard-1X): bundle exec sidekiq -C config/sidekiq.yml (1)\r\nworker.1: up 2023/03/16 15:42:21 +0900 (~ 5h ago)\r\n\r\n-------------------------------------\r\nsirius-ep-console\r\nNo dynos on ⬢ sirius-ep-console\r\n-------------------------------------\r\nsirius-ep-console-staging\r\nNo dynos on ⬢ sirius-ep-console-staging\r\n-------------------------------------\r\nsl2-api-db-migration-test\r\n=== web (Private-M): bundle exec puma -C config/puma.rb (1)\r\nweb.1: up 2023/03/16 07:14:55 +0900 (~ 14h ago)\r\n\r\n=== worker (Private-M): bundle exec sidekiq -C config/sidekiq.yml (1)\r\nworker.1: up 2023/03/16 07:14:48 +0900 (~ 14h ago)\r\n\r\n-------------------------------------\r\nsl2-api-production\r\n=== web (Private-M): bundle exec puma -C config/puma.rb (4)\r\nweb.1: up 2023/03/16 01:42:08 +0900 (~ 19h ago)\r\nweb.2: up 2023/03/16 00:40:44 +0900 (~ 20h ago)\r\nweb.3: up 2023/03/16 00:48:49 +0900 (~ 20h ago)\r\nweb.4: up 2023/03/16 02:16:42 +0900 (~ 19h ago)\r\n\r\n=== worker (Private-S): bundle exec sidekiq -C config/sidekiq.yml (2)\r\nworker.1: up 2023/03/16 07:45:33 +0900 (~ 13h ago)\r\nworker.2: up 2023/03/15 21:23:57 +0900 (~ 23h ago)\r\n\r\n-------------------------------------\r\nsl2-api-sirius-staging\r\n=== web (Standard-1X): bundle exec puma -C config/puma.rb (1)\r\nweb.1: up 2023/03/16 08:27:50 +0900 (~ 12h ago)\r\n\r\n=== worker (Standard-1X): bundle exec sidekiq -C config/sidekiq.yml (1)\r\nworker.1: up 2023/03/16 13:53:27 +0900 (~ 7h ago)\r\n\r\n-------------------------------------\r\nsl2-api-staging\r\n=== web (Private-S): bundle exec puma -C config/puma.rb (1)\r\nweb.1: up 2023/03/16 19:32:23 +0900 (~ 1h ago)\r\n\r\n=== worker (Private-S): bundle exec sidekiq -C config/sidekiq.yml (1)\r\nworker.1: up 2023/03/16 19:32:17 +0900 (~ 1h ago)\r\n\r\n-------------------------------------\r\nsl2-api-staging-test\r\n=== web (Standard-2X): bundle exec puma -C config/puma.rb (1)\r\nweb.1: up 2023/03/16 13:58:26 +0900 (~ 7h ago)\r\n\r\n=== worker (Standard-1X): bundle exec sidekiq -C config/sidekiq.yml (1)\r\nworker.1: up 2023/03/16 12:21:18 +0900 (~ 9h ago)\r\n\r\n-------------------------------------\r\nsl2-api-sucre-staging\r\n=== web (Standard-2X): bundle exec puma -C config/puma.rb (1)\r\nweb.1: up 2023/03/16 07:19:11 +0900 (~ 14h ago)\r\n\r\n=== worker (Standard-1X): bundle exec sidekiq -C config/sidekiq.yml (1)\r\nworker.1: up 2023/03/16 07:53:21 +0900 (~ 13h ago)\r\n\r\n-------------------------------------\r\nstaging-king-ope\r\nNo dynos on ⬢ staging-king-ope\r\n-------------------------------------\r\ntest-api-1\r\nNo dynos on ⬢ test-api-1\r\n-------------------------------------\r\ntest-api-2\r\nNo dynos on ⬢ test-api-2\r\n```\r\n\r\n\r\n</details>\r\n\r\nPrivate-Sにできるか\r\n\r\n- [x] customer-support-api-staging (Private-M*1)\r\n- [x] roomon-api-dev (Private-M*1)検討中\r\n- [ ] 付随して、roomon-api-staging (Private-M*1)検討中\r\n- [x] sl2-api-db-migration-test (Private-M*2)\r\n    - 本番検証が控えているため上記プランを継続、利用後削除か\r\n\r\n上3つをPrivate-Sにすることで15dyno units/月 節約できる\r\n\r\n\r\n## コスト影響を踏まえての判断\r\n\r\n各staging dynoをprivateにうつさない場合は、AuroraKingDBのセキュリティが低下(移行前と同水準に戻る)する\r\n＝roomon-apiとsirius-apiのStagingをPrivate Dynoで構成することで、セキュリティを向上した上でHerokuPostgres分の料金が削減できる状態に未だあると判断できるが、大幅なコスト効果の低下\r\n\r\nまた、今後Heroku DynoではなくAWSへのサーバー移管も計画していることからdyno unitsの消費増加は1〜2年の限定的的なものとみれるが、AWSでのサーバー運用コスト評価次第\r\n\r\n## 反省\r\n\r\nprivate spaceに移動するとコストが上がるところを見落としていたことを反省しています。\r\n",
    "body_html": "<h2 data-sourcepos=\"1:1-1:12\" id=\"0-1-0\" name=\"0-1-0\"><a class=\"anchor\" id=\"これは\" name=\"これは\" href=\"#これは\" data-position=\"0-1-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"これは\"> &gt; これは</span></a>これは</h2>\n<p data-sourcepos=\"3:1-3:167\">King-apiのAurora移行起因でroomon-api、sirius-apiのStaging環境をPrivateSpaceに移動させたことによるコスト増分と再度接続方法の見直し</p>\n<h2 data-sourcepos=\"5:1-5:9\" id=\"0-2-0\" name=\"0-2-0\"><a class=\"anchor\" id=\"接続\" name=\"接続\" href=\"#接続\" data-position=\"0-2-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"接続\"> &gt; 接続</span></a>接続</h2>\n<table data-sourcepos=\"7:1-11:188\">\n<thead>\n<tr data-sourcepos=\"7:1-7:72\">\n<th data-sourcepos=\"7:2-7:3\"></th>\n<th data-sourcepos=\"7:5-7:35\">通常dyno Staging環境(旧)</th>\n<th data-sourcepos=\"7:37-7:71\">PrivateSpaceStaging環境(現行)</th>\n</tr>\n</thead>\n<tbody>\n<tr data-sourcepos=\"9:1-9:82\">\n<td data-sourcepos=\"9:2-9:24\">dynoのIPアドレス</td>\n<td data-sourcepos=\"9:26-9:54\">グローバルかつ動的</td>\n<td data-sourcepos=\"9:56-9:81\">ローカルかつ静的</td>\n</tr>\n<tr data-sourcepos=\"10:1-10:129\">\n<td data-sourcepos=\"10:2-10:27\">AuroraKingDBとの接続</td>\n<td data-sourcepos=\"10:29-10:78\">HerokuKingDBと同様インターネット経由</td>\n<td data-sourcepos=\"10:80-10:128\">VPC Peering経由でプライベートに接続</td>\n</tr>\n<tr data-sourcepos=\"11:1-11:188\">\n<td data-sourcepos=\"11:2-11:15\">懸念事項</td>\n<td data-sourcepos=\"11:17-11:115\">AuroraKingDBのセキュリティ低下(パブリックアクセスをONにする必要がある)</td>\n<td data-sourcepos=\"11:117-11:187\">KingDBのAurora移行によるコストインパクトを阻害する</td>\n</tr>\n</tbody>\n</table>\n<h2 data-sourcepos=\"13:1-13:25\" id=\"0-3-0\" name=\"0-3-0\"><a class=\"anchor\" id=\"消費dyno units比較\" name=\"消費dyno units比較\" href=\"#消費dyno units比較\" data-position=\"0-3-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"消費dyno units比較\"> &gt; 消費dyno units比較</span></a>消費dyno units比較</h2>\n<p data-sourcepos=\"14:1-14:28\">変動したdynoのみ記述</p>\n<ul data-sourcepos=\"16:1-23:0\">\n<li data-sourcepos=\"16:1-17:40\">customer-staging\n<ul data-sourcepos=\"17:5-17:40\">\n<li data-sourcepos=\"17:5-17:40\">web(standard1x→PrivateM)(1→10)</li>\n</ul></li>\n<li data-sourcepos=\"18:1-19:40\">roomon-dev\n<ul data-sourcepos=\"19:5-19:40\">\n<li data-sourcepos=\"19:5-19:40\">web(standard1x→PrivateM)(1→10)</li>\n</ul></li>\n<li data-sourcepos=\"20:1-23:0\">sirius-api-staging\n<ul data-sourcepos=\"21:5-23:0\">\n<li data-sourcepos=\"21:5-21:40\">web (standard1x→PrivateS)(1→5)</li>\n<li data-sourcepos=\"22:5-23:0\">worker(standard1x→PrivateS)(1→5)</li>\n</ul></li>\n</ul>\n<p data-sourcepos=\"24:1-26:80\">旧common runtimeとの比較を表にする<br>\n1dyno=5,000円として<br>\n今後の容量増加を見据えてProdのDB容量が1TB〜1.6TBまでの試算</p>\n<table data-sourcepos=\"28:1-36:82\">\n<thead>\n<tr data-sourcepos=\"28:1-28:108\">\n<th data-sourcepos=\"28:2-28:47\">Staging=3,000IOPSで月内160時間の場合</th>\n<th data-sourcepos=\"28:49-28:59\">旧構成</th>\n<th data-sourcepos=\"28:61-28:81\">現Private-M構成</th>\n<th data-sourcepos=\"28:83-28:107\">Private-Sにした場合</th>\n</tr>\n</thead>\n<tbody>\n<tr data-sourcepos=\"30:1-30:32\">\n<td data-sourcepos=\"30:2-30:17\">月消費units</td>\n<td data-sourcepos=\"30:19-30:21\">4</td>\n<td data-sourcepos=\"30:23-30:26\">30</td>\n<td data-sourcepos=\"30:28-30:31\">20</td>\n</tr>\n<tr data-sourcepos=\"31:1-31:52\">\n<td data-sourcepos=\"31:2-31:22\">日本円に直すと</td>\n<td data-sourcepos=\"31:24-31:31\">20,000</td>\n<td data-sourcepos=\"31:33-31:41\">150,000</td>\n<td data-sourcepos=\"31:43-31:51\">100,000</td>\n</tr>\n<tr data-sourcepos=\"32:1-32:37\">\n<td data-sourcepos=\"32:2-32:13\">dyno差額</td>\n<td data-sourcepos=\"32:15-32:17\">0</td>\n<td data-sourcepos=\"32:19-32:27\">130,000</td>\n<td data-sourcepos=\"32:29-32:36\">80,000</td>\n</tr>\n<tr data-sourcepos=\"33:1-33:164\">\n<td data-sourcepos=\"33:2-33:121\"><a href=\"https://qrio.esa.io/posts/1493#%E6%AF%94%E8%BC%83%E8%A1%A8\">DBコスト効果(ドル/月)prod1TBオーバー(stg高)</a></td>\n<td data-sourcepos=\"33:123-33:135\">-2,555.0684</td>\n<td data-sourcepos=\"33:137-33:149\">-2,555.0684</td>\n<td data-sourcepos=\"33:151-33:163\">-2,555.0684</td>\n</tr>\n<tr data-sourcepos=\"34:1-34:160\">\n<td data-sourcepos=\"34:2-34:118\"><a href=\"https://qrio.esa.io/posts/1493#%E6%AF%94%E8%BC%83%E8%A1%A8\">DBコスト効果(円/月)prod1TBオーバー(stg高)</a></td>\n<td data-sourcepos=\"34:120-34:132\">-339,890.53</td>\n<td data-sourcepos=\"34:134-34:146\">-339,890.53</td>\n<td data-sourcepos=\"34:148-34:159\">-339,890.53</td>\n</tr>\n<tr data-sourcepos=\"35:1-35:67\">\n<td data-sourcepos=\"35:2-35:25\">dyno差額打ち消し</td>\n<td data-sourcepos=\"35:27-35:39\">-339,890.53</td>\n<td data-sourcepos=\"35:41-35:53\">-209,890.53</td>\n<td data-sourcepos=\"35:55-35:66\">-259890.53</td>\n</tr>\n<tr data-sourcepos=\"36:1-36:82\">\n<td data-sourcepos=\"36:2-36:33\">年間コスト効果(円/年)</td>\n<td data-sourcepos=\"36:35-36:49\">-4,078,686.36</td>\n<td data-sourcepos=\"36:51-36:65\">-2,518,686.36</td>\n<td data-sourcepos=\"36:67-36:81\">-3,118,686.36</td>\n</tr>\n</tbody>\n</table>\n<table data-sourcepos=\"38:1-46:82\">\n<thead>\n<tr data-sourcepos=\"38:1-38:107\">\n<th data-sourcepos=\"38:2-38:46\">Staging=3,000IOPSで月内20時間の場合</th>\n<th data-sourcepos=\"38:48-38:58\">旧構成</th>\n<th data-sourcepos=\"38:60-38:80\">現Private-M構成</th>\n<th data-sourcepos=\"38:82-38:106\">Private-Sにした場合</th>\n</tr>\n</thead>\n<tbody>\n<tr data-sourcepos=\"40:1-40:32\">\n<td data-sourcepos=\"40:2-40:17\">月消費units</td>\n<td data-sourcepos=\"40:19-40:21\">4</td>\n<td data-sourcepos=\"40:23-40:26\">30</td>\n<td data-sourcepos=\"40:28-40:31\">20</td>\n</tr>\n<tr data-sourcepos=\"41:1-41:52\">\n<td data-sourcepos=\"41:2-41:22\">日本円に直すと</td>\n<td data-sourcepos=\"41:24-41:31\">20,000</td>\n<td data-sourcepos=\"41:33-41:41\">150,000</td>\n<td data-sourcepos=\"41:43-41:51\">100,000</td>\n</tr>\n<tr data-sourcepos=\"42:1-42:37\">\n<td data-sourcepos=\"42:2-42:13\">dyno差額</td>\n<td data-sourcepos=\"42:15-42:17\">0</td>\n<td data-sourcepos=\"42:19-42:27\">130,000</td>\n<td data-sourcepos=\"42:29-42:36\">80,000</td>\n</tr>\n<tr data-sourcepos=\"43:1-43:163\">\n<td data-sourcepos=\"43:2-43:121\"><a href=\"https://qrio.esa.io/posts/1493#%E6%AF%94%E8%BC%83%E8%A1%A8\">DBコスト効果(ドル/月)prod1TBオーバー(stg低)</a></td>\n<td data-sourcepos=\"43:123-43:134\">-2,785.1566</td>\n<td data-sourcepos=\"43:136-43:148\">-2,785.1566</td>\n<td data-sourcepos=\"43:150-43:162\">-2,785.1566</td>\n</tr>\n<tr data-sourcepos=\"44:1-44:162\">\n<td data-sourcepos=\"44:2-44:118\"><a href=\"https://qrio.esa.io/posts/1493#%E6%AF%94%E8%BC%83%E8%A1%A8\">DBコスト効果(円/月)prod1TBオーバー(stg低)</a></td>\n<td data-sourcepos=\"44:120-44:132\">-370,345.06</td>\n<td data-sourcepos=\"44:134-44:146\">-370,345.06</td>\n<td data-sourcepos=\"44:148-44:160\">-370,345.06</td>\n</tr>\n<tr data-sourcepos=\"45:1-45:68\">\n<td data-sourcepos=\"45:2-45:25\">dyno差額打ち消し</td>\n<td data-sourcepos=\"45:27-45:39\">-370,345.06</td>\n<td data-sourcepos=\"45:41-45:53\">-240,345.06</td>\n<td data-sourcepos=\"45:55-45:67\">-290,345.06</td>\n</tr>\n<tr data-sourcepos=\"46:1-46:82\">\n<td data-sourcepos=\"46:2-46:33\">年間コスト効果(円/年)</td>\n<td data-sourcepos=\"46:35-46:49\">-4,444,140.72</td>\n<td data-sourcepos=\"46:51-46:65\">-2,884,140.72</td>\n<td data-sourcepos=\"46:67-46:81\">-3,484,140.72</td>\n</tr>\n</tbody>\n</table>\n<p data-sourcepos=\"49:1-50:55\"><strong>dyno unitsが契約数からはみ出たら上記dyno差額が発生する</strong><br>\n→ただ、現状利用分は両チーム合計で224</p>\n<p data-sourcepos=\"52:1-52:48\">上限は260なので、はみ出なさそう？</p>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/03/17/136273/9b9dbf5c-910d-4322-aabc-248fe0d63c07.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"1432\" alt=\"スクリーンショット 2023-01-10 12.48.09.png (133.0 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/03/17/136273/9b9dbf5c-910d-4322-aabc-248fe0d63c07.png\"></a>\n<p data-sourcepos=\"56:1-56:88\">→→<strong>だが来期契約の見積もりに現在の使用数が影響する？？？</strong></p>\n<h2 data-sourcepos=\"58:1-58:24\" id=\"0-4-0\" name=\"0-4-0\"><a class=\"anchor\" id=\"プラン下げ施策\" name=\"プラン下げ施策\" href=\"#プラン下げ施策\" data-position=\"0-4-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"プラン下げ施策\"> &gt; プラン下げ施策</span></a>プラン下げ施策</h2>\n<details>\n<summary>全アプリプラン一覧</summary>\n<div class=\"code-block\" data-sourcepos=\"64:1-375:3\"><div class=\"highlight\"><pre class=\"highlight plaintext\"><code>andfactory-api-document\nNo dynos on ⬢ andfactory-api-document\n-------------------------------------\ndotd-api-document\nNo dynos on ⬢ dotd-api-document\n-------------------------------------\nekey-generator\n=== web (Standard-1X): java -Dserver.port=$PORT $JAVA_OPTS -jar build/libs/*.jar (1)\nweb.1: up 2023/03/16 12:55:39 +0900 (~ 8h ago)\n\n-------------------------------------\nencored-japan-api-document\nNo dynos on ⬢ encored-japan-api-document\n-------------------------------------\nkddi-api-document\nNo dynos on ⬢ kddi-api-document\n-------------------------------------\nke-hi-production\n=== web (Standard-1X): bin/rails server -p $PORT -e $RAILS_ENV (4)\nweb.1: up 2023/03/16 15:02:56 +0900 (~ 6h ago)\nweb.2: up 2023/03/16 16:45:57 +0900 (~ 4h ago)\nweb.3: up 2023/03/16 14:43:16 +0900 (~ 6h ago)\nweb.4: up 2023/03/16 16:21:34 +0900 (~ 4h ago)\n\n=== worker (Standard-1X): bundle exec sidekiq -C config/sidekiq.yml (2)\nworker.1: up 2023/03/16 16:32:39 +0900 (~ 4h ago)\nworker.2: up 2023/03/16 14:07:34 +0900 (~ 7h ago)\n\n-------------------------------------\nke-hi-staging\n=== web (Standard-1X): bin/proximo rails server -p $PORT -e $RAILS_ENV (1)\nweb.1: up 2023/03/16 06:11:18 +0900 (~ 15h ago)\n\n=== worker (Standard-1X): bin/proximo bundle exec sidekiq -C config/sidekiq.yml (1)\nworker.1: up 2023/03/16 06:11:15 +0900 (~ 15h ago)\n\n-------------------------------------\nkehi-ope\nNo dynos on ⬢ kehi-ope\n-------------------------------------\nking-btob-api-document\nNo dynos on ⬢ king-btob-api-document\n-------------------------------------\nmaster-data-production\nNo dynos on ⬢ master-data-production\n-------------------------------------\nmaster-data-staging\n=== web (Standard-2X): bin/rails server -p ${PORT:-5000} -e $RAILS_ENV (1)\nweb.1: up 2023/03/16 16:10:56 +0900 (~ 5h ago)\n\n-------------------------------------\nnature-api-document\n=== web (Standard-1X): node index.js (1)\nweb.1: up 2023/03/16 08:34:28 +0900 (~ 12h ago)\n\n-------------------------------------\nplanis-api-document\nNo dynos on ⬢ planis-api-document\n-------------------------------------\nqb-api-production\n=== web (Performance-M): bin/rails server -p ${PORT:-5000} -e $RAILS_ENV (2)\nweb.1: up 2023/03/16 02:12:04 +0900 (~ 19h ago)\nweb.2: up 2023/03/16 02:21:21 +0900 (~ 18h ago)\n\n-------------------------------------\nqb-api-staging\n=== web (Standard-1X): bin/rails server -p ${PORT:-5000} -e $RAILS_ENV (1)\nweb.1: up 2023/03/16 09:51:55 +0900 (~ 11h ago)\n\n-------------------------------------\nqb-auth-production\n=== web (Standard-1X): bin/rails server -p $PORT -e $RAILS_ENV (2)\nweb.1: up 2023/03/16 05:33:57 +0900 (~ 15h ago)\nweb.2: up 2023/03/16 06:55:35 +0900 (~ 14h ago)\n\n=== worker (Standard-1X): bundle exec sidekiq -C config/sidekiq.yml (1)\nworker.1: up 2023/03/16 07:55:00 +0900 (~ 13h ago)\n\n-------------------------------------\nqb-auth-staging\n=== web (Standard-1X): bin/rails server -p $PORT -e $RAILS_ENV (1)\nweb.1: up 2023/03/16 09:51:54 +0900 (~ 11h ago)\n\n=== worker (Standard-1X): bundle exec sidekiq -C config/sidekiq.yml (1)\nworker.1: up 2023/03/16 09:51:51 +0900 (~ 11h ago)\n\n-------------------------------------\nqriolock-document\nNo dynos on ⬢ qriolock-document\n-------------------------------------\nsecual-api-document\nNo dynos on ⬢ secual-api-document\n-------------------------------------\nsimely-production\n=== web (Standard-1X): bin/rails server -p ${PORT:-5000} -e $RAILS_ENV (1)\nweb.1: up 2023/03/16 15:14:28 +0900 (~ 6h ago)\n\n-------------------------------------\nsimely-staging\nNo dynos on ⬢ simely-staging\n-------------------------------------\nsmartlock-api-production\n=== web (Performance-M): ./docker-entrypoint.sh (2)\nweb.1: up 2023/03/16 12:26:06 +0900 (~ 8h ago)\nweb.2: up 2023/03/15 21:55:08 +0900 (~ 23h ago)\n\n-------------------------------------\nsmartlock-api-staging\n=== web (Standard-1X): ./docker-entrypoint.sh (1)\nweb.1: up 2023/03/16 13:09:36 +0900 (~ 8h ago)\n\n-------------------------------------\nsmartlock-ekey-production\n=== web (Standard-1X): bin/rails server -p $PORT -e $RAILS_ENV (3)\nweb.1: up 2023/03/16 05:05:31 +0900 (~ 16h ago)\nweb.2: up 2023/03/16 05:05:30 +0900 (~ 16h ago)\nweb.3: up 2023/03/16 05:05:29 +0900 (~ 16h ago)\n\n-------------------------------------\nsmartlock-ekey-staging\nNo dynos on ⬢ smartlock-ekey-staging\n-------------------------------------\nsmarttag-server-production\n=== web (Standard-1X): newrelic-admin run-program python app.py (2)\nweb.1: up 2023/03/16 12:24:10 +0900 (~ 8h ago)\nweb.2: up 2023/03/16 15:34:40 +0900 (~ 5h ago)\n\n-------------------------------------\nsmarttag-server-staging\nNo dynos on ⬢ smarttag-server-staging\n-------------------------------------\nsomc-api-document\n=== web (Standard-1X): node index.js (1)\nweb.1: up 2023/03/16 14:23:19 +0900 (~ 6h ago)\n\n-------------------------------------\nstaging-king-api-document\nNo dynos on ⬢ staging-king-api-document\n-------------------------------------\nsupenavi-api-document\nNo dynos on ⬢ supenavi-api-document\n-------------------------------------\ncastle-api-production\n=== web (Private-S): yarn start (2)\nweb.1: up 2023/03/16 03:15:24 +0900 (~ 18h ago)\nweb.2: up 2023/03/16 00:45:46 +0900 (~ 20h ago)\n\n-------------------------------------\ncastle-api-staging\n=== web (Standard-2X): yarn start (1)\nweb.1: up 2023/03/16 14:35:30 +0900 (~ 6h ago)\n\n-------------------------------------\ncastle-console-production\n=== web (Private-S): yarn start (2)\nweb.1: up 2023/03/16 04:32:57 +0900 (~ 16h ago)\nweb.2: up 2023/03/15 23:53:43 +0900 (~ 21h ago)\n\n-------------------------------------\ncastle-console-staging\n=== web (Standard-2X): yarn start (1)\nweb.1: up 2023/03/16 15:04:26 +0900 (~ 6h ago)\n\n-------------------------------------\ncastle-ope\n=== web (Private-S): npm start (1)\nweb.1: up 2023/03/16 02:46:34 +0900 (~ 18h ago)\n\n-------------------------------------\ncastle-ope-staging\nNo dynos on ⬢ castle-ope-staging\n-------------------------------------\ncustomer-support-api-prod\n=== web (Private-M): npm start (1)\nweb.1: up 2023/03/16 03:23:11 +0900 (~ 17h ago)\n\n-------------------------------------\ncustomer-support-api-staging\n=== web (Private-M): npm start (1)\nweb.1: up 2023/03/15 18:52:29 +0900\n\n-------------------------------------\nprod-king-ope\n=== web (Private-S): npm start (1)\nweb.1: up 2023/03/15 22:58:42 +0900 (~ 22h ago)\n\n-------------------------------------\nroomon-api-dev\n=== web (Private-M): npm start (1)\nweb.1: up 2023/03/15 20:18:54 +0900\n\n-------------------------------------\nroomon-api-dev-old\nNo dynos on ⬢ roomon-api-dev-old\n-------------------------------------\nroomon-api-production\n=== web (Private-M): npm start (2)\nweb.1: up 2023/03/16 01:39:25 +0900 (~ 19h ago)\nweb.2: up 2023/03/16 06:50:02 +0900 (~ 14h ago)\n\n-------------------------------------\nroomon-api-staging\n=== web (Private-M): npm start (1)\nweb.1: up 2023/03/16 18:37:39 +0900 (~ 2h ago)\n\n-------------------------------------\nroomon-api-sucre-dev\n=== web (Standard-1X): npm start (1)\nweb.1: up 2023/03/16 07:57:21 +0900 (~ 13h ago)\n\n-------------------------------------\nroomon-api-sucre-staging\n=== web (Standard-1X): npm start (1)\nweb.1: up 2023/03/16 18:33:25 +0900 (~ 2h ago)\n\n-------------------------------------\nsirius-api-production\n=== web (Private-S): bundle exec puma -C config/puma.rb (2)\nweb.1: up 2023/03/16 05:45:12 +0900 (~ 15h ago)\nweb.2: up 2023/03/16 07:34:54 +0900 (~ 13h ago)\n\n=== worker (Private-S): bundle exec sidekiq -C config/sidekiq.yml (1)\nworker.1: up 2023/03/16 07:37:00 +0900 (~ 13h ago)\n\n-------------------------------------\nsirius-api-staging\n=== web (Private-S): bundle exec puma -C config/puma.rb (1)\nweb.1: up 2023/03/16 12:35:08 +0900 (~ 8h ago)\n\n=== worker (Private-S): bundle exec sidekiq -C config/sidekiq.yml (1)\nworker.1: up 2023/03/16 12:35:15 +0900 (~ 8h ago)\n\n-------------------------------------\nsirius-api-stg-before-pri-spa\nNo dynos on ⬢ sirius-api-stg-before-pri-spa\n-------------------------------------\nsirius-api-v3-staging\n=== web (Standard-2X): bundle exec puma -C config/puma.rb (1)\nweb.1: up 2023/03/16 16:10:07 +0900 (~ 5h ago)\n\n=== worker (Standard-1X): bundle exec sidekiq -C config/sidekiq.yml (1)\nworker.1: up 2023/03/16 15:42:21 +0900 (~ 5h ago)\n\n-------------------------------------\nsirius-ep-console\nNo dynos on ⬢ sirius-ep-console\n-------------------------------------\nsirius-ep-console-staging\nNo dynos on ⬢ sirius-ep-console-staging\n-------------------------------------\nsl2-api-db-migration-test\n=== web (Private-M): bundle exec puma -C config/puma.rb (1)\nweb.1: up 2023/03/16 07:14:55 +0900 (~ 14h ago)\n\n=== worker (Private-M): bundle exec sidekiq -C config/sidekiq.yml (1)\nworker.1: up 2023/03/16 07:14:48 +0900 (~ 14h ago)\n\n-------------------------------------\nsl2-api-production\n=== web (Private-M): bundle exec puma -C config/puma.rb (4)\nweb.1: up 2023/03/16 01:42:08 +0900 (~ 19h ago)\nweb.2: up 2023/03/16 00:40:44 +0900 (~ 20h ago)\nweb.3: up 2023/03/16 00:48:49 +0900 (~ 20h ago)\nweb.4: up 2023/03/16 02:16:42 +0900 (~ 19h ago)\n\n=== worker (Private-S): bundle exec sidekiq -C config/sidekiq.yml (2)\nworker.1: up 2023/03/16 07:45:33 +0900 (~ 13h ago)\nworker.2: up 2023/03/15 21:23:57 +0900 (~ 23h ago)\n\n-------------------------------------\nsl2-api-sirius-staging\n=== web (Standard-1X): bundle exec puma -C config/puma.rb (1)\nweb.1: up 2023/03/16 08:27:50 +0900 (~ 12h ago)\n\n=== worker (Standard-1X): bundle exec sidekiq -C config/sidekiq.yml (1)\nworker.1: up 2023/03/16 13:53:27 +0900 (~ 7h ago)\n\n-------------------------------------\nsl2-api-staging\n=== web (Private-S): bundle exec puma -C config/puma.rb (1)\nweb.1: up 2023/03/16 19:32:23 +0900 (~ 1h ago)\n\n=== worker (Private-S): bundle exec sidekiq -C config/sidekiq.yml (1)\nworker.1: up 2023/03/16 19:32:17 +0900 (~ 1h ago)\n\n-------------------------------------\nsl2-api-staging-test\n=== web (Standard-2X): bundle exec puma -C config/puma.rb (1)\nweb.1: up 2023/03/16 13:58:26 +0900 (~ 7h ago)\n\n=== worker (Standard-1X): bundle exec sidekiq -C config/sidekiq.yml (1)\nworker.1: up 2023/03/16 12:21:18 +0900 (~ 9h ago)\n\n-------------------------------------\nsl2-api-sucre-staging\n=== web (Standard-2X): bundle exec puma -C config/puma.rb (1)\nweb.1: up 2023/03/16 07:19:11 +0900 (~ 14h ago)\n\n=== worker (Standard-1X): bundle exec sidekiq -C config/sidekiq.yml (1)\nworker.1: up 2023/03/16 07:53:21 +0900 (~ 13h ago)\n\n-------------------------------------\nstaging-king-ope\nNo dynos on ⬢ staging-king-ope\n-------------------------------------\ntest-api-1\nNo dynos on ⬢ test-api-1\n-------------------------------------\ntest-api-2\nNo dynos on ⬢ test-api-2\n</code></pre></div></div>\n</details>\n<p data-sourcepos=\"380:1-380:24\">Private-Sにできるか</p>\n<ul data-sourcepos=\"382:1-387:0\" class=\"task-list\">\n<li data-sourcepos=\"382:1-382:48\" class=\"task-list-item\"><input type=\"checkbox\" class=\"task-list-item-checkbox\" data-item-position=\"0\" checked=\"\">customer-support-api-staging (Private-M*1)</li>\n<li data-sourcepos=\"383:1-383:43\" class=\"task-list-item\"><input type=\"checkbox\" class=\"task-list-item-checkbox\" data-item-position=\"1\" checked=\"\">roomon-api-dev (Private-M*1)検討中</li>\n<li data-sourcepos=\"384:1-384:62\" class=\"task-list-item\"><input type=\"checkbox\" class=\"task-list-item-checkbox\" data-item-position=\"2\">付随して、roomon-api-staging (Private-M*1)検討中</li>\n<li data-sourcepos=\"385:1-387:0\" class=\"task-list-item\"><input type=\"checkbox\" class=\"task-list-item-checkbox\" data-item-position=\"3\" checked=\"\">sl2-api-db-migration-test (Private-M*2)\n<ul data-sourcepos=\"386:5-387:0\">\n<li data-sourcepos=\"386:5-387:0\">本番検証が控えているため上記プランを継続、利用後削除か</li>\n</ul></li>\n</ul>\n<p data-sourcepos=\"388:1-388:69\">上3つをPrivate-Sにすることで15dyno units/月 節約できる</p>\n<h2 data-sourcepos=\"391:1-391:42\" id=\"0-5-0\" name=\"0-5-0\"><a class=\"anchor\" id=\"コスト影響を踏まえての判断\" name=\"コスト影響を踏まえての判断\" href=\"#コスト影響を踏まえての判断\" data-position=\"0-5-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"コスト影響を踏まえての判断\"> &gt; コスト影響を踏まえての判断</span></a>コスト影響を踏まえての判断</h2>\n<p data-sourcepos=\"393:1-394:239\">各staging dynoをprivateにうつさない場合は、AuroraKingDBのセキュリティが低下(移行前と同水準に戻る)する<br>\n＝roomon-apiとsirius-apiのStagingをPrivate Dynoで構成することで、セキュリティを向上した上でHerokuPostgres分の料金が削減できる状態に未だあると判断できるが、大幅なコスト効果の低下</p>\n<p data-sourcepos=\"396:1-396:224\">また、今後Heroku DynoではなくAWSへのサーバー移管も計画していることからdyno unitsの消費増加は1〜2年の限定的的なものとみれるが、AWSでのサーバー運用コスト評価次第</p>\n<h2 data-sourcepos=\"398:1-398:9\" id=\"0-6-0\" name=\"0-6-0\"><a class=\"anchor\" id=\"反省\" name=\"反省\" href=\"#反省\" data-position=\"0-6-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"反省\"> &gt; 反省</span></a>反省</h2>\n<p data-sourcepos=\"400:1-400:118\">private spaceに移動するとコストが上がるところを見落としていたことを反省しています。</p>\n",
    "created_at": "2023-03-16T16:42:57+09:00",
    "message": "Update post.",
    "kind": "stock",
    "comments_count": 0,
    "tasks_count": 4,
    "done_tasks_count": 3,
    "url": "https://qrio.esa.io/posts/1563",
    "updated_at": "2023-07-18T10:47:19+09:00",
    "tags": [],
    "category": "Users/杉山/Database",
    "revision_number": 17,
    "created_by": {
      "myself": false,
      "name": "杉山聡",
      "screen_name": "satoshi_sugiyama",
      "icon": "https://img.esa.io/uploads/production/members/129432/icon/thumb_m_4589e2842b9d87757c7c9db07c45c00d.jpg"
    },
    "updated_by": {
      "myself": false,
      "name": "杉山聡",
      "screen_name": "satoshi_sugiyama",
      "icon": "https://img.esa.io/uploads/production/members/129432/icon/thumb_m_4589e2842b9d87757c7c9db07c45c00d.jpg"
    },
    "stargazers_count": 0,
    "watchers_count": 1,
    "star": false,
    "watch": false,
    "sharing_urls": null
  },
  {
    "number": 1603,
    "name": "bucardoの動作再確認(プールの検出範囲)",
    "full_name": "Users/杉山/Database/bucardoの動作再確認(プールの検出範囲)",
    "wip": false,
    "body_md": "## dockerで検証\r\n\r\nhttps://github.com/qrioinc/migrate-db\r\n\r\nherokuモック:source-dbコンテナ\r\nawsモック:target-dbコンテナ\r\nbucardo EC2モック:migrate-db-bucardo-db-1コンテナ\r\n\r\n## 検証すべきは\r\n\r\n`bucardo add sync`より前の変更はプールするのかどうか\r\n\r\n## source-db 初期データ\r\n```sql\r\npostgres=# select relname,n_live_tup from pg_stat_user_tables order by relname asc;\r\n            relname             | n_live_tup\r\n--------------------------------+------------\r\n active_storage_attachments     |          0\r\n active_storage_blobs           |          0\r\n active_storage_variant_records |          0\r\n ar_internal_metadata           |          1\r\n autolock_schedules             |          0\r\n cards                          |          0\r\n command_logs                   |      52428\r\n dailies                        |         10\r\n display_logs                   |       1090\r\n door_mode_changed_histories    |        136\r\n durations                      |         12\r\n entrance_block_fob_keys        |          0\r\n entrance_block_knight_cards    |          0\r\n entrance_fob_keys              |          1\r\n entrance_invitations           |         12\r\n entrance_knight_keys           |          6\r\n entrance_knight_pins           |          3\r\n entrance_lock_settings         |          6\r\n entrance_locks                 |        408\r\n entrance_master_keys           |          6\r\n entrance_resident_guest_keys   |          1\r\n entrance_resident_keys         |          3\r\n family_keys                    |          4\r\n fob_keys                       |         10\r\n fobs                           |      95210\r\n guest_keys                     |          6\r\n hubs                           |      60216\r\n invitations                    |         13\r\n json_web_keys                  |          2\r\n knight_cards                   |         18\r\n knight_commands                |     310300\r\n knight_keys                    |        123\r\n knight_logs                    |        124\r\n knight_pins                    |         33\r\n knights                        |        754\r\n laresia_pins                   |          0\r\n lock_settings                  |        178\r\n lock_webhook_tokens            |         41\r\n locks                          |       1092\r\n logs                           |      23890\r\n managers                       |        117\r\n master_keys                    |        181\r\n mst_display_logs               |         80\r\n relationships                  |          1\r\n resident_guest_keys            |          1\r\n resident_keys                  |          5\r\n schema_migrations              |        103\r\n term_of_validities             |         22\r\n users                          |        993\r\n webhook_tokens                 |         24\r\n webhooks                       |          9\r\n weeklies                       |         10\r\n wena_keys                      |          1\r\n wenas                          |        259\r\n(54 rows)\r\n```\r\n\r\n## schema投入後の target-db\r\n```sql\r\npostgres=# select relname,n_live_tup from pg_stat_user_tables order by relname asc;\r\n            relname             | n_live_tup\r\n--------------------------------+------------\r\n active_storage_attachments     |          0\r\n active_storage_blobs           |          0\r\n active_storage_variant_records |          0\r\n ar_internal_metadata           |          0\r\n autolock_schedules             |          0\r\n cards                          |          0\r\n command_logs                   |          0\r\n dailies                        |          0\r\n display_logs                   |          0\r\n door_mode_changed_histories    |          0\r\n durations                      |          0\r\n entrance_block_fob_keys        |          0\r\n entrance_block_knight_cards    |          0\r\n entrance_fob_keys              |          0\r\n entrance_invitations           |          0\r\n entrance_knight_keys           |          0\r\n entrance_knight_pins           |          0\r\n entrance_lock_settings         |          0\r\n entrance_locks                 |          0\r\n entrance_master_keys           |          0\r\n entrance_resident_guest_keys   |          0\r\n entrance_resident_keys         |          0\r\n family_keys                    |          0\r\n fob_keys                       |          0\r\n fobs                           |          0\r\n guest_keys                     |          0\r\n hubs                           |          0\r\n invitations                    |          0\r\n json_web_keys                  |          0\r\n knight_cards                   |          0\r\n knight_commands                |          0\r\n knight_keys                    |          0\r\n knight_logs                    |          0\r\n knight_pins                    |          0\r\n knights                        |          0\r\n laresia_pins                   |          0\r\n lock_settings                  |          0\r\n lock_webhook_tokens            |          0\r\n locks                          |          0\r\n logs                           |          0\r\n managers                       |          0\r\n master_keys                    |          0\r\n mst_display_logs               |          0\r\n relationships                  |          0\r\n resident_guest_keys            |          0\r\n resident_keys                  |          0\r\n schema_migrations              |          0\r\n term_of_validities             |          0\r\n users                          |          0\r\n webhook_tokens                 |          0\r\n webhooks                       |          0\r\n weeklies                       |          0\r\n wena_keys                      |          0\r\n wenas                          |          0\r\n(54 rows)\r\n```\r\n\r\nここからはlogsテーブルに焦点を置き操作を行う。\r\n\r\n## data_restore後 target-db \r\n\r\n```sql\r\nselect count(*) from logs;\r\n count\r\n-------\r\n 23890\r\n(1 row)\r\n```\r\n\r\nここからbucardoのsync設定が入っていない状態でsource-dbのlogsを全て削除(23890)\r\n\r\n```sql\r\npostgres=# delete from logs;\r\nDELETE 23890\r\npostgres=# select count(*) from logs;\r\n count\r\n-------\r\n     0\r\n(1 row)\r\n```\r\n\r\n→bucardoの**syncを追加**して**bucardo start**\r\n\r\nここからプールをするというのが既知の情報\r\n\r\n\r\n```sh\r\nbucardo add sync sync_heroku_aws relgroup=herd_heroku_db db=heroku_db,aws_db\r\nAdded sync \"sync_heroku_aws\"\r\nUsing existing dbgroup \"dbs\"\r\n\r\nbucardo start\r\nbucardo status sync_heroku_aws\r\n======================================================================\r\nLast good                : Apr 11, 2023 07:05:16 (time to run: 1s)\r\nRows deleted/inserted    : 0 / 0\r\nSync name                : sync_heroku_aws\r\nCurrent state            : Good\r\nSource relgroup/database : herd_heroku_db / heroku_db\r\nTables in sync           : 2\r\nStatus                   : Active\r\nCheck time               : None\r\nOverdue time             : 00:00:00\r\nExpired time             : 00:00:00\r\nStayalive/Kidsalive      : Yes / Yes\r\nRebuild index            : No\r\nAutokick                 : Yes\r\nOnetimecopy              : No\r\nPost-copy analyze        : Yes\r\nLast error:              :\r\n======================================================================\r\n```\r\n\r\n→→source-dbにinsert1行\r\n\r\n```sql\r\ninsert into logs (lock_id,lock_log_id,log_type,param1,param2,param3,logged_at,double_lock,on_upside,created_at,updated_at) VALUES ('b644378d-b2fa-868d-8f47-cd47e698175e',7777,1,0,13,17,'2023-04-11 13:36:01',false,true,NOW(),NOW());\r\nINSERT 0 1\r\n\r\npostgres=# select count(*) from logs;\r\n count\r\n-------\r\n     1\r\n(1 row)\r\n```\r\n\r\nここでsource-dbのcount(*) from logsが(1)となればその通りだが、\r\ntarget-dbにはsyncを追加する前のdeleteが反映されているのか確認\r\n\r\n```sh\r\nbucardo status sync_heroku_aws\r\n======================================================================\r\nLast good                : Apr 11, 2023 07:10:05 (time to run: 1s)\r\nRows deleted/inserted    : 1 / 1\r\nSync name                : sync_heroku_aws\r\nCurrent state            : Good\r\nSource relgroup/database : herd_heroku_db / heroku_db\r\nTables in sync           : 2\r\nStatus                   : Active\r\nCheck time               : None\r\nOverdue time             : 00:00:00\r\nExpired time             : 00:00:00\r\nStayalive/Kidsalive      : Yes / Yes\r\nRebuild index            : No\r\nAutokick                 : Yes\r\nOnetimecopy              : No\r\nPost-copy analyze        : Yes\r\nLast error:              :\r\n======================================================================\r\n```\r\n\r\n```sql\r\n\r\nselect count(*) from logs;\r\n-[ RECORD 1 ]\r\ncount | 23891\r\n\r\nselect * from logs order by created_at desc limit 1;\r\n-[ RECORD 1 ]---+-------------------------------------\r\nid              | 5547fae3-2967-42b4-8427-45f2611acbbd\r\nlock_id         | b644378d-b2fa-868d-8f47-cd47e698175e\r\nlock_log_id     | 7777\r\nlog_type        | 1\r\nparam1          | 0\r\nparam2          | 13\r\nparam3          | 17\r\nlogged_at       | 2023-04-11 13:36:01\r\nrecordable_type |\r\nrecordable_id   |\r\ndouble_lock     | f\r\non_upside       | t\r\nuser_name       |\r\ncreated_at      | 2023-04-11 07:36:18.986918\r\nupdated_at      | 2023-04-11 07:36:18.986918\r\n```\r\n\r\nadd syncする前の変更は検出されていないので、add sync後のプールのみ検知していることが改めてわかった\r\n",
    "body_html": "<h2 data-sourcepos=\"1:1-1:18\" id=\"0-1-0\" name=\"0-1-0\"><a class=\"anchor\" id=\"dockerで検証\" name=\"dockerで検証\" href=\"#dockerで検証\" data-position=\"0-1-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"dockerで検証\"> &gt; dockerで検証</span></a>dockerで検証</h2>\n<p data-sourcepos=\"3:1-3:37\"><a href=\"https://github.com/qrioinc/migrate-db\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/qrioinc/migrate-db</a></p>\n<p data-sourcepos=\"5:1-7:56\">herokuモック:source-dbコンテナ<br>\nawsモック:target-dbコンテナ<br>\nbucardo EC2モック:migrate-db-bucardo-db-1コンテナ</p>\n<h2 data-sourcepos=\"9:1-9:21\" id=\"0-2-0\" name=\"0-2-0\"><a class=\"anchor\" id=\"検証すべきは\" name=\"検証すべきは\" href=\"#検証すべきは\" data-position=\"0-2-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"検証すべきは\"> &gt; 検証すべきは</span></a>検証すべきは</h2>\n<p data-sourcepos=\"11:1-11:69\"><code>bucardo add sync</code>より前の変更はプールするのかどうか</p>\n<h2 data-sourcepos=\"13:1-13:28\" id=\"0-3-0\" name=\"0-3-0\"><a class=\"anchor\" id=\"source-db 初期データ\" name=\"source-db 初期データ\" href=\"#source-db 初期データ\" data-position=\"0-3-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"source-db 初期データ\"> &gt; source-db 初期データ</span></a>source-db 初期データ</h2>\n<div class=\"code-block\" data-sourcepos=\"14:1-73:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sql</div><div class=\"highlight\"><pre class=\"highlight sql\"><code><span class=\"n\">postgres</span><span class=\"o\">=#</span> <span class=\"k\">select</span> <span class=\"n\">relname</span><span class=\"p\">,</span><span class=\"n\">n_live_tup</span> <span class=\"k\">from</span> <span class=\"n\">pg_stat_user_tables</span> <span class=\"k\">order</span> <span class=\"k\">by</span> <span class=\"n\">relname</span> <span class=\"k\">asc</span><span class=\"p\">;</span>\n            <span class=\"n\">relname</span>             <span class=\"o\">|</span> <span class=\"n\">n_live_tup</span>\n<span class=\"c1\">--------------------------------+------------</span>\n <span class=\"n\">active_storage_attachments</span>     <span class=\"o\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">active_storage_blobs</span>           <span class=\"o\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">active_storage_variant_records</span> <span class=\"o\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">ar_internal_metadata</span>           <span class=\"o\">|</span>          <span class=\"mi\">1</span>\n <span class=\"n\">autolock_schedules</span>             <span class=\"o\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">cards</span>                          <span class=\"o\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">command_logs</span>                   <span class=\"o\">|</span>      <span class=\"mi\">52428</span>\n <span class=\"n\">dailies</span>                        <span class=\"o\">|</span>         <span class=\"mi\">10</span>\n <span class=\"n\">display_logs</span>                   <span class=\"o\">|</span>       <span class=\"mi\">1090</span>\n <span class=\"n\">door_mode_changed_histories</span>    <span class=\"o\">|</span>        <span class=\"mi\">136</span>\n <span class=\"n\">durations</span>                      <span class=\"o\">|</span>         <span class=\"mi\">12</span>\n <span class=\"n\">entrance_block_fob_keys</span>        <span class=\"o\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">entrance_block_knight_cards</span>    <span class=\"o\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">entrance_fob_keys</span>              <span class=\"o\">|</span>          <span class=\"mi\">1</span>\n <span class=\"n\">entrance_invitations</span>           <span class=\"o\">|</span>         <span class=\"mi\">12</span>\n <span class=\"n\">entrance_knight_keys</span>           <span class=\"o\">|</span>          <span class=\"mi\">6</span>\n <span class=\"n\">entrance_knight_pins</span>           <span class=\"o\">|</span>          <span class=\"mi\">3</span>\n <span class=\"n\">entrance_lock_settings</span>         <span class=\"o\">|</span>          <span class=\"mi\">6</span>\n <span class=\"n\">entrance_locks</span>                 <span class=\"o\">|</span>        <span class=\"mi\">408</span>\n <span class=\"n\">entrance_master_keys</span>           <span class=\"o\">|</span>          <span class=\"mi\">6</span>\n <span class=\"n\">entrance_resident_guest_keys</span>   <span class=\"o\">|</span>          <span class=\"mi\">1</span>\n <span class=\"n\">entrance_resident_keys</span>         <span class=\"o\">|</span>          <span class=\"mi\">3</span>\n <span class=\"n\">family_keys</span>                    <span class=\"o\">|</span>          <span class=\"mi\">4</span>\n <span class=\"n\">fob_keys</span>                       <span class=\"o\">|</span>         <span class=\"mi\">10</span>\n <span class=\"n\">fobs</span>                           <span class=\"o\">|</span>      <span class=\"mi\">95210</span>\n <span class=\"n\">guest_keys</span>                     <span class=\"o\">|</span>          <span class=\"mi\">6</span>\n <span class=\"n\">hubs</span>                           <span class=\"o\">|</span>      <span class=\"mi\">60216</span>\n <span class=\"n\">invitations</span>                    <span class=\"o\">|</span>         <span class=\"mi\">13</span>\n <span class=\"n\">json_web_keys</span>                  <span class=\"o\">|</span>          <span class=\"mi\">2</span>\n <span class=\"n\">knight_cards</span>                   <span class=\"o\">|</span>         <span class=\"mi\">18</span>\n <span class=\"n\">knight_commands</span>                <span class=\"o\">|</span>     <span class=\"mi\">310300</span>\n <span class=\"n\">knight_keys</span>                    <span class=\"o\">|</span>        <span class=\"mi\">123</span>\n <span class=\"n\">knight_logs</span>                    <span class=\"o\">|</span>        <span class=\"mi\">124</span>\n <span class=\"n\">knight_pins</span>                    <span class=\"o\">|</span>         <span class=\"mi\">33</span>\n <span class=\"n\">knights</span>                        <span class=\"o\">|</span>        <span class=\"mi\">754</span>\n <span class=\"n\">laresia_pins</span>                   <span class=\"o\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">lock_settings</span>                  <span class=\"o\">|</span>        <span class=\"mi\">178</span>\n <span class=\"n\">lock_webhook_tokens</span>            <span class=\"o\">|</span>         <span class=\"mi\">41</span>\n <span class=\"n\">locks</span>                          <span class=\"o\">|</span>       <span class=\"mi\">1092</span>\n <span class=\"n\">logs</span>                           <span class=\"o\">|</span>      <span class=\"mi\">23890</span>\n <span class=\"n\">managers</span>                       <span class=\"o\">|</span>        <span class=\"mi\">117</span>\n <span class=\"n\">master_keys</span>                    <span class=\"o\">|</span>        <span class=\"mi\">181</span>\n <span class=\"n\">mst_display_logs</span>               <span class=\"o\">|</span>         <span class=\"mi\">80</span>\n <span class=\"n\">relationships</span>                  <span class=\"o\">|</span>          <span class=\"mi\">1</span>\n <span class=\"n\">resident_guest_keys</span>            <span class=\"o\">|</span>          <span class=\"mi\">1</span>\n <span class=\"n\">resident_keys</span>                  <span class=\"o\">|</span>          <span class=\"mi\">5</span>\n <span class=\"n\">schema_migrations</span>              <span class=\"o\">|</span>        <span class=\"mi\">103</span>\n <span class=\"n\">term_of_validities</span>             <span class=\"o\">|</span>         <span class=\"mi\">22</span>\n <span class=\"n\">users</span>                          <span class=\"o\">|</span>        <span class=\"mi\">993</span>\n <span class=\"n\">webhook_tokens</span>                 <span class=\"o\">|</span>         <span class=\"mi\">24</span>\n <span class=\"n\">webhooks</span>                       <span class=\"o\">|</span>          <span class=\"mi\">9</span>\n <span class=\"n\">weeklies</span>                       <span class=\"o\">|</span>         <span class=\"mi\">10</span>\n <span class=\"n\">wena_keys</span>                      <span class=\"o\">|</span>          <span class=\"mi\">1</span>\n <span class=\"n\">wenas</span>                          <span class=\"o\">|</span>        <span class=\"mi\">259</span>\n<span class=\"p\">(</span><span class=\"mi\">54</span> <span class=\"k\">rows</span><span class=\"p\">)</span>\n</code></pre></div></div>\n<h2 data-sourcepos=\"75:1-75:31\" id=\"0-4-0\" name=\"0-4-0\"><a class=\"anchor\" id=\"schema投入後の target-db\" name=\"schema投入後の target-db\" href=\"#schema投入後の target-db\" data-position=\"0-4-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"schema投入後の target-db\"> &gt; schema投入後の target-db</span></a>schema投入後の target-db</h2>\n<div class=\"code-block\" data-sourcepos=\"76:1-135:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sql</div><div class=\"highlight\"><pre class=\"highlight sql\"><code><span class=\"n\">postgres</span><span class=\"o\">=#</span> <span class=\"k\">select</span> <span class=\"n\">relname</span><span class=\"p\">,</span><span class=\"n\">n_live_tup</span> <span class=\"k\">from</span> <span class=\"n\">pg_stat_user_tables</span> <span class=\"k\">order</span> <span class=\"k\">by</span> <span class=\"n\">relname</span> <span class=\"k\">asc</span><span class=\"p\">;</span>\n            <span class=\"n\">relname</span>             <span class=\"o\">|</span> <span class=\"n\">n_live_tup</span>\n<span class=\"c1\">--------------------------------+------------</span>\n <span class=\"n\">active_storage_attachments</span>     <span class=\"o\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">active_storage_blobs</span>           <span class=\"o\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">active_storage_variant_records</span> <span class=\"o\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">ar_internal_metadata</span>           <span class=\"o\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">autolock_schedules</span>             <span class=\"o\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">cards</span>                          <span class=\"o\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">command_logs</span>                   <span class=\"o\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">dailies</span>                        <span class=\"o\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">display_logs</span>                   <span class=\"o\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">door_mode_changed_histories</span>    <span class=\"o\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">durations</span>                      <span class=\"o\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">entrance_block_fob_keys</span>        <span class=\"o\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">entrance_block_knight_cards</span>    <span class=\"o\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">entrance_fob_keys</span>              <span class=\"o\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">entrance_invitations</span>           <span class=\"o\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">entrance_knight_keys</span>           <span class=\"o\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">entrance_knight_pins</span>           <span class=\"o\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">entrance_lock_settings</span>         <span class=\"o\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">entrance_locks</span>                 <span class=\"o\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">entrance_master_keys</span>           <span class=\"o\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">entrance_resident_guest_keys</span>   <span class=\"o\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">entrance_resident_keys</span>         <span class=\"o\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">family_keys</span>                    <span class=\"o\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">fob_keys</span>                       <span class=\"o\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">fobs</span>                           <span class=\"o\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">guest_keys</span>                     <span class=\"o\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">hubs</span>                           <span class=\"o\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">invitations</span>                    <span class=\"o\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">json_web_keys</span>                  <span class=\"o\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">knight_cards</span>                   <span class=\"o\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">knight_commands</span>                <span class=\"o\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">knight_keys</span>                    <span class=\"o\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">knight_logs</span>                    <span class=\"o\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">knight_pins</span>                    <span class=\"o\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">knights</span>                        <span class=\"o\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">laresia_pins</span>                   <span class=\"o\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">lock_settings</span>                  <span class=\"o\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">lock_webhook_tokens</span>            <span class=\"o\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">locks</span>                          <span class=\"o\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">logs</span>                           <span class=\"o\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">managers</span>                       <span class=\"o\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">master_keys</span>                    <span class=\"o\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">mst_display_logs</span>               <span class=\"o\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">relationships</span>                  <span class=\"o\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">resident_guest_keys</span>            <span class=\"o\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">resident_keys</span>                  <span class=\"o\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">schema_migrations</span>              <span class=\"o\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">term_of_validities</span>             <span class=\"o\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">users</span>                          <span class=\"o\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">webhook_tokens</span>                 <span class=\"o\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">webhooks</span>                       <span class=\"o\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">weeklies</span>                       <span class=\"o\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">wena_keys</span>                      <span class=\"o\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">wenas</span>                          <span class=\"o\">|</span>          <span class=\"mi\">0</span>\n<span class=\"p\">(</span><span class=\"mi\">54</span> <span class=\"k\">rows</span><span class=\"p\">)</span>\n</code></pre></div></div>\n<p data-sourcepos=\"137:1-137:67\">ここからはlogsテーブルに焦点を置き操作を行う。</p>\n<h2 data-sourcepos=\"139:1-139:28\" id=\"0-5-0\" name=\"0-5-0\"><a class=\"anchor\" id=\"data_restore後 target-db\" name=\"data_restore後 target-db\" href=\"#data_restore後 target-db\" data-position=\"0-5-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"data_restore後 target-db\"> &gt; data_restore後 target-db</span></a>data_restore後 target-db</h2>\n<div class=\"code-block\" data-sourcepos=\"141:1-147:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sql</div><div class=\"highlight\"><pre class=\"highlight sql\"><code><span class=\"k\">select</span> <span class=\"k\">count</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"p\">)</span> <span class=\"k\">from</span> <span class=\"n\">logs</span><span class=\"p\">;</span>\n <span class=\"k\">count</span>\n<span class=\"c1\">-------</span>\n <span class=\"mi\">23890</span>\n<span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"k\">row</span><span class=\"p\">)</span>\n</code></pre></div></div>\n<p data-sourcepos=\"149:1-149:100\">ここからbucardoのsync設定が入っていない状態でsource-dbのlogsを全て削除(23890)</p>\n<div class=\"code-block\" data-sourcepos=\"151:1-159:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sql</div><div class=\"highlight\"><pre class=\"highlight sql\"><code><span class=\"n\">postgres</span><span class=\"o\">=#</span> <span class=\"k\">delete</span> <span class=\"k\">from</span> <span class=\"n\">logs</span><span class=\"p\">;</span>\n<span class=\"k\">DELETE</span> <span class=\"mi\">23890</span>\n<span class=\"n\">postgres</span><span class=\"o\">=#</span> <span class=\"k\">select</span> <span class=\"k\">count</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"p\">)</span> <span class=\"k\">from</span> <span class=\"n\">logs</span><span class=\"p\">;</span>\n <span class=\"k\">count</span>\n<span class=\"c1\">-------</span>\n     <span class=\"mi\">0</span>\n<span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"k\">row</span><span class=\"p\">)</span>\n</code></pre></div></div>\n<p data-sourcepos=\"161:1-161:53\">→bucardoの<strong>syncを追加</strong>して<strong>bucardo start</strong></p>\n<p data-sourcepos=\"163:1-163:60\">ここからプールをするというのが既知の情報</p>\n<div class=\"code-block\" data-sourcepos=\"166:1-191:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>bucardo add <span class=\"nb\">sync </span>sync_heroku_aws <span class=\"nv\">relgroup</span><span class=\"o\">=</span>herd_heroku_db <span class=\"nv\">db</span><span class=\"o\">=</span>heroku_db,aws_db\nAdded <span class=\"nb\">sync</span> <span class=\"s2\">\"sync_heroku_aws\"</span>\nUsing existing dbgroup <span class=\"s2\">\"dbs\"</span>\n\nbucardo start\nbucardo status sync_heroku_aws\n<span class=\"o\">======================================================================</span>\nLast good                : Apr 11, 2023 07:05:16 <span class=\"o\">(</span><span class=\"nb\">time </span>to run: 1s<span class=\"o\">)</span>\nRows deleted/inserted    : 0 / 0\nSync name                : sync_heroku_aws\nCurrent state            : Good\nSource relgroup/database : herd_heroku_db / heroku_db\nTables <span class=\"k\">in </span><span class=\"nb\">sync</span>           : 2\nStatus                   : Active\nCheck <span class=\"nb\">time</span>               : None\nOverdue <span class=\"nb\">time</span>             : 00:00:00\nExpired <span class=\"nb\">time</span>             : 00:00:00\nStayalive/Kidsalive      : Yes / Yes\nRebuild index            : No\nAutokick                 : Yes\nOnetimecopy              : No\nPost-copy analyze        : Yes\nLast error:              :\n<span class=\"o\">======================================================================</span>\n</code></pre></div></div>\n<p data-sourcepos=\"193:1-193:28\">→→source-dbにinsert1行</p>\n<div class=\"code-block\" data-sourcepos=\"195:1-204:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sql</div><div class=\"highlight\"><pre class=\"highlight sql\"><code><span class=\"k\">insert</span> <span class=\"k\">into</span> <span class=\"n\">logs</span> <span class=\"p\">(</span><span class=\"n\">lock_id</span><span class=\"p\">,</span><span class=\"n\">lock_log_id</span><span class=\"p\">,</span><span class=\"n\">log_type</span><span class=\"p\">,</span><span class=\"n\">param1</span><span class=\"p\">,</span><span class=\"n\">param2</span><span class=\"p\">,</span><span class=\"n\">param3</span><span class=\"p\">,</span><span class=\"n\">logged_at</span><span class=\"p\">,</span><span class=\"n\">double_lock</span><span class=\"p\">,</span><span class=\"n\">on_upside</span><span class=\"p\">,</span><span class=\"n\">created_at</span><span class=\"p\">,</span><span class=\"n\">updated_at</span><span class=\"p\">)</span> <span class=\"k\">VALUES</span> <span class=\"p\">(</span><span class=\"s1\">'b644378d-b2fa-868d-8f47-cd47e698175e'</span><span class=\"p\">,</span><span class=\"mi\">7777</span><span class=\"p\">,</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"mi\">13</span><span class=\"p\">,</span><span class=\"mi\">17</span><span class=\"p\">,</span><span class=\"s1\">'2023-04-11 13:36:01'</span><span class=\"p\">,</span><span class=\"k\">false</span><span class=\"p\">,</span><span class=\"k\">true</span><span class=\"p\">,</span><span class=\"n\">NOW</span><span class=\"p\">(),</span><span class=\"n\">NOW</span><span class=\"p\">());</span>\n<span class=\"k\">INSERT</span> <span class=\"mi\">0</span> <span class=\"mi\">1</span>\n\n<span class=\"n\">postgres</span><span class=\"o\">=#</span> <span class=\"k\">select</span> <span class=\"k\">count</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"p\">)</span> <span class=\"k\">from</span> <span class=\"n\">logs</span><span class=\"p\">;</span>\n <span class=\"k\">count</span>\n<span class=\"c1\">-------</span>\n     <span class=\"mi\">1</span>\n<span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"k\">row</span><span class=\"p\">)</span>\n</code></pre></div></div>\n<p data-sourcepos=\"206:1-207:82\">ここでsource-dbのcount(*) from logsが(1)となればその通りだが、<br>\ntarget-dbにはsyncを追加する前のdeleteが反映されているのか確認</p>\n<div class=\"code-block\" data-sourcepos=\"209:1-229:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>bucardo status sync_heroku_aws\n<span class=\"o\">======================================================================</span>\nLast good                : Apr 11, 2023 07:10:05 <span class=\"o\">(</span><span class=\"nb\">time </span>to run: 1s<span class=\"o\">)</span>\nRows deleted/inserted    : 1 / 1\nSync name                : sync_heroku_aws\nCurrent state            : Good\nSource relgroup/database : herd_heroku_db / heroku_db\nTables <span class=\"k\">in </span><span class=\"nb\">sync</span>           : 2\nStatus                   : Active\nCheck <span class=\"nb\">time</span>               : None\nOverdue <span class=\"nb\">time</span>             : 00:00:00\nExpired <span class=\"nb\">time</span>             : 00:00:00\nStayalive/Kidsalive      : Yes / Yes\nRebuild index            : No\nAutokick                 : Yes\nOnetimecopy              : No\nPost-copy analyze        : Yes\nLast error:              :\n<span class=\"o\">======================================================================</span>\n</code></pre></div></div>\n<div class=\"code-block\" data-sourcepos=\"231:1-254:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sql</div><div class=\"highlight\"><pre class=\"highlight sql\"><code>\n<span class=\"k\">select</span> <span class=\"k\">count</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"p\">)</span> <span class=\"k\">from</span> <span class=\"n\">logs</span><span class=\"p\">;</span>\n<span class=\"o\">-</span><span class=\"p\">[</span> <span class=\"n\">RECORD</span> <span class=\"mi\">1</span> <span class=\"p\">]</span>\n<span class=\"k\">count</span> <span class=\"o\">|</span> <span class=\"mi\">23891</span>\n\n<span class=\"k\">select</span> <span class=\"o\">*</span> <span class=\"k\">from</span> <span class=\"n\">logs</span> <span class=\"k\">order</span> <span class=\"k\">by</span> <span class=\"n\">created_at</span> <span class=\"k\">desc</span> <span class=\"k\">limit</span> <span class=\"mi\">1</span><span class=\"p\">;</span>\n<span class=\"o\">-</span><span class=\"p\">[</span> <span class=\"n\">RECORD</span> <span class=\"mi\">1</span> <span class=\"p\">]</span><span class=\"c1\">---+-------------------------------------</span>\n<span class=\"n\">id</span>              <span class=\"o\">|</span> <span class=\"mi\">5547</span><span class=\"n\">fae3</span><span class=\"o\">-</span><span class=\"mi\">2967</span><span class=\"o\">-</span><span class=\"mi\">42</span><span class=\"n\">b4</span><span class=\"o\">-</span><span class=\"mi\">8427</span><span class=\"o\">-</span><span class=\"mi\">45</span><span class=\"n\">f2611acbbd</span>\n<span class=\"n\">lock_id</span>         <span class=\"o\">|</span> <span class=\"n\">b644378d</span><span class=\"o\">-</span><span class=\"n\">b2fa</span><span class=\"o\">-</span><span class=\"mi\">868</span><span class=\"n\">d</span><span class=\"o\">-</span><span class=\"mi\">8</span><span class=\"n\">f47</span><span class=\"o\">-</span><span class=\"n\">cd47e698175e</span>\n<span class=\"n\">lock_log_id</span>     <span class=\"o\">|</span> <span class=\"mi\">7777</span>\n<span class=\"n\">log_type</span>        <span class=\"o\">|</span> <span class=\"mi\">1</span>\n<span class=\"n\">param1</span>          <span class=\"o\">|</span> <span class=\"mi\">0</span>\n<span class=\"n\">param2</span>          <span class=\"o\">|</span> <span class=\"mi\">13</span>\n<span class=\"n\">param3</span>          <span class=\"o\">|</span> <span class=\"mi\">17</span>\n<span class=\"n\">logged_at</span>       <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">04</span><span class=\"o\">-</span><span class=\"mi\">11</span> <span class=\"mi\">13</span><span class=\"p\">:</span><span class=\"mi\">36</span><span class=\"p\">:</span><span class=\"mi\">01</span>\n<span class=\"n\">recordable_type</span> <span class=\"o\">|</span>\n<span class=\"n\">recordable_id</span>   <span class=\"o\">|</span>\n<span class=\"n\">double_lock</span>     <span class=\"o\">|</span> <span class=\"n\">f</span>\n<span class=\"n\">on_upside</span>       <span class=\"o\">|</span> <span class=\"n\">t</span>\n<span class=\"n\">user_name</span>       <span class=\"o\">|</span>\n<span class=\"n\">created_at</span>      <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">04</span><span class=\"o\">-</span><span class=\"mi\">11</span> <span class=\"mi\">07</span><span class=\"p\">:</span><span class=\"mi\">36</span><span class=\"p\">:</span><span class=\"mi\">18</span><span class=\"p\">.</span><span class=\"mi\">986918</span>\n<span class=\"n\">updated_at</span>      <span class=\"o\">|</span> <span class=\"mi\">2023</span><span class=\"o\">-</span><span class=\"mi\">04</span><span class=\"o\">-</span><span class=\"mi\">11</span> <span class=\"mi\">07</span><span class=\"p\">:</span><span class=\"mi\">36</span><span class=\"p\">:</span><span class=\"mi\">18</span><span class=\"p\">.</span><span class=\"mi\">986918</span>\n</code></pre></div></div>\n<p data-sourcepos=\"256:1-256:139\">add syncする前の変更は検出されていないので、add sync後のプールのみ検知していることが改めてわかった</p>\n",
    "created_at": "2023-04-11T16:41:28+09:00",
    "message": "Update post.",
    "kind": "stock",
    "comments_count": 0,
    "tasks_count": 0,
    "done_tasks_count": 0,
    "url": "https://qrio.esa.io/posts/1603",
    "updated_at": "2023-07-18T10:46:57+09:00",
    "tags": [],
    "category": "Users/杉山/Database",
    "revision_number": 3,
    "created_by": {
      "myself": false,
      "name": "杉山聡",
      "screen_name": "satoshi_sugiyama",
      "icon": "https://img.esa.io/uploads/production/members/129432/icon/thumb_m_4589e2842b9d87757c7c9db07c45c00d.jpg"
    },
    "updated_by": {
      "myself": false,
      "name": "杉山聡",
      "screen_name": "satoshi_sugiyama",
      "icon": "https://img.esa.io/uploads/production/members/129432/icon/thumb_m_4589e2842b9d87757c7c9db07c45c00d.jpg"
    },
    "stargazers_count": 0,
    "watchers_count": 1,
    "star": false,
    "watch": false,
    "sharing_urls": null
  },
  {
    "number": 1598,
    "name": "logsとdisplaylogsのrestore時間検証",
    "full_name": "Users/杉山/Database/logsとdisplaylogsのrestore時間検証",
    "wip": false,
    "body_md": "## 現状\r\n\r\n- 4/6 14:55(JST)時点でまだ終わらない、もうすぐ24時間\r\n\r\n## 原因\r\n\r\n- pg_restoreの並列化をしていない(—jobsオプション)=vCPUが8なのに1つしかCPUが利用されていない\r\n\r\nhttps://ap-northeast-1.console.aws.amazon.com/rds/home?region=ap-northeast-1#performance-insights-v20206:/resourceId/db-EB5SYBSC3DTQ625X7R5I7K37GA/resourceName/king-api-aurora-production-base-stac-auroraprimary-drxxfqmy9iip/startTime/1680674311515/endTime/1680760711515/presetKey/24h/presetAmount/24/presetUnit/hour\r\n<img width=\"861\" alt=\"スクリーンショット 2023-04-06 15.00.55.png (46.5 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/06/136273/ffac24e4-4020-47a0-98f7-362fb792cd38.png\">\r\n\r\n\r\n## 対策\r\n\r\n- pg_restoreコマンドに—jobs=8を追加する(試行する最初の値としてサーバのCPUコア数を勧めます。)\r\n上記対策を講じた上で再度sessionが切れない設定(iterm2)でssh接続→dockerコンテナからpg_restoreの実行をしたいです。\r\n\r\n## pg_restore --jobs\r\n\r\nhttps://www.postgresql.jp/document/14/html/app-pgrestore.html\r\n\r\n> pg_restoreのもっとも時間がかかる部分、つまり、データのロード、インデックスの作成、制約の作成部分を最大number-of-jobsの並行セッションを使用して実行します。 このオプションは、複数プロセッサマシンで稼働するサーバに大規模なデータベースをリストアする時間を劇的に減らすことができます。 \r\n\r\n## 再実施手順\r\n\r\n### ssh接続キープ\r\n\r\niterm2で設定を操作し、iterm2無操作時に60秒ごとに\"0\"を入力送信するようにする。\r\n`When idle, send ASCII code 0 every 60 seconds`\r\n<img width=\"978\" alt=\"スクリーンショット 2023-04-06 15.11.05.png (641.6 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/06/136273/6bf64f68-4b96-465b-af89-5917bbbc643f.png\">\r\n\r\n\r\n```sh\r\n# EC2に接続\r\n[local] ssh -i \"king-api-production-bucardo-ec2.pem\" \\\r\n    ubuntu@ec2-13-112-10-43.ap-northeast-1.compute.amazonaws.com\r\n    \r\n# Dockerコンテナに入る\r\n[EC2] sudo docker exec -it --user root 4cb10adfdfd4 sh\r\n\r\n# pg_restoreを止める\r\n[Docker] kill -9 2742\r\n\r\n# Auroraにpsql接続\r\n[Docker] psql -h king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com -U kingadmin -d kingapi -p 5432\r\n\r\n# logsとdisplay_logs再検証のためデータ削除\r\n[Docker] kingapi=> TRUNCATE logs, display_logs CASCADE;\r\n\r\n# logsrestore.shを以下の内容に変更する(--jobs=8が入っている)\r\n```\r\n```logsrestore.sh\r\n#!/bin/sh\r\n\r\ntouch restoretime_logs_displaylogs\r\n\r\necho \"restore start--------\" >restoretime_logs_displaylogs\r\ndate >> restoretime_logs_displaylogs\r\n\r\npg_restore --verbose --data-only -h king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com -p 5432 -d kingapi -U kingadmin --jobs=8 logs_displaylogs.dump\r\n\r\necho \"----------------------\" >>restoretime_logs_displaylogs\r\necho \"restore finish-----\" >>restoretime_logs_displaylogs\r\ndate >> restoretime_logs_displaylogs\r\n\r\n```\r\n再実行\r\n```sh\r\nbash logsrestore.sh\r\n```\r\n\r\n## TRUNCATE\r\n\r\nhttps://www.postgresql.jp/document/14/html/sql-truncate.html\r\n\r\n> TRUNCATEはテーブル群から全ての行を素早く削除します。 各テーブルに対して条件指定のないDELETEコマンドの実行と同じ効果を持ちますが、実際にテーブルを走査しない分、このコマンドの方が高速です。 さらに、その後にVACUUM操作を行うことなく、このコマンドはディスク領域を即座に回収します。 このコマンドは、大きなテーブルを対象とする場合に最も有用です。\r\n",
    "body_html": "<h2 data-sourcepos=\"1:1-1:9\" id=\"0-1-0\" name=\"0-1-0\"><a class=\"anchor\" id=\"現状\" name=\"現状\" href=\"#現状\" data-position=\"0-1-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"現状\"> &gt; 現状</span></a>現状</h2>\n<ul data-sourcepos=\"3:1-4:0\">\n<li data-sourcepos=\"3:1-4:0\">4/6 14:55(JST)時点でまだ終わらない、もうすぐ24時間</li>\n</ul>\n<h2 data-sourcepos=\"5:1-5:9\" id=\"0-2-0\" name=\"0-2-0\"><a class=\"anchor\" id=\"原因\" name=\"原因\" href=\"#原因\" data-position=\"0-2-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"原因\"> &gt; 原因</span></a>原因</h2>\n<ul data-sourcepos=\"7:1-8:0\">\n<li data-sourcepos=\"7:1-8:0\">pg_restoreの並列化をしていない(—jobsオプション)=vCPUが8なのに1つしかCPUが利用されていない</li>\n</ul>\n<p data-sourcepos=\"9:1-10:205\"><a href=\"https://ap-northeast-1.console.aws.amazon.com/rds/home?region=ap-northeast-1#performance-insights-v20206:/resourceId/db-EB5SYBSC3DTQ625X7R5I7K37GA/resourceName/king-api-aurora-production-base-stac-auroraprimary-drxxfqmy9iip/startTime/1680674311515/endTime/1680760711515/presetKey/24h/presetAmount/24/presetUnit/hour\" target=\"_blank\" rel=\"noopener noreferrer\">https://ap-northeast-1.console.aws.amazon.com/rds/home?region=ap-northeast-1#performance-insights-v20206:/resourceId/db-EB5SYBSC3DTQ625X7R5I7K37GA/resourceName/king-api-aurora-production-base-stac-auroraprimary-drxxfqmy9iip/startTime/1680674311515/endTime/1680760711515/presetKey/24h/presetAmount/24/presetUnit/hour</a><br>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/06/136273/ffac24e4-4020-47a0-98f7-362fb792cd38.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"861\" alt=\"スクリーンショット 2023-04-06 15.00.55.png (46.5 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/06/136273/ffac24e4-4020-47a0-98f7-362fb792cd38.png\"></a></p>\n<h2 data-sourcepos=\"13:1-13:9\" id=\"0-3-0\" name=\"0-3-0\"><a class=\"anchor\" id=\"対策\" name=\"対策\" href=\"#対策\" data-position=\"0-3-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"対策\"> &gt; 対策</span></a>対策</h2>\n<ul data-sourcepos=\"15:1-17:0\">\n<li data-sourcepos=\"15:1-17:0\">pg_restoreコマンドに—jobs=8を追加する(試行する最初の値としてサーバのCPUコア数を勧めます。)<br>\n上記対策を講じた上で再度sessionが切れない設定(iterm2)でssh接続→dockerコンテナからpg_restoreの実行をしたいです。</li>\n</ul>\n<h2 data-sourcepos=\"18:1-18:20\" id=\"0-4-0\" name=\"0-4-0\"><a class=\"anchor\" id=\"pg_restore --jobs\" name=\"pg_restore --jobs\" href=\"#pg_restore --jobs\" data-position=\"0-4-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"pg_restore --jobs\"> &gt; pg_restore --jobs</span></a>pg_restore --jobs</h2>\n<p data-sourcepos=\"20:1-20:61\"><a href=\"https://www.postgresql.jp/document/14/html/app-pgrestore.html\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.postgresql.jp/document/14/html/app-pgrestore.html</a></p>\n<blockquote data-sourcepos=\"22:1-22:409\">\n<p data-sourcepos=\"22:3-22:409\">pg_restoreのもっとも時間がかかる部分、つまり、データのロード、インデックスの作成、制約の作成部分を最大number-of-jobsの並行セッションを使用して実行します。 このオプションは、複数プロセッサマシンで稼働するサーバに大規模なデータベースをリストアする時間を劇的に減らすことができます。</p>\n</blockquote>\n<h2 data-sourcepos=\"24:1-24:18\" id=\"0-5-0\" name=\"0-5-0\"><a class=\"anchor\" id=\"再実施手順\" name=\"再実施手順\" href=\"#再実施手順\" data-position=\"0-5-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"再実施手順\"> &gt; 再実施手順</span></a>再実施手順</h2>\n<h3 data-sourcepos=\"26:1-26:22\" id=\"0-5-1\" name=\"0-5-1\"><a class=\"anchor\" id=\"ssh接続キープ\" name=\"ssh接続キープ\" href=\"#ssh接続キープ\" data-position=\"0-5-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"ssh接続キープ\"> &gt; ssh接続キープ</span></a>ssh接続キープ</h3>\n<p data-sourcepos=\"28:1-30:206\">iterm2で設定を操作し、iterm2無操作時に60秒ごとに\"0\"を入力送信するようにする。<br>\n<code>When idle, send ASCII code 0 every 60 seconds</code><br>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/06/136273/6bf64f68-4b96-465b-af89-5917bbbc643f.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"978\" alt=\"スクリーンショット 2023-04-06 15.11.05.png (641.6 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/04/06/136273/6bf64f68-4b96-465b-af89-5917bbbc643f.png\"></a></p>\n<div class=\"code-block\" data-sourcepos=\"33:1-51:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code><span class=\"c\"># EC2に接続</span>\n<span class=\"o\">[</span><span class=\"nb\">local</span><span class=\"o\">]</span> ssh <span class=\"nt\">-i</span> <span class=\"s2\">\"king-api-production-bucardo-ec2.pem\"</span> <span class=\"se\">\\</span>\n    ubuntu@ec2-13-112-10-43.ap-northeast-1.compute.amazonaws.com\n    \n<span class=\"c\"># Dockerコンテナに入る</span>\n<span class=\"o\">[</span>EC2] <span class=\"nb\">sudo </span>docker <span class=\"nb\">exec</span> <span class=\"nt\">-it</span> <span class=\"nt\">--user</span> root 4cb10adfdfd4 sh\n\n<span class=\"c\"># pg_restoreを止める</span>\n<span class=\"o\">[</span>Docker] <span class=\"nb\">kill</span> <span class=\"nt\">-9</span> 2742\n\n<span class=\"c\"># Auroraにpsql接続</span>\n<span class=\"o\">[</span>Docker] psql <span class=\"nt\">-h</span> king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com <span class=\"nt\">-U</span> kingadmin <span class=\"nt\">-d</span> kingapi <span class=\"nt\">-p</span> 5432\n\n<span class=\"c\"># logsとdisplay_logs再検証のためデータ削除</span>\n<span class=\"o\">[</span>Docker] <span class=\"nv\">kingapi</span><span class=\"o\">=&gt;</span> TRUNCATE logs, display_logs CASCADE<span class=\"p\">;</span>\n\n<span class=\"c\"># logsrestore.shを以下の内容に変更する(--jobs=8が入っている)</span>\n</code></pre></div></div>\n<div class=\"code-block\" data-sourcepos=\"52:1-66:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>logsrestore.sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code><span class=\"c\">#!/bin/sh</span>\n\n<span class=\"nb\">touch </span>restoretime_logs_displaylogs\n\n<span class=\"nb\">echo</span> <span class=\"s2\">\"restore start--------\"</span> <span class=\"o\">&gt;</span>restoretime_logs_displaylogs\n<span class=\"nb\">date</span> <span class=\"o\">&gt;&gt;</span> restoretime_logs_displaylogs\n\npg_restore <span class=\"nt\">--verbose</span> <span class=\"nt\">--data-only</span> <span class=\"nt\">-h</span> king-api-production.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com <span class=\"nt\">-p</span> 5432 <span class=\"nt\">-d</span> kingapi <span class=\"nt\">-U</span> kingadmin <span class=\"nt\">--jobs</span><span class=\"o\">=</span>8 logs_displaylogs.dump\n\n<span class=\"nb\">echo</span> <span class=\"s2\">\"----------------------\"</span> <span class=\"o\">&gt;&gt;</span>restoretime_logs_displaylogs\n<span class=\"nb\">echo</span> <span class=\"s2\">\"restore finish-----\"</span> <span class=\"o\">&gt;&gt;</span>restoretime_logs_displaylogs\n<span class=\"nb\">date</span> <span class=\"o\">&gt;&gt;</span> restoretime_logs_displaylogs\n</code></pre></div></div>\n<p data-sourcepos=\"67:1-67:9\">再実行</p>\n<div class=\"code-block\" data-sourcepos=\"68:1-70:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>bash logsrestore.sh\n</code></pre></div></div>\n<h2 data-sourcepos=\"72:1-72:11\" id=\"0-6-0\" name=\"0-6-0\"><a class=\"anchor\" id=\"TRUNCATE\" name=\"TRUNCATE\" href=\"#TRUNCATE\" data-position=\"0-6-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"TRUNCATE\"> &gt; TRUNCATE</span></a>TRUNCATE</h2>\n<p data-sourcepos=\"74:1-74:60\"><a href=\"https://www.postgresql.jp/document/14/html/sql-truncate.html\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.postgresql.jp/document/14/html/sql-truncate.html</a></p>\n<blockquote data-sourcepos=\"76:1-76:499\">\n<p data-sourcepos=\"76:3-76:499\">TRUNCATEはテーブル群から全ての行を素早く削除します。 各テーブルに対して条件指定のないDELETEコマンドの実行と同じ効果を持ちますが、実際にテーブルを走査しない分、このコマンドの方が高速です。 さらに、その後にVACUUM操作を行うことなく、このコマンドはディスク領域を即座に回収します。 このコマンドは、大きなテーブルを対象とする場合に最も有用です。</p>\n</blockquote>\n",
    "created_at": "2023-04-06T15:02:07+09:00",
    "message": "Update post.",
    "kind": "stock",
    "comments_count": 10,
    "tasks_count": 0,
    "done_tasks_count": 0,
    "url": "https://qrio.esa.io/posts/1598",
    "updated_at": "2023-07-18T10:46:31+09:00",
    "tags": [],
    "category": "Users/杉山/Database",
    "revision_number": 3,
    "created_by": {
      "myself": false,
      "name": "杉山聡",
      "screen_name": "satoshi_sugiyama",
      "icon": "https://img.esa.io/uploads/production/members/129432/icon/thumb_m_4589e2842b9d87757c7c9db07c45c00d.jpg"
    },
    "updated_by": {
      "myself": false,
      "name": "杉山聡",
      "screen_name": "satoshi_sugiyama",
      "icon": "https://img.esa.io/uploads/production/members/129432/icon/thumb_m_4589e2842b9d87757c7c9db07c45c00d.jpg"
    },
    "stargazers_count": 0,
    "watchers_count": 2,
    "star": false,
    "watch": false,
    "sharing_urls": null
  },
  {
    "number": 1558,
    "name": "Aurora移行後のstaging-dbの接続方法",
    "full_name": "Users/杉山/Database/Aurora移行後のstaging-dbの接続方法",
    "wip": false,
    "body_md": "# Aurora移行後のstaging-dbの接続方法\r\n\r\n## 実現したいこと\r\n\r\n[king-api](https://github.com/qrioinc/king-api/blob/develop/README.md)のStagingAuroraDBをセキュアに保ちつつ、writeが発生する作業を行えるようにしたい\r\n\r\n## 結論\r\n\r\n- [踏み台サーバー](https://ap-northeast-1.console.aws.amazon.com/ec2/home?region=ap-northeast-1#InstanceDetails:instanceId=i-0b9a36bde732bb939)\r\n    - GUI(table plusなど)向き\r\n    - 設定にはprodiction-qrioの権限が必要\r\n    - セキュリティグループへのIP追加が必要\r\n    - 公開鍵ファイルをAuthorized _keysにコピーしてもらう依頼をする\r\n- `rails db`で接続\r\n    - `heroku run --size=private-s --app=sl2-api-staging rails db`\r\n- [redash](https://cs-redash.qrio.me/)→Create→Queryで`sl2-staging`を選択\r\n\r\n## 条件\r\n\r\n- DBのセキュリティを担保するため直接psql接続不可\r\n- Herokuからのrails cでの利用は可能(VPCピアリングによる実現)\r\n- publicly accessibleは`なし`\r\n    - `あり`にするとVPCピアリングが利用できなくなる=Heroku Private Space Dynoからの接続がインターネット経由になってしまう\r\n\r\n## EC2踏み台サーバの利用検討\r\n\r\n### メリット\r\n\r\n- 現在の運用方法からあまり変わらない\r\n    - Table Plusやpsqlがこれまで通り利用できる\r\n- 設計の際にドキュメントが豊富\r\n- 起動が遅い`heroku run`をしなくて良い\r\n- [SSMを利用した接続で、踏み台EC2のprivate subnet配置](https://qiita.com/subretu/items/6f8c81a07693aeebb1b6)も可能\r\n    - セキュリティ的には万歳だが、こちらは料金が跳ね上がる\r\n\r\n### デメリット\r\n\r\n- 料金がかかる\r\n    - $4.36/月\r\n- 利用頻度もそこまで高くなく、rails cで代用できる内容が多い\r\n- approveしてもらった[プルリク](https://github.com/qrioinc/king-cloudformation/pull/2)のテンプレートに変更を加えることになるかも\r\n    - 設置に1日欲しい\r\n    - stagingの移行が遅れる可能性が出てくる？\r\n- 移行後しばらくは使えないが後付けでサーバー設立であれば移行スケジュールやプルリクに影響はない\r\n\r\n## 逆に、EC2踏み台サーバを用意しない場合\r\n\r\n### メリット\r\n\r\n- コストが余計にかからない\r\n\r\n### デメリット\r\n\r\n- これまでの運用とはガラッと変わる\r\n    - 開発に携わる人々(**server team以外にもいる**)にキャッチアップコストがふりかかる\r\n- DBに直接操作をしたい場合の運用が煩雑になる\r\n    - sql文を叩きたい場合(DELETE/INSERT/UPDATE含む)は`heroku run rails c`となるためone-off dynoの起動が必要、時間がかかる\r\n    - one-off dynoに別途料金がかかる\r\n    - Table Plusやpsql対話ターミナルが使えない\r\n    - 量産機の個体データ登録は別途バッチなど作成する必要が出てくる\r\n- 運用手順の煩雑化に伴う開発/デバッグ効率の低下を懸念\r\n\r\n## 比較\r\n\r\n| 作業内容 | EC2-PublicSubnet | EC2なし(現状のAurora設置計画のまま) |※ex EC2PrivateSubnet(private link併用)|\r\n| -------- | -------- | -------- | -------- |\r\n| SQL文の実行 | ssh接続後psql | heroku run rails cでActiveRecordで実行 | ssm接続後psql |\r\n| 大量データの投入 | ssh接続→table plusなどでCSV貼り付けが可能 | 別途ツール作成が必要か | ssm接続→table plusなどでCSV貼り付けが可能 |\r\n| 料金コスト | ＄4.36/月(t4g.nano) | one-off dyno利用時間分のdyno units消費 | 約＄36/月(EC2+VPC Endpoint+データ転送) |\r\n| 環境設置 | EC2 Instance/InternetGateway/SecurityGroupの設置 | 大量データ投入(年1〜2回)までにツール/taskを作成 | EC2 Instance(private subnet内)/Private Link(3つ)/VPC Endpoint/SecurityGroup/ |\r\n| 利用前提知識 | ssh接続ができる | rails cが利用できる(Active Recordがわかる) |  |\r\n| 工数考慮 | 設置時のみ少し工数かかる | 利用時heroku runで時間がかかる/大量データ投入用のツール、task作成に工数がかかる | 設置時EC2-SSHよりも少し工数かかる(インプットも含め) |\r\n| 参考URL | [ssh-RDS接続例](https://m-shige1979.hatenablog.com/entry/2021/11/14/080000) |  | [ssm-RDS接続例](https://qiita.com/subretu/items/6f8c81a07693aeebb1b6) |\r\n| セキュリティ | セキュリティグループ |  | IAM Role |\r\n| 利用者負荷 | 少ない ○ | 高いかも × | 少ない ○ |\r\n\r\n## ここまでのまとめ\r\n\r\n- 運用負荷はEC2踏み台サーバを設置すると、現行Aurora設置計画よりも十分に改善される見込み\r\n- ただHerokuDBの時よりも1コマンド増える可能性がある(public,private共に)\r\n- 料金はprivate subnetだと高くなる\r\n\r\n→public subnetにEC2を配置する方式がよさそう？\r\n\r\n```mermaid\r\nflowchart LR\r\n  subgraph \"VPC\"\r\n    subgraph \"Public Subnet\"\r\n      EC2_Instance[\"EC2 Instance\"]\r\n    end\r\n    subgraph \"Private Subnet\"\r\n      Aurora_DB[\"Aurora PostgreSQL\"]\r\n    end\r\n  end\r\n  IGW(Internet Gateway) --SSH--> EC2_Instance\r\n  EC2_Instance --PSQL--> Aurora_DB\r\n\r\n```\r\n\r\n## 話し合い3/17\r\n\r\nhttps://docs.google.com/presentation/d/1xZC5EjLNo3-89ZQiPezXdLIXHNUjfzu6NQ8L0tSgsQw/edit?usp=sharing\r\n\r\n## 話し合い結果\r\n\r\n- 踏み台なくても実際はなんとかなる\r\n- とりあえずEC2をつけずこのまま運用してみよう\r\n    - `rails db`の利用でSQL実行\r\n        - 普通に使えたので良いが、ローカルのファイルは適用できないかも\r\n    - `heroku ps:forward`の利用でポートフォワーディング\r\n        - 実現できていない\r\n- U1さんが踏み台サーバ作ってくれた\r\n    - Security GroupへのIP追加、つなぐことができる人に公開鍵ファイルを`Authorized keys`に入れてもらう\r\n",
    "body_html": "<h1 data-sourcepos=\"1:1-1:45\" id=\"1-0-0\" name=\"1-0-0\"><a class=\"anchor\" id=\"Aurora移行後のstaging-dbの接続方法\" name=\"Aurora移行後のstaging-dbの接続方法\" href=\"#Aurora移行後のstaging-dbの接続方法\" data-position=\"1-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"Aurora移行後のstaging-dbの接続方法\"> &gt; Aurora移行後のstaging-dbの接続方法</span></a>Aurora移行後のstaging-dbの接続方法</h1>\n<h2 data-sourcepos=\"3:1-3:24\" id=\"1-1-0\" name=\"1-1-0\"><a class=\"anchor\" id=\"実現したいこと\" name=\"実現したいこと\" href=\"#実現したいこと\" data-position=\"1-1-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"実現したいこと\"> &gt; 実現したいこと</span></a>実現したいこと</h2>\n<p data-sourcepos=\"5:1-5:177\"><a href=\"https://github.com/qrioinc/king-api/blob/develop/README.md\" target=\"_blank\" rel=\"noopener noreferrer\">king-api</a>のStagingAuroraDBをセキュアに保ちつつ、writeが発生する作業を行えるようにしたい</p>\n<h2 data-sourcepos=\"7:1-7:9\" id=\"1-2-0\" name=\"1-2-0\"><a class=\"anchor\" id=\"結論\" name=\"結論\" href=\"#結論\" data-position=\"1-2-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"結論\"> &gt; 結論</span></a>結論</h2>\n<ul data-sourcepos=\"9:1-17:0\">\n<li data-sourcepos=\"9:1-13:88\"><a href=\"https://ap-northeast-1.console.aws.amazon.com/ec2/home?region=ap-northeast-1#InstanceDetails:instanceId=i-0b9a36bde732bb939\" target=\"_blank\" rel=\"noopener noreferrer\">踏み台サーバー</a><ul data-sourcepos=\"10:5-13:88\">\n<li data-sourcepos=\"10:5-10:33\">GUI(table plusなど)向き</li>\n<li data-sourcepos=\"11:5-11:51\">設定にはprodiction-qrioの権限が必要</li>\n<li data-sourcepos=\"12:5-12:59\">セキュリティグループへのIP追加が必要</li>\n<li data-sourcepos=\"13:5-13:88\">公開鍵ファイルをAuthorized _keysにコピーしてもらう依頼をする</li>\n</ul></li>\n<li data-sourcepos=\"14:1-15:66\"><code>rails db</code>で接続\n<ul data-sourcepos=\"15:5-15:66\">\n<li data-sourcepos=\"15:5-15:66\"><code>heroku run --size=private-s --app=sl2-api-staging rails db</code></li>\n</ul></li>\n<li data-sourcepos=\"16:1-17:0\"><a href=\"https://cs-redash.qrio.me/\" target=\"_blank\" rel=\"noopener noreferrer\">redash</a>→Create→Queryで<code>sl2-staging</code>を選択</li>\n</ul>\n<h2 data-sourcepos=\"18:1-18:9\" id=\"1-3-0\" name=\"1-3-0\"><a class=\"anchor\" id=\"条件\" name=\"条件\" href=\"#条件\" data-position=\"1-3-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"条件\"> &gt; 条件</span></a>条件</h2>\n<ul data-sourcepos=\"20:1-24:0\">\n<li data-sourcepos=\"20:1-20:68\">DBのセキュリティを担保するため直接psql接続不可</li>\n<li data-sourcepos=\"21:1-21:80\">Herokuからのrails cでの利用は可能(VPCピアリングによる実現)</li>\n<li data-sourcepos=\"22:1-24:0\">publicly accessibleは<code>なし</code><ul data-sourcepos=\"23:5-24:0\">\n<li data-sourcepos=\"23:5-24:0\"><code>あり</code>にするとVPCピアリングが利用できなくなる=Heroku Private Space Dynoからの接続がインターネット経由になってしまう</li>\n</ul></li>\n</ul>\n<h2 data-sourcepos=\"25:1-25:39\" id=\"1-4-0\" name=\"1-4-0\"><a class=\"anchor\" id=\"EC2踏み台サーバの利用検討\" name=\"EC2踏み台サーバの利用検討\" href=\"#EC2踏み台サーバの利用検討\" data-position=\"1-4-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"EC2踏み台サーバの利用検討\"> &gt; EC2踏み台サーバの利用検討</span></a>EC2踏み台サーバの利用検討</h2>\n<h3 data-sourcepos=\"27:1-27:16\" id=\"1-4-1\" name=\"1-4-1\"><a class=\"anchor\" id=\"メリット\" name=\"メリット\" href=\"#メリット\" data-position=\"1-4-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"メリット\"> &gt; メリット</span></a>メリット</h3>\n<ul data-sourcepos=\"29:1-35:0\">\n<li data-sourcepos=\"29:1-30:59\">現在の運用方法からあまり変わらない\n<ul data-sourcepos=\"30:5-30:59\">\n<li data-sourcepos=\"30:5-30:59\">Table Plusやpsqlがこれまで通り利用できる</li>\n</ul></li>\n<li data-sourcepos=\"31:1-31:44\">設計の際にドキュメントが豊富</li>\n<li data-sourcepos=\"32:1-32:50\">起動が遅い<code>heroku run</code>をしなくて良い</li>\n<li data-sourcepos=\"33:1-35:0\"><a href=\"https://qiita.com/subretu/items/6f8c81a07693aeebb1b6\" target=\"_blank\" rel=\"noopener noreferrer\">SSMを利用した接続で、踏み台EC2のprivate subnet配置</a>も可能\n<ul data-sourcepos=\"34:5-35:0\">\n<li data-sourcepos=\"34:5-35:0\">セキュリティ的には万歳だが、こちらは料金が跳ね上がる</li>\n</ul></li>\n</ul>\n<h3 data-sourcepos=\"36:1-36:19\" id=\"1-4-2\" name=\"1-4-2\"><a class=\"anchor\" id=\"デメリット\" name=\"デメリット\" href=\"#デメリット\" data-position=\"1-4-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"デメリット\"> &gt; デメリット</span></a>デメリット</h3>\n<ul data-sourcepos=\"38:1-45:0\">\n<li data-sourcepos=\"38:1-39:15\">料金がかかる\n<ul data-sourcepos=\"39:5-39:15\">\n<li data-sourcepos=\"39:5-39:15\">$4.36/月</li>\n</ul></li>\n<li data-sourcepos=\"40:1-40:84\">利用頻度もそこまで高くなく、rails cで代用できる内容が多い</li>\n<li data-sourcepos=\"41:1-43:61\">approveしてもらった<a href=\"https://github.com/qrioinc/king-cloudformation/pull/2\" target=\"_blank\" rel=\"noopener noreferrer\">プルリク</a>のテンプレートに変更を加えることになるかも\n<ul data-sourcepos=\"42:5-43:61\">\n<li data-sourcepos=\"42:5-42:28\">設置に1日欲しい</li>\n<li data-sourcepos=\"43:5-43:61\">stagingの移行が遅れる可能性が出てくる？</li>\n</ul></li>\n<li data-sourcepos=\"44:1-45:0\">移行後しばらくは使えないが後付けでサーバー設立であれば移行スケジュールやプルリクに影響はない</li>\n</ul>\n<h2 data-sourcepos=\"46:1-46:57\" id=\"1-5-0\" name=\"1-5-0\"><a class=\"anchor\" id=\"逆に、EC2踏み台サーバを用意しない場合\" name=\"逆に、EC2踏み台サーバを用意しない場合\" href=\"#逆に、EC2踏み台サーバを用意しない場合\" data-position=\"1-5-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"逆に、EC2踏み台サーバを用意しない場合\"> &gt; 逆に、EC2踏み台サーバを用意しない場合</span></a>逆に、EC2踏み台サーバを用意しない場合</h2>\n<h3 data-sourcepos=\"48:1-48:16\" id=\"1-5-1\" name=\"1-5-1\"><a class=\"anchor\" id=\"メリット-1\" name=\"メリット-1\" href=\"#メリット-1\" data-position=\"1-5-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"メリット\"> &gt; メリット</span></a>メリット</h3>\n<ul data-sourcepos=\"50:1-51:0\">\n<li data-sourcepos=\"50:1-51:0\">コストが余計にかからない</li>\n</ul>\n<h3 data-sourcepos=\"52:1-52:19\" id=\"1-5-2\" name=\"1-5-2\"><a class=\"anchor\" id=\"デメリット-1\" name=\"デメリット-1\" href=\"#デメリット-1\" data-position=\"1-5-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"デメリット\"> &gt; デメリット</span></a>デメリット</h3>\n<ul data-sourcepos=\"54:1-62:0\">\n<li data-sourcepos=\"54:1-55:116\">これまでの運用とはガラッと変わる\n<ul data-sourcepos=\"55:5-55:116\">\n<li data-sourcepos=\"55:5-55:116\">開発に携わる人々(<strong>server team以外にもいる</strong>)にキャッチアップコストがふりかかる</li>\n</ul></li>\n<li data-sourcepos=\"56:1-60:96\">DBに直接操作をしたい場合の運用が煩雑になる\n<ul data-sourcepos=\"57:5-60:96\">\n<li data-sourcepos=\"57:5-57:150\">sql文を叩きたい場合(DELETE/INSERT/UPDATE含む)は<code>heroku run rails c</code>となるためone-off dynoの起動が必要、時間がかかる</li>\n<li data-sourcepos=\"58:5-58:45\">one-off dynoに別途料金がかかる</li>\n<li data-sourcepos=\"59:5-59:59\">Table Plusやpsql対話ターミナルが使えない</li>\n<li data-sourcepos=\"60:5-60:96\">量産機の個体データ登録は別途バッチなど作成する必要が出てくる</li>\n</ul></li>\n<li data-sourcepos=\"61:1-62:0\">運用手順の煩雑化に伴う開発/デバッグ効率の低下を懸念</li>\n</ul>\n<h2 data-sourcepos=\"63:1-63:9\" id=\"1-6-0\" name=\"1-6-0\"><a class=\"anchor\" id=\"比較\" name=\"比較\" href=\"#比較\" data-position=\"1-6-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"比較\"> &gt; 比較</span></a>比較</h2>\n<table data-sourcepos=\"65:1-75:69\">\n<thead>\n<tr data-sourcepos=\"65:1-65:128\">\n<th data-sourcepos=\"65:2-65:15\">作業内容</th>\n<th data-sourcepos=\"65:17-65:34\">EC2-PublicSubnet</th>\n<th data-sourcepos=\"65:36-65:84\">EC2なし(現状のAurora設置計画のまま)</th>\n<th data-sourcepos=\"65:86-65:127\">※ex EC2PrivateSubnet(private link併用)</th>\n</tr>\n</thead>\n<tbody>\n<tr data-sourcepos=\"67:1-67:102\">\n<td data-sourcepos=\"67:2-67:18\">SQL文の実行</td>\n<td data-sourcepos=\"67:20-67:37\">ssh接続後psql</td>\n<td data-sourcepos=\"67:39-67:82\">heroku run rails cでActiveRecordで実行</td>\n<td data-sourcepos=\"67:84-67:101\">ssm接続後psql</td>\n</tr>\n<tr data-sourcepos=\"68:1-68:180\">\n<td data-sourcepos=\"68:2-68:27\">大量データの投入</td>\n<td data-sourcepos=\"68:29-68:85\">ssh接続→table plusなどでCSV貼り付けが可能</td>\n<td data-sourcepos=\"68:87-68:121\">別途ツール作成が必要か</td>\n<td data-sourcepos=\"68:123-68:179\">ssm接続→table plusなどでCSV貼り付けが可能</td>\n</tr>\n<tr data-sourcepos=\"69:1-69:141\">\n<td data-sourcepos=\"69:2-69:18\">料金コスト</td>\n<td data-sourcepos=\"69:20-69:42\">＄4.36/月(t4g.nano)</td>\n<td data-sourcepos=\"69:44-69:91\">one-off dyno利用時間分のdyno units消費</td>\n<td data-sourcepos=\"69:93-69:140\">約＄36/月(EC2+VPC Endpoint+データ転送)</td>\n</tr>\n<tr data-sourcepos=\"70:1-70:220\">\n<td data-sourcepos=\"70:2-70:15\">環境設置</td>\n<td data-sourcepos=\"70:17-70:69\">EC2 Instance/InternetGateway/SecurityGroupの設置</td>\n<td data-sourcepos=\"70:71-70:138\">大量データ投入(年1〜2回)までにツール/taskを作成</td>\n<td data-sourcepos=\"70:140-70:219\">EC2 Instance(private subnet内)/Private Link(3つ)/VPC Endpoint/SecurityGroup/</td>\n</tr>\n<tr data-sourcepos=\"71:1-71:104\">\n<td data-sourcepos=\"71:2-71:21\">利用前提知識</td>\n<td data-sourcepos=\"71:23-71:45\">ssh接続ができる</td>\n<td data-sourcepos=\"71:47-71:100\">rails cが利用できる(Active Recordがわかる)</td>\n<td data-sourcepos=\"71:102-71:103\"></td>\n</tr>\n<tr data-sourcepos=\"72:1-72:244\">\n<td data-sourcepos=\"72:2-72:15\">工数考慮</td>\n<td data-sourcepos=\"72:17-72:54\">設置時のみ少し工数かかる</td>\n<td data-sourcepos=\"72:56-72:168\">利用時heroku runで時間がかかる/大量データ投入用のツール、task作成に工数がかかる</td>\n<td data-sourcepos=\"72:170-72:243\">設置時EC2-SSHよりも少し工数かかる(インプットも含め)</td>\n</tr>\n<tr data-sourcepos=\"73:1-73:172\">\n<td data-sourcepos=\"73:2-73:12\">参考URL</td>\n<td data-sourcepos=\"73:14-73:93\"><a href=\"https://m-shige1979.hatenablog.com/entry/2021/11/14/080000\" target=\"_blank\" rel=\"noopener noreferrer\">ssh-RDS接続例</a></td>\n<td data-sourcepos=\"73:95-73:96\"></td>\n<td data-sourcepos=\"73:98-73:171\"><a href=\"https://qiita.com/subretu/items/6f8c81a07693aeebb1b6\" target=\"_blank\" rel=\"noopener noreferrer\">ssm-RDS接続例</a></td>\n</tr>\n<tr data-sourcepos=\"74:1-74:69\">\n<td data-sourcepos=\"74:2-74:21\">セキュリティ</td>\n<td data-sourcepos=\"74:23-74:54\">セキュリティグループ</td>\n<td data-sourcepos=\"74:56-74:57\"></td>\n<td data-sourcepos=\"74:59-74:68\">IAM Role</td>\n</tr>\n<tr data-sourcepos=\"75:1-75:69\">\n<td data-sourcepos=\"75:2-75:18\">利用者負荷</td>\n<td data-sourcepos=\"75:20-75:34\">少ない ○</td>\n<td data-sourcepos=\"75:36-75:52\">高いかも ×</td>\n<td data-sourcepos=\"75:54-75:68\">少ない ○</td>\n</tr>\n</tbody>\n</table>\n<h2 data-sourcepos=\"77:1-77:27\" id=\"1-7-0\" name=\"1-7-0\"><a class=\"anchor\" id=\"ここまでのまとめ\" name=\"ここまでのまとめ\" href=\"#ここまでのまとめ\" data-position=\"1-7-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"ここまでのまとめ\"> &gt; ここまでのまとめ</span></a>ここまでのまとめ</h2>\n<ul data-sourcepos=\"79:1-82:0\">\n<li data-sourcepos=\"79:1-79:125\">運用負荷はEC2踏み台サーバを設置すると、現行Aurora設置計画よりも十分に改善される見込み</li>\n<li data-sourcepos=\"80:1-80:93\">ただHerokuDBの時よりも1コマンド増える可能性がある(public,private共に)</li>\n<li data-sourcepos=\"81:1-82:0\">料金はprivate subnetだと高くなる</li>\n</ul>\n<p data-sourcepos=\"83:1-83:61\">→public subnetにEC2を配置する方式がよさそう？</p>\n<div class=\"code-block\" data-sourcepos=\"85:1-98:3\"><div class=\"mermaid\">flowchart LR\n  subgraph \"VPC\"\n    subgraph \"Public Subnet\"\n      EC2_Instance[\"EC2 Instance\"]\n    end\n    subgraph \"Private Subnet\"\n      Aurora_DB[\"Aurora PostgreSQL\"]\n    end\n  end\n  IGW(Internet Gateway) --SSH--&gt; EC2_Instance\n  EC2_Instance --PSQL--&gt; Aurora_DB\n</div></div>\n<h2 data-sourcepos=\"100:1-100:19\" id=\"1-8-0\" name=\"1-8-0\"><a class=\"anchor\" id=\"話し合い3/17\" name=\"話し合い3/17\" href=\"#話し合い3/17\" data-position=\"1-8-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"話し合い3/17\"> &gt; 話し合い3/17</span></a>話し合い3/17</h2>\n<p data-sourcepos=\"102:1-102:100\"><a href=\"https://docs.google.com/presentation/d/1xZC5EjLNo3-89ZQiPezXdLIXHNUjfzu6NQ8L0tSgsQw/edit?usp=sharing\" target=\"_blank\" rel=\"noopener noreferrer\">https://docs.google.com/presentation/d/1xZC5EjLNo3-89ZQiPezXdLIXHNUjfzu6NQ8L0tSgsQw/edit?usp=sharing</a></p>\n<h2 data-sourcepos=\"104:1-104:21\" id=\"1-9-0\" name=\"1-9-0\"><a class=\"anchor\" id=\"話し合い結果\" name=\"話し合い結果\" href=\"#話し合い結果\" data-position=\"1-9-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"話し合い結果\"> &gt; 話し合い結果</span></a>話し合い結果</h2>\n<ul data-sourcepos=\"106:1-113:132\">\n<li data-sourcepos=\"106:1-106:50\">踏み台なくても実際はなんとかなる</li>\n<li data-sourcepos=\"107:1-111:34\">とりあえずEC2をつけずこのまま運用してみよう\n<ul data-sourcepos=\"108:5-111:34\">\n<li data-sourcepos=\"108:5-109:100\"><code>rails db</code>の利用でSQL実行\n<ul data-sourcepos=\"109:9-109:100\">\n<li data-sourcepos=\"109:9-109:100\">普通に使えたので良いが、ローカルのファイルは適用できないかも</li>\n</ul></li>\n<li data-sourcepos=\"110:5-111:34\"><code>heroku ps:forward</code>の利用でポートフォワーディング\n<ul data-sourcepos=\"111:9-111:34\">\n<li data-sourcepos=\"111:9-111:34\">実現できていない</li>\n</ul></li>\n</ul></li>\n<li data-sourcepos=\"112:1-113:132\">U1さんが踏み台サーバ作ってくれた\n<ul data-sourcepos=\"113:5-113:132\">\n<li data-sourcepos=\"113:5-113:132\">Security GroupへのIP追加、つなぐことができる人に公開鍵ファイルを<code>Authorized keys</code>に入れてもらう</li>\n</ul></li>\n</ul>\n",
    "created_at": "2023-03-14T16:46:43+09:00",
    "message": "Update post.",
    "kind": "stock",
    "comments_count": 0,
    "tasks_count": 0,
    "done_tasks_count": 0,
    "url": "https://qrio.esa.io/posts/1558",
    "updated_at": "2023-07-18T10:45:50+09:00",
    "tags": [],
    "category": "Users/杉山/Database",
    "revision_number": 13,
    "created_by": {
      "myself": false,
      "name": "杉山聡",
      "screen_name": "satoshi_sugiyama",
      "icon": "https://img.esa.io/uploads/production/members/129432/icon/thumb_m_4589e2842b9d87757c7c9db07c45c00d.jpg"
    },
    "updated_by": {
      "myself": false,
      "name": "杉山聡",
      "screen_name": "satoshi_sugiyama",
      "icon": "https://img.esa.io/uploads/production/members/129432/icon/thumb_m_4589e2842b9d87757c7c9db07c45c00d.jpg"
    },
    "stargazers_count": 0,
    "watchers_count": 1,
    "star": false,
    "watch": false,
    "sharing_urls": null
  },
  {
    "number": 1588,
    "name": "session_replication_role実験2",
    "full_name": "Users/杉山/Database/session_replication_role実験2",
    "wip": true,
    "body_md": "Copied from: [Users/杉山/session_replication_role実験1](/posts/1587)\r\n\r\n## 実験2\r\n### 前回との実施差分\r\n- Heroku(sl2-api-db-migration-test)DBからbucardoスキーマを削除した状態で05スクリプトでテーブルスキーマのdump/restoreを行なった\r\n- logs, display_logsのrestoreの際に`--disable-triggers`を除外した\r\n\r\n### 結果差分\r\n#### logs, display_logsテーブルのrestore\r\n- 成功した\r\n    - `--disable-triggers`オプションを消して実行、無事成功\r\n#### main_dataのrestore\r\n- 成功した\r\n    - 以前の検証環境でのbucardoスキーマを削除したのでbucardoスキーマが存在しない状態でテーブル情報のdump/restoreを行なった→bucardoの設定に進んだ\r\n    - Auroraにはbucardoのスキーマがない状態ができた\r\n### 結果詳細\r\n#### 初期のsession_replication_role\r\n- origin\r\n\r\n#### session_replication_roleをパラメータグループから変更した際の挙動\r\n- 成功した\r\n- session_replication_roleがreplicaに変わった\r\n#### logs, display_logsテーブルのrestore(上述)\r\n- 成功した\r\n    - `--disable-triggers`オプションを消して実行、無事成功\r\n#### session_replication_roleをパラメータグループから戻した際の挙動\r\n- 成功した\r\n- session_replication_roleがoriginに戻った\r\n#### main_dataのrestore(上述)\r\n- 成功した\r\n    - 以前の検証環境でのbucardoスキーマを削除したのでbucardoスキーマが存在しない状態でテーブル情報のdump/restoreを行なった→bucardoの設定に進んだ\r\n    - Auroraにはbucardoのスキーマがない状態ができた\r\n\r\n### 内容\r\n\r\n#### やり直しのため再構成\r\n\r\nAuroraのschema全削除\r\nAuroraにpublicスキーマ作成\r\nBucardoの同期系データ全削除\r\nsl2-api-db-migration-testのdbのbucardoスキーマ削除\r\n\r\nrm -rf main_data.dump logs_displaylogs.dump heroku_tables.dump\r\n\r\n\r\n[移行手順書](https://docs.google.com/spreadsheets/d/1W3DymCJ_ifiXtSUwVAjcl9tzPGfz5WE6bmnnwYL9Gbo/edit#gid=602303325)のBucardoの設定、データプールの開始まで終わっている状態以降\r\n\r\n#### logsとdisplay_logsのdump\r\n\r\n```sh\r\npg_dump --format=custom --verbose --data-only --table=logs --table=display_logs -h vpce-0e9251c411c13ce7a-zursyjry.vpce-svc-08edb438435192caf.ap-northeast-1.vpce.amazonaws.com -p 5432 -d d6ci42p2305kgu -U uc3938nrsvfra > logs_displaylogs.dump\r\n```\r\n<details>\r\n\r\n```sh\r\npg_dump: last built-in OID is 16383\r\npg_dump: reading extensions\r\npg_dump: identifying extension members\r\npg_dump: reading schemas\r\npg_dump: reading user-defined tables\r\npg_dump: reading user-defined functions\r\npg_dump: reading user-defined types\r\npg_dump: reading procedural languages\r\npg_dump: reading user-defined aggregate functions\r\npg_dump: reading user-defined operators\r\npg_dump: reading user-defined access methods\r\npg_dump: reading user-defined operator classes\r\npg_dump: reading user-defined operator families\r\npg_dump: reading user-defined text search parsers\r\npg_dump: reading user-defined text search templates\r\npg_dump: reading user-defined text search dictionaries\r\npg_dump: reading user-defined text search configurations\r\npg_dump: reading user-defined foreign-data wrappers\r\npg_dump: reading user-defined foreign servers\r\npg_dump: reading default privileges\r\npg_dump: reading user-defined collations\r\npg_dump: reading user-defined conversions\r\npg_dump: reading type casts\r\npg_dump: reading transforms\r\npg_dump: reading table inheritance information\r\npg_dump: reading event triggers\r\npg_dump: finding extension tables\r\npg_dump: finding inheritance relationships\r\npg_dump: reading column info for interesting tables\r\npg_dump: finding the columns and types of table \"public.display_logs\"\r\npg_dump: finding the columns and types of table \"public.logs\"\r\npg_dump: flagging inherited columns in subtables\r\npg_dump: reading indexes\r\npg_dump: reading indexes for table \"public.display_logs\"\r\npg_dump: reading indexes for table \"public.logs\"\r\npg_dump: flagging indexes in partitioned tables\r\npg_dump: reading extended statistics\r\npg_dump: reading constraints\r\npg_dump: reading foreign key constraints for table \"public.display_logs\"\r\npg_dump: reading foreign key constraints for table \"public.logs\"\r\npg_dump: reading triggers\r\npg_dump: reading triggers for table \"public.display_logs\"\r\npg_dump: reading triggers for table \"public.logs\"\r\npg_dump: reading rewrite rules\r\npg_dump: reading policies\r\npg_dump: reading row-level security policies\r\npg_dump: reading publications\r\npg_dump: reading publication membership\r\npg_dump: reading subscriptions\r\npg_dump: reading dependency data\r\npg_dump: saving encoding = UTF8\r\npg_dump: saving standard_conforming_strings = on\r\npg_dump: saving search_path = \r\npg_dump: saving database definition\r\npg_dump: dumping contents of table \"public.display_logs\"\r\npg_dump: dumping contents of table \"public.logs\"\r\n```\r\n\r\n</details>\r\n\r\n#### session_replication_roleの初期値確認\r\n\r\n```\r\nkingapi=> show session_replication_role;\r\n session_replication_role \r\n--------------------------\r\n origin\r\n(1 row)\r\n```\r\n\r\n#### 新手順 session_replication_roleをreplicaにする\r\n\r\nDBクラスタの「変更」からDBクラスターのパラメータグループをking-api-cfn-test-parametergroup-copyを選択\r\n<img width=\"799\" alt=\"スクリーンショット 2023-03-31 13.58.48.png (51.5 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/03/31/136273/e97852dc-18e0-4e32-86d2-bf4d94afd72c.png\">\r\n\r\n変更を「すぐに適用」する\r\n適用できた\r\n<img width=\"209\" alt=\"スクリーンショット 2023-03-31 13.59.55.png (9.9 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/03/31/136273/3bd7096d-ed86-4b37-bd4e-7803ff27986a.png\">\r\n\r\n\r\n#### session_replication_roleの変更適用確認\r\n```sh\r\nkingapi=> show session_replication_role;\r\n session_replication_role \r\n--------------------------\r\n replica\r\n(1 row)\r\n```\r\nちなみに、psql接続を続けた状態でもreplicaに変更が反映できた\r\n\r\n#### logs, display_logsのrestore\r\n今回は`--disable-triggers`を除外している。\r\n\r\n```sh\r\nroot@d57ada7337a5:/# pg_restore --verbose --data-only -h king-api-cfn-test.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com -U kingadmin -d kingapi -p 5432 logs_displaylogs.dump\r\n```\r\n\r\n<details>\r\n\r\n<summary>エラーなしで成功</summary>\r\n\r\n```sh\r\npg_restore --verbose --data-only -h king-api-cfn-test.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com -U kingadmin -d kingapi -p 5432 logs_displaylogs.dump\r\npg_restore: connecting to database for restore\r\npg_restore: processing data for table \"public.display_logs\"\r\npg_restore: processing data for table \"public.logs\"\r\n```\r\n\r\n</details>\r\n\r\n#### 行数確認\r\n同数となった\r\n```sql\r\nkingapi=> select count(*) from logs;\r\n count \r\n-------\r\n 23759\r\n(1 row)\r\n\r\nkingapi=> select count(*) from display_logs;\r\n count \r\n-------\r\n  1125\r\n(1 row)\r\n\r\nkingapi=> \r\n```\r\n\r\n```sql\r\nsl2-api-db-migration-test::DATABASE=> select count(*) from logs;\r\n count\r\n-------\r\n 23759\r\n(1 row)\r\n\r\nsl2-api-db-migration-test::DATABASE=> select count(*) from display_logs;\r\n count\r\n-------\r\n  1125\r\n(1 row)\r\n\r\nsl2-api-db-migration-test::DATABASE=>\r\n```\r\n\r\n#### パラメータグループを戻す\r\n先ほどと同様に、パラメータグループを元々ついていたものに戻す\r\n<img width=\"764\" alt=\"スクリーンショット 2023-03-31 12.46.09.png (62.7 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/03/31/136273/cee6ce7d-ca7b-4134-9bf1-6f49e829c008.png\">\r\n\r\n#### session_replication_role確認\r\nこちらも変わらず成功\r\n```sh\r\nkingapi=> show session_replication_role;\r\n session_replication_role \r\n--------------------------\r\n origin\r\n(1 row)\r\n```\r\n\r\n#### logs, display_logs以外のdump\r\n\r\n```sh\r\nroot@d57ada7337a5:/# pg_dump --format=custom --verbose --data-only --exclude-table=logs --exclude-table=display_logs -h vpce-0e9251c411c13ce7a-zursyjry.vpce-svc-08edb438435192caf.ap-northeast-1.vpce.amazonaws.com -d d6ci42p2305kgu -U uc3938nrsvfra -p 5432 >main_data.dump\r\n```\r\n\r\n<details>\r\n\r\n<summary>bucardo.delta_public_(テーブル名)などがlogsとdisplaylogsのみになった</summary>\r\n\r\n```sh\r\npg_dump: last built-in OID is 16383\r\npg_dump: reading extensions\r\npg_dump: identifying extension members\r\npg_dump: reading schemas\r\npg_dump: reading user-defined tables\r\npg_dump: reading user-defined functions\r\npg_dump: reading user-defined types\r\npg_dump: reading procedural languages\r\npg_dump: reading user-defined aggregate functions\r\npg_dump: reading user-defined operators\r\npg_dump: reading user-defined access methods\r\npg_dump: reading user-defined operator classes\r\npg_dump: reading user-defined operator families\r\npg_dump: reading user-defined text search parsers\r\npg_dump: reading user-defined text search templates\r\npg_dump: reading user-defined text search dictionaries\r\npg_dump: reading user-defined text search configurations\r\npg_dump: reading user-defined foreign-data wrappers\r\npg_dump: reading user-defined foreign servers\r\npg_dump: reading default privileges\r\npg_dump: reading user-defined collations\r\npg_dump: reading user-defined conversions\r\npg_dump: reading type casts\r\npg_dump: reading transforms\r\npg_dump: reading table inheritance information\r\npg_dump: reading event triggers\r\npg_dump: finding extension tables\r\npg_dump: finding inheritance relationships\r\npg_dump: reading column info for interesting tables\r\npg_dump: finding the columns and types of table \"public.pg_stat_statements_info\"\r\npg_dump: finding the columns and types of table \"public.pg_stat_statements\"\r\npg_dump: finding the columns and types of table \"public.active_storage_attachments\"\r\npg_dump: finding the columns and types of table \"public.active_storage_blobs\"\r\npg_dump: finding the columns and types of table \"public.active_storage_variant_records\"\r\npg_dump: finding the columns and types of table \"public.ar_internal_metadata\"\r\npg_dump: finding the columns and types of table \"public.autolock_schedules\"\r\npg_dump: finding the columns and types of table \"public.cards\"\r\npg_dump: finding the columns and types of table \"public.command_logs\"\r\npg_dump: finding the columns and types of table \"public.dailies\"\r\npg_dump: finding the columns and types of table \"public.door_mode_changed_histories\"\r\npg_dump: finding the columns and types of table \"public.durations\"\r\npg_dump: finding the columns and types of table \"public.entrance_block_fob_keys\"\r\npg_dump: finding the columns and types of table \"public.entrance_block_knight_cards\"\r\npg_dump: finding the columns and types of table \"public.entrance_fob_keys\"\r\npg_dump: finding the columns and types of table \"public.entrance_invitations\"\r\npg_dump: finding the columns and types of table \"public.entrance_knight_keys\"\r\npg_dump: finding the columns and types of table \"public.entrance_knight_pins\"\r\npg_dump: finding the columns and types of table \"public.entrance_lock_settings\"\r\npg_dump: finding the columns and types of table \"public.entrance_locks\"\r\npg_dump: finding the columns and types of table \"public.entrance_master_keys\"\r\npg_dump: finding the columns and types of table \"public.entrance_resident_guest_keys\"\r\npg_dump: finding the columns and types of table \"public.entrance_resident_keys\"\r\npg_dump: finding the columns and types of table \"public.family_keys\"\r\npg_dump: finding the columns and types of table \"public.fob_keys\"\r\npg_dump: finding the columns and types of table \"public.fobs\"\r\npg_dump: finding the columns and types of table \"public.guest_keys\"\r\npg_dump: finding the columns and types of table \"public.hubs\"\r\npg_dump: finding the columns and types of table \"public.invitations\"\r\npg_dump: finding the columns and types of table \"public.json_web_keys\"\r\npg_dump: finding the columns and types of table \"public.knight_cards\"\r\npg_dump: finding the columns and types of table \"public.knight_commands\"\r\npg_dump: finding the columns and types of table \"public.knight_keys\"\r\npg_dump: finding the columns and types of table \"public.knight_logs\"\r\npg_dump: finding the columns and types of table \"public.knight_pins\"\r\npg_dump: finding the columns and types of table \"public.knights\"\r\npg_dump: finding the columns and types of table \"public.laresia_pins\"\r\npg_dump: finding the columns and types of table \"public.lock_settings\"\r\npg_dump: finding the columns and types of table \"public.lock_webhook_tokens\"\r\npg_dump: finding the columns and types of table \"public.locks\"\r\npg_dump: finding the columns and types of table \"public.managers\"\r\npg_dump: finding the columns and types of table \"public.master_keys\"\r\npg_dump: finding the columns and types of table \"public.mst_display_logs\"\r\npg_dump: finding the columns and types of table \"public.relationships\"\r\npg_dump: finding the columns and types of table \"public.resident_guest_keys\"\r\npg_dump: finding the columns and types of table \"public.resident_keys\"\r\npg_dump: finding the columns and types of table \"public.schema_migrations\"\r\npg_dump: finding the columns and types of table \"public.term_of_validities\"\r\npg_dump: finding the columns and types of table \"public.users\"\r\npg_dump: finding the columns and types of table \"public.webhook_tokens\"\r\npg_dump: finding the columns and types of table \"public.webhooks\"\r\npg_dump: finding the columns and types of table \"public.weeklies\"\r\npg_dump: finding the columns and types of table \"public.wena_keys\"\r\npg_dump: finding the columns and types of table \"public.wenas\"\r\npg_dump: finding the columns and types of table \"bucardo.bucardo_delta_names\"\r\npg_dump: finding the columns and types of table \"bucardo.bucardo_delta_targets\"\r\npg_dump: finding the columns and types of table \"bucardo.bucardo_truncate_trigger\"\r\npg_dump: finding the columns and types of table \"bucardo.bucardo_truncate_trigger_log\"\r\npg_dump: finding the columns and types of table \"bucardo.bucardo_sequences\"\r\npg_dump: finding the columns and types of table \"bucardo.delta_public_display_logs\"\r\npg_dump: finding the columns and types of table \"bucardo.track_public_display_logs\"\r\npg_dump: finding the columns and types of table \"bucardo.stage_public_display_logs\"\r\npg_dump: finding the columns and types of table \"bucardo.delta_public_logs\"\r\npg_dump: finding the columns and types of table \"bucardo.track_public_logs\"\r\npg_dump: finding the columns and types of table \"bucardo.stage_public_logs\"\r\npg_dump: flagging inherited columns in subtables\r\npg_dump: reading indexes\r\npg_dump: reading indexes for table \"public.active_storage_attachments\"\r\npg_dump: reading indexes for table \"public.active_storage_blobs\"\r\npg_dump: reading indexes for table \"public.active_storage_variant_records\"\r\npg_dump: reading indexes for table \"public.ar_internal_metadata\"\r\npg_dump: reading indexes for table \"public.autolock_schedules\"\r\npg_dump: reading indexes for table \"public.cards\"\r\npg_dump: reading indexes for table \"public.command_logs\"\r\npg_dump: reading indexes for table \"public.dailies\"\r\npg_dump: reading indexes for table \"public.door_mode_changed_histories\"\r\npg_dump: reading indexes for table \"public.durations\"\r\npg_dump: reading indexes for table \"public.entrance_block_fob_keys\"\r\npg_dump: reading indexes for table \"public.entrance_block_knight_cards\"\r\npg_dump: reading indexes for table \"public.entrance_fob_keys\"\r\npg_dump: reading indexes for table \"public.entrance_invitations\"\r\npg_dump: reading indexes for table \"public.entrance_knight_keys\"\r\npg_dump: reading indexes for table \"public.entrance_knight_pins\"\r\npg_dump: reading indexes for table \"public.entrance_lock_settings\"\r\npg_dump: reading indexes for table \"public.entrance_locks\"\r\npg_dump: reading indexes for table \"public.entrance_master_keys\"\r\npg_dump: reading indexes for table \"public.entrance_resident_guest_keys\"\r\npg_dump: reading indexes for table \"public.entrance_resident_keys\"\r\npg_dump: reading indexes for table \"public.family_keys\"\r\npg_dump: reading indexes for table \"public.fob_keys\"\r\npg_dump: reading indexes for table \"public.fobs\"\r\npg_dump: reading indexes for table \"public.guest_keys\"\r\npg_dump: reading indexes for table \"public.hubs\"\r\npg_dump: reading indexes for table \"public.invitations\"\r\npg_dump: reading indexes for table \"public.json_web_keys\"\r\npg_dump: reading indexes for table \"public.knight_cards\"\r\npg_dump: reading indexes for table \"public.knight_commands\"\r\npg_dump: reading indexes for table \"public.knight_keys\"\r\npg_dump: reading indexes for table \"public.knight_logs\"\r\npg_dump: reading indexes for table \"public.knight_pins\"\r\npg_dump: reading indexes for table \"public.knights\"\r\npg_dump: reading indexes for table \"public.laresia_pins\"\r\npg_dump: reading indexes for table \"public.lock_settings\"\r\npg_dump: reading indexes for table \"public.lock_webhook_tokens\"\r\npg_dump: reading indexes for table \"public.locks\"\r\npg_dump: reading indexes for table \"public.managers\"\r\npg_dump: reading indexes for table \"public.master_keys\"\r\npg_dump: reading indexes for table \"public.mst_display_logs\"\r\npg_dump: reading indexes for table \"public.relationships\"\r\npg_dump: reading indexes for table \"public.resident_guest_keys\"\r\npg_dump: reading indexes for table \"public.resident_keys\"\r\npg_dump: reading indexes for table \"public.schema_migrations\"\r\npg_dump: reading indexes for table \"public.term_of_validities\"\r\npg_dump: reading indexes for table \"public.users\"\r\npg_dump: reading indexes for table \"public.webhook_tokens\"\r\npg_dump: reading indexes for table \"public.webhooks\"\r\npg_dump: reading indexes for table \"public.weeklies\"\r\npg_dump: reading indexes for table \"public.wena_keys\"\r\npg_dump: reading indexes for table \"public.wenas\"\r\npg_dump: reading indexes for table \"bucardo.bucardo_delta_names\"\r\npg_dump: reading indexes for table \"bucardo.bucardo_delta_targets\"\r\npg_dump: reading indexes for table \"bucardo.bucardo_truncate_trigger\"\r\npg_dump: reading indexes for table \"bucardo.bucardo_sequences\"\r\npg_dump: reading indexes for table \"bucardo.delta_public_display_logs\"\r\npg_dump: reading indexes for table \"bucardo.track_public_display_logs\"\r\npg_dump: reading indexes for table \"bucardo.delta_public_logs\"\r\npg_dump: reading indexes for table \"bucardo.track_public_logs\"\r\npg_dump: flagging indexes in partitioned tables\r\npg_dump: reading extended statistics\r\npg_dump: reading constraints\r\npg_dump: reading foreign key constraints for table \"public.active_storage_attachments\"\r\npg_dump: reading foreign key constraints for table \"public.active_storage_blobs\"\r\npg_dump: reading foreign key constraints for table \"public.active_storage_variant_records\"\r\npg_dump: reading foreign key constraints for table \"public.ar_internal_metadata\"\r\npg_dump: reading foreign key constraints for table \"public.autolock_schedules\"\r\npg_dump: reading foreign key constraints for table \"public.cards\"\r\npg_dump: reading foreign key constraints for table \"public.command_logs\"\r\npg_dump: reading foreign key constraints for table \"public.dailies\"\r\npg_dump: reading foreign key constraints for table \"public.door_mode_changed_histories\"\r\npg_dump: reading foreign key constraints for table \"public.durations\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_block_fob_keys\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_block_knight_cards\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_fob_keys\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_invitations\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_knight_keys\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_knight_pins\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_lock_settings\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_locks\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_master_keys\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_resident_guest_keys\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_resident_keys\"\r\npg_dump: reading foreign key constraints for table \"public.family_keys\"\r\npg_dump: reading foreign key constraints for table \"public.fob_keys\"\r\npg_dump: reading foreign key constraints for table \"public.fobs\"\r\npg_dump: reading foreign key constraints for table \"public.guest_keys\"\r\npg_dump: reading foreign key constraints for table \"public.hubs\"\r\npg_dump: reading foreign key constraints for table \"public.invitations\"\r\npg_dump: reading foreign key constraints for table \"public.json_web_keys\"\r\npg_dump: reading foreign key constraints for table \"public.knight_cards\"\r\npg_dump: reading foreign key constraints for table \"public.knight_commands\"\r\npg_dump: reading foreign key constraints for table \"public.knight_keys\"\r\npg_dump: reading foreign key constraints for table \"public.knight_logs\"\r\npg_dump: reading foreign key constraints for table \"public.knight_pins\"\r\npg_dump: reading foreign key constraints for table \"public.knights\"\r\npg_dump: reading foreign key constraints for table \"public.laresia_pins\"\r\npg_dump: reading foreign key constraints for table \"public.lock_settings\"\r\npg_dump: reading foreign key constraints for table \"public.lock_webhook_tokens\"\r\npg_dump: reading foreign key constraints for table \"public.locks\"\r\npg_dump: reading foreign key constraints for table \"public.managers\"\r\npg_dump: reading foreign key constraints for table \"public.master_keys\"\r\npg_dump: reading foreign key constraints for table \"public.mst_display_logs\"\r\npg_dump: reading foreign key constraints for table \"public.relationships\"\r\npg_dump: reading foreign key constraints for table \"public.resident_guest_keys\"\r\npg_dump: reading foreign key constraints for table \"public.resident_keys\"\r\npg_dump: reading foreign key constraints for table \"public.schema_migrations\"\r\npg_dump: reading foreign key constraints for table \"public.term_of_validities\"\r\npg_dump: reading foreign key constraints for table \"public.users\"\r\npg_dump: reading foreign key constraints for table \"public.webhook_tokens\"\r\npg_dump: reading foreign key constraints for table \"public.webhooks\"\r\npg_dump: reading foreign key constraints for table \"public.weeklies\"\r\npg_dump: reading foreign key constraints for table \"public.wena_keys\"\r\npg_dump: reading foreign key constraints for table \"public.wenas\"\r\npg_dump: reading foreign key constraints for table \"bucardo.bucardo_delta_names\"\r\npg_dump: reading triggers\r\npg_dump: reading triggers for table \"public.active_storage_attachments\"\r\npg_dump: reading triggers for table \"public.active_storage_blobs\"\r\npg_dump: reading triggers for table \"public.active_storage_variant_records\"\r\npg_dump: reading triggers for table \"public.ar_internal_metadata\"\r\npg_dump: reading triggers for table \"public.autolock_schedules\"\r\npg_dump: reading triggers for table \"public.cards\"\r\npg_dump: reading triggers for table \"public.command_logs\"\r\npg_dump: reading triggers for table \"public.dailies\"\r\npg_dump: reading triggers for table \"public.door_mode_changed_histories\"\r\npg_dump: reading triggers for table \"public.durations\"\r\npg_dump: reading triggers for table \"public.entrance_block_fob_keys\"\r\npg_dump: reading triggers for table \"public.entrance_block_knight_cards\"\r\npg_dump: reading triggers for table \"public.entrance_fob_keys\"\r\npg_dump: reading triggers for table \"public.entrance_invitations\"\r\npg_dump: reading triggers for table \"public.entrance_knight_keys\"\r\npg_dump: reading triggers for table \"public.entrance_knight_pins\"\r\npg_dump: reading triggers for table \"public.entrance_lock_settings\"\r\npg_dump: reading triggers for table \"public.entrance_locks\"\r\npg_dump: reading triggers for table \"public.entrance_master_keys\"\r\npg_dump: reading triggers for table \"public.entrance_resident_guest_keys\"\r\npg_dump: reading triggers for table \"public.entrance_resident_keys\"\r\npg_dump: reading triggers for table \"public.family_keys\"\r\npg_dump: reading triggers for table \"public.fob_keys\"\r\npg_dump: reading triggers for table \"public.fobs\"\r\npg_dump: reading triggers for table \"public.guest_keys\"\r\npg_dump: reading triggers for table \"public.hubs\"\r\npg_dump: reading triggers for table \"public.invitations\"\r\npg_dump: reading triggers for table \"public.json_web_keys\"\r\npg_dump: reading triggers for table \"public.knight_cards\"\r\npg_dump: reading triggers for table \"public.knight_commands\"\r\npg_dump: reading triggers for table \"public.knight_keys\"\r\npg_dump: reading triggers for table \"public.knight_logs\"\r\npg_dump: reading triggers for table \"public.knight_pins\"\r\npg_dump: reading triggers for table \"public.knights\"\r\npg_dump: reading triggers for table \"public.laresia_pins\"\r\npg_dump: reading triggers for table \"public.lock_settings\"\r\npg_dump: reading triggers for table \"public.lock_webhook_tokens\"\r\npg_dump: reading triggers for table \"public.locks\"\r\npg_dump: reading triggers for table \"public.managers\"\r\npg_dump: reading triggers for table \"public.master_keys\"\r\npg_dump: reading triggers for table \"public.mst_display_logs\"\r\npg_dump: reading triggers for table \"public.relationships\"\r\npg_dump: reading triggers for table \"public.resident_guest_keys\"\r\npg_dump: reading triggers for table \"public.resident_keys\"\r\npg_dump: reading triggers for table \"public.schema_migrations\"\r\npg_dump: reading triggers for table \"public.term_of_validities\"\r\npg_dump: reading triggers for table \"public.users\"\r\npg_dump: reading triggers for table \"public.webhook_tokens\"\r\npg_dump: reading triggers for table \"public.webhooks\"\r\npg_dump: reading triggers for table \"public.weeklies\"\r\npg_dump: reading triggers for table \"public.wena_keys\"\r\npg_dump: reading triggers for table \"public.wenas\"\r\npg_dump: reading triggers for table \"bucardo.bucardo_delta_names\"\r\npg_dump: reading rewrite rules\r\npg_dump: reading policies\r\npg_dump: reading row-level security policies\r\npg_dump: reading publications\r\npg_dump: reading publication membership\r\npg_dump: reading subscriptions\r\npg_dump: reading large objects\r\npg_dump: reading dependency data\r\npg_dump: saving encoding = UTF8\r\npg_dump: saving standard_conforming_strings = on\r\npg_dump: saving search_path = \r\npg_dump: saving database definition\r\npg_dump: dumping contents of table \"bucardo.bucardo_delta_names\"\r\npg_dump: dumping contents of table \"bucardo.bucardo_delta_targets\"\r\npg_dump: dumping contents of table \"bucardo.bucardo_sequences\"\r\npg_dump: dumping contents of table \"bucardo.bucardo_truncate_trigger\"\r\npg_dump: dumping contents of table \"bucardo.bucardo_truncate_trigger_log\"\r\npg_dump: dumping contents of table \"bucardo.delta_public_display_logs\"\r\npg_dump: dumping contents of table \"bucardo.delta_public_logs\"\r\npg_dump: dumping contents of table \"bucardo.stage_public_display_logs\"\r\npg_dump: dumping contents of table \"bucardo.stage_public_logs\"\r\npg_dump: dumping contents of table \"bucardo.track_public_display_logs\"\r\npg_dump: dumping contents of table \"bucardo.track_public_logs\"\r\npg_dump: dumping contents of table \"public.active_storage_blobs\"\r\npg_dump: dumping contents of table \"public.active_storage_attachments\"\r\npg_dump: dumping contents of table \"public.active_storage_variant_records\"\r\npg_dump: dumping contents of table \"public.ar_internal_metadata\"\r\npg_dump: dumping contents of table \"public.locks\"\r\npg_dump: dumping contents of table \"public.users\"\r\npg_dump: dumping contents of table \"public.master_keys\"\r\npg_dump: dumping contents of table \"public.autolock_schedules\"\r\npg_dump: dumping contents of table \"public.cards\"\r\npg_dump: dumping contents of table \"public.hubs\"\r\npg_dump: dumping contents of table \"public.command_logs\"\r\npg_dump: dumping contents of table \"public.term_of_validities\"\r\npg_dump: dumping contents of table \"public.dailies\"\r\npg_dump: dumping contents of table \"public.door_mode_changed_histories\"\r\npg_dump: dumping contents of table \"public.durations\"\r\npg_dump: dumping contents of table \"public.entrance_locks\"\r\npg_dump: dumping contents of table \"public.entrance_master_keys\"\r\npg_dump: dumping contents of table \"public.fobs\"\r\npg_dump: dumping contents of table \"public.fob_keys\"\r\npg_dump: dumping contents of table \"public.entrance_fob_keys\"\r\npg_dump: dumping contents of table \"public.entrance_block_fob_keys\"\r\npg_dump: dumping contents of table \"public.knights\"\r\npg_dump: dumping contents of table \"public.entrance_knight_keys\"\r\npg_dump: dumping contents of table \"public.knight_keys\"\r\npg_dump: dumping contents of table \"public.knight_cards\"\r\npg_dump: dumping contents of table \"public.entrance_block_knight_cards\"\r\npg_dump: dumping contents of table \"public.invitations\"\r\npg_dump: dumping contents of table \"public.entrance_invitations\"\r\npg_dump: dumping contents of table \"public.entrance_knight_pins\"\r\npg_dump: dumping contents of table \"public.entrance_lock_settings\"\r\npg_dump: dumping contents of table \"public.resident_guest_keys\"\r\npg_dump: dumping contents of table \"public.entrance_resident_guest_keys\"\r\npg_dump: dumping contents of table \"public.resident_keys\"\r\npg_dump: dumping contents of table \"public.entrance_resident_keys\"\r\npg_dump: dumping contents of table \"public.family_keys\"\r\npg_dump: dumping contents of table \"public.guest_keys\"\r\npg_dump: dumping contents of table \"public.json_web_keys\"\r\npg_dump: dumping contents of table \"public.knight_commands\"\r\npg_dump: dumping contents of table \"public.knight_logs\"\r\npg_dump: dumping contents of table \"public.knight_pins\"\r\npg_dump: dumping contents of table \"public.laresia_pins\"\r\npg_dump: dumping contents of table \"public.lock_settings\"\r\npg_dump: dumping contents of table \"public.webhook_tokens\"\r\npg_dump: dumping contents of table \"public.lock_webhook_tokens\"\r\npg_dump: dumping contents of table \"public.managers\"\r\npg_dump: dumping contents of table \"public.mst_display_logs\"\r\npg_dump: dumping contents of table \"public.relationships\"\r\npg_dump: dumping contents of table \"public.schema_migrations\"\r\npg_dump: dumping contents of table \"public.webhooks\"\r\npg_dump: dumping contents of table \"public.weeklies\"\r\npg_dump: dumping contents of table \"public.wenas\"\r\npg_dump: dumping contents of table \"public.wena_keys\"\r\n```\r\n\r\n</details>\r\n\r\n#### logs, display_logs以外のrestore\r\n\r\n```sh\r\nroot@d57ada7337a5:/# pg_restore --verbose --data-only -h king-api-cfn-test.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com -d kingapi -U kingadmin -p 5432 main_data.dump\r\n```\r\n\r\n<details>\r\n\r\n\r\n<summary>上記dump同様bucardo.delta_public_(テーブル名)が追跡テーブルのみになった</summary>\r\n\r\n```sh\r\npg_restore: connecting to database for restore\r\npg_restore: processing data for table \"bucardo.bucardo_delta_names\"\r\npg_restore: while PROCESSING TOC:\r\npg_restore: from TOC entry 4968; 0 20221 TABLE DATA bucardo_delta_names uc3938nrsvfra\r\npg_restore: error: could not execute query: ERROR:  schema \"bucardo\" does not exist\r\nCommand was: COPY bucardo.bucardo_delta_names (sync, tablename, deltaname, trackname, cdate) FROM stdin;\r\npg_restore: processing data for table \"bucardo.bucardo_delta_targets\"\r\npg_restore: from TOC entry 4969; 0 20229 TABLE DATA bucardo_delta_targets uc3938nrsvfra\r\npg_restore: error: could not execute query: ERROR:  schema \"bucardo\" does not exist\r\nCommand was: COPY bucardo.bucardo_delta_targets (tablename, target, cdate) FROM stdin;\r\npg_restore: processing data for table \"bucardo.bucardo_sequences\"\r\npg_restore: from TOC entry 4972; 0 20248 TABLE DATA bucardo_sequences uc3938nrsvfra\r\npg_restore: error: could not execute query: ERROR:  schema \"bucardo\" does not exist\r\nCommand was: COPY bucardo.bucardo_sequences (schemaname, seqname, syncname, targetname, last_value, start_value, increment_by, max_value, min_value, is_cycled, is_called) FROM stdin;\r\npg_restore: processing data for table \"bucardo.bucardo_truncate_trigger\"\r\npg_restore: from TOC entry 4970; 0 20235 TABLE DATA bucardo_truncate_trigger uc3938nrsvfra\r\npg_restore: error: could not execute query: ERROR:  schema \"bucardo\" does not exist\r\nCommand was: COPY bucardo.bucardo_truncate_trigger (tablename, sname, tname, sync, replicated, cdate) FROM stdin;\r\npg_restore: processing data for table \"bucardo.bucardo_truncate_trigger_log\"\r\npg_restore: from TOC entry 4971; 0 20242 TABLE DATA bucardo_truncate_trigger_log uc3938nrsvfra\r\npg_restore: error: could not execute query: ERROR:  schema \"bucardo\" does not exist\r\nCommand was: COPY bucardo.bucardo_truncate_trigger_log (tablename, sname, tname, sync, target, replicated, cdate) FROM stdin;\r\npg_restore: processing data for table \"bucardo.delta_public_display_logs\"\r\npg_restore: from TOC entry 4973; 0 20255 TABLE DATA delta_public_display_logs uc3938nrsvfra\r\npg_restore: error: could not execute query: ERROR:  schema \"bucardo\" does not exist\r\nCommand was: COPY bucardo.delta_public_display_logs (id, txntime) FROM stdin;\r\npg_restore: processing data for table \"bucardo.delta_public_logs\"\r\npg_restore: from TOC entry 4976; 0 20277 TABLE DATA delta_public_logs uc3938nrsvfra\r\npg_restore: error: could not execute query: ERROR:  schema \"bucardo\" does not exist\r\nCommand was: COPY bucardo.delta_public_logs (id, txntime) FROM stdin;\r\npg_restore: processing data for table \"bucardo.stage_public_display_logs\"\r\npg_restore: from TOC entry 4975; 0 20269 TABLE DATA stage_public_display_logs uc3938nrsvfra\r\npg_restore: error: could not execute query: ERROR:  schema \"bucardo\" does not exist\r\nCommand was: COPY bucardo.stage_public_display_logs (txntime, target) FROM stdin;\r\npg_restore: processing data for table \"bucardo.stage_public_logs\"\r\npg_restore: from TOC entry 4978; 0 20291 TABLE DATA stage_public_logs uc3938nrsvfra\r\npg_restore: error: could not execute query: ERROR:  schema \"bucardo\" does not exist\r\nCommand was: COPY bucardo.stage_public_logs (txntime, target) FROM stdin;\r\npg_restore: processing data for table \"bucardo.track_public_display_logs\"\r\npg_restore: from TOC entry 4974; 0 20263 TABLE DATA track_public_display_logs uc3938nrsvfra\r\npg_restore: error: could not execute query: ERROR:  schema \"bucardo\" does not exist\r\nCommand was: COPY bucardo.track_public_display_logs (txntime, target) FROM stdin;\r\npg_restore: processing data for table \"bucardo.track_public_logs\"\r\npg_restore: from TOC entry 4977; 0 20285 TABLE DATA track_public_logs uc3938nrsvfra\r\npg_restore: error: could not execute query: ERROR:  schema \"bucardo\" does not exist\r\nCommand was: COPY bucardo.track_public_logs (txntime, target) FROM stdin;\r\npg_restore: processing data for table \"public.active_storage_blobs\"\r\npg_restore: processing data for table \"public.active_storage_attachments\"\r\npg_restore: processing data for table \"public.active_storage_variant_records\"\r\npg_restore: processing data for table \"public.ar_internal_metadata\"\r\npg_restore: processing data for table \"public.locks\"\r\npg_restore: processing data for table \"public.users\"\r\npg_restore: processing data for table \"public.master_keys\"\r\npg_restore: processing data for table \"public.autolock_schedules\"\r\npg_restore: processing data for table \"public.cards\"\r\npg_restore: processing data for table \"public.hubs\"\r\npg_restore: processing data for table \"public.command_logs\"\r\npg_restore: processing data for table \"public.term_of_validities\"\r\npg_restore: processing data for table \"public.dailies\"\r\npg_restore: processing data for table \"public.door_mode_changed_histories\"\r\npg_restore: processing data for table \"public.durations\"\r\npg_restore: processing data for table \"public.entrance_locks\"\r\npg_restore: processing data for table \"public.entrance_master_keys\"\r\npg_restore: processing data for table \"public.fobs\"\r\npg_restore: processing data for table \"public.fob_keys\"\r\npg_restore: processing data for table \"public.entrance_fob_keys\"\r\npg_restore: processing data for table \"public.entrance_block_fob_keys\"\r\npg_restore: processing data for table \"public.knights\"\r\npg_restore: processing data for table \"public.entrance_knight_keys\"\r\npg_restore: processing data for table \"public.knight_keys\"\r\npg_restore: processing data for table \"public.knight_cards\"\r\npg_restore: processing data for table \"public.entrance_block_knight_cards\"\r\npg_restore: processing data for table \"public.invitations\"\r\npg_restore: processing data for table \"public.entrance_invitations\"\r\npg_restore: processing data for table \"public.entrance_knight_pins\"\r\npg_restore: processing data for table \"public.entrance_lock_settings\"\r\npg_restore: processing data for table \"public.resident_guest_keys\"\r\npg_restore: processing data for table \"public.entrance_resident_guest_keys\"\r\npg_restore: processing data for table \"public.resident_keys\"\r\npg_restore: processing data for table \"public.entrance_resident_keys\"\r\npg_restore: processing data for table \"public.family_keys\"\r\npg_restore: processing data for table \"public.guest_keys\"\r\npg_restore: processing data for table \"public.json_web_keys\"\r\npg_restore: processing data for table \"public.knight_commands\"\r\npg_restore: processing data for table \"public.knight_logs\"\r\npg_restore: processing data for table \"public.knight_pins\"\r\npg_restore: processing data for table \"public.laresia_pins\"\r\npg_restore: processing data for table \"public.lock_settings\"\r\npg_restore: processing data for table \"public.webhook_tokens\"\r\npg_restore: processing data for table \"public.lock_webhook_tokens\"\r\npg_restore: processing data for table \"public.managers\"\r\npg_restore: processing data for table \"public.mst_display_logs\"\r\npg_restore: processing data for table \"public.relationships\"\r\npg_restore: processing data for table \"public.schema_migrations\"\r\npg_restore: processing data for table \"public.webhooks\"\r\npg_restore: processing data for table \"public.weeklies\"\r\npg_restore: processing data for table \"public.wenas\"\r\npg_restore: processing data for table \"public.wena_keys\"\r\npg_restore: executing SEQUENCE SET active_storage_attachments_id_seq\r\npg_restore: executing SEQUENCE SET active_storage_blobs_id_seq\r\npg_restore: executing SEQUENCE SET active_storage_variant_records_id_seq\r\npg_restore: executing SEQUENCE SET json_web_keys_id_seq\r\npg_restore: warning: errors ignored on restore: 11\r\n```\r\n\r\n\r\n</details>",
    "body_html": "<p data-sourcepos=\"1:1-1:72\">Copied from: <a href=\"/posts/1587\">Users/杉山/session_replication_role実験1</a></p>\n<h2 data-sourcepos=\"3:1-3:10\" id=\"0-1-0\" name=\"0-1-0\"><a class=\"anchor\" id=\"実験2\" name=\"実験2\" href=\"#実験2\" data-position=\"0-1-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"実験2\"> &gt; 実験2</span></a>実験2</h2>\n<h3 data-sourcepos=\"4:1-4:28\" id=\"0-1-1\" name=\"0-1-1\"><a class=\"anchor\" id=\"前回との実施差分\" name=\"前回との実施差分\" href=\"#前回との実施差分\" data-position=\"0-1-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"前回との実施差分\"> &gt; 前回との実施差分</span></a>前回との実施差分</h3>\n<ul data-sourcepos=\"5:1-7:0\">\n<li data-sourcepos=\"5:1-5:160\">Heroku(sl2-api-db-migration-test)DBからbucardoスキーマを削除した状態で05スクリプトでテーブルスキーマのdump/restoreを行なった</li>\n<li data-sourcepos=\"6:1-7:0\">logs, display_logsのrestoreの際に<code>--disable-triggers</code>を除外した</li>\n</ul>\n<h3 data-sourcepos=\"8:1-8:16\" id=\"0-1-2\" name=\"0-1-2\"><a class=\"anchor\" id=\"結果差分\" name=\"結果差分\" href=\"#結果差分\" data-position=\"0-1-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"結果差分\"> &gt; 結果差分</span></a>結果差分</h3>\n<h4 data-sourcepos=\"9:1-9:45\">logs, display_logsテーブルのrestore</h4>\n<ul data-sourcepos=\"10:1-11:74\">\n<li data-sourcepos=\"10:1-11:74\">成功した\n<ul data-sourcepos=\"11:5-11:74\">\n<li data-sourcepos=\"11:5-11:74\"><code>--disable-triggers</code>オプションを消して実行、無事成功</li>\n</ul></li>\n</ul>\n<h4 data-sourcepos=\"12:1-12:24\">main_dataのrestore</h4>\n<ul data-sourcepos=\"13:1-15:67\">\n<li data-sourcepos=\"13:1-15:67\">成功した\n<ul data-sourcepos=\"14:5-15:67\">\n<li data-sourcepos=\"14:5-14:198\">以前の検証環境でのbucardoスキーマを削除したのでbucardoスキーマが存在しない状態でテーブル情報のdump/restoreを行なった→bucardoの設定に進んだ</li>\n<li data-sourcepos=\"15:5-15:67\">Auroraにはbucardoのスキーマがない状態ができた</li>\n</ul></li>\n</ul>\n<h3 data-sourcepos=\"16:1-16:16\" id=\"0-1-3\" name=\"0-1-3\"><a class=\"anchor\" id=\"結果詳細\" name=\"結果詳細\" href=\"#結果詳細\" data-position=\"0-1-3\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"結果詳細\"> &gt; 結果詳細</span></a>結果詳細</h3>\n<h4 data-sourcepos=\"17:1-17:38\">初期のsession_replication_role</h4>\n<ul data-sourcepos=\"18:1-19:0\">\n<li data-sourcepos=\"18:1-19:0\">origin</li>\n</ul>\n<h4 data-sourcepos=\"20:1-20:89\">session_replication_roleをパラメータグループから変更した際の挙動</h4>\n<ul data-sourcepos=\"21:1-22:51\">\n<li data-sourcepos=\"21:1-21:14\">成功した</li>\n<li data-sourcepos=\"22:1-22:51\">session_replication_roleがreplicaに変わった</li>\n</ul>\n<h4 data-sourcepos=\"23:1-23:53\">logs, display_logsテーブルのrestore(上述)</h4>\n<ul data-sourcepos=\"24:1-25:74\">\n<li data-sourcepos=\"24:1-25:74\">成功した\n<ul data-sourcepos=\"25:5-25:74\">\n<li data-sourcepos=\"25:5-25:74\"><code>--disable-triggers</code>オプションを消して実行、無事成功</li>\n</ul></li>\n</ul>\n<h4 data-sourcepos=\"26:1-26:86\">session_replication_roleをパラメータグループから戻した際の挙動</h4>\n<ul data-sourcepos=\"27:1-28:47\">\n<li data-sourcepos=\"27:1-27:14\">成功した</li>\n<li data-sourcepos=\"28:1-28:47\">session_replication_roleがoriginに戻った</li>\n</ul>\n<h4 data-sourcepos=\"29:1-29:32\">main_dataのrestore(上述)</h4>\n<ul data-sourcepos=\"30:1-33:0\">\n<li data-sourcepos=\"30:1-33:0\">成功した\n<ul data-sourcepos=\"31:5-33:0\">\n<li data-sourcepos=\"31:5-31:198\">以前の検証環境でのbucardoスキーマを削除したのでbucardoスキーマが存在しない状態でテーブル情報のdump/restoreを行なった→bucardoの設定に進んだ</li>\n<li data-sourcepos=\"32:5-33:0\">Auroraにはbucardoのスキーマがない状態ができた</li>\n</ul></li>\n</ul>\n<h3 data-sourcepos=\"34:1-34:10\" id=\"0-1-4\" name=\"0-1-4\"><a class=\"anchor\" id=\"内容\" name=\"内容\" href=\"#内容\" data-position=\"0-1-4\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"内容\"> &gt; 内容</span></a>内容</h3>\n<h4 data-sourcepos=\"36:1-36:35\">やり直しのため再構成</h4>\n<p data-sourcepos=\"38:1-41:58\">Auroraのschema全削除<br>\nAuroraにpublicスキーマ作成<br>\nBucardoの同期系データ全削除<br>\nsl2-api-db-migration-testのdbのbucardoスキーマ削除</p>\n<p data-sourcepos=\"43:1-43:62\">rm -rf main_data.dump logs_displaylogs.dump heroku_tables.dump</p>\n<p data-sourcepos=\"46:1-46:206\"><a href=\"https://docs.google.com/spreadsheets/d/1W3DymCJ_ifiXtSUwVAjcl9tzPGfz5WE6bmnnwYL9Gbo/edit#gid=602303325\" target=\"_blank\" rel=\"noopener noreferrer\">移行手順書</a>のBucardoの設定、データプールの開始まで終わっている状態以降</p>\n<h4 data-sourcepos=\"48:1-48:31\">logsとdisplay_logsのdump</h4>\n<div class=\"code-block\" data-sourcepos=\"50:1-52:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>pg_dump <span class=\"nt\">--format</span><span class=\"o\">=</span>custom <span class=\"nt\">--verbose</span> <span class=\"nt\">--data-only</span> <span class=\"nt\">--table</span><span class=\"o\">=</span>logs <span class=\"nt\">--table</span><span class=\"o\">=</span>display_logs <span class=\"nt\">-h</span> vpce-0e9251c411c13ce7a-zursyjry.vpce-svc-08edb438435192caf.ap-northeast-1.vpce.amazonaws.com <span class=\"nt\">-p</span> 5432 <span class=\"nt\">-d</span> d6ci42p2305kgu <span class=\"nt\">-U</span> uc3938nrsvfra <span class=\"o\">&gt;</span> logs_displaylogs.dump\n</code></pre></div></div>\n<details>\n<div class=\"code-block\" data-sourcepos=\"55:1-112:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>pg_dump: last built-in OID is 16383\npg_dump: reading extensions\npg_dump: identifying extension members\npg_dump: reading schemas\npg_dump: reading user-defined tables\npg_dump: reading user-defined functions\npg_dump: reading user-defined types\npg_dump: reading procedural languages\npg_dump: reading user-defined aggregate functions\npg_dump: reading user-defined operators\npg_dump: reading user-defined access methods\npg_dump: reading user-defined operator classes\npg_dump: reading user-defined operator families\npg_dump: reading user-defined text search parsers\npg_dump: reading user-defined text search templates\npg_dump: reading user-defined text search dictionaries\npg_dump: reading user-defined text search configurations\npg_dump: reading user-defined foreign-data wrappers\npg_dump: reading user-defined foreign servers\npg_dump: reading default privileges\npg_dump: reading user-defined collations\npg_dump: reading user-defined conversions\npg_dump: reading <span class=\"nb\">type </span>casts\npg_dump: reading transforms\npg_dump: reading table inheritance information\npg_dump: reading event triggers\npg_dump: finding extension tables\npg_dump: finding inheritance relationships\npg_dump: reading column info <span class=\"k\">for </span>interesting tables\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.display_logs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.logs\"</span>\npg_dump: flagging inherited columns <span class=\"k\">in </span>subtables\npg_dump: reading indexes\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.display_logs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.logs\"</span>\npg_dump: flagging indexes <span class=\"k\">in </span>partitioned tables\npg_dump: reading extended statistics\npg_dump: reading constraints\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.display_logs\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.logs\"</span>\npg_dump: reading triggers\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.display_logs\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.logs\"</span>\npg_dump: reading rewrite rules\npg_dump: reading policies\npg_dump: reading row-level security policies\npg_dump: reading publications\npg_dump: reading publication membership\npg_dump: reading subscriptions\npg_dump: reading dependency data\npg_dump: saving encoding <span class=\"o\">=</span> UTF8\npg_dump: saving standard_conforming_strings <span class=\"o\">=</span> on\npg_dump: saving search_path <span class=\"o\">=</span> \npg_dump: saving database definition\npg_dump: dumping contents of table <span class=\"s2\">\"public.display_logs\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.logs\"</span>\n</code></pre></div></div>\n</details>\n<h4 data-sourcepos=\"116:1-116:47\">session_replication_roleの初期値確認</h4>\n<div class=\"code-block\" data-sourcepos=\"118:1-124:3\"><div class=\"highlight\"><pre class=\"highlight plaintext\"><code>kingapi=&gt; show session_replication_role;\n session_replication_role \n--------------------------\n origin\n(1 row)\n</code></pre></div></div>\n<h4 data-sourcepos=\"126:1-126:58\">新手順 session_replication_roleをreplicaにする</h4>\n<p data-sourcepos=\"128:1-129:205\">DBクラスタの「変更」からDBクラスターのパラメータグループをking-api-cfn-test-parametergroup-copyを選択<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/03/31/136273/e97852dc-18e0-4e32-86d2-bf4d94afd72c.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"799\" alt=\"スクリーンショット 2023-03-31 13.58.48.png (51.5 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/03/31/136273/e97852dc-18e0-4e32-86d2-bf4d94afd72c.png\"></a></p>\n<p data-sourcepos=\"131:1-133:204\">変更を「すぐに適用」する<br>\n適用できた<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/03/31/136273/3bd7096d-ed86-4b37-bd4e-7803ff27986a.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"209\" alt=\"スクリーンショット 2023-03-31 13.59.55.png (9.9 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/03/31/136273/3bd7096d-ed86-4b37-bd4e-7803ff27986a.png\"></a></p>\n<h4 data-sourcepos=\"136:1-136:50\">session_replication_roleの変更適用確認</h4>\n<div class=\"code-block\" data-sourcepos=\"137:1-143:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code><span class=\"nv\">kingapi</span><span class=\"o\">=&gt;</span> show session_replication_role<span class=\"p\">;</span>\n session_replication_role \n<span class=\"nt\">--------------------------</span>\n replica\n<span class=\"o\">(</span>1 row<span class=\"o\">)</span>\n</code></pre></div></div>\n<p data-sourcepos=\"144:1-144:83\">ちなみに、psql接続を続けた状態でもreplicaに変更が反映できた</p>\n<h4 data-sourcepos=\"146:1-146:33\">logs, display_logsのrestore</h4>\n<p data-sourcepos=\"147:1-147:53\">今回は<code>--disable-triggers</code>を除外している。</p>\n<div class=\"code-block\" data-sourcepos=\"149:1-151:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>root@d57ada7337a5:/# pg_restore <span class=\"nt\">--verbose</span> <span class=\"nt\">--data-only</span> <span class=\"nt\">-h</span> king-api-cfn-test.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com <span class=\"nt\">-U</span> kingadmin <span class=\"nt\">-d</span> kingapi <span class=\"nt\">-p</span> 5432 logs_displaylogs.dump\n</code></pre></div></div>\n<details>\n<summary>エラーなしで成功</summary>\n<div class=\"code-block\" data-sourcepos=\"157:1-162:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>pg_restore <span class=\"nt\">--verbose</span> <span class=\"nt\">--data-only</span> <span class=\"nt\">-h</span> king-api-cfn-test.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com <span class=\"nt\">-U</span> kingadmin <span class=\"nt\">-d</span> kingapi <span class=\"nt\">-p</span> 5432 logs_displaylogs.dump\npg_restore: connecting to database <span class=\"k\">for </span>restore\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.display_logs\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.logs\"</span>\n</code></pre></div></div>\n</details>\n<h4 data-sourcepos=\"166:1-166:17\">行数確認</h4>\n<p data-sourcepos=\"167:1-167:18\">同数となった</p>\n<div class=\"code-block\" data-sourcepos=\"168:1-182:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sql</div><div class=\"highlight\"><pre class=\"highlight sql\"><code><span class=\"n\">kingapi</span><span class=\"o\">=&gt;</span> <span class=\"k\">select</span> <span class=\"k\">count</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"p\">)</span> <span class=\"k\">from</span> <span class=\"n\">logs</span><span class=\"p\">;</span>\n <span class=\"k\">count</span> \n<span class=\"c1\">-------</span>\n <span class=\"mi\">23759</span>\n<span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"k\">row</span><span class=\"p\">)</span>\n\n<span class=\"n\">kingapi</span><span class=\"o\">=&gt;</span> <span class=\"k\">select</span> <span class=\"k\">count</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"p\">)</span> <span class=\"k\">from</span> <span class=\"n\">display_logs</span><span class=\"p\">;</span>\n <span class=\"k\">count</span> \n<span class=\"c1\">-------</span>\n  <span class=\"mi\">1125</span>\n<span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"k\">row</span><span class=\"p\">)</span>\n\n<span class=\"n\">kingapi</span><span class=\"o\">=&gt;</span> \n</code></pre></div></div>\n<div class=\"code-block\" data-sourcepos=\"184:1-198:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sql</div><div class=\"highlight\"><pre class=\"highlight sql\"><code><span class=\"n\">sl2</span><span class=\"o\">-</span><span class=\"n\">api</span><span class=\"o\">-</span><span class=\"n\">db</span><span class=\"o\">-</span><span class=\"n\">migration</span><span class=\"o\">-</span><span class=\"n\">test</span><span class=\"p\">::</span><span class=\"k\">DATABASE</span><span class=\"o\">=&gt;</span> <span class=\"k\">select</span> <span class=\"k\">count</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"p\">)</span> <span class=\"k\">from</span> <span class=\"n\">logs</span><span class=\"p\">;</span>\n <span class=\"k\">count</span>\n<span class=\"c1\">-------</span>\n <span class=\"mi\">23759</span>\n<span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"k\">row</span><span class=\"p\">)</span>\n\n<span class=\"n\">sl2</span><span class=\"o\">-</span><span class=\"n\">api</span><span class=\"o\">-</span><span class=\"n\">db</span><span class=\"o\">-</span><span class=\"n\">migration</span><span class=\"o\">-</span><span class=\"n\">test</span><span class=\"p\">::</span><span class=\"k\">DATABASE</span><span class=\"o\">=&gt;</span> <span class=\"k\">select</span> <span class=\"k\">count</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"p\">)</span> <span class=\"k\">from</span> <span class=\"n\">display_logs</span><span class=\"p\">;</span>\n <span class=\"k\">count</span>\n<span class=\"c1\">-------</span>\n  <span class=\"mi\">1125</span>\n<span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"k\">row</span><span class=\"p\">)</span>\n\n<span class=\"n\">sl2</span><span class=\"o\">-</span><span class=\"n\">api</span><span class=\"o\">-</span><span class=\"n\">db</span><span class=\"o\">-</span><span class=\"n\">migration</span><span class=\"o\">-</span><span class=\"n\">test</span><span class=\"p\">::</span><span class=\"k\">DATABASE</span><span class=\"o\">=&gt;</span>\n</code></pre></div></div>\n<h4 data-sourcepos=\"200:1-200:41\">パラメータグループを戻す</h4>\n<p data-sourcepos=\"201:1-202:205\">先ほどと同様に、パラメータグループを元々ついていたものに戻す<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/03/31/136273/cee6ce7d-ca7b-4134-9bf1-6f49e829c008.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"764\" alt=\"スクリーンショット 2023-03-31 12.46.09.png (62.7 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/03/31/136273/cee6ce7d-ca7b-4134-9bf1-6f49e829c008.png\"></a></p>\n<h4 data-sourcepos=\"204:1-204:35\">session_replication_role確認</h4>\n<p data-sourcepos=\"205:1-205:30\">こちらも変わらず成功</p>\n<div class=\"code-block\" data-sourcepos=\"206:1-212:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code><span class=\"nv\">kingapi</span><span class=\"o\">=&gt;</span> show session_replication_role<span class=\"p\">;</span>\n session_replication_role \n<span class=\"nt\">--------------------------</span>\n origin\n<span class=\"o\">(</span>1 row<span class=\"o\">)</span>\n</code></pre></div></div>\n<h4 data-sourcepos=\"214:1-214:36\">logs, display_logs以外のdump</h4>\n<div class=\"code-block\" data-sourcepos=\"216:1-218:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>root@d57ada7337a5:/# pg_dump <span class=\"nt\">--format</span><span class=\"o\">=</span>custom <span class=\"nt\">--verbose</span> <span class=\"nt\">--data-only</span> <span class=\"nt\">--exclude-table</span><span class=\"o\">=</span>logs <span class=\"nt\">--exclude-table</span><span class=\"o\">=</span>display_logs <span class=\"nt\">-h</span> vpce-0e9251c411c13ce7a-zursyjry.vpce-svc-08edb438435192caf.ap-northeast-1.vpce.amazonaws.com <span class=\"nt\">-d</span> d6ci42p2305kgu <span class=\"nt\">-U</span> uc3938nrsvfra <span class=\"nt\">-p</span> 5432 <span class=\"o\">&gt;</span>main_data.dump\n</code></pre></div></div>\n<details>\n<summary>bucardo.delta_public_(テーブル名)などがlogsとdisplaylogsのみになった</summary>\n<div class=\"code-block\" data-sourcepos=\"224:1-566:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>pg_dump: last built-in OID is 16383\npg_dump: reading extensions\npg_dump: identifying extension members\npg_dump: reading schemas\npg_dump: reading user-defined tables\npg_dump: reading user-defined functions\npg_dump: reading user-defined types\npg_dump: reading procedural languages\npg_dump: reading user-defined aggregate functions\npg_dump: reading user-defined operators\npg_dump: reading user-defined access methods\npg_dump: reading user-defined operator classes\npg_dump: reading user-defined operator families\npg_dump: reading user-defined text search parsers\npg_dump: reading user-defined text search templates\npg_dump: reading user-defined text search dictionaries\npg_dump: reading user-defined text search configurations\npg_dump: reading user-defined foreign-data wrappers\npg_dump: reading user-defined foreign servers\npg_dump: reading default privileges\npg_dump: reading user-defined collations\npg_dump: reading user-defined conversions\npg_dump: reading <span class=\"nb\">type </span>casts\npg_dump: reading transforms\npg_dump: reading table inheritance information\npg_dump: reading event triggers\npg_dump: finding extension tables\npg_dump: finding inheritance relationships\npg_dump: reading column info <span class=\"k\">for </span>interesting tables\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.pg_stat_statements_info\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.pg_stat_statements\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.active_storage_attachments\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.active_storage_blobs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.active_storage_variant_records\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.ar_internal_metadata\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.autolock_schedules\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.cards\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.command_logs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.dailies\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.door_mode_changed_histories\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.durations\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.entrance_block_fob_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.entrance_block_knight_cards\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.entrance_fob_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.entrance_invitations\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.entrance_knight_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.entrance_knight_pins\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.entrance_lock_settings\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.entrance_locks\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.entrance_master_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.entrance_resident_guest_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.entrance_resident_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.family_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.fob_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.fobs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.guest_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.hubs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.invitations\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.json_web_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.knight_cards\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.knight_commands\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.knight_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.knight_logs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.knight_pins\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.knights\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.laresia_pins\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.lock_settings\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.lock_webhook_tokens\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.locks\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.managers\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.master_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.mst_display_logs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.relationships\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.resident_guest_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.resident_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.schema_migrations\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.term_of_validities\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.users\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.webhook_tokens\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.webhooks\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.weeklies\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.wena_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.wenas\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.bucardo_delta_names\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.bucardo_delta_targets\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.bucardo_truncate_trigger\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.bucardo_truncate_trigger_log\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.bucardo_sequences\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.delta_public_display_logs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.track_public_display_logs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.stage_public_display_logs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.delta_public_logs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.track_public_logs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.stage_public_logs\"</span>\npg_dump: flagging inherited columns <span class=\"k\">in </span>subtables\npg_dump: reading indexes\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.active_storage_attachments\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.active_storage_blobs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.active_storage_variant_records\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.ar_internal_metadata\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.autolock_schedules\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.cards\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.command_logs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.dailies\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.door_mode_changed_histories\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.durations\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_block_fob_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_block_knight_cards\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_fob_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_invitations\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_knight_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_knight_pins\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_lock_settings\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_locks\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_master_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_resident_guest_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_resident_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.family_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.fob_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.fobs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.guest_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.hubs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.invitations\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.json_web_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_cards\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_commands\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_logs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_pins\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.knights\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.laresia_pins\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.lock_settings\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.lock_webhook_tokens\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.locks\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.managers\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.master_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.mst_display_logs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.relationships\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.resident_guest_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.resident_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.schema_migrations\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.term_of_validities\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.users\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.webhook_tokens\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.webhooks\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.weeklies\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.wena_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.wenas\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.bucardo_delta_names\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.bucardo_delta_targets\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.bucardo_truncate_trigger\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.bucardo_sequences\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_display_logs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_display_logs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_logs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_logs\"</span>\npg_dump: flagging indexes <span class=\"k\">in </span>partitioned tables\npg_dump: reading extended statistics\npg_dump: reading constraints\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.active_storage_attachments\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.active_storage_blobs\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.active_storage_variant_records\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.ar_internal_metadata\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.autolock_schedules\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.cards\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.command_logs\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.dailies\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.door_mode_changed_histories\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.durations\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_block_fob_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_block_knight_cards\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_fob_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_invitations\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_knight_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_knight_pins\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_lock_settings\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_locks\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_master_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_resident_guest_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_resident_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.family_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.fob_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.fobs\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.guest_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.hubs\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.invitations\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.json_web_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_cards\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_commands\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_logs\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_pins\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.knights\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.laresia_pins\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.lock_settings\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.lock_webhook_tokens\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.locks\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.managers\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.master_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.mst_display_logs\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.relationships\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.resident_guest_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.resident_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.schema_migrations\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.term_of_validities\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.users\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.webhook_tokens\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.webhooks\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.weeklies\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.wena_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.wenas\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.bucardo_delta_names\"</span>\npg_dump: reading triggers\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.active_storage_attachments\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.active_storage_blobs\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.active_storage_variant_records\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.ar_internal_metadata\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.autolock_schedules\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.cards\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.command_logs\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.dailies\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.door_mode_changed_histories\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.durations\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_block_fob_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_block_knight_cards\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_fob_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_invitations\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_knight_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_knight_pins\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_lock_settings\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_locks\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_master_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_resident_guest_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_resident_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.family_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.fob_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.fobs\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.guest_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.hubs\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.invitations\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.json_web_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_cards\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_commands\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_logs\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_pins\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.knights\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.laresia_pins\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.lock_settings\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.lock_webhook_tokens\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.locks\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.managers\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.master_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.mst_display_logs\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.relationships\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.resident_guest_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.resident_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.schema_migrations\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.term_of_validities\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.users\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.webhook_tokens\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.webhooks\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.weeklies\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.wena_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.wenas\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.bucardo_delta_names\"</span>\npg_dump: reading rewrite rules\npg_dump: reading policies\npg_dump: reading row-level security policies\npg_dump: reading publications\npg_dump: reading publication membership\npg_dump: reading subscriptions\npg_dump: reading large objects\npg_dump: reading dependency data\npg_dump: saving encoding <span class=\"o\">=</span> UTF8\npg_dump: saving standard_conforming_strings <span class=\"o\">=</span> on\npg_dump: saving search_path <span class=\"o\">=</span> \npg_dump: saving database definition\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.bucardo_delta_names\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.bucardo_delta_targets\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.bucardo_sequences\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.bucardo_truncate_trigger\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.bucardo_truncate_trigger_log\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.delta_public_display_logs\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.delta_public_logs\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.stage_public_display_logs\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.stage_public_logs\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.track_public_display_logs\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.track_public_logs\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.active_storage_blobs\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.active_storage_attachments\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.active_storage_variant_records\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.ar_internal_metadata\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.locks\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.users\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.master_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.autolock_schedules\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.cards\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.hubs\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.command_logs\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.term_of_validities\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.dailies\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.door_mode_changed_histories\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.durations\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.entrance_locks\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.entrance_master_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.fobs\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.fob_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.entrance_fob_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.entrance_block_fob_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.knights\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.entrance_knight_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.knight_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.knight_cards\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.entrance_block_knight_cards\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.invitations\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.entrance_invitations\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.entrance_knight_pins\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.entrance_lock_settings\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.resident_guest_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.entrance_resident_guest_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.resident_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.entrance_resident_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.family_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.guest_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.json_web_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.knight_commands\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.knight_logs\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.knight_pins\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.laresia_pins\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.lock_settings\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.webhook_tokens\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.lock_webhook_tokens\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.managers\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.mst_display_logs\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.relationships\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.schema_migrations\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.webhooks\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.weeklies\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.wenas\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.wena_keys\"</span>\n</code></pre></div></div>\n</details>\n<h4 data-sourcepos=\"570:1-570:39\">logs, display_logs以外のrestore</h4>\n<div class=\"code-block\" data-sourcepos=\"572:1-574:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>root@d57ada7337a5:/# pg_restore <span class=\"nt\">--verbose</span> <span class=\"nt\">--data-only</span> <span class=\"nt\">-h</span> king-api-cfn-test.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com <span class=\"nt\">-d</span> kingapi <span class=\"nt\">-U</span> kingadmin <span class=\"nt\">-p</span> 5432 main_data.dump\n</code></pre></div></div>\n<details>\n<summary>上記dump同様bucardo.delta_public_(テーブル名)が追跡テーブルのみになった</summary>\n<div class=\"code-block\" data-sourcepos=\"581:1-685:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>pg_restore: connecting to database <span class=\"k\">for </span>restore\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.bucardo_delta_names\"</span>\npg_restore: <span class=\"k\">while </span>PROCESSING TOC:\npg_restore: from TOC entry 4968<span class=\"p\">;</span> 0 20221 TABLE DATA bucardo_delta_names uc3938nrsvfra\npg_restore: error: could not execute query: ERROR:  schema <span class=\"s2\">\"bucardo\"</span> does not exist\nCommand was: COPY bucardo.bucardo_delta_names <span class=\"o\">(</span><span class=\"nb\">sync</span>, tablename, deltaname, trackname, cdate<span class=\"o\">)</span> FROM stdin<span class=\"p\">;</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.bucardo_delta_targets\"</span>\npg_restore: from TOC entry 4969<span class=\"p\">;</span> 0 20229 TABLE DATA bucardo_delta_targets uc3938nrsvfra\npg_restore: error: could not execute query: ERROR:  schema <span class=\"s2\">\"bucardo\"</span> does not exist\nCommand was: COPY bucardo.bucardo_delta_targets <span class=\"o\">(</span>tablename, target, cdate<span class=\"o\">)</span> FROM stdin<span class=\"p\">;</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.bucardo_sequences\"</span>\npg_restore: from TOC entry 4972<span class=\"p\">;</span> 0 20248 TABLE DATA bucardo_sequences uc3938nrsvfra\npg_restore: error: could not execute query: ERROR:  schema <span class=\"s2\">\"bucardo\"</span> does not exist\nCommand was: COPY bucardo.bucardo_sequences <span class=\"o\">(</span>schemaname, seqname, syncname, targetname, last_value, start_value, increment_by, max_value, min_value, is_cycled, is_called<span class=\"o\">)</span> FROM stdin<span class=\"p\">;</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.bucardo_truncate_trigger\"</span>\npg_restore: from TOC entry 4970<span class=\"p\">;</span> 0 20235 TABLE DATA bucardo_truncate_trigger uc3938nrsvfra\npg_restore: error: could not execute query: ERROR:  schema <span class=\"s2\">\"bucardo\"</span> does not exist\nCommand was: COPY bucardo.bucardo_truncate_trigger <span class=\"o\">(</span>tablename, sname, tname, <span class=\"nb\">sync</span>, replicated, cdate<span class=\"o\">)</span> FROM stdin<span class=\"p\">;</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.bucardo_truncate_trigger_log\"</span>\npg_restore: from TOC entry 4971<span class=\"p\">;</span> 0 20242 TABLE DATA bucardo_truncate_trigger_log uc3938nrsvfra\npg_restore: error: could not execute query: ERROR:  schema <span class=\"s2\">\"bucardo\"</span> does not exist\nCommand was: COPY bucardo.bucardo_truncate_trigger_log <span class=\"o\">(</span>tablename, sname, tname, <span class=\"nb\">sync</span>, target, replicated, cdate<span class=\"o\">)</span> FROM stdin<span class=\"p\">;</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_display_logs\"</span>\npg_restore: from TOC entry 4973<span class=\"p\">;</span> 0 20255 TABLE DATA delta_public_display_logs uc3938nrsvfra\npg_restore: error: could not execute query: ERROR:  schema <span class=\"s2\">\"bucardo\"</span> does not exist\nCommand was: COPY bucardo.delta_public_display_logs <span class=\"o\">(</span><span class=\"nb\">id</span>, txntime<span class=\"o\">)</span> FROM stdin<span class=\"p\">;</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_logs\"</span>\npg_restore: from TOC entry 4976<span class=\"p\">;</span> 0 20277 TABLE DATA delta_public_logs uc3938nrsvfra\npg_restore: error: could not execute query: ERROR:  schema <span class=\"s2\">\"bucardo\"</span> does not exist\nCommand was: COPY bucardo.delta_public_logs <span class=\"o\">(</span><span class=\"nb\">id</span>, txntime<span class=\"o\">)</span> FROM stdin<span class=\"p\">;</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.stage_public_display_logs\"</span>\npg_restore: from TOC entry 4975<span class=\"p\">;</span> 0 20269 TABLE DATA stage_public_display_logs uc3938nrsvfra\npg_restore: error: could not execute query: ERROR:  schema <span class=\"s2\">\"bucardo\"</span> does not exist\nCommand was: COPY bucardo.stage_public_display_logs <span class=\"o\">(</span>txntime, target<span class=\"o\">)</span> FROM stdin<span class=\"p\">;</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.stage_public_logs\"</span>\npg_restore: from TOC entry 4978<span class=\"p\">;</span> 0 20291 TABLE DATA stage_public_logs uc3938nrsvfra\npg_restore: error: could not execute query: ERROR:  schema <span class=\"s2\">\"bucardo\"</span> does not exist\nCommand was: COPY bucardo.stage_public_logs <span class=\"o\">(</span>txntime, target<span class=\"o\">)</span> FROM stdin<span class=\"p\">;</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_display_logs\"</span>\npg_restore: from TOC entry 4974<span class=\"p\">;</span> 0 20263 TABLE DATA track_public_display_logs uc3938nrsvfra\npg_restore: error: could not execute query: ERROR:  schema <span class=\"s2\">\"bucardo\"</span> does not exist\nCommand was: COPY bucardo.track_public_display_logs <span class=\"o\">(</span>txntime, target<span class=\"o\">)</span> FROM stdin<span class=\"p\">;</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_logs\"</span>\npg_restore: from TOC entry 4977<span class=\"p\">;</span> 0 20285 TABLE DATA track_public_logs uc3938nrsvfra\npg_restore: error: could not execute query: ERROR:  schema <span class=\"s2\">\"bucardo\"</span> does not exist\nCommand was: COPY bucardo.track_public_logs <span class=\"o\">(</span>txntime, target<span class=\"o\">)</span> FROM stdin<span class=\"p\">;</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.active_storage_blobs\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.active_storage_attachments\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.active_storage_variant_records\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.ar_internal_metadata\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.locks\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.users\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.master_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.autolock_schedules\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.cards\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.hubs\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.command_logs\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.term_of_validities\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.dailies\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.door_mode_changed_histories\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.durations\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_locks\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_master_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.fobs\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.fob_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_fob_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_block_fob_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.knights\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_knight_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_cards\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_block_knight_cards\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.invitations\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_invitations\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_knight_pins\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_lock_settings\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.resident_guest_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_resident_guest_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.resident_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_resident_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.family_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.guest_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.json_web_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_commands\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_logs\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_pins\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.laresia_pins\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.lock_settings\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.webhook_tokens\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.lock_webhook_tokens\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.managers\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.mst_display_logs\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.relationships\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.schema_migrations\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.webhooks\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.weeklies\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.wenas\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.wena_keys\"</span>\npg_restore: executing SEQUENCE SET active_storage_attachments_id_seq\npg_restore: executing SEQUENCE SET active_storage_blobs_id_seq\npg_restore: executing SEQUENCE SET active_storage_variant_records_id_seq\npg_restore: executing SEQUENCE SET json_web_keys_id_seq\npg_restore: warning: errors ignored on restore: 11\n</code></pre></div></div>\n</details>\n",
    "created_at": "2023-03-31T14:11:35+09:00",
    "message": "Update post.",
    "kind": "stock",
    "comments_count": 0,
    "tasks_count": 0,
    "done_tasks_count": 0,
    "url": "https://qrio.esa.io/posts/1588",
    "updated_at": "2023-07-18T10:38:38+09:00",
    "tags": [],
    "category": "Users/杉山/Database",
    "revision_number": 3,
    "created_by": {
      "myself": false,
      "name": "杉山聡",
      "screen_name": "satoshi_sugiyama",
      "icon": "https://img.esa.io/uploads/production/members/129432/icon/thumb_m_4589e2842b9d87757c7c9db07c45c00d.jpg"
    },
    "updated_by": {
      "myself": false,
      "name": "杉山聡",
      "screen_name": "satoshi_sugiyama",
      "icon": "https://img.esa.io/uploads/production/members/129432/icon/thumb_m_4589e2842b9d87757c7c9db07c45c00d.jpg"
    },
    "stargazers_count": 0,
    "watchers_count": 1,
    "star": false,
    "watch": false,
    "sharing_urls": null
  },
  {
    "number": 1587,
    "name": "session_replication_role実験1",
    "full_name": "Users/杉山/Database/session_replication_role実験1",
    "wip": true,
    "body_md": "## 実験1(環境準備ミス)\r\n### 結果\r\n#### 初期のsession_replication_role\r\n- origin\r\n\r\n#### session_replication_roleをパラメータグループから変更した際の挙動\r\n- 再起動せず\r\n- session_replication_roleがreplicaに変わった\r\n#### logs, display_logsテーブルのrestore\r\n- 成功した\r\n- しかし、`ALTER TABLE public.logs DISABLE TRIGGER ALL;`のエラーが出た\r\n    - `--disable-triggers`オプションを消し忘れていたのが原因\r\n#### session_replication_roleをパラメータグループから戻した際の挙動\r\n- 再起動せず\r\n- session_replication_roleがoriginに戻った\r\n#### main_dataのrestore\r\n- 成功した\r\n- しかし、**以前の**bucardoスキーマがdumpされていてそれも投入された\r\n    - 以前の検証環境でのbucardo利用後、HerokuDB側のbucardoスキーマを削除していなかった\r\n\r\n### 内容\r\n\r\n[移行手順書](https://docs.google.com/spreadsheets/d/1W3DymCJ_ifiXtSUwVAjcl9tzPGfz5WE6bmnnwYL9Gbo/edit#gid=602303325)のBucardoの設定、データプールの開始まで終わっている状態以降\r\n\r\n#### logsとdisplay_logsのdump\r\n\r\n```sh\r\npg_dump --format=custom --verbose --data-only --table=logs --table=display_logs -h vpce-0e9251c411c13ce7a-zursyjry.vpce-svc-08edb438435192caf.ap-northeast-1.vpce.amazonaws.com -p 5432 -d d6ci42p2305kgu -U uc3938nrsvfra > logs_displaylogs.dump\r\n```\r\n<details>\r\n\r\n```sh\r\npg_dump: last built-in OID is 16383\r\npg_dump: reading extensions\r\npg_dump: identifying extension members\r\npg_dump: reading schemas\r\npg_dump: reading user-defined tables\r\npg_dump: reading user-defined functions\r\npg_dump: reading user-defined types\r\npg_dump: reading procedural languages\r\npg_dump: reading user-defined aggregate functions\r\npg_dump: reading user-defined operators\r\npg_dump: reading user-defined access methods\r\npg_dump: reading user-defined operator classes\r\npg_dump: reading user-defined operator families\r\npg_dump: reading user-defined text search parsers\r\npg_dump: reading user-defined text search templates\r\npg_dump: reading user-defined text search dictionaries\r\npg_dump: reading user-defined text search configurations\r\npg_dump: reading user-defined foreign-data wrappers\r\npg_dump: reading user-defined foreign servers\r\npg_dump: reading default privileges\r\npg_dump: reading user-defined collations\r\npg_dump: reading user-defined conversions\r\npg_dump: reading type casts\r\npg_dump: reading transforms\r\npg_dump: reading table inheritance information\r\npg_dump: reading event triggers\r\npg_dump: finding extension tables\r\npg_dump: finding inheritance relationships\r\npg_dump: reading column info for interesting tables\r\npg_dump: finding the columns and types of table \"public.display_logs\"\r\npg_dump: finding the columns and types of table \"public.logs\"\r\npg_dump: flagging inherited columns in subtables\r\npg_dump: reading indexes\r\npg_dump: reading indexes for table \"public.display_logs\"\r\npg_dump: reading indexes for table \"public.logs\"\r\npg_dump: flagging indexes in partitioned tables\r\npg_dump: reading extended statistics\r\npg_dump: reading constraints\r\npg_dump: reading foreign key constraints for table \"public.display_logs\"\r\npg_dump: reading foreign key constraints for table \"public.logs\"\r\npg_dump: reading triggers\r\npg_dump: reading triggers for table \"public.display_logs\"\r\npg_dump: reading triggers for table \"public.logs\"\r\npg_dump: reading rewrite rules\r\npg_dump: reading policies\r\npg_dump: reading row-level security policies\r\npg_dump: reading publications\r\npg_dump: reading publication membership\r\npg_dump: reading subscriptions\r\npg_dump: reading dependency data\r\npg_dump: saving encoding = UTF8\r\npg_dump: saving standard_conforming_strings = on\r\npg_dump: saving search_path = \r\npg_dump: saving database definition\r\npg_dump: dumping contents of table \"public.display_logs\"\r\npg_dump: dumping contents of table \"public.logs\"\r\n```\r\n\r\n</details>\r\n\r\n#### session_replication_roleの初期値確認\r\n\r\n```\r\nkingapi=> show session_replication_role;\r\n session_replication_role \r\n--------------------------\r\n origin\r\n(1 row)\r\n```\r\n#### 新手順 session_replication_roleをreplicaにする\r\n\r\nパラメータグループをコピー(king-api-cfn-test-parametergroup-copy)して、session_replication_roleの値を'replica'にして保存する\r\n<img width=\"1565\" alt=\"スクリーンショット 2023-03-31 12.27.35.png (115.7 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/03/31/136273/d8d74da8-3c6e-4f8b-944e-5cef09c74afb.png\">\r\nDBクラスタの「変更」からDBクラスターのパラメータグループをking-api-cfn-test-parametergroup-copyを選択\r\n<img width=\"762\" alt=\"スクリーンショット 2023-03-31 12.28.03.png (68.3 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/03/31/136273/baa4b279-4731-4f24-a1f4-eb95d6d239fc.png\">\r\n変更を「すぐに適用」する\r\n<img width=\"783\" alt=\"スクリーンショット 2023-03-31 12.28.15.png (94.8 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/03/31/136273/5bac49e8-8315-4425-b6e8-f43df34dfedc.png\">\r\n\r\n再起動は起こらなかったが、適用できた\r\n<img width=\"793\" alt=\"スクリーンショット 2023-03-31 12.29.41.png (102.4 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/03/31/136273/af1f9499-200f-4734-83c8-603e0ecf40bd.png\">\r\n\r\n#### session_replication_roleの変更適用確認\r\n```sh\r\nkingapi=> show session_replication_role;\r\n session_replication_role \r\n--------------------------\r\n replica\r\n(1 row)\r\n```\r\n\r\n#### logs, display_logsのrestore\r\n```sh\r\nroot@d57ada7337a5:/# pg_restore --verbose --data-only --disable-triggers -h king-api-cfn-test.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com -U kingadmin -d kingapi -p 5432 logs_displaylogs.dump\r\n```\r\n\r\n<details>\r\n\r\n```sh\r\npg_restore: connecting to database for restore\r\npg_restore: disabling triggers for display_logs\r\npg_restore: while PROCESSING TOC:\r\npg_restore: from TOC entry 5105; 0 18155 TABLE DATA display_logs uc3938nrsvfra\r\npg_restore: error: could not execute query: ERROR:  permission denied: \"RI_ConstraintTrigger_c_22614\" is a system trigger\r\nCommand was: ALTER TABLE public.display_logs DISABLE TRIGGER ALL;\r\n\r\npg_restore: processing data for table \"public.display_logs\"\r\npg_restore: enabling triggers for display_logs\r\npg_restore: error: could not execute query: ERROR:  permission denied: \"RI_ConstraintTrigger_c_22614\" is a system trigger\r\nCommand was: ALTER TABLE public.display_logs ENABLE TRIGGER ALL;\r\n\r\npg_restore: disabling triggers for logs\r\npg_restore: from TOC entry 5106; 0 18351 TABLE DATA logs uc3938nrsvfra\r\npg_restore: error: could not execute query: ERROR:  permission denied: \"RI_ConstraintTrigger_c_22819\" is a system trigger\r\nCommand was: ALTER TABLE public.logs DISABLE TRIGGER ALL;\r\n\r\npg_restore: processing data for table \"public.logs\"\r\npg_restore: enabling triggers for logs\r\npg_restore: error: could not execute query: ERROR:  permission denied: \"RI_ConstraintTrigger_c_22819\" is a system trigger\r\nCommand was: ALTER TABLE public.logs ENABLE TRIGGER ALL;\r\n\r\npg_restore: warning: errors ignored on restore: 4\r\n```\r\n\r\n</details>\r\n\r\n`--disable-triggers`が入っているためRDSにおける実行不可能な`ALTER TABLE *** DISABLE TRIGGER ALL`のエラーが発生している。\r\n\r\n#### 行数確認\r\n同数となった\r\n```sql\r\nkingapi=> select count(*) from logs;\r\n count \r\n-------\r\n 23759\r\n(1 row)\r\n\r\nkingapi=> select count(*) from display_logs;\r\n count \r\n-------\r\n  1125\r\n(1 row)\r\n```\r\n\r\n```sql\r\nsl2-api-db-migration-test::DATABASE=> select count(*) from logs;\r\n count\r\n-------\r\n 23759\r\n(1 row)\r\n\r\nsl2-api-db-migration-test::DATABASE=> select count(*) from display_logs;\r\n count\r\n-------\r\n  1125\r\n(1 row)\r\n```\r\n\r\n#### パラメータグループを戻す\r\n先ほどと同様に、パラメータグループを元々ついていたものに戻す\r\n<img width=\"764\" alt=\"スクリーンショット 2023-03-31 12.46.09.png (62.7 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/03/31/136273/cee6ce7d-ca7b-4134-9bf1-6f49e829c008.png\">\r\n\r\n#### session_replication_role確認\r\n\r\n```sh\r\nkingapi=> show session_replication_role;\r\n session_replication_role \r\n--------------------------\r\n origin\r\n(1 row)\r\n```\r\n\r\n#### logs, display_logs以外のdump\r\n\r\n```sh\r\nroot@d57ada7337a5:/# pg_dump --format=custom --verbose --data-only --exclude-table=logs --exclude-table=display_logs -h vpce-0e9251c411c13ce7a-zursyjry.vpce-svc-08edb438435192caf.ap-northeast-1.vpce.amazonaws.com -d d6ci42p2305kgu -U uc3938nrsvfra -p 5432 >main_data.dump\r\n```\r\n\r\n<details>\r\n\r\n```sh\r\npg_dump: last built-in OID is 16383\r\npg_dump: reading extensions\r\npg_dump: identifying extension members\r\npg_dump: reading schemas\r\npg_dump: reading user-defined tables\r\npg_dump: reading user-defined functions\r\npg_dump: reading user-defined types\r\npg_dump: reading procedural languages\r\npg_dump: reading user-defined aggregate functions\r\npg_dump: reading user-defined operators\r\npg_dump: reading user-defined access methods\r\npg_dump: reading user-defined operator classes\r\npg_dump: reading user-defined operator families\r\npg_dump: reading user-defined text search parsers\r\npg_dump: reading user-defined text search templates\r\npg_dump: reading user-defined text search dictionaries\r\npg_dump: reading user-defined text search configurations\r\npg_dump: reading user-defined foreign-data wrappers\r\npg_dump: reading user-defined foreign servers\r\npg_dump: reading default privileges\r\npg_dump: reading user-defined collations\r\npg_dump: reading user-defined conversions\r\npg_dump: reading type casts\r\npg_dump: reading transforms\r\npg_dump: reading table inheritance information\r\npg_dump: reading event triggers\r\npg_dump: finding extension tables\r\npg_dump: finding inheritance relationships\r\npg_dump: reading column info for interesting tables\r\npg_dump: finding the columns and types of table \"public.pg_stat_statements_info\"\r\npg_dump: finding the columns and types of table \"public.pg_stat_statements\"\r\npg_dump: finding the columns and types of table \"public.active_storage_attachments\"\r\npg_dump: finding the columns and types of table \"public.active_storage_blobs\"\r\npg_dump: finding the columns and types of table \"public.active_storage_variant_records\"\r\npg_dump: finding the columns and types of table \"public.ar_internal_metadata\"\r\npg_dump: finding the columns and types of table \"public.autolock_schedules\"\r\npg_dump: finding the columns and types of table \"public.cards\"\r\npg_dump: finding the columns and types of table \"public.command_logs\"\r\npg_dump: finding the columns and types of table \"public.dailies\"\r\npg_dump: finding the columns and types of table \"public.door_mode_changed_histories\"\r\npg_dump: finding the columns and types of table \"public.durations\"\r\npg_dump: finding the columns and types of table \"public.entrance_block_fob_keys\"\r\npg_dump: finding the columns and types of table \"public.entrance_block_knight_cards\"\r\npg_dump: finding the columns and types of table \"public.entrance_fob_keys\"\r\npg_dump: finding the columns and types of table \"public.entrance_invitations\"\r\npg_dump: finding the columns and types of table \"public.entrance_knight_keys\"\r\npg_dump: finding the columns and types of table \"public.entrance_knight_pins\"\r\npg_dump: finding the columns and types of table \"public.entrance_lock_settings\"\r\npg_dump: finding the columns and types of table \"public.entrance_locks\"\r\npg_dump: finding the columns and types of table \"public.entrance_master_keys\"\r\npg_dump: finding the columns and types of table \"public.entrance_resident_guest_keys\"\r\npg_dump: finding the columns and types of table \"public.entrance_resident_keys\"\r\npg_dump: finding the columns and types of table \"public.family_keys\"\r\npg_dump: finding the columns and types of table \"public.fob_keys\"\r\npg_dump: finding the columns and types of table \"public.fobs\"\r\npg_dump: finding the columns and types of table \"public.guest_keys\"\r\npg_dump: finding the columns and types of table \"public.hubs\"\r\npg_dump: finding the columns and types of table \"public.invitations\"\r\npg_dump: finding the columns and types of table \"public.json_web_keys\"\r\npg_dump: finding the columns and types of table \"public.knight_cards\"\r\npg_dump: finding the columns and types of table \"public.knight_commands\"\r\npg_dump: finding the columns and types of table \"public.knight_keys\"\r\npg_dump: finding the columns and types of table \"public.knight_logs\"\r\npg_dump: finding the columns and types of table \"public.knight_pins\"\r\npg_dump: finding the columns and types of table \"public.knights\"\r\npg_dump: finding the columns and types of table \"public.laresia_pins\"\r\npg_dump: finding the columns and types of table \"public.lock_settings\"\r\npg_dump: finding the columns and types of table \"public.lock_webhook_tokens\"\r\npg_dump: finding the columns and types of table \"public.locks\"\r\npg_dump: finding the columns and types of table \"public.managers\"\r\npg_dump: finding the columns and types of table \"public.master_keys\"\r\npg_dump: finding the columns and types of table \"public.mst_display_logs\"\r\npg_dump: finding the columns and types of table \"public.relationships\"\r\npg_dump: finding the columns and types of table \"public.resident_guest_keys\"\r\npg_dump: finding the columns and types of table \"public.resident_keys\"\r\npg_dump: finding the columns and types of table \"public.schema_migrations\"\r\npg_dump: finding the columns and types of table \"public.term_of_validities\"\r\npg_dump: finding the columns and types of table \"public.users\"\r\npg_dump: finding the columns and types of table \"public.webhook_tokens\"\r\npg_dump: finding the columns and types of table \"public.webhooks\"\r\npg_dump: finding the columns and types of table \"public.weeklies\"\r\npg_dump: finding the columns and types of table \"public.wena_keys\"\r\npg_dump: finding the columns and types of table \"public.wenas\"\r\npg_dump: finding the columns and types of table \"bucardo.bucardo_delta_names\"\r\npg_dump: finding the columns and types of table \"bucardo.bucardo_delta_targets\"\r\npg_dump: finding the columns and types of table \"bucardo.bucardo_truncate_trigger\"\r\npg_dump: finding the columns and types of table \"bucardo.bucardo_truncate_trigger_log\"\r\npg_dump: finding the columns and types of table \"bucardo.bucardo_sequences\"\r\npg_dump: finding the columns and types of table \"bucardo.delta_public_active_storage_attachments\"\r\npg_dump: finding the columns and types of table \"bucardo.track_public_active_storage_attachments\"\r\npg_dump: finding the columns and types of table \"bucardo.stage_public_active_storage_attachments\"\r\npg_dump: finding the columns and types of table \"bucardo.delta_public_active_storage_blobs\"\r\npg_dump: finding the columns and types of table \"bucardo.track_public_active_storage_blobs\"\r\npg_dump: finding the columns and types of table \"bucardo.stage_public_active_storage_blobs\"\r\npg_dump: finding the columns and types of table \"bucardo.delta_public_active_storage_variant_records\"\r\npg_dump: finding the columns and types of table \"bucardo.track_public_active_storage_variant_records\"\r\npg_dump: finding the columns and types of table \"bucardo.stage_public_active_storage_variant_records\"\r\npg_dump: finding the columns and types of table \"bucardo.delta_public_ar_internal_metadata\"\r\npg_dump: finding the columns and types of table \"bucardo.track_public_ar_internal_metadata\"\r\npg_dump: finding the columns and types of table \"bucardo.stage_public_ar_internal_metadata\"\r\npg_dump: finding the columns and types of table \"bucardo.delta_public_autolock_schedules\"\r\npg_dump: finding the columns and types of table \"bucardo.track_public_autolock_schedules\"\r\npg_dump: finding the columns and types of table \"bucardo.stage_public_autolock_schedules\"\r\npg_dump: finding the columns and types of table \"bucardo.delta_public_cards\"\r\npg_dump: finding the columns and types of table \"bucardo.track_public_cards\"\r\npg_dump: finding the columns and types of table \"bucardo.stage_public_cards\"\r\npg_dump: finding the columns and types of table \"bucardo.delta_public_command_logs\"\r\npg_dump: finding the columns and types of table \"bucardo.track_public_command_logs\"\r\npg_dump: finding the columns and types of table \"bucardo.stage_public_command_logs\"\r\npg_dump: finding the columns and types of table \"bucardo.delta_public_dailies\"\r\npg_dump: finding the columns and types of table \"bucardo.track_public_dailies\"\r\npg_dump: finding the columns and types of table \"bucardo.stage_public_dailies\"\r\npg_dump: finding the columns and types of table \"bucardo.delta_public_display_logs\"\r\npg_dump: finding the columns and types of table \"bucardo.track_public_display_logs\"\r\npg_dump: finding the columns and types of table \"bucardo.stage_public_display_logs\"\r\npg_dump: finding the columns and types of table \"bucardo.delta_public_door_mode_changed_histories\"\r\npg_dump: finding the columns and types of table \"bucardo.track_public_door_mode_changed_histories\"\r\npg_dump: finding the columns and types of table \"bucardo.stage_public_door_mode_changed_histories\"\r\npg_dump: finding the columns and types of table \"bucardo.delta_public_durations\"\r\npg_dump: finding the columns and types of table \"bucardo.track_public_durations\"\r\npg_dump: finding the columns and types of table \"bucardo.stage_public_durations\"\r\npg_dump: finding the columns and types of table \"bucardo.delta_public_entrance_block_fob_keys\"\r\npg_dump: finding the columns and types of table \"bucardo.track_public_entrance_block_fob_keys\"\r\npg_dump: finding the columns and types of table \"bucardo.stage_public_entrance_block_fob_keys\"\r\npg_dump: finding the columns and types of table \"bucardo.delta_public_entrance_block_knight_cards\"\r\npg_dump: finding the columns and types of table \"bucardo.track_public_entrance_block_knight_cards\"\r\npg_dump: finding the columns and types of table \"bucardo.stage_public_entrance_block_knight_cards\"\r\npg_dump: finding the columns and types of table \"bucardo.delta_public_entrance_fob_keys\"\r\npg_dump: finding the columns and types of table \"bucardo.track_public_entrance_fob_keys\"\r\npg_dump: finding the columns and types of table \"bucardo.stage_public_entrance_fob_keys\"\r\npg_dump: finding the columns and types of table \"bucardo.delta_public_entrance_invitations\"\r\npg_dump: finding the columns and types of table \"bucardo.track_public_entrance_invitations\"\r\npg_dump: finding the columns and types of table \"bucardo.stage_public_entrance_invitations\"\r\npg_dump: finding the columns and types of table \"bucardo.delta_public_entrance_knight_keys\"\r\npg_dump: finding the columns and types of table \"bucardo.track_public_entrance_knight_keys\"\r\npg_dump: finding the columns and types of table \"bucardo.stage_public_entrance_knight_keys\"\r\npg_dump: finding the columns and types of table \"bucardo.delta_public_entrance_knight_pins\"\r\npg_dump: finding the columns and types of table \"bucardo.track_public_entrance_knight_pins\"\r\npg_dump: finding the columns and types of table \"bucardo.stage_public_entrance_knight_pins\"\r\npg_dump: finding the columns and types of table \"bucardo.delta_public_entrance_lock_settings\"\r\npg_dump: finding the columns and types of table \"bucardo.track_public_entrance_lock_settings\"\r\npg_dump: finding the columns and types of table \"bucardo.stage_public_entrance_lock_settings\"\r\npg_dump: finding the columns and types of table \"bucardo.delta_public_entrance_locks\"\r\npg_dump: finding the columns and types of table \"bucardo.track_public_entrance_locks\"\r\npg_dump: finding the columns and types of table \"bucardo.stage_public_entrance_locks\"\r\npg_dump: finding the columns and types of table \"bucardo.delta_public_entrance_master_keys\"\r\npg_dump: finding the columns and types of table \"bucardo.track_public_entrance_master_keys\"\r\npg_dump: finding the columns and types of table \"bucardo.stage_public_entrance_master_keys\"\r\npg_dump: finding the columns and types of table \"bucardo.delta_public_entrance_resident_guest_keys\"\r\npg_dump: finding the columns and types of table \"bucardo.track_public_entrance_resident_guest_keys\"\r\npg_dump: finding the columns and types of table \"bucardo.stage_public_entrance_resident_guest_keys\"\r\npg_dump: finding the columns and types of table \"bucardo.delta_public_entrance_resident_keys\"\r\npg_dump: finding the columns and types of table \"bucardo.track_public_entrance_resident_keys\"\r\npg_dump: finding the columns and types of table \"bucardo.stage_public_entrance_resident_keys\"\r\npg_dump: finding the columns and types of table \"bucardo.delta_public_family_keys\"\r\npg_dump: finding the columns and types of table \"bucardo.track_public_family_keys\"\r\npg_dump: finding the columns and types of table \"bucardo.stage_public_family_keys\"\r\npg_dump: finding the columns and types of table \"bucardo.delta_public_fob_keys\"\r\npg_dump: finding the columns and types of table \"bucardo.track_public_fob_keys\"\r\npg_dump: finding the columns and types of table \"bucardo.stage_public_fob_keys\"\r\npg_dump: finding the columns and types of table \"bucardo.delta_public_fobs\"\r\npg_dump: finding the columns and types of table \"bucardo.track_public_fobs\"\r\npg_dump: finding the columns and types of table \"bucardo.stage_public_fobs\"\r\npg_dump: finding the columns and types of table \"bucardo.delta_public_guest_keys\"\r\npg_dump: finding the columns and types of table \"bucardo.track_public_guest_keys\"\r\npg_dump: finding the columns and types of table \"bucardo.stage_public_guest_keys\"\r\npg_dump: finding the columns and types of table \"bucardo.delta_public_hubs\"\r\npg_dump: finding the columns and types of table \"bucardo.track_public_hubs\"\r\npg_dump: finding the columns and types of table \"bucardo.stage_public_hubs\"\r\npg_dump: finding the columns and types of table \"bucardo.delta_public_invitations\"\r\npg_dump: finding the columns and types of table \"bucardo.track_public_invitations\"\r\npg_dump: finding the columns and types of table \"bucardo.stage_public_invitations\"\r\npg_dump: finding the columns and types of table \"bucardo.delta_public_json_web_keys\"\r\npg_dump: finding the columns and types of table \"bucardo.track_public_json_web_keys\"\r\npg_dump: finding the columns and types of table \"bucardo.stage_public_json_web_keys\"\r\npg_dump: finding the columns and types of table \"bucardo.delta_public_knight_cards\"\r\npg_dump: finding the columns and types of table \"bucardo.track_public_knight_cards\"\r\npg_dump: finding the columns and types of table \"bucardo.stage_public_knight_cards\"\r\npg_dump: finding the columns and types of table \"bucardo.delta_public_knight_commands\"\r\npg_dump: finding the columns and types of table \"bucardo.track_public_knight_commands\"\r\npg_dump: finding the columns and types of table \"bucardo.stage_public_knight_commands\"\r\npg_dump: finding the columns and types of table \"bucardo.delta_public_knight_keys\"\r\npg_dump: finding the columns and types of table \"bucardo.track_public_knight_keys\"\r\npg_dump: finding the columns and types of table \"bucardo.stage_public_knight_keys\"\r\npg_dump: finding the columns and types of table \"bucardo.delta_public_knight_logs\"\r\npg_dump: finding the columns and types of table \"bucardo.track_public_knight_logs\"\r\npg_dump: finding the columns and types of table \"bucardo.stage_public_knight_logs\"\r\npg_dump: finding the columns and types of table \"bucardo.delta_public_knight_pins\"\r\npg_dump: finding the columns and types of table \"bucardo.track_public_knight_pins\"\r\npg_dump: finding the columns and types of table \"bucardo.stage_public_knight_pins\"\r\npg_dump: finding the columns and types of table \"bucardo.delta_public_knights\"\r\npg_dump: finding the columns and types of table \"bucardo.track_public_knights\"\r\npg_dump: finding the columns and types of table \"bucardo.stage_public_knights\"\r\npg_dump: finding the columns and types of table \"bucardo.delta_public_laresia_pins\"\r\npg_dump: finding the columns and types of table \"bucardo.track_public_laresia_pins\"\r\npg_dump: finding the columns and types of table \"bucardo.stage_public_laresia_pins\"\r\npg_dump: finding the columns and types of table \"bucardo.delta_public_lock_settings\"\r\npg_dump: finding the columns and types of table \"bucardo.track_public_lock_settings\"\r\npg_dump: finding the columns and types of table \"bucardo.stage_public_lock_settings\"\r\npg_dump: finding the columns and types of table \"bucardo.delta_public_lock_webhook_tokens\"\r\npg_dump: finding the columns and types of table \"bucardo.track_public_lock_webhook_tokens\"\r\npg_dump: finding the columns and types of table \"bucardo.stage_public_lock_webhook_tokens\"\r\npg_dump: finding the columns and types of table \"bucardo.delta_public_locks\"\r\npg_dump: finding the columns and types of table \"bucardo.track_public_locks\"\r\npg_dump: finding the columns and types of table \"bucardo.stage_public_locks\"\r\npg_dump: finding the columns and types of table \"bucardo.delta_public_logs\"\r\npg_dump: finding the columns and types of table \"bucardo.track_public_logs\"\r\npg_dump: finding the columns and types of table \"bucardo.stage_public_logs\"\r\npg_dump: finding the columns and types of table \"bucardo.delta_public_managers\"\r\npg_dump: finding the columns and types of table \"bucardo.track_public_managers\"\r\npg_dump: finding the columns and types of table \"bucardo.stage_public_managers\"\r\npg_dump: finding the columns and types of table \"bucardo.delta_public_master_keys\"\r\npg_dump: finding the columns and types of table \"bucardo.track_public_master_keys\"\r\npg_dump: finding the columns and types of table \"bucardo.stage_public_master_keys\"\r\npg_dump: finding the columns and types of table \"bucardo.delta_public_mst_display_logs\"\r\npg_dump: finding the columns and types of table \"bucardo.track_public_mst_display_logs\"\r\npg_dump: finding the columns and types of table \"bucardo.stage_public_mst_display_logs\"\r\npg_dump: finding the columns and types of table \"bucardo.delta_public_relationships\"\r\npg_dump: finding the columns and types of table \"bucardo.track_public_relationships\"\r\npg_dump: finding the columns and types of table \"bucardo.stage_public_relationships\"\r\npg_dump: finding the columns and types of table \"bucardo.delta_public_resident_guest_keys\"\r\npg_dump: finding the columns and types of table \"bucardo.track_public_resident_guest_keys\"\r\npg_dump: finding the columns and types of table \"bucardo.stage_public_resident_guest_keys\"\r\npg_dump: finding the columns and types of table \"bucardo.delta_public_resident_keys\"\r\npg_dump: finding the columns and types of table \"bucardo.track_public_resident_keys\"\r\npg_dump: finding the columns and types of table \"bucardo.stage_public_resident_keys\"\r\npg_dump: finding the columns and types of table \"bucardo.delta_public_schema_migrations\"\r\npg_dump: finding the columns and types of table \"bucardo.track_public_schema_migrations\"\r\npg_dump: finding the columns and types of table \"bucardo.stage_public_schema_migrations\"\r\npg_dump: finding the columns and types of table \"bucardo.delta_public_term_of_validities\"\r\npg_dump: finding the columns and types of table \"bucardo.track_public_term_of_validities\"\r\npg_dump: finding the columns and types of table \"bucardo.stage_public_term_of_validities\"\r\npg_dump: finding the columns and types of table \"bucardo.delta_public_users\"\r\npg_dump: finding the columns and types of table \"bucardo.track_public_users\"\r\npg_dump: finding the columns and types of table \"bucardo.stage_public_users\"\r\npg_dump: finding the columns and types of table \"bucardo.delta_public_webhook_tokens\"\r\npg_dump: finding the columns and types of table \"bucardo.track_public_webhook_tokens\"\r\npg_dump: finding the columns and types of table \"bucardo.stage_public_webhook_tokens\"\r\npg_dump: finding the columns and types of table \"bucardo.delta_public_webhooks\"\r\npg_dump: finding the columns and types of table \"bucardo.track_public_webhooks\"\r\npg_dump: finding the columns and types of table \"bucardo.stage_public_webhooks\"\r\npg_dump: finding the columns and types of table \"bucardo.delta_public_weeklies\"\r\npg_dump: finding the columns and types of table \"bucardo.track_public_weeklies\"\r\npg_dump: finding the columns and types of table \"bucardo.stage_public_weeklies\"\r\npg_dump: finding the columns and types of table \"bucardo.delta_public_wena_keys\"\r\npg_dump: finding the columns and types of table \"bucardo.track_public_wena_keys\"\r\npg_dump: finding the columns and types of table \"bucardo.stage_public_wena_keys\"\r\npg_dump: finding the columns and types of table \"bucardo.delta_public_wenas\"\r\npg_dump: finding the columns and types of table \"bucardo.track_public_wenas\"\r\npg_dump: finding the columns and types of table \"bucardo.stage_public_wenas\"\r\npg_dump: flagging inherited columns in subtables\r\npg_dump: reading indexes\r\npg_dump: reading indexes for table \"public.active_storage_attachments\"\r\npg_dump: reading indexes for table \"public.active_storage_blobs\"\r\npg_dump: reading indexes for table \"public.active_storage_variant_records\"\r\npg_dump: reading indexes for table \"public.ar_internal_metadata\"\r\npg_dump: reading indexes for table \"public.autolock_schedules\"\r\npg_dump: reading indexes for table \"public.cards\"\r\npg_dump: reading indexes for table \"public.command_logs\"\r\npg_dump: reading indexes for table \"public.dailies\"\r\npg_dump: reading indexes for table \"public.door_mode_changed_histories\"\r\npg_dump: reading indexes for table \"public.durations\"\r\npg_dump: reading indexes for table \"public.entrance_block_fob_keys\"\r\npg_dump: reading indexes for table \"public.entrance_block_knight_cards\"\r\npg_dump: reading indexes for table \"public.entrance_fob_keys\"\r\npg_dump: reading indexes for table \"public.entrance_invitations\"\r\npg_dump: reading indexes for table \"public.entrance_knight_keys\"\r\npg_dump: reading indexes for table \"public.entrance_knight_pins\"\r\npg_dump: reading indexes for table \"public.entrance_lock_settings\"\r\npg_dump: reading indexes for table \"public.entrance_locks\"\r\npg_dump: reading indexes for table \"public.entrance_master_keys\"\r\npg_dump: reading indexes for table \"public.entrance_resident_guest_keys\"\r\npg_dump: reading indexes for table \"public.entrance_resident_keys\"\r\npg_dump: reading indexes for table \"public.family_keys\"\r\npg_dump: reading indexes for table \"public.fob_keys\"\r\npg_dump: reading indexes for table \"public.fobs\"\r\npg_dump: reading indexes for table \"public.guest_keys\"\r\npg_dump: reading indexes for table \"public.hubs\"\r\npg_dump: reading indexes for table \"public.invitations\"\r\npg_dump: reading indexes for table \"public.json_web_keys\"\r\npg_dump: reading indexes for table \"public.knight_cards\"\r\npg_dump: reading indexes for table \"public.knight_commands\"\r\npg_dump: reading indexes for table \"public.knight_keys\"\r\npg_dump: reading indexes for table \"public.knight_logs\"\r\npg_dump: reading indexes for table \"public.knight_pins\"\r\npg_dump: reading indexes for table \"public.knights\"\r\npg_dump: reading indexes for table \"public.laresia_pins\"\r\npg_dump: reading indexes for table \"public.lock_settings\"\r\npg_dump: reading indexes for table \"public.lock_webhook_tokens\"\r\npg_dump: reading indexes for table \"public.locks\"\r\npg_dump: reading indexes for table \"public.managers\"\r\npg_dump: reading indexes for table \"public.master_keys\"\r\npg_dump: reading indexes for table \"public.mst_display_logs\"\r\npg_dump: reading indexes for table \"public.relationships\"\r\npg_dump: reading indexes for table \"public.resident_guest_keys\"\r\npg_dump: reading indexes for table \"public.resident_keys\"\r\npg_dump: reading indexes for table \"public.schema_migrations\"\r\npg_dump: reading indexes for table \"public.term_of_validities\"\r\npg_dump: reading indexes for table \"public.users\"\r\npg_dump: reading indexes for table \"public.webhook_tokens\"\r\npg_dump: reading indexes for table \"public.webhooks\"\r\npg_dump: reading indexes for table \"public.weeklies\"\r\npg_dump: reading indexes for table \"public.wena_keys\"\r\npg_dump: reading indexes for table \"public.wenas\"\r\npg_dump: reading indexes for table \"bucardo.bucardo_delta_names\"\r\npg_dump: reading indexes for table \"bucardo.bucardo_delta_targets\"\r\npg_dump: reading indexes for table \"bucardo.bucardo_truncate_trigger\"\r\npg_dump: reading indexes for table \"bucardo.bucardo_sequences\"\r\npg_dump: reading indexes for table \"bucardo.delta_public_active_storage_attachments\"\r\npg_dump: reading indexes for table \"bucardo.track_public_active_storage_attachments\"\r\npg_dump: reading indexes for table \"bucardo.delta_public_active_storage_blobs\"\r\npg_dump: reading indexes for table \"bucardo.track_public_active_storage_blobs\"\r\npg_dump: reading indexes for table \"bucardo.delta_public_active_storage_variant_records\"\r\npg_dump: reading indexes for table \"bucardo.track_public_active_storage_variant_records\"\r\npg_dump: reading indexes for table \"bucardo.delta_public_ar_internal_metadata\"\r\npg_dump: reading indexes for table \"bucardo.track_public_ar_internal_metadata\"\r\npg_dump: reading indexes for table \"bucardo.delta_public_autolock_schedules\"\r\npg_dump: reading indexes for table \"bucardo.track_public_autolock_schedules\"\r\npg_dump: reading indexes for table \"bucardo.delta_public_cards\"\r\npg_dump: reading indexes for table \"bucardo.track_public_cards\"\r\npg_dump: reading indexes for table \"bucardo.delta_public_command_logs\"\r\npg_dump: reading indexes for table \"bucardo.track_public_command_logs\"\r\npg_dump: reading indexes for table \"bucardo.delta_public_dailies\"\r\npg_dump: reading indexes for table \"bucardo.track_public_dailies\"\r\npg_dump: reading indexes for table \"bucardo.delta_public_display_logs\"\r\npg_dump: reading indexes for table \"bucardo.track_public_display_logs\"\r\npg_dump: reading indexes for table \"bucardo.delta_public_door_mode_changed_histories\"\r\npg_dump: reading indexes for table \"bucardo.track_public_door_mode_changed_histories\"\r\npg_dump: reading indexes for table \"bucardo.delta_public_durations\"\r\npg_dump: reading indexes for table \"bucardo.track_public_durations\"\r\npg_dump: reading indexes for table \"bucardo.delta_public_entrance_block_fob_keys\"\r\npg_dump: reading indexes for table \"bucardo.track_public_entrance_block_fob_keys\"\r\npg_dump: reading indexes for table \"bucardo.delta_public_entrance_block_knight_cards\"\r\npg_dump: reading indexes for table \"bucardo.track_public_entrance_block_knight_cards\"\r\npg_dump: reading indexes for table \"bucardo.delta_public_entrance_fob_keys\"\r\npg_dump: reading indexes for table \"bucardo.track_public_entrance_fob_keys\"\r\npg_dump: reading indexes for table \"bucardo.delta_public_entrance_invitations\"\r\npg_dump: reading indexes for table \"bucardo.track_public_entrance_invitations\"\r\npg_dump: reading indexes for table \"bucardo.delta_public_entrance_knight_keys\"\r\npg_dump: reading indexes for table \"bucardo.track_public_entrance_knight_keys\"\r\npg_dump: reading indexes for table \"bucardo.delta_public_entrance_knight_pins\"\r\npg_dump: reading indexes for table \"bucardo.track_public_entrance_knight_pins\"\r\npg_dump: reading indexes for table \"bucardo.delta_public_entrance_lock_settings\"\r\npg_dump: reading indexes for table \"bucardo.track_public_entrance_lock_settings\"\r\npg_dump: reading indexes for table \"bucardo.delta_public_entrance_locks\"\r\npg_dump: reading indexes for table \"bucardo.track_public_entrance_locks\"\r\npg_dump: reading indexes for table \"bucardo.delta_public_entrance_master_keys\"\r\npg_dump: reading indexes for table \"bucardo.track_public_entrance_master_keys\"\r\npg_dump: reading indexes for table \"bucardo.delta_public_entrance_resident_guest_keys\"\r\npg_dump: reading indexes for table \"bucardo.track_public_entrance_resident_guest_keys\"\r\npg_dump: reading indexes for table \"bucardo.delta_public_entrance_resident_keys\"\r\npg_dump: reading indexes for table \"bucardo.track_public_entrance_resident_keys\"\r\npg_dump: reading indexes for table \"bucardo.delta_public_family_keys\"\r\npg_dump: reading indexes for table \"bucardo.track_public_family_keys\"\r\npg_dump: reading indexes for table \"bucardo.delta_public_fob_keys\"\r\npg_dump: reading indexes for table \"bucardo.track_public_fob_keys\"\r\npg_dump: reading indexes for table \"bucardo.delta_public_fobs\"\r\npg_dump: reading indexes for table \"bucardo.track_public_fobs\"\r\npg_dump: reading indexes for table \"bucardo.delta_public_guest_keys\"\r\npg_dump: reading indexes for table \"bucardo.track_public_guest_keys\"\r\npg_dump: reading indexes for table \"bucardo.delta_public_hubs\"\r\npg_dump: reading indexes for table \"bucardo.track_public_hubs\"\r\npg_dump: reading indexes for table \"bucardo.delta_public_invitations\"\r\npg_dump: reading indexes for table \"bucardo.track_public_invitations\"\r\npg_dump: reading indexes for table \"bucardo.delta_public_json_web_keys\"\r\npg_dump: reading indexes for table \"bucardo.track_public_json_web_keys\"\r\npg_dump: reading indexes for table \"bucardo.delta_public_knight_cards\"\r\npg_dump: reading indexes for table \"bucardo.track_public_knight_cards\"\r\npg_dump: reading indexes for table \"bucardo.delta_public_knight_commands\"\r\npg_dump: reading indexes for table \"bucardo.track_public_knight_commands\"\r\npg_dump: reading indexes for table \"bucardo.delta_public_knight_keys\"\r\npg_dump: reading indexes for table \"bucardo.track_public_knight_keys\"\r\npg_dump: reading indexes for table \"bucardo.delta_public_knight_logs\"\r\npg_dump: reading indexes for table \"bucardo.track_public_knight_logs\"\r\npg_dump: reading indexes for table \"bucardo.delta_public_knight_pins\"\r\npg_dump: reading indexes for table \"bucardo.track_public_knight_pins\"\r\npg_dump: reading indexes for table \"bucardo.delta_public_knights\"\r\npg_dump: reading indexes for table \"bucardo.track_public_knights\"\r\npg_dump: reading indexes for table \"bucardo.delta_public_laresia_pins\"\r\npg_dump: reading indexes for table \"bucardo.track_public_laresia_pins\"\r\npg_dump: reading indexes for table \"bucardo.delta_public_lock_settings\"\r\npg_dump: reading indexes for table \"bucardo.track_public_lock_settings\"\r\npg_dump: reading indexes for table \"bucardo.delta_public_lock_webhook_tokens\"\r\npg_dump: reading indexes for table \"bucardo.track_public_lock_webhook_tokens\"\r\npg_dump: reading indexes for table \"bucardo.delta_public_locks\"\r\npg_dump: reading indexes for table \"bucardo.track_public_locks\"\r\npg_dump: reading indexes for table \"bucardo.delta_public_logs\"\r\npg_dump: reading indexes for table \"bucardo.track_public_logs\"\r\npg_dump: reading indexes for table \"bucardo.delta_public_managers\"\r\npg_dump: reading indexes for table \"bucardo.track_public_managers\"\r\npg_dump: reading indexes for table \"bucardo.delta_public_master_keys\"\r\npg_dump: reading indexes for table \"bucardo.track_public_master_keys\"\r\npg_dump: reading indexes for table \"bucardo.delta_public_mst_display_logs\"\r\npg_dump: reading indexes for table \"bucardo.track_public_mst_display_logs\"\r\npg_dump: reading indexes for table \"bucardo.delta_public_relationships\"\r\npg_dump: reading indexes for table \"bucardo.track_public_relationships\"\r\npg_dump: reading indexes for table \"bucardo.delta_public_resident_guest_keys\"\r\npg_dump: reading indexes for table \"bucardo.track_public_resident_guest_keys\"\r\npg_dump: reading indexes for table \"bucardo.delta_public_resident_keys\"\r\npg_dump: reading indexes for table \"bucardo.track_public_resident_keys\"\r\npg_dump: reading indexes for table \"bucardo.delta_public_schema_migrations\"\r\npg_dump: reading indexes for table \"bucardo.track_public_schema_migrations\"\r\npg_dump: reading indexes for table \"bucardo.delta_public_term_of_validities\"\r\npg_dump: reading indexes for table \"bucardo.track_public_term_of_validities\"\r\npg_dump: reading indexes for table \"bucardo.delta_public_users\"\r\npg_dump: reading indexes for table \"bucardo.track_public_users\"\r\npg_dump: reading indexes for table \"bucardo.delta_public_webhook_tokens\"\r\npg_dump: reading indexes for table \"bucardo.track_public_webhook_tokens\"\r\npg_dump: reading indexes for table \"bucardo.delta_public_webhooks\"\r\npg_dump: reading indexes for table \"bucardo.track_public_webhooks\"\r\npg_dump: reading indexes for table \"bucardo.delta_public_weeklies\"\r\npg_dump: reading indexes for table \"bucardo.track_public_weeklies\"\r\npg_dump: reading indexes for table \"bucardo.delta_public_wena_keys\"\r\npg_dump: reading indexes for table \"bucardo.track_public_wena_keys\"\r\npg_dump: reading indexes for table \"bucardo.delta_public_wenas\"\r\npg_dump: reading indexes for table \"bucardo.track_public_wenas\"\r\npg_dump: flagging indexes in partitioned tables\r\npg_dump: reading extended statistics\r\npg_dump: reading constraints\r\npg_dump: reading foreign key constraints for table \"public.active_storage_attachments\"\r\npg_dump: reading foreign key constraints for table \"public.active_storage_blobs\"\r\npg_dump: reading foreign key constraints for table \"public.active_storage_variant_records\"\r\npg_dump: reading foreign key constraints for table \"public.ar_internal_metadata\"\r\npg_dump: reading foreign key constraints for table \"public.autolock_schedules\"\r\npg_dump: reading foreign key constraints for table \"public.cards\"\r\npg_dump: reading foreign key constraints for table \"public.command_logs\"\r\npg_dump: reading foreign key constraints for table \"public.dailies\"\r\npg_dump: reading foreign key constraints for table \"public.door_mode_changed_histories\"\r\npg_dump: reading foreign key constraints for table \"public.durations\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_block_fob_keys\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_block_knight_cards\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_fob_keys\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_invitations\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_knight_keys\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_knight_pins\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_lock_settings\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_locks\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_master_keys\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_resident_guest_keys\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_resident_keys\"\r\npg_dump: reading foreign key constraints for table \"public.family_keys\"\r\npg_dump: reading foreign key constraints for table \"public.fob_keys\"\r\npg_dump: reading foreign key constraints for table \"public.fobs\"\r\npg_dump: reading foreign key constraints for table \"public.guest_keys\"\r\npg_dump: reading foreign key constraints for table \"public.hubs\"\r\npg_dump: reading foreign key constraints for table \"public.invitations\"\r\npg_dump: reading foreign key constraints for table \"public.json_web_keys\"\r\npg_dump: reading foreign key constraints for table \"public.knight_cards\"\r\npg_dump: reading foreign key constraints for table \"public.knight_commands\"\r\npg_dump: reading foreign key constraints for table \"public.knight_keys\"\r\npg_dump: reading foreign key constraints for table \"public.knight_logs\"\r\npg_dump: reading foreign key constraints for table \"public.knight_pins\"\r\npg_dump: reading foreign key constraints for table \"public.knights\"\r\npg_dump: reading foreign key constraints for table \"public.laresia_pins\"\r\npg_dump: reading foreign key constraints for table \"public.lock_settings\"\r\npg_dump: reading foreign key constraints for table \"public.lock_webhook_tokens\"\r\npg_dump: reading foreign key constraints for table \"public.locks\"\r\npg_dump: reading foreign key constraints for table \"public.managers\"\r\npg_dump: reading foreign key constraints for table \"public.master_keys\"\r\npg_dump: reading foreign key constraints for table \"public.mst_display_logs\"\r\npg_dump: reading foreign key constraints for table \"public.relationships\"\r\npg_dump: reading foreign key constraints for table \"public.resident_guest_keys\"\r\npg_dump: reading foreign key constraints for table \"public.resident_keys\"\r\npg_dump: reading foreign key constraints for table \"public.schema_migrations\"\r\npg_dump: reading foreign key constraints for table \"public.term_of_validities\"\r\npg_dump: reading foreign key constraints for table \"public.users\"\r\npg_dump: reading foreign key constraints for table \"public.webhook_tokens\"\r\npg_dump: reading foreign key constraints for table \"public.webhooks\"\r\npg_dump: reading foreign key constraints for table \"public.weeklies\"\r\npg_dump: reading foreign key constraints for table \"public.wena_keys\"\r\npg_dump: reading foreign key constraints for table \"public.wenas\"\r\npg_dump: reading foreign key constraints for table \"bucardo.bucardo_delta_names\"\r\npg_dump: reading triggers\r\npg_dump: reading triggers for table \"public.active_storage_attachments\"\r\npg_dump: reading triggers for table \"public.active_storage_blobs\"\r\npg_dump: reading triggers for table \"public.active_storage_variant_records\"\r\npg_dump: reading triggers for table \"public.ar_internal_metadata\"\r\npg_dump: reading triggers for table \"public.autolock_schedules\"\r\npg_dump: reading triggers for table \"public.cards\"\r\npg_dump: reading triggers for table \"public.command_logs\"\r\npg_dump: reading triggers for table \"public.dailies\"\r\npg_dump: reading triggers for table \"public.door_mode_changed_histories\"\r\npg_dump: reading triggers for table \"public.durations\"\r\npg_dump: reading triggers for table \"public.entrance_block_fob_keys\"\r\npg_dump: reading triggers for table \"public.entrance_block_knight_cards\"\r\npg_dump: reading triggers for table \"public.entrance_fob_keys\"\r\npg_dump: reading triggers for table \"public.entrance_invitations\"\r\npg_dump: reading triggers for table \"public.entrance_knight_keys\"\r\npg_dump: reading triggers for table \"public.entrance_knight_pins\"\r\npg_dump: reading triggers for table \"public.entrance_lock_settings\"\r\npg_dump: reading triggers for table \"public.entrance_locks\"\r\npg_dump: reading triggers for table \"public.entrance_master_keys\"\r\npg_dump: reading triggers for table \"public.entrance_resident_guest_keys\"\r\npg_dump: reading triggers for table \"public.entrance_resident_keys\"\r\npg_dump: reading triggers for table \"public.family_keys\"\r\npg_dump: reading triggers for table \"public.fob_keys\"\r\npg_dump: reading triggers for table \"public.fobs\"\r\npg_dump: reading triggers for table \"public.guest_keys\"\r\npg_dump: reading triggers for table \"public.hubs\"\r\npg_dump: reading triggers for table \"public.invitations\"\r\npg_dump: reading triggers for table \"public.json_web_keys\"\r\npg_dump: reading triggers for table \"public.knight_cards\"\r\npg_dump: reading triggers for table \"public.knight_commands\"\r\npg_dump: reading triggers for table \"public.knight_keys\"\r\npg_dump: reading triggers for table \"public.knight_logs\"\r\npg_dump: reading triggers for table \"public.knight_pins\"\r\npg_dump: reading triggers for table \"public.knights\"\r\npg_dump: reading triggers for table \"public.laresia_pins\"\r\npg_dump: reading triggers for table \"public.lock_settings\"\r\npg_dump: reading triggers for table \"public.lock_webhook_tokens\"\r\npg_dump: reading triggers for table \"public.locks\"\r\npg_dump: reading triggers for table \"public.managers\"\r\npg_dump: reading triggers for table \"public.master_keys\"\r\npg_dump: reading triggers for table \"public.mst_display_logs\"\r\npg_dump: reading triggers for table \"public.relationships\"\r\npg_dump: reading triggers for table \"public.resident_guest_keys\"\r\npg_dump: reading triggers for table \"public.resident_keys\"\r\npg_dump: reading triggers for table \"public.schema_migrations\"\r\npg_dump: reading triggers for table \"public.term_of_validities\"\r\npg_dump: reading triggers for table \"public.users\"\r\npg_dump: reading triggers for table \"public.webhook_tokens\"\r\npg_dump: reading triggers for table \"public.webhooks\"\r\npg_dump: reading triggers for table \"public.weeklies\"\r\npg_dump: reading triggers for table \"public.wena_keys\"\r\npg_dump: reading triggers for table \"public.wenas\"\r\npg_dump: reading triggers for table \"bucardo.bucardo_delta_names\"\r\npg_dump: reading rewrite rules\r\npg_dump: reading policies\r\npg_dump: reading row-level security policies\r\npg_dump: reading publications\r\npg_dump: reading publication membership\r\npg_dump: reading subscriptions\r\npg_dump: reading large objects\r\npg_dump: reading dependency data\r\npg_dump: saving encoding = UTF8\r\npg_dump: saving standard_conforming_strings = on\r\npg_dump: saving search_path = \r\npg_dump: saving database definition\r\npg_dump: dumping contents of table \"bucardo.bucardo_delta_names\"\r\npg_dump: dumping contents of table \"bucardo.bucardo_delta_targets\"\r\npg_dump: dumping contents of table \"bucardo.bucardo_sequences\"\r\npg_dump: dumping contents of table \"bucardo.bucardo_truncate_trigger\"\r\npg_dump: dumping contents of table \"bucardo.bucardo_truncate_trigger_log\"\r\npg_dump: dumping contents of table \"bucardo.delta_public_active_storage_attachments\"\r\npg_dump: dumping contents of table \"bucardo.delta_public_active_storage_blobs\"\r\npg_dump: dumping contents of table \"bucardo.delta_public_active_storage_variant_records\"\r\npg_dump: dumping contents of table \"bucardo.delta_public_ar_internal_metadata\"\r\npg_dump: dumping contents of table \"bucardo.delta_public_autolock_schedules\"\r\npg_dump: dumping contents of table \"bucardo.delta_public_cards\"\r\npg_dump: dumping contents of table \"bucardo.delta_public_command_logs\"\r\npg_dump: dumping contents of table \"bucardo.delta_public_dailies\"\r\npg_dump: dumping contents of table \"bucardo.delta_public_display_logs\"\r\npg_dump: dumping contents of table \"bucardo.delta_public_door_mode_changed_histories\"\r\npg_dump: dumping contents of table \"bucardo.delta_public_durations\"\r\npg_dump: dumping contents of table \"bucardo.delta_public_entrance_block_fob_keys\"\r\npg_dump: dumping contents of table \"bucardo.delta_public_entrance_block_knight_cards\"\r\npg_dump: dumping contents of table \"bucardo.delta_public_entrance_fob_keys\"\r\npg_dump: dumping contents of table \"bucardo.delta_public_entrance_invitations\"\r\npg_dump: dumping contents of table \"bucardo.delta_public_entrance_knight_keys\"\r\npg_dump: dumping contents of table \"bucardo.delta_public_entrance_knight_pins\"\r\npg_dump: dumping contents of table \"bucardo.delta_public_entrance_lock_settings\"\r\npg_dump: dumping contents of table \"bucardo.delta_public_entrance_locks\"\r\npg_dump: dumping contents of table \"bucardo.delta_public_entrance_master_keys\"\r\npg_dump: dumping contents of table \"bucardo.delta_public_entrance_resident_guest_keys\"\r\npg_dump: dumping contents of table \"bucardo.delta_public_entrance_resident_keys\"\r\npg_dump: dumping contents of table \"bucardo.delta_public_family_keys\"\r\npg_dump: dumping contents of table \"bucardo.delta_public_fob_keys\"\r\npg_dump: dumping contents of table \"bucardo.delta_public_fobs\"\r\npg_dump: dumping contents of table \"bucardo.delta_public_guest_keys\"\r\npg_dump: dumping contents of table \"bucardo.delta_public_hubs\"\r\npg_dump: dumping contents of table \"bucardo.delta_public_invitations\"\r\npg_dump: dumping contents of table \"bucardo.delta_public_json_web_keys\"\r\npg_dump: dumping contents of table \"bucardo.delta_public_knight_cards\"\r\npg_dump: dumping contents of table \"bucardo.delta_public_knight_commands\"\r\npg_dump: dumping contents of table \"bucardo.delta_public_knight_keys\"\r\npg_dump: dumping contents of table \"bucardo.delta_public_knight_logs\"\r\npg_dump: dumping contents of table \"bucardo.delta_public_knight_pins\"\r\npg_dump: dumping contents of table \"bucardo.delta_public_knights\"\r\npg_dump: dumping contents of table \"bucardo.delta_public_laresia_pins\"\r\npg_dump: dumping contents of table \"bucardo.delta_public_lock_settings\"\r\npg_dump: dumping contents of table \"bucardo.delta_public_lock_webhook_tokens\"\r\npg_dump: dumping contents of table \"bucardo.delta_public_locks\"\r\npg_dump: dumping contents of table \"bucardo.delta_public_logs\"\r\npg_dump: dumping contents of table \"bucardo.delta_public_managers\"\r\npg_dump: dumping contents of table \"bucardo.delta_public_master_keys\"\r\npg_dump: dumping contents of table \"bucardo.delta_public_mst_display_logs\"\r\npg_dump: dumping contents of table \"bucardo.delta_public_relationships\"\r\npg_dump: dumping contents of table \"bucardo.delta_public_resident_guest_keys\"\r\npg_dump: dumping contents of table \"bucardo.delta_public_resident_keys\"\r\npg_dump: dumping contents of table \"bucardo.delta_public_schema_migrations\"\r\npg_dump: dumping contents of table \"bucardo.delta_public_term_of_validities\"\r\npg_dump: dumping contents of table \"bucardo.delta_public_users\"\r\npg_dump: dumping contents of table \"bucardo.delta_public_webhook_tokens\"\r\npg_dump: dumping contents of table \"bucardo.delta_public_webhooks\"\r\npg_dump: dumping contents of table \"bucardo.delta_public_weeklies\"\r\npg_dump: dumping contents of table \"bucardo.delta_public_wena_keys\"\r\npg_dump: dumping contents of table \"bucardo.delta_public_wenas\"\r\npg_dump: dumping contents of table \"bucardo.stage_public_active_storage_attachments\"\r\npg_dump: dumping contents of table \"bucardo.stage_public_active_storage_blobs\"\r\npg_dump: dumping contents of table \"bucardo.stage_public_active_storage_variant_records\"\r\npg_dump: dumping contents of table \"bucardo.stage_public_ar_internal_metadata\"\r\npg_dump: dumping contents of table \"bucardo.stage_public_autolock_schedules\"\r\npg_dump: dumping contents of table \"bucardo.stage_public_cards\"\r\npg_dump: dumping contents of table \"bucardo.stage_public_command_logs\"\r\npg_dump: dumping contents of table \"bucardo.stage_public_dailies\"\r\npg_dump: dumping contents of table \"bucardo.stage_public_display_logs\"\r\npg_dump: dumping contents of table \"bucardo.stage_public_door_mode_changed_histories\"\r\npg_dump: dumping contents of table \"bucardo.stage_public_durations\"\r\npg_dump: dumping contents of table \"bucardo.stage_public_entrance_block_fob_keys\"\r\npg_dump: dumping contents of table \"bucardo.stage_public_entrance_block_knight_cards\"\r\npg_dump: dumping contents of table \"bucardo.stage_public_entrance_fob_keys\"\r\npg_dump: dumping contents of table \"bucardo.stage_public_entrance_invitations\"\r\npg_dump: dumping contents of table \"bucardo.stage_public_entrance_knight_keys\"\r\npg_dump: dumping contents of table \"bucardo.stage_public_entrance_knight_pins\"\r\npg_dump: dumping contents of table \"bucardo.stage_public_entrance_lock_settings\"\r\npg_dump: dumping contents of table \"bucardo.stage_public_entrance_locks\"\r\npg_dump: dumping contents of table \"bucardo.stage_public_entrance_master_keys\"\r\npg_dump: dumping contents of table \"bucardo.stage_public_entrance_resident_guest_keys\"\r\npg_dump: dumping contents of table \"bucardo.stage_public_entrance_resident_keys\"\r\npg_dump: dumping contents of table \"bucardo.stage_public_family_keys\"\r\npg_dump: dumping contents of table \"bucardo.stage_public_fob_keys\"\r\npg_dump: dumping contents of table \"bucardo.stage_public_fobs\"\r\npg_dump: dumping contents of table \"bucardo.stage_public_guest_keys\"\r\npg_dump: dumping contents of table \"bucardo.stage_public_hubs\"\r\npg_dump: dumping contents of table \"bucardo.stage_public_invitations\"\r\npg_dump: dumping contents of table \"bucardo.stage_public_json_web_keys\"\r\npg_dump: dumping contents of table \"bucardo.stage_public_knight_cards\"\r\npg_dump: dumping contents of table \"bucardo.stage_public_knight_commands\"\r\npg_dump: dumping contents of table \"bucardo.stage_public_knight_keys\"\r\npg_dump: dumping contents of table \"bucardo.stage_public_knight_logs\"\r\npg_dump: dumping contents of table \"bucardo.stage_public_knight_pins\"\r\npg_dump: dumping contents of table \"bucardo.stage_public_knights\"\r\npg_dump: dumping contents of table \"bucardo.stage_public_laresia_pins\"\r\npg_dump: dumping contents of table \"bucardo.stage_public_lock_settings\"\r\npg_dump: dumping contents of table \"bucardo.stage_public_lock_webhook_tokens\"\r\npg_dump: dumping contents of table \"bucardo.stage_public_locks\"\r\npg_dump: dumping contents of table \"bucardo.stage_public_logs\"\r\npg_dump: dumping contents of table \"bucardo.stage_public_managers\"\r\npg_dump: dumping contents of table \"bucardo.stage_public_master_keys\"\r\npg_dump: dumping contents of table \"bucardo.stage_public_mst_display_logs\"\r\npg_dump: dumping contents of table \"bucardo.stage_public_relationships\"\r\npg_dump: dumping contents of table \"bucardo.stage_public_resident_guest_keys\"\r\npg_dump: dumping contents of table \"bucardo.stage_public_resident_keys\"\r\npg_dump: dumping contents of table \"bucardo.stage_public_schema_migrations\"\r\npg_dump: dumping contents of table \"bucardo.stage_public_term_of_validities\"\r\npg_dump: dumping contents of table \"bucardo.stage_public_users\"\r\npg_dump: dumping contents of table \"bucardo.stage_public_webhook_tokens\"\r\npg_dump: dumping contents of table \"bucardo.stage_public_webhooks\"\r\npg_dump: dumping contents of table \"bucardo.stage_public_weeklies\"\r\npg_dump: dumping contents of table \"bucardo.stage_public_wena_keys\"\r\npg_dump: dumping contents of table \"bucardo.stage_public_wenas\"\r\npg_dump: dumping contents of table \"bucardo.track_public_active_storage_attachments\"\r\npg_dump: dumping contents of table \"bucardo.track_public_active_storage_blobs\"\r\npg_dump: dumping contents of table \"bucardo.track_public_active_storage_variant_records\"\r\npg_dump: dumping contents of table \"bucardo.track_public_ar_internal_metadata\"\r\npg_dump: dumping contents of table \"bucardo.track_public_autolock_schedules\"\r\npg_dump: dumping contents of table \"bucardo.track_public_cards\"\r\npg_dump: dumping contents of table \"bucardo.track_public_command_logs\"\r\npg_dump: dumping contents of table \"bucardo.track_public_dailies\"\r\npg_dump: dumping contents of table \"bucardo.track_public_display_logs\"\r\npg_dump: dumping contents of table \"bucardo.track_public_door_mode_changed_histories\"\r\npg_dump: dumping contents of table \"bucardo.track_public_durations\"\r\npg_dump: dumping contents of table \"bucardo.track_public_entrance_block_fob_keys\"\r\npg_dump: dumping contents of table \"bucardo.track_public_entrance_block_knight_cards\"\r\npg_dump: dumping contents of table \"bucardo.track_public_entrance_fob_keys\"\r\npg_dump: dumping contents of table \"bucardo.track_public_entrance_invitations\"\r\npg_dump: dumping contents of table \"bucardo.track_public_entrance_knight_keys\"\r\npg_dump: dumping contents of table \"bucardo.track_public_entrance_knight_pins\"\r\npg_dump: dumping contents of table \"bucardo.track_public_entrance_lock_settings\"\r\npg_dump: dumping contents of table \"bucardo.track_public_entrance_locks\"\r\npg_dump: dumping contents of table \"bucardo.track_public_entrance_master_keys\"\r\npg_dump: dumping contents of table \"bucardo.track_public_entrance_resident_guest_keys\"\r\npg_dump: dumping contents of table \"bucardo.track_public_entrance_resident_keys\"\r\npg_dump: dumping contents of table \"bucardo.track_public_family_keys\"\r\npg_dump: dumping contents of table \"bucardo.track_public_fob_keys\"\r\npg_dump: dumping contents of table \"bucardo.track_public_fobs\"\r\npg_dump: dumping contents of table \"bucardo.track_public_guest_keys\"\r\npg_dump: dumping contents of table \"bucardo.track_public_hubs\"\r\npg_dump: dumping contents of table \"bucardo.track_public_invitations\"\r\npg_dump: dumping contents of table \"bucardo.track_public_json_web_keys\"\r\npg_dump: dumping contents of table \"bucardo.track_public_knight_cards\"\r\npg_dump: dumping contents of table \"bucardo.track_public_knight_commands\"\r\npg_dump: dumping contents of table \"bucardo.track_public_knight_keys\"\r\npg_dump: dumping contents of table \"bucardo.track_public_knight_logs\"\r\npg_dump: dumping contents of table \"bucardo.track_public_knight_pins\"\r\npg_dump: dumping contents of table \"bucardo.track_public_knights\"\r\npg_dump: dumping contents of table \"bucardo.track_public_laresia_pins\"\r\npg_dump: dumping contents of table \"bucardo.track_public_lock_settings\"\r\npg_dump: dumping contents of table \"bucardo.track_public_lock_webhook_tokens\"\r\npg_dump: dumping contents of table \"bucardo.track_public_locks\"\r\npg_dump: dumping contents of table \"bucardo.track_public_logs\"\r\npg_dump: dumping contents of table \"bucardo.track_public_managers\"\r\npg_dump: dumping contents of table \"bucardo.track_public_master_keys\"\r\npg_dump: dumping contents of table \"bucardo.track_public_mst_display_logs\"\r\npg_dump: dumping contents of table \"bucardo.track_public_relationships\"\r\npg_dump: dumping contents of table \"bucardo.track_public_resident_guest_keys\"\r\npg_dump: dumping contents of table \"bucardo.track_public_resident_keys\"\r\npg_dump: dumping contents of table \"bucardo.track_public_schema_migrations\"\r\npg_dump: dumping contents of table \"bucardo.track_public_term_of_validities\"\r\npg_dump: dumping contents of table \"bucardo.track_public_users\"\r\npg_dump: dumping contents of table \"bucardo.track_public_webhook_tokens\"\r\npg_dump: dumping contents of table \"bucardo.track_public_webhooks\"\r\npg_dump: dumping contents of table \"bucardo.track_public_weeklies\"\r\npg_dump: dumping contents of table \"bucardo.track_public_wena_keys\"\r\npg_dump: dumping contents of table \"bucardo.track_public_wenas\"\r\npg_dump: dumping contents of table \"public.active_storage_blobs\"\r\npg_dump: dumping contents of table \"public.active_storage_attachments\"\r\npg_dump: dumping contents of table \"public.active_storage_variant_records\"\r\npg_dump: dumping contents of table \"public.ar_internal_metadata\"\r\npg_dump: dumping contents of table \"public.locks\"\r\npg_dump: dumping contents of table \"public.users\"\r\npg_dump: dumping contents of table \"public.master_keys\"\r\npg_dump: dumping contents of table \"public.autolock_schedules\"\r\npg_dump: dumping contents of table \"public.cards\"\r\npg_dump: dumping contents of table \"public.hubs\"\r\npg_dump: dumping contents of table \"public.command_logs\"\r\npg_dump: dumping contents of table \"public.term_of_validities\"\r\npg_dump: dumping contents of table \"public.dailies\"\r\npg_dump: dumping contents of table \"public.door_mode_changed_histories\"\r\npg_dump: dumping contents of table \"public.durations\"\r\npg_dump: dumping contents of table \"public.entrance_locks\"\r\npg_dump: dumping contents of table \"public.entrance_master_keys\"\r\npg_dump: dumping contents of table \"public.fobs\"\r\npg_dump: dumping contents of table \"public.fob_keys\"\r\npg_dump: dumping contents of table \"public.entrance_fob_keys\"\r\npg_dump: dumping contents of table \"public.entrance_block_fob_keys\"\r\npg_dump: dumping contents of table \"public.knights\"\r\npg_dump: dumping contents of table \"public.entrance_knight_keys\"\r\npg_dump: dumping contents of table \"public.knight_keys\"\r\npg_dump: dumping contents of table \"public.knight_cards\"\r\npg_dump: dumping contents of table \"public.entrance_block_knight_cards\"\r\npg_dump: dumping contents of table \"public.invitations\"\r\npg_dump: dumping contents of table \"public.entrance_invitations\"\r\npg_dump: dumping contents of table \"public.entrance_knight_pins\"\r\npg_dump: dumping contents of table \"public.entrance_lock_settings\"\r\npg_dump: dumping contents of table \"public.resident_guest_keys\"\r\npg_dump: dumping contents of table \"public.entrance_resident_guest_keys\"\r\npg_dump: dumping contents of table \"public.resident_keys\"\r\npg_dump: dumping contents of table \"public.entrance_resident_keys\"\r\npg_dump: dumping contents of table \"public.family_keys\"\r\npg_dump: dumping contents of table \"public.guest_keys\"\r\npg_dump: dumping contents of table \"public.json_web_keys\"\r\npg_dump: dumping contents of table \"public.knight_commands\"\r\npg_dump: dumping contents of table \"public.knight_logs\"\r\npg_dump: dumping contents of table \"public.knight_pins\"\r\npg_dump: dumping contents of table \"public.laresia_pins\"\r\npg_dump: dumping contents of table \"public.lock_settings\"\r\npg_dump: dumping contents of table \"public.webhook_tokens\"\r\npg_dump: dumping contents of table \"public.lock_webhook_tokens\"\r\npg_dump: dumping contents of table \"public.managers\"\r\npg_dump: dumping contents of table \"public.mst_display_logs\"\r\npg_dump: dumping contents of table \"public.relationships\"\r\npg_dump: dumping contents of table \"public.schema_migrations\"\r\npg_dump: dumping contents of table \"public.webhooks\"\r\npg_dump: dumping contents of table \"public.weeklies\"\r\npg_dump: dumping contents of table \"public.wenas\"\r\npg_dump: dumping contents of table \"public.wena_keys\"\r\n```\r\n\r\n</details>\r\n\r\n#### logs, display_logs以外のrestore\r\n\r\n```sh\r\nroot@d57ada7337a5:/# pg_restore --verbose --data-only -h king-api-cfn-test.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com -d kingapi -U kingadmin -p 5432 main_data.dump\r\n```\r\n\r\n<details>\r\n\r\n```sh\r\npg_restore: connecting to database for restore\r\npg_restore: processing data for table \"bucardo.bucardo_delta_names\"\r\npg_restore: processing data for table \"bucardo.bucardo_delta_targets\"\r\npg_restore: processing data for table \"bucardo.bucardo_sequences\"\r\npg_restore: processing data for table \"bucardo.bucardo_truncate_trigger\"\r\npg_restore: processing data for table \"bucardo.bucardo_truncate_trigger_log\"\r\npg_restore: processing data for table \"bucardo.delta_public_active_storage_attachments\"\r\npg_restore: processing data for table \"bucardo.delta_public_active_storage_blobs\"\r\npg_restore: processing data for table \"bucardo.delta_public_active_storage_variant_records\"\r\npg_restore: processing data for table \"bucardo.delta_public_ar_internal_metadata\"\r\npg_restore: processing data for table \"bucardo.delta_public_autolock_schedules\"\r\npg_restore: processing data for table \"bucardo.delta_public_cards\"\r\npg_restore: processing data for table \"bucardo.delta_public_command_logs\"\r\npg_restore: processing data for table \"bucardo.delta_public_dailies\"\r\npg_restore: processing data for table \"bucardo.delta_public_display_logs\"\r\npg_restore: processing data for table \"bucardo.delta_public_door_mode_changed_histories\"\r\npg_restore: processing data for table \"bucardo.delta_public_durations\"\r\npg_restore: processing data for table \"bucardo.delta_public_entrance_block_fob_keys\"\r\npg_restore: processing data for table \"bucardo.delta_public_entrance_block_knight_cards\"\r\npg_restore: processing data for table \"bucardo.delta_public_entrance_fob_keys\"\r\npg_restore: processing data for table \"bucardo.delta_public_entrance_invitations\"\r\npg_restore: processing data for table \"bucardo.delta_public_entrance_knight_keys\"\r\npg_restore: processing data for table \"bucardo.delta_public_entrance_knight_pins\"\r\npg_restore: processing data for table \"bucardo.delta_public_entrance_lock_settings\"\r\npg_restore: processing data for table \"bucardo.delta_public_entrance_locks\"\r\npg_restore: processing data for table \"bucardo.delta_public_entrance_master_keys\"\r\npg_restore: processing data for table \"bucardo.delta_public_entrance_resident_guest_keys\"\r\npg_restore: processing data for table \"bucardo.delta_public_entrance_resident_keys\"\r\npg_restore: processing data for table \"bucardo.delta_public_family_keys\"\r\npg_restore: processing data for table \"bucardo.delta_public_fob_keys\"\r\npg_restore: processing data for table \"bucardo.delta_public_fobs\"\r\npg_restore: processing data for table \"bucardo.delta_public_guest_keys\"\r\npg_restore: processing data for table \"bucardo.delta_public_hubs\"\r\npg_restore: processing data for table \"bucardo.delta_public_invitations\"\r\npg_restore: processing data for table \"bucardo.delta_public_json_web_keys\"\r\npg_restore: processing data for table \"bucardo.delta_public_knight_cards\"\r\npg_restore: processing data for table \"bucardo.delta_public_knight_commands\"\r\npg_restore: processing data for table \"bucardo.delta_public_knight_keys\"\r\npg_restore: processing data for table \"bucardo.delta_public_knight_logs\"\r\npg_restore: processing data for table \"bucardo.delta_public_knight_pins\"\r\npg_restore: processing data for table \"bucardo.delta_public_knights\"\r\npg_restore: processing data for table \"bucardo.delta_public_laresia_pins\"\r\npg_restore: processing data for table \"bucardo.delta_public_lock_settings\"\r\npg_restore: processing data for table \"bucardo.delta_public_lock_webhook_tokens\"\r\npg_restore: processing data for table \"bucardo.delta_public_locks\"\r\npg_restore: processing data for table \"bucardo.delta_public_logs\"\r\npg_restore: processing data for table \"bucardo.delta_public_managers\"\r\npg_restore: processing data for table \"bucardo.delta_public_master_keys\"\r\npg_restore: processing data for table \"bucardo.delta_public_mst_display_logs\"\r\npg_restore: processing data for table \"bucardo.delta_public_relationships\"\r\npg_restore: processing data for table \"bucardo.delta_public_resident_guest_keys\"\r\npg_restore: processing data for table \"bucardo.delta_public_resident_keys\"\r\npg_restore: processing data for table \"bucardo.delta_public_schema_migrations\"\r\npg_restore: processing data for table \"bucardo.delta_public_term_of_validities\"\r\npg_restore: processing data for table \"bucardo.delta_public_users\"\r\npg_restore: processing data for table \"bucardo.delta_public_webhook_tokens\"\r\npg_restore: processing data for table \"bucardo.delta_public_webhooks\"\r\npg_restore: processing data for table \"bucardo.delta_public_weeklies\"\r\npg_restore: processing data for table \"bucardo.delta_public_wena_keys\"\r\npg_restore: processing data for table \"bucardo.delta_public_wenas\"\r\npg_restore: processing data for table \"bucardo.stage_public_active_storage_attachments\"\r\npg_restore: processing data for table \"bucardo.stage_public_active_storage_blobs\"\r\npg_restore: processing data for table \"bucardo.stage_public_active_storage_variant_records\"\r\npg_restore: processing data for table \"bucardo.stage_public_ar_internal_metadata\"\r\npg_restore: processing data for table \"bucardo.stage_public_autolock_schedules\"\r\npg_restore: processing data for table \"bucardo.stage_public_cards\"\r\npg_restore: processing data for table \"bucardo.stage_public_command_logs\"\r\npg_restore: processing data for table \"bucardo.stage_public_dailies\"\r\npg_restore: processing data for table \"bucardo.stage_public_display_logs\"\r\npg_restore: processing data for table \"bucardo.stage_public_door_mode_changed_histories\"\r\npg_restore: processing data for table \"bucardo.stage_public_durations\"\r\npg_restore: processing data for table \"bucardo.stage_public_entrance_block_fob_keys\"\r\npg_restore: processing data for table \"bucardo.stage_public_entrance_block_knight_cards\"\r\npg_restore: processing data for table \"bucardo.stage_public_entrance_fob_keys\"\r\npg_restore: processing data for table \"bucardo.stage_public_entrance_invitations\"\r\npg_restore: processing data for table \"bucardo.stage_public_entrance_knight_keys\"\r\npg_restore: processing data for table \"bucardo.stage_public_entrance_knight_pins\"\r\npg_restore: processing data for table \"bucardo.stage_public_entrance_lock_settings\"\r\npg_restore: processing data for table \"bucardo.stage_public_entrance_locks\"\r\npg_restore: processing data for table \"bucardo.stage_public_entrance_master_keys\"\r\npg_restore: processing data for table \"bucardo.stage_public_entrance_resident_guest_keys\"\r\npg_restore: processing data for table \"bucardo.stage_public_entrance_resident_keys\"\r\npg_restore: processing data for table \"bucardo.stage_public_family_keys\"\r\npg_restore: processing data for table \"bucardo.stage_public_fob_keys\"\r\npg_restore: processing data for table \"bucardo.stage_public_fobs\"\r\npg_restore: processing data for table \"bucardo.stage_public_guest_keys\"\r\npg_restore: processing data for table \"bucardo.stage_public_hubs\"\r\npg_restore: processing data for table \"bucardo.stage_public_invitations\"\r\npg_restore: processing data for table \"bucardo.stage_public_json_web_keys\"\r\npg_restore: processing data for table \"bucardo.stage_public_knight_cards\"\r\npg_restore: processing data for table \"bucardo.stage_public_knight_commands\"\r\npg_restore: processing data for table \"bucardo.stage_public_knight_keys\"\r\npg_restore: processing data for table \"bucardo.stage_public_knight_logs\"\r\npg_restore: processing data for table \"bucardo.stage_public_knight_pins\"\r\npg_restore: processing data for table \"bucardo.stage_public_knights\"\r\npg_restore: processing data for table \"bucardo.stage_public_laresia_pins\"\r\npg_restore: processing data for table \"bucardo.stage_public_lock_settings\"\r\npg_restore: processing data for table \"bucardo.stage_public_lock_webhook_tokens\"\r\npg_restore: processing data for table \"bucardo.stage_public_locks\"\r\npg_restore: processing data for table \"bucardo.stage_public_logs\"\r\npg_restore: processing data for table \"bucardo.stage_public_managers\"\r\npg_restore: processing data for table \"bucardo.stage_public_master_keys\"\r\npg_restore: processing data for table \"bucardo.stage_public_mst_display_logs\"\r\npg_restore: processing data for table \"bucardo.stage_public_relationships\"\r\npg_restore: processing data for table \"bucardo.stage_public_resident_guest_keys\"\r\npg_restore: processing data for table \"bucardo.stage_public_resident_keys\"\r\npg_restore: processing data for table \"bucardo.stage_public_schema_migrations\"\r\npg_restore: processing data for table \"bucardo.stage_public_term_of_validities\"\r\npg_restore: processing data for table \"bucardo.stage_public_users\"\r\npg_restore: processing data for table \"bucardo.stage_public_webhook_tokens\"\r\npg_restore: processing data for table \"bucardo.stage_public_webhooks\"\r\npg_restore: processing data for table \"bucardo.stage_public_weeklies\"\r\npg_restore: processing data for table \"bucardo.stage_public_wena_keys\"\r\npg_restore: processing data for table \"bucardo.stage_public_wenas\"\r\npg_restore: processing data for table \"bucardo.track_public_active_storage_attachments\"\r\npg_restore: processing data for table \"bucardo.track_public_active_storage_blobs\"\r\npg_restore: processing data for table \"bucardo.track_public_active_storage_variant_records\"\r\npg_restore: processing data for table \"bucardo.track_public_ar_internal_metadata\"\r\npg_restore: processing data for table \"bucardo.track_public_autolock_schedules\"\r\npg_restore: processing data for table \"bucardo.track_public_cards\"\r\npg_restore: processing data for table \"bucardo.track_public_command_logs\"\r\npg_restore: processing data for table \"bucardo.track_public_dailies\"\r\npg_restore: processing data for table \"bucardo.track_public_display_logs\"\r\npg_restore: processing data for table \"bucardo.track_public_door_mode_changed_histories\"\r\npg_restore: processing data for table \"bucardo.track_public_durations\"\r\npg_restore: processing data for table \"bucardo.track_public_entrance_block_fob_keys\"\r\npg_restore: processing data for table \"bucardo.track_public_entrance_block_knight_cards\"\r\npg_restore: processing data for table \"bucardo.track_public_entrance_fob_keys\"\r\npg_restore: processing data for table \"bucardo.track_public_entrance_invitations\"\r\npg_restore: processing data for table \"bucardo.track_public_entrance_knight_keys\"\r\npg_restore: processing data for table \"bucardo.track_public_entrance_knight_pins\"\r\npg_restore: processing data for table \"bucardo.track_public_entrance_lock_settings\"\r\npg_restore: processing data for table \"bucardo.track_public_entrance_locks\"\r\npg_restore: processing data for table \"bucardo.track_public_entrance_master_keys\"\r\npg_restore: processing data for table \"bucardo.track_public_entrance_resident_guest_keys\"\r\npg_restore: processing data for table \"bucardo.track_public_entrance_resident_keys\"\r\npg_restore: processing data for table \"bucardo.track_public_family_keys\"\r\npg_restore: processing data for table \"bucardo.track_public_fob_keys\"\r\npg_restore: processing data for table \"bucardo.track_public_fobs\"\r\npg_restore: processing data for table \"bucardo.track_public_guest_keys\"\r\npg_restore: processing data for table \"bucardo.track_public_hubs\"\r\npg_restore: processing data for table \"bucardo.track_public_invitations\"\r\npg_restore: processing data for table \"bucardo.track_public_json_web_keys\"\r\npg_restore: processing data for table \"bucardo.track_public_knight_cards\"\r\npg_restore: processing data for table \"bucardo.track_public_knight_commands\"\r\npg_restore: processing data for table \"bucardo.track_public_knight_keys\"\r\npg_restore: processing data for table \"bucardo.track_public_knight_logs\"\r\npg_restore: processing data for table \"bucardo.track_public_knight_pins\"\r\npg_restore: processing data for table \"bucardo.track_public_knights\"\r\npg_restore: processing data for table \"bucardo.track_public_laresia_pins\"\r\npg_restore: processing data for table \"bucardo.track_public_lock_settings\"\r\npg_restore: processing data for table \"bucardo.track_public_lock_webhook_tokens\"\r\npg_restore: processing data for table \"bucardo.track_public_locks\"\r\npg_restore: processing data for table \"bucardo.track_public_logs\"\r\npg_restore: processing data for table \"bucardo.track_public_managers\"\r\npg_restore: processing data for table \"bucardo.track_public_master_keys\"\r\npg_restore: processing data for table \"bucardo.track_public_mst_display_logs\"\r\npg_restore: processing data for table \"bucardo.track_public_relationships\"\r\npg_restore: processing data for table \"bucardo.track_public_resident_guest_keys\"\r\npg_restore: processing data for table \"bucardo.track_public_resident_keys\"\r\npg_restore: processing data for table \"bucardo.track_public_schema_migrations\"\r\npg_restore: processing data for table \"bucardo.track_public_term_of_validities\"\r\npg_restore: processing data for table \"bucardo.track_public_users\"\r\npg_restore: processing data for table \"bucardo.track_public_webhook_tokens\"\r\npg_restore: processing data for table \"bucardo.track_public_webhooks\"\r\npg_restore: processing data for table \"bucardo.track_public_weeklies\"\r\npg_restore: processing data for table \"bucardo.track_public_wena_keys\"\r\npg_restore: processing data for table \"bucardo.track_public_wenas\"\r\npg_restore: processing data for table \"public.active_storage_blobs\"\r\npg_restore: processing data for table \"public.active_storage_attachments\"\r\npg_restore: processing data for table \"public.active_storage_variant_records\"\r\npg_restore: processing data for table \"public.ar_internal_metadata\"\r\npg_restore: processing data for table \"public.locks\"\r\npg_restore: processing data for table \"public.users\"\r\npg_restore: processing data for table \"public.master_keys\"\r\npg_restore: processing data for table \"public.autolock_schedules\"\r\npg_restore: processing data for table \"public.cards\"\r\npg_restore: processing data for table \"public.hubs\"\r\npg_restore: processing data for table \"public.command_logs\"\r\npg_restore: processing data for table \"public.term_of_validities\"\r\npg_restore: processing data for table \"public.dailies\"\r\npg_restore: processing data for table \"public.door_mode_changed_histories\"\r\npg_restore: processing data for table \"public.durations\"\r\npg_restore: processing data for table \"public.entrance_locks\"\r\npg_restore: processing data for table \"public.entrance_master_keys\"\r\npg_restore: processing data for table \"public.fobs\"\r\npg_restore: processing data for table \"public.fob_keys\"\r\npg_restore: processing data for table \"public.entrance_fob_keys\"\r\npg_restore: processing data for table \"public.entrance_block_fob_keys\"\r\npg_restore: processing data for table \"public.knights\"\r\npg_restore: processing data for table \"public.entrance_knight_keys\"\r\npg_restore: processing data for table \"public.knight_keys\"\r\npg_restore: processing data for table \"public.knight_cards\"\r\npg_restore: processing data for table \"public.entrance_block_knight_cards\"\r\npg_restore: processing data for table \"public.invitations\"\r\npg_restore: processing data for table \"public.entrance_invitations\"\r\npg_restore: processing data for table \"public.entrance_knight_pins\"\r\npg_restore: processing data for table \"public.entrance_lock_settings\"\r\npg_restore: processing data for table \"public.resident_guest_keys\"\r\npg_restore: processing data for table \"public.entrance_resident_guest_keys\"\r\npg_restore: processing data for table \"public.resident_keys\"\r\npg_restore: processing data for table \"public.entrance_resident_keys\"\r\npg_restore: processing data for table \"public.family_keys\"\r\npg_restore: processing data for table \"public.guest_keys\"\r\npg_restore: processing data for table \"public.json_web_keys\"\r\npg_restore: processing data for table \"public.knight_commands\"\r\npg_restore: processing data for table \"public.knight_logs\"\r\npg_restore: processing data for table \"public.knight_pins\"\r\npg_restore: processing data for table \"public.laresia_pins\"\r\npg_restore: processing data for table \"public.lock_settings\"\r\npg_restore: processing data for table \"public.webhook_tokens\"\r\npg_restore: processing data for table \"public.lock_webhook_tokens\"\r\npg_restore: processing data for table \"public.managers\"\r\npg_restore: processing data for table \"public.mst_display_logs\"\r\npg_restore: processing data for table \"public.relationships\"\r\npg_restore: processing data for table \"public.schema_migrations\"\r\npg_restore: processing data for table \"public.webhooks\"\r\npg_restore: processing data for table \"public.weeklies\"\r\npg_restore: processing data for table \"public.wenas\"\r\npg_restore: processing data for table \"public.wena_keys\"\r\npg_restore: executing SEQUENCE SET active_storage_attachments_id_seq\r\npg_restore: executing SEQUENCE SET active_storage_blobs_id_seq\r\npg_restore: executing SEQUENCE SET active_storage_variant_records_id_seq\r\npg_restore: executing SEQUENCE SET json_web_keys_id_seq\r\n```\r\n\r\n\r\n</details>",
    "body_html": "<h2 data-sourcepos=\"1:1-1:30\" id=\"0-1-0\" name=\"0-1-0\"><a class=\"anchor\" id=\"実験1(環境準備ミス)\" name=\"実験1(環境準備ミス)\" href=\"#実験1(環境準備ミス)\" data-position=\"0-1-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"実験1(環境準備ミス)\"> &gt; 実験1(環境準備ミス)</span></a>実験1(環境準備ミス)</h2>\n<h3 data-sourcepos=\"2:1-2:10\" id=\"0-1-1\" name=\"0-1-1\"><a class=\"anchor\" id=\"結果\" name=\"結果\" href=\"#結果\" data-position=\"0-1-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"結果\"> &gt; 結果</span></a>結果</h3>\n<h4 data-sourcepos=\"3:1-3:38\">初期のsession_replication_role</h4>\n<ul data-sourcepos=\"4:1-5:0\">\n<li data-sourcepos=\"4:1-5:0\">origin</li>\n</ul>\n<h4 data-sourcepos=\"6:1-6:89\">session_replication_roleをパラメータグループから変更した際の挙動</h4>\n<ul data-sourcepos=\"7:1-8:51\">\n<li data-sourcepos=\"7:1-7:17\">再起動せず</li>\n<li data-sourcepos=\"8:1-8:51\">session_replication_roleがreplicaに変わった</li>\n</ul>\n<h4 data-sourcepos=\"9:1-9:45\">logs, display_logsテーブルのrestore</h4>\n<ul data-sourcepos=\"10:1-12:77\">\n<li data-sourcepos=\"10:1-10:14\">成功した</li>\n<li data-sourcepos=\"11:1-12:77\">しかし、<code>ALTER TABLE public.logs DISABLE TRIGGER ALL;</code>のエラーが出た\n<ul data-sourcepos=\"12:5-12:77\">\n<li data-sourcepos=\"12:5-12:77\"><code>--disable-triggers</code>オプションを消し忘れていたのが原因</li>\n</ul></li>\n</ul>\n<h4 data-sourcepos=\"13:1-13:86\">session_replication_roleをパラメータグループから戻した際の挙動</h4>\n<ul data-sourcepos=\"14:1-15:47\">\n<li data-sourcepos=\"14:1-14:17\">再起動せず</li>\n<li data-sourcepos=\"15:1-15:47\">session_replication_roleがoriginに戻った</li>\n</ul>\n<h4 data-sourcepos=\"16:1-16:24\">main_dataのrestore</h4>\n<ul data-sourcepos=\"17:1-20:0\">\n<li data-sourcepos=\"17:1-17:14\">成功した</li>\n<li data-sourcepos=\"18:1-20:0\">しかし、<strong>以前の</strong>bucardoスキーマがdumpされていてそれも投入された\n<ul data-sourcepos=\"19:5-20:0\">\n<li data-sourcepos=\"19:5-20:0\">以前の検証環境でのbucardo利用後、HerokuDB側のbucardoスキーマを削除していなかった</li>\n</ul></li>\n</ul>\n<h3 data-sourcepos=\"21:1-21:10\" id=\"0-1-2\" name=\"0-1-2\"><a class=\"anchor\" id=\"内容\" name=\"内容\" href=\"#内容\" data-position=\"0-1-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"内容\"> &gt; 内容</span></a>内容</h3>\n<p data-sourcepos=\"23:1-23:206\"><a href=\"https://docs.google.com/spreadsheets/d/1W3DymCJ_ifiXtSUwVAjcl9tzPGfz5WE6bmnnwYL9Gbo/edit#gid=602303325\" target=\"_blank\" rel=\"noopener noreferrer\">移行手順書</a>のBucardoの設定、データプールの開始まで終わっている状態以降</p>\n<h4 data-sourcepos=\"25:1-25:31\">logsとdisplay_logsのdump</h4>\n<div class=\"code-block\" data-sourcepos=\"27:1-29:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>pg_dump <span class=\"nt\">--format</span><span class=\"o\">=</span>custom <span class=\"nt\">--verbose</span> <span class=\"nt\">--data-only</span> <span class=\"nt\">--table</span><span class=\"o\">=</span>logs <span class=\"nt\">--table</span><span class=\"o\">=</span>display_logs <span class=\"nt\">-h</span> vpce-0e9251c411c13ce7a-zursyjry.vpce-svc-08edb438435192caf.ap-northeast-1.vpce.amazonaws.com <span class=\"nt\">-p</span> 5432 <span class=\"nt\">-d</span> d6ci42p2305kgu <span class=\"nt\">-U</span> uc3938nrsvfra <span class=\"o\">&gt;</span> logs_displaylogs.dump\n</code></pre></div></div>\n<details>\n<div class=\"code-block\" data-sourcepos=\"32:1-89:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>pg_dump: last built-in OID is 16383\npg_dump: reading extensions\npg_dump: identifying extension members\npg_dump: reading schemas\npg_dump: reading user-defined tables\npg_dump: reading user-defined functions\npg_dump: reading user-defined types\npg_dump: reading procedural languages\npg_dump: reading user-defined aggregate functions\npg_dump: reading user-defined operators\npg_dump: reading user-defined access methods\npg_dump: reading user-defined operator classes\npg_dump: reading user-defined operator families\npg_dump: reading user-defined text search parsers\npg_dump: reading user-defined text search templates\npg_dump: reading user-defined text search dictionaries\npg_dump: reading user-defined text search configurations\npg_dump: reading user-defined foreign-data wrappers\npg_dump: reading user-defined foreign servers\npg_dump: reading default privileges\npg_dump: reading user-defined collations\npg_dump: reading user-defined conversions\npg_dump: reading <span class=\"nb\">type </span>casts\npg_dump: reading transforms\npg_dump: reading table inheritance information\npg_dump: reading event triggers\npg_dump: finding extension tables\npg_dump: finding inheritance relationships\npg_dump: reading column info <span class=\"k\">for </span>interesting tables\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.display_logs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.logs\"</span>\npg_dump: flagging inherited columns <span class=\"k\">in </span>subtables\npg_dump: reading indexes\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.display_logs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.logs\"</span>\npg_dump: flagging indexes <span class=\"k\">in </span>partitioned tables\npg_dump: reading extended statistics\npg_dump: reading constraints\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.display_logs\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.logs\"</span>\npg_dump: reading triggers\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.display_logs\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.logs\"</span>\npg_dump: reading rewrite rules\npg_dump: reading policies\npg_dump: reading row-level security policies\npg_dump: reading publications\npg_dump: reading publication membership\npg_dump: reading subscriptions\npg_dump: reading dependency data\npg_dump: saving encoding <span class=\"o\">=</span> UTF8\npg_dump: saving standard_conforming_strings <span class=\"o\">=</span> on\npg_dump: saving search_path <span class=\"o\">=</span> \npg_dump: saving database definition\npg_dump: dumping contents of table <span class=\"s2\">\"public.display_logs\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.logs\"</span>\n</code></pre></div></div>\n</details>\n<h4 data-sourcepos=\"93:1-93:47\">session_replication_roleの初期値確認</h4>\n<div class=\"code-block\" data-sourcepos=\"95:1-101:3\"><div class=\"highlight\"><pre class=\"highlight plaintext\"><code>kingapi=&gt; show session_replication_role;\n session_replication_role \n--------------------------\n origin\n(1 row)\n</code></pre></div></div>\n<h4 data-sourcepos=\"102:1-102:58\">新手順 session_replication_roleをreplicaにする</h4>\n<p data-sourcepos=\"104:1-109:205\">パラメータグループをコピー(king-api-cfn-test-parametergroup-copy)して、session_replication_roleの値を'replica'にして保存する<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/03/31/136273/d8d74da8-3c6e-4f8b-944e-5cef09c74afb.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"1565\" alt=\"スクリーンショット 2023-03-31 12.27.35.png (115.7 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/03/31/136273/d8d74da8-3c6e-4f8b-944e-5cef09c74afb.png\"></a><br>\nDBクラスタの「変更」からDBクラスターのパラメータグループをking-api-cfn-test-parametergroup-copyを選択<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/03/31/136273/baa4b279-4731-4f24-a1f4-eb95d6d239fc.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"762\" alt=\"スクリーンショット 2023-03-31 12.28.03.png (68.3 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/03/31/136273/baa4b279-4731-4f24-a1f4-eb95d6d239fc.png\"></a><br>\n変更を「すぐに適用」する<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/03/31/136273/5bac49e8-8315-4425-b6e8-f43df34dfedc.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"783\" alt=\"スクリーンショット 2023-03-31 12.28.15.png (94.8 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/03/31/136273/5bac49e8-8315-4425-b6e8-f43df34dfedc.png\"></a></p>\n<p data-sourcepos=\"111:1-112:206\">再起動は起こらなかったが、適用できた<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/03/31/136273/af1f9499-200f-4734-83c8-603e0ecf40bd.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"793\" alt=\"スクリーンショット 2023-03-31 12.29.41.png (102.4 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/03/31/136273/af1f9499-200f-4734-83c8-603e0ecf40bd.png\"></a></p>\n<h4 data-sourcepos=\"114:1-114:50\">session_replication_roleの変更適用確認</h4>\n<div class=\"code-block\" data-sourcepos=\"115:1-121:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code><span class=\"nv\">kingapi</span><span class=\"o\">=&gt;</span> show session_replication_role<span class=\"p\">;</span>\n session_replication_role \n<span class=\"nt\">--------------------------</span>\n replica\n<span class=\"o\">(</span>1 row<span class=\"o\">)</span>\n</code></pre></div></div>\n<h4 data-sourcepos=\"123:1-123:33\">logs, display_logsのrestore</h4>\n<div class=\"code-block\" data-sourcepos=\"124:1-126:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>root@d57ada7337a5:/# pg_restore <span class=\"nt\">--verbose</span> <span class=\"nt\">--data-only</span> <span class=\"nt\">--disable-triggers</span> <span class=\"nt\">-h</span> king-api-cfn-test.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com <span class=\"nt\">-U</span> kingadmin <span class=\"nt\">-d</span> kingapi <span class=\"nt\">-p</span> 5432 logs_displaylogs.dump\n</code></pre></div></div>\n<details>\n<div class=\"code-block\" data-sourcepos=\"130:1-154:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>pg_restore: connecting to database <span class=\"k\">for </span>restore\npg_restore: disabling triggers <span class=\"k\">for </span>display_logs\npg_restore: <span class=\"k\">while </span>PROCESSING TOC:\npg_restore: from TOC entry 5105<span class=\"p\">;</span> 0 18155 TABLE DATA display_logs uc3938nrsvfra\npg_restore: error: could not execute query: ERROR:  permission denied: <span class=\"s2\">\"RI_ConstraintTrigger_c_22614\"</span> is a system trigger\nCommand was: ALTER TABLE public.display_logs DISABLE TRIGGER ALL<span class=\"p\">;</span>\n\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.display_logs\"</span>\npg_restore: enabling triggers <span class=\"k\">for </span>display_logs\npg_restore: error: could not execute query: ERROR:  permission denied: <span class=\"s2\">\"RI_ConstraintTrigger_c_22614\"</span> is a system trigger\nCommand was: ALTER TABLE public.display_logs ENABLE TRIGGER ALL<span class=\"p\">;</span>\n\npg_restore: disabling triggers <span class=\"k\">for </span>logs\npg_restore: from TOC entry 5106<span class=\"p\">;</span> 0 18351 TABLE DATA logs uc3938nrsvfra\npg_restore: error: could not execute query: ERROR:  permission denied: <span class=\"s2\">\"RI_ConstraintTrigger_c_22819\"</span> is a system trigger\nCommand was: ALTER TABLE public.logs DISABLE TRIGGER ALL<span class=\"p\">;</span>\n\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.logs\"</span>\npg_restore: enabling triggers <span class=\"k\">for </span>logs\npg_restore: error: could not execute query: ERROR:  permission denied: <span class=\"s2\">\"RI_ConstraintTrigger_c_22819\"</span> is a system trigger\nCommand was: ALTER TABLE public.logs ENABLE TRIGGER ALL<span class=\"p\">;</span>\n\npg_restore: warning: errors ignored on restore: 4\n</code></pre></div></div>\n</details>\n<p data-sourcepos=\"158:1-158:150\"><code>--disable-triggers</code>が入っているためRDSにおける実行不可能な<code>ALTER TABLE *** DISABLE TRIGGER ALL</code>のエラーが発生している。</p>\n<h4 data-sourcepos=\"160:1-160:17\">行数確認</h4>\n<p data-sourcepos=\"161:1-161:18\">同数となった</p>\n<div class=\"code-block\" data-sourcepos=\"162:1-174:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sql</div><div class=\"highlight\"><pre class=\"highlight sql\"><code><span class=\"n\">kingapi</span><span class=\"o\">=&gt;</span> <span class=\"k\">select</span> <span class=\"k\">count</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"p\">)</span> <span class=\"k\">from</span> <span class=\"n\">logs</span><span class=\"p\">;</span>\n <span class=\"k\">count</span> \n<span class=\"c1\">-------</span>\n <span class=\"mi\">23759</span>\n<span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"k\">row</span><span class=\"p\">)</span>\n\n<span class=\"n\">kingapi</span><span class=\"o\">=&gt;</span> <span class=\"k\">select</span> <span class=\"k\">count</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"p\">)</span> <span class=\"k\">from</span> <span class=\"n\">display_logs</span><span class=\"p\">;</span>\n <span class=\"k\">count</span> \n<span class=\"c1\">-------</span>\n  <span class=\"mi\">1125</span>\n<span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"k\">row</span><span class=\"p\">)</span>\n</code></pre></div></div>\n<div class=\"code-block\" data-sourcepos=\"176:1-188:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sql</div><div class=\"highlight\"><pre class=\"highlight sql\"><code><span class=\"n\">sl2</span><span class=\"o\">-</span><span class=\"n\">api</span><span class=\"o\">-</span><span class=\"n\">db</span><span class=\"o\">-</span><span class=\"n\">migration</span><span class=\"o\">-</span><span class=\"n\">test</span><span class=\"p\">::</span><span class=\"k\">DATABASE</span><span class=\"o\">=&gt;</span> <span class=\"k\">select</span> <span class=\"k\">count</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"p\">)</span> <span class=\"k\">from</span> <span class=\"n\">logs</span><span class=\"p\">;</span>\n <span class=\"k\">count</span>\n<span class=\"c1\">-------</span>\n <span class=\"mi\">23759</span>\n<span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"k\">row</span><span class=\"p\">)</span>\n\n<span class=\"n\">sl2</span><span class=\"o\">-</span><span class=\"n\">api</span><span class=\"o\">-</span><span class=\"n\">db</span><span class=\"o\">-</span><span class=\"n\">migration</span><span class=\"o\">-</span><span class=\"n\">test</span><span class=\"p\">::</span><span class=\"k\">DATABASE</span><span class=\"o\">=&gt;</span> <span class=\"k\">select</span> <span class=\"k\">count</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"p\">)</span> <span class=\"k\">from</span> <span class=\"n\">display_logs</span><span class=\"p\">;</span>\n <span class=\"k\">count</span>\n<span class=\"c1\">-------</span>\n  <span class=\"mi\">1125</span>\n<span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"k\">row</span><span class=\"p\">)</span>\n</code></pre></div></div>\n<h4 data-sourcepos=\"190:1-190:41\">パラメータグループを戻す</h4>\n<p data-sourcepos=\"191:1-192:205\">先ほどと同様に、パラメータグループを元々ついていたものに戻す<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/4178/2023/03/31/136273/cee6ce7d-ca7b-4134-9bf1-6f49e829c008.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"764\" alt=\"スクリーンショット 2023-03-31 12.46.09.png (62.7 kB)\" src=\"https://img.esa.io/uploads/production/attachments/4178/2023/03/31/136273/cee6ce7d-ca7b-4134-9bf1-6f49e829c008.png\"></a></p>\n<h4 data-sourcepos=\"194:1-194:35\">session_replication_role確認</h4>\n<div class=\"code-block\" data-sourcepos=\"196:1-202:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code><span class=\"nv\">kingapi</span><span class=\"o\">=&gt;</span> show session_replication_role<span class=\"p\">;</span>\n session_replication_role \n<span class=\"nt\">--------------------------</span>\n origin\n<span class=\"o\">(</span>1 row<span class=\"o\">)</span>\n</code></pre></div></div>\n<h4 data-sourcepos=\"204:1-204:36\">logs, display_logs以外のdump</h4>\n<div class=\"code-block\" data-sourcepos=\"206:1-208:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>root@d57ada7337a5:/# pg_dump <span class=\"nt\">--format</span><span class=\"o\">=</span>custom <span class=\"nt\">--verbose</span> <span class=\"nt\">--data-only</span> <span class=\"nt\">--exclude-table</span><span class=\"o\">=</span>logs <span class=\"nt\">--exclude-table</span><span class=\"o\">=</span>display_logs <span class=\"nt\">-h</span> vpce-0e9251c411c13ce7a-zursyjry.vpce-svc-08edb438435192caf.ap-northeast-1.vpce.amazonaws.com <span class=\"nt\">-d</span> d6ci42p2305kgu <span class=\"nt\">-U</span> uc3938nrsvfra <span class=\"nt\">-p</span> 5432 <span class=\"o\">&gt;</span>main_data.dump\n</code></pre></div></div>\n<details>\n<div class=\"code-block\" data-sourcepos=\"212:1-970:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>pg_dump: last built-in OID is 16383\npg_dump: reading extensions\npg_dump: identifying extension members\npg_dump: reading schemas\npg_dump: reading user-defined tables\npg_dump: reading user-defined functions\npg_dump: reading user-defined types\npg_dump: reading procedural languages\npg_dump: reading user-defined aggregate functions\npg_dump: reading user-defined operators\npg_dump: reading user-defined access methods\npg_dump: reading user-defined operator classes\npg_dump: reading user-defined operator families\npg_dump: reading user-defined text search parsers\npg_dump: reading user-defined text search templates\npg_dump: reading user-defined text search dictionaries\npg_dump: reading user-defined text search configurations\npg_dump: reading user-defined foreign-data wrappers\npg_dump: reading user-defined foreign servers\npg_dump: reading default privileges\npg_dump: reading user-defined collations\npg_dump: reading user-defined conversions\npg_dump: reading <span class=\"nb\">type </span>casts\npg_dump: reading transforms\npg_dump: reading table inheritance information\npg_dump: reading event triggers\npg_dump: finding extension tables\npg_dump: finding inheritance relationships\npg_dump: reading column info <span class=\"k\">for </span>interesting tables\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.pg_stat_statements_info\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.pg_stat_statements\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.active_storage_attachments\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.active_storage_blobs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.active_storage_variant_records\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.ar_internal_metadata\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.autolock_schedules\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.cards\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.command_logs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.dailies\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.door_mode_changed_histories\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.durations\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.entrance_block_fob_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.entrance_block_knight_cards\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.entrance_fob_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.entrance_invitations\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.entrance_knight_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.entrance_knight_pins\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.entrance_lock_settings\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.entrance_locks\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.entrance_master_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.entrance_resident_guest_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.entrance_resident_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.family_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.fob_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.fobs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.guest_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.hubs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.invitations\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.json_web_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.knight_cards\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.knight_commands\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.knight_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.knight_logs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.knight_pins\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.knights\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.laresia_pins\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.lock_settings\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.lock_webhook_tokens\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.locks\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.managers\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.master_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.mst_display_logs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.relationships\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.resident_guest_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.resident_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.schema_migrations\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.term_of_validities\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.users\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.webhook_tokens\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.webhooks\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.weeklies\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.wena_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.wenas\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.bucardo_delta_names\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.bucardo_delta_targets\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.bucardo_truncate_trigger\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.bucardo_truncate_trigger_log\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.bucardo_sequences\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.delta_public_active_storage_attachments\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.track_public_active_storage_attachments\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.stage_public_active_storage_attachments\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.delta_public_active_storage_blobs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.track_public_active_storage_blobs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.stage_public_active_storage_blobs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.delta_public_active_storage_variant_records\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.track_public_active_storage_variant_records\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.stage_public_active_storage_variant_records\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.delta_public_ar_internal_metadata\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.track_public_ar_internal_metadata\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.stage_public_ar_internal_metadata\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.delta_public_autolock_schedules\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.track_public_autolock_schedules\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.stage_public_autolock_schedules\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.delta_public_cards\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.track_public_cards\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.stage_public_cards\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.delta_public_command_logs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.track_public_command_logs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.stage_public_command_logs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.delta_public_dailies\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.track_public_dailies\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.stage_public_dailies\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.delta_public_display_logs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.track_public_display_logs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.stage_public_display_logs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.delta_public_door_mode_changed_histories\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.track_public_door_mode_changed_histories\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.stage_public_door_mode_changed_histories\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.delta_public_durations\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.track_public_durations\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.stage_public_durations\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.delta_public_entrance_block_fob_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.track_public_entrance_block_fob_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.stage_public_entrance_block_fob_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.delta_public_entrance_block_knight_cards\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.track_public_entrance_block_knight_cards\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.stage_public_entrance_block_knight_cards\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.delta_public_entrance_fob_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.track_public_entrance_fob_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.stage_public_entrance_fob_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.delta_public_entrance_invitations\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.track_public_entrance_invitations\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.stage_public_entrance_invitations\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.delta_public_entrance_knight_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.track_public_entrance_knight_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.stage_public_entrance_knight_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.delta_public_entrance_knight_pins\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.track_public_entrance_knight_pins\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.stage_public_entrance_knight_pins\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.delta_public_entrance_lock_settings\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.track_public_entrance_lock_settings\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.stage_public_entrance_lock_settings\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.delta_public_entrance_locks\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.track_public_entrance_locks\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.stage_public_entrance_locks\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.delta_public_entrance_master_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.track_public_entrance_master_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.stage_public_entrance_master_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.delta_public_entrance_resident_guest_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.track_public_entrance_resident_guest_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.stage_public_entrance_resident_guest_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.delta_public_entrance_resident_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.track_public_entrance_resident_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.stage_public_entrance_resident_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.delta_public_family_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.track_public_family_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.stage_public_family_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.delta_public_fob_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.track_public_fob_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.stage_public_fob_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.delta_public_fobs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.track_public_fobs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.stage_public_fobs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.delta_public_guest_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.track_public_guest_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.stage_public_guest_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.delta_public_hubs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.track_public_hubs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.stage_public_hubs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.delta_public_invitations\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.track_public_invitations\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.stage_public_invitations\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.delta_public_json_web_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.track_public_json_web_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.stage_public_json_web_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.delta_public_knight_cards\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.track_public_knight_cards\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.stage_public_knight_cards\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.delta_public_knight_commands\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.track_public_knight_commands\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.stage_public_knight_commands\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.delta_public_knight_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.track_public_knight_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.stage_public_knight_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.delta_public_knight_logs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.track_public_knight_logs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.stage_public_knight_logs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.delta_public_knight_pins\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.track_public_knight_pins\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.stage_public_knight_pins\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.delta_public_knights\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.track_public_knights\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.stage_public_knights\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.delta_public_laresia_pins\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.track_public_laresia_pins\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.stage_public_laresia_pins\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.delta_public_lock_settings\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.track_public_lock_settings\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.stage_public_lock_settings\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.delta_public_lock_webhook_tokens\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.track_public_lock_webhook_tokens\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.stage_public_lock_webhook_tokens\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.delta_public_locks\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.track_public_locks\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.stage_public_locks\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.delta_public_logs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.track_public_logs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.stage_public_logs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.delta_public_managers\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.track_public_managers\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.stage_public_managers\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.delta_public_master_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.track_public_master_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.stage_public_master_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.delta_public_mst_display_logs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.track_public_mst_display_logs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.stage_public_mst_display_logs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.delta_public_relationships\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.track_public_relationships\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.stage_public_relationships\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.delta_public_resident_guest_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.track_public_resident_guest_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.stage_public_resident_guest_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.delta_public_resident_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.track_public_resident_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.stage_public_resident_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.delta_public_schema_migrations\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.track_public_schema_migrations\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.stage_public_schema_migrations\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.delta_public_term_of_validities\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.track_public_term_of_validities\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.stage_public_term_of_validities\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.delta_public_users\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.track_public_users\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.stage_public_users\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.delta_public_webhook_tokens\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.track_public_webhook_tokens\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.stage_public_webhook_tokens\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.delta_public_webhooks\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.track_public_webhooks\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.stage_public_webhooks\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.delta_public_weeklies\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.track_public_weeklies\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.stage_public_weeklies\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.delta_public_wena_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.track_public_wena_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.stage_public_wena_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.delta_public_wenas\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.track_public_wenas\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"bucardo.stage_public_wenas\"</span>\npg_dump: flagging inherited columns <span class=\"k\">in </span>subtables\npg_dump: reading indexes\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.active_storage_attachments\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.active_storage_blobs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.active_storage_variant_records\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.ar_internal_metadata\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.autolock_schedules\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.cards\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.command_logs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.dailies\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.door_mode_changed_histories\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.durations\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_block_fob_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_block_knight_cards\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_fob_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_invitations\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_knight_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_knight_pins\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_lock_settings\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_locks\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_master_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_resident_guest_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_resident_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.family_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.fob_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.fobs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.guest_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.hubs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.invitations\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.json_web_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_cards\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_commands\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_logs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_pins\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.knights\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.laresia_pins\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.lock_settings\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.lock_webhook_tokens\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.locks\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.managers\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.master_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.mst_display_logs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.relationships\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.resident_guest_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.resident_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.schema_migrations\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.term_of_validities\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.users\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.webhook_tokens\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.webhooks\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.weeklies\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.wena_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.wenas\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.bucardo_delta_names\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.bucardo_delta_targets\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.bucardo_truncate_trigger\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.bucardo_sequences\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_active_storage_attachments\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_active_storage_attachments\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_active_storage_blobs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_active_storage_blobs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_active_storage_variant_records\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_active_storage_variant_records\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_ar_internal_metadata\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_ar_internal_metadata\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_autolock_schedules\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_autolock_schedules\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_cards\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_cards\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_command_logs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_command_logs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_dailies\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_dailies\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_display_logs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_display_logs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_door_mode_changed_histories\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_door_mode_changed_histories\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_durations\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_durations\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_entrance_block_fob_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_entrance_block_fob_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_entrance_block_knight_cards\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_entrance_block_knight_cards\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_entrance_fob_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_entrance_fob_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_entrance_invitations\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_entrance_invitations\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_entrance_knight_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_entrance_knight_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_entrance_knight_pins\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_entrance_knight_pins\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_entrance_lock_settings\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_entrance_lock_settings\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_entrance_locks\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_entrance_locks\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_entrance_master_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_entrance_master_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_entrance_resident_guest_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_entrance_resident_guest_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_entrance_resident_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_entrance_resident_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_family_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_family_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_fob_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_fob_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_fobs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_fobs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_guest_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_guest_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_hubs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_hubs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_invitations\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_invitations\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_json_web_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_json_web_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_knight_cards\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_knight_cards\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_knight_commands\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_knight_commands\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_knight_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_knight_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_knight_logs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_knight_logs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_knight_pins\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_knight_pins\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_knights\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_knights\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_laresia_pins\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_laresia_pins\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_lock_settings\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_lock_settings\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_lock_webhook_tokens\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_lock_webhook_tokens\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_locks\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_locks\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_logs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_logs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_managers\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_managers\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_master_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_master_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_mst_display_logs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_mst_display_logs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_relationships\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_relationships\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_resident_guest_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_resident_guest_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_resident_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_resident_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_schema_migrations\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_schema_migrations\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_term_of_validities\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_term_of_validities\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_users\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_users\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_webhook_tokens\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_webhook_tokens\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_webhooks\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_webhooks\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_weeklies\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_weeklies\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_wena_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_wena_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_wenas\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_wenas\"</span>\npg_dump: flagging indexes <span class=\"k\">in </span>partitioned tables\npg_dump: reading extended statistics\npg_dump: reading constraints\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.active_storage_attachments\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.active_storage_blobs\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.active_storage_variant_records\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.ar_internal_metadata\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.autolock_schedules\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.cards\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.command_logs\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.dailies\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.door_mode_changed_histories\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.durations\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_block_fob_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_block_knight_cards\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_fob_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_invitations\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_knight_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_knight_pins\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_lock_settings\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_locks\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_master_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_resident_guest_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_resident_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.family_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.fob_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.fobs\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.guest_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.hubs\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.invitations\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.json_web_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_cards\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_commands\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_logs\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_pins\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.knights\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.laresia_pins\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.lock_settings\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.lock_webhook_tokens\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.locks\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.managers\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.master_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.mst_display_logs\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.relationships\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.resident_guest_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.resident_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.schema_migrations\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.term_of_validities\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.users\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.webhook_tokens\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.webhooks\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.weeklies\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.wena_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.wenas\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.bucardo_delta_names\"</span>\npg_dump: reading triggers\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.active_storage_attachments\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.active_storage_blobs\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.active_storage_variant_records\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.ar_internal_metadata\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.autolock_schedules\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.cards\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.command_logs\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.dailies\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.door_mode_changed_histories\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.durations\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_block_fob_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_block_knight_cards\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_fob_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_invitations\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_knight_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_knight_pins\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_lock_settings\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_locks\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_master_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_resident_guest_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_resident_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.family_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.fob_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.fobs\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.guest_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.hubs\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.invitations\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.json_web_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_cards\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_commands\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_logs\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_pins\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.knights\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.laresia_pins\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.lock_settings\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.lock_webhook_tokens\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.locks\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.managers\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.master_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.mst_display_logs\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.relationships\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.resident_guest_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.resident_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.schema_migrations\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.term_of_validities\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.users\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.webhook_tokens\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.webhooks\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.weeklies\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.wena_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.wenas\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.bucardo_delta_names\"</span>\npg_dump: reading rewrite rules\npg_dump: reading policies\npg_dump: reading row-level security policies\npg_dump: reading publications\npg_dump: reading publication membership\npg_dump: reading subscriptions\npg_dump: reading large objects\npg_dump: reading dependency data\npg_dump: saving encoding <span class=\"o\">=</span> UTF8\npg_dump: saving standard_conforming_strings <span class=\"o\">=</span> on\npg_dump: saving search_path <span class=\"o\">=</span> \npg_dump: saving database definition\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.bucardo_delta_names\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.bucardo_delta_targets\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.bucardo_sequences\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.bucardo_truncate_trigger\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.bucardo_truncate_trigger_log\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.delta_public_active_storage_attachments\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.delta_public_active_storage_blobs\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.delta_public_active_storage_variant_records\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.delta_public_ar_internal_metadata\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.delta_public_autolock_schedules\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.delta_public_cards\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.delta_public_command_logs\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.delta_public_dailies\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.delta_public_display_logs\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.delta_public_door_mode_changed_histories\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.delta_public_durations\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.delta_public_entrance_block_fob_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.delta_public_entrance_block_knight_cards\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.delta_public_entrance_fob_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.delta_public_entrance_invitations\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.delta_public_entrance_knight_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.delta_public_entrance_knight_pins\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.delta_public_entrance_lock_settings\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.delta_public_entrance_locks\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.delta_public_entrance_master_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.delta_public_entrance_resident_guest_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.delta_public_entrance_resident_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.delta_public_family_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.delta_public_fob_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.delta_public_fobs\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.delta_public_guest_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.delta_public_hubs\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.delta_public_invitations\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.delta_public_json_web_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.delta_public_knight_cards\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.delta_public_knight_commands\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.delta_public_knight_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.delta_public_knight_logs\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.delta_public_knight_pins\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.delta_public_knights\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.delta_public_laresia_pins\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.delta_public_lock_settings\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.delta_public_lock_webhook_tokens\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.delta_public_locks\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.delta_public_logs\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.delta_public_managers\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.delta_public_master_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.delta_public_mst_display_logs\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.delta_public_relationships\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.delta_public_resident_guest_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.delta_public_resident_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.delta_public_schema_migrations\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.delta_public_term_of_validities\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.delta_public_users\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.delta_public_webhook_tokens\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.delta_public_webhooks\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.delta_public_weeklies\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.delta_public_wena_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.delta_public_wenas\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.stage_public_active_storage_attachments\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.stage_public_active_storage_blobs\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.stage_public_active_storage_variant_records\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.stage_public_ar_internal_metadata\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.stage_public_autolock_schedules\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.stage_public_cards\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.stage_public_command_logs\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.stage_public_dailies\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.stage_public_display_logs\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.stage_public_door_mode_changed_histories\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.stage_public_durations\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.stage_public_entrance_block_fob_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.stage_public_entrance_block_knight_cards\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.stage_public_entrance_fob_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.stage_public_entrance_invitations\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.stage_public_entrance_knight_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.stage_public_entrance_knight_pins\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.stage_public_entrance_lock_settings\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.stage_public_entrance_locks\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.stage_public_entrance_master_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.stage_public_entrance_resident_guest_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.stage_public_entrance_resident_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.stage_public_family_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.stage_public_fob_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.stage_public_fobs\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.stage_public_guest_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.stage_public_hubs\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.stage_public_invitations\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.stage_public_json_web_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.stage_public_knight_cards\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.stage_public_knight_commands\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.stage_public_knight_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.stage_public_knight_logs\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.stage_public_knight_pins\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.stage_public_knights\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.stage_public_laresia_pins\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.stage_public_lock_settings\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.stage_public_lock_webhook_tokens\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.stage_public_locks\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.stage_public_logs\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.stage_public_managers\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.stage_public_master_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.stage_public_mst_display_logs\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.stage_public_relationships\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.stage_public_resident_guest_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.stage_public_resident_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.stage_public_schema_migrations\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.stage_public_term_of_validities\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.stage_public_users\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.stage_public_webhook_tokens\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.stage_public_webhooks\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.stage_public_weeklies\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.stage_public_wena_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.stage_public_wenas\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.track_public_active_storage_attachments\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.track_public_active_storage_blobs\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.track_public_active_storage_variant_records\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.track_public_ar_internal_metadata\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.track_public_autolock_schedules\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.track_public_cards\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.track_public_command_logs\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.track_public_dailies\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.track_public_display_logs\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.track_public_door_mode_changed_histories\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.track_public_durations\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.track_public_entrance_block_fob_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.track_public_entrance_block_knight_cards\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.track_public_entrance_fob_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.track_public_entrance_invitations\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.track_public_entrance_knight_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.track_public_entrance_knight_pins\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.track_public_entrance_lock_settings\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.track_public_entrance_locks\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.track_public_entrance_master_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.track_public_entrance_resident_guest_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.track_public_entrance_resident_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.track_public_family_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.track_public_fob_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.track_public_fobs\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.track_public_guest_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.track_public_hubs\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.track_public_invitations\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.track_public_json_web_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.track_public_knight_cards\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.track_public_knight_commands\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.track_public_knight_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.track_public_knight_logs\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.track_public_knight_pins\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.track_public_knights\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.track_public_laresia_pins\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.track_public_lock_settings\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.track_public_lock_webhook_tokens\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.track_public_locks\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.track_public_logs\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.track_public_managers\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.track_public_master_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.track_public_mst_display_logs\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.track_public_relationships\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.track_public_resident_guest_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.track_public_resident_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.track_public_schema_migrations\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.track_public_term_of_validities\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.track_public_users\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.track_public_webhook_tokens\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.track_public_webhooks\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.track_public_weeklies\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.track_public_wena_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"bucardo.track_public_wenas\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.active_storage_blobs\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.active_storage_attachments\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.active_storage_variant_records\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.ar_internal_metadata\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.locks\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.users\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.master_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.autolock_schedules\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.cards\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.hubs\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.command_logs\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.term_of_validities\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.dailies\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.door_mode_changed_histories\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.durations\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.entrance_locks\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.entrance_master_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.fobs\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.fob_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.entrance_fob_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.entrance_block_fob_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.knights\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.entrance_knight_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.knight_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.knight_cards\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.entrance_block_knight_cards\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.invitations\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.entrance_invitations\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.entrance_knight_pins\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.entrance_lock_settings\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.resident_guest_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.entrance_resident_guest_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.resident_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.entrance_resident_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.family_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.guest_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.json_web_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.knight_commands\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.knight_logs\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.knight_pins\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.laresia_pins\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.lock_settings\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.webhook_tokens\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.lock_webhook_tokens\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.managers\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.mst_display_logs\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.relationships\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.schema_migrations\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.webhooks\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.weeklies\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.wenas\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.wena_keys\"</span>\n</code></pre></div></div>\n</details>\n<h4 data-sourcepos=\"974:1-974:39\">logs, display_logs以外のrestore</h4>\n<div class=\"code-block\" data-sourcepos=\"976:1-978:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>root@d57ada7337a5:/# pg_restore <span class=\"nt\">--verbose</span> <span class=\"nt\">--data-only</span> <span class=\"nt\">-h</span> king-api-cfn-test.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com <span class=\"nt\">-d</span> kingapi <span class=\"nt\">-U</span> kingadmin <span class=\"nt\">-p</span> 5432 main_data.dump\n</code></pre></div></div>\n<details>\n<div class=\"code-block\" data-sourcepos=\"982:1-1207:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>pg_restore: connecting to database <span class=\"k\">for </span>restore\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.bucardo_delta_names\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.bucardo_delta_targets\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.bucardo_sequences\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.bucardo_truncate_trigger\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.bucardo_truncate_trigger_log\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_active_storage_attachments\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_active_storage_blobs\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_active_storage_variant_records\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_ar_internal_metadata\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_autolock_schedules\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_cards\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_command_logs\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_dailies\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_display_logs\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_door_mode_changed_histories\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_durations\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_entrance_block_fob_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_entrance_block_knight_cards\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_entrance_fob_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_entrance_invitations\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_entrance_knight_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_entrance_knight_pins\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_entrance_lock_settings\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_entrance_locks\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_entrance_master_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_entrance_resident_guest_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_entrance_resident_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_family_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_fob_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_fobs\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_guest_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_hubs\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_invitations\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_json_web_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_knight_cards\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_knight_commands\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_knight_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_knight_logs\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_knight_pins\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_knights\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_laresia_pins\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_lock_settings\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_lock_webhook_tokens\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_locks\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_logs\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_managers\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_master_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_mst_display_logs\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_relationships\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_resident_guest_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_resident_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_schema_migrations\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_term_of_validities\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_users\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_webhook_tokens\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_webhooks\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_weeklies\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_wena_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.delta_public_wenas\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.stage_public_active_storage_attachments\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.stage_public_active_storage_blobs\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.stage_public_active_storage_variant_records\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.stage_public_ar_internal_metadata\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.stage_public_autolock_schedules\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.stage_public_cards\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.stage_public_command_logs\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.stage_public_dailies\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.stage_public_display_logs\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.stage_public_door_mode_changed_histories\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.stage_public_durations\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.stage_public_entrance_block_fob_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.stage_public_entrance_block_knight_cards\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.stage_public_entrance_fob_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.stage_public_entrance_invitations\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.stage_public_entrance_knight_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.stage_public_entrance_knight_pins\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.stage_public_entrance_lock_settings\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.stage_public_entrance_locks\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.stage_public_entrance_master_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.stage_public_entrance_resident_guest_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.stage_public_entrance_resident_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.stage_public_family_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.stage_public_fob_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.stage_public_fobs\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.stage_public_guest_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.stage_public_hubs\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.stage_public_invitations\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.stage_public_json_web_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.stage_public_knight_cards\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.stage_public_knight_commands\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.stage_public_knight_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.stage_public_knight_logs\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.stage_public_knight_pins\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.stage_public_knights\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.stage_public_laresia_pins\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.stage_public_lock_settings\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.stage_public_lock_webhook_tokens\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.stage_public_locks\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.stage_public_logs\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.stage_public_managers\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.stage_public_master_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.stage_public_mst_display_logs\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.stage_public_relationships\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.stage_public_resident_guest_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.stage_public_resident_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.stage_public_schema_migrations\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.stage_public_term_of_validities\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.stage_public_users\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.stage_public_webhook_tokens\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.stage_public_webhooks\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.stage_public_weeklies\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.stage_public_wena_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.stage_public_wenas\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_active_storage_attachments\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_active_storage_blobs\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_active_storage_variant_records\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_ar_internal_metadata\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_autolock_schedules\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_cards\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_command_logs\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_dailies\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_display_logs\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_door_mode_changed_histories\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_durations\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_entrance_block_fob_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_entrance_block_knight_cards\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_entrance_fob_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_entrance_invitations\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_entrance_knight_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_entrance_knight_pins\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_entrance_lock_settings\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_entrance_locks\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_entrance_master_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_entrance_resident_guest_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_entrance_resident_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_family_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_fob_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_fobs\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_guest_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_hubs\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_invitations\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_json_web_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_knight_cards\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_knight_commands\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_knight_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_knight_logs\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_knight_pins\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_knights\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_laresia_pins\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_lock_settings\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_lock_webhook_tokens\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_locks\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_logs\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_managers\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_master_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_mst_display_logs\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_relationships\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_resident_guest_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_resident_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_schema_migrations\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_term_of_validities\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_users\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_webhook_tokens\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_webhooks\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_weeklies\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_wena_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"bucardo.track_public_wenas\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.active_storage_blobs\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.active_storage_attachments\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.active_storage_variant_records\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.ar_internal_metadata\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.locks\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.users\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.master_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.autolock_schedules\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.cards\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.hubs\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.command_logs\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.term_of_validities\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.dailies\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.door_mode_changed_histories\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.durations\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_locks\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_master_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.fobs\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.fob_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_fob_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_block_fob_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.knights\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_knight_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_cards\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_block_knight_cards\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.invitations\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_invitations\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_knight_pins\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_lock_settings\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.resident_guest_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_resident_guest_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.resident_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_resident_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.family_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.guest_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.json_web_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_commands\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_logs\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_pins\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.laresia_pins\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.lock_settings\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.webhook_tokens\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.lock_webhook_tokens\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.managers\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.mst_display_logs\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.relationships\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.schema_migrations\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.webhooks\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.weeklies\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.wenas\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.wena_keys\"</span>\npg_restore: executing SEQUENCE SET active_storage_attachments_id_seq\npg_restore: executing SEQUENCE SET active_storage_blobs_id_seq\npg_restore: executing SEQUENCE SET active_storage_variant_records_id_seq\npg_restore: executing SEQUENCE SET json_web_keys_id_seq\n</code></pre></div></div>\n</details>\n",
    "created_at": "2023-03-31T13:21:34+09:00",
    "message": "Update post.",
    "kind": "stock",
    "comments_count": 0,
    "tasks_count": 0,
    "done_tasks_count": 0,
    "url": "https://qrio.esa.io/posts/1587",
    "updated_at": "2023-07-18T10:38:20+09:00",
    "tags": [],
    "category": "Users/杉山/Database",
    "revision_number": 7,
    "created_by": {
      "myself": false,
      "name": "杉山聡",
      "screen_name": "satoshi_sugiyama",
      "icon": "https://img.esa.io/uploads/production/members/129432/icon/thumb_m_4589e2842b9d87757c7c9db07c45c00d.jpg"
    },
    "updated_by": {
      "myself": false,
      "name": "杉山聡",
      "screen_name": "satoshi_sugiyama",
      "icon": "https://img.esa.io/uploads/production/members/129432/icon/thumb_m_4589e2842b9d87757c7c9db07c45c00d.jpg"
    },
    "stargazers_count": 0,
    "watchers_count": 1,
    "star": false,
    "watch": false,
    "sharing_urls": null
  },
  {
    "number": 1577,
    "name": "外部キー制約があるテーブルを単独でrestore",
    "full_name": "Users/杉山/Database/外部キー制約があるテーブルを単独でrestore",
    "wip": false,
    "body_md": "## 経緯\r\n\r\nHeroku→Aurora Database移行において、テーブルごとに作業分割すること\r\n- logsテーブル、display_logsテーブルは重要度が**比較的**高くないためbucardoによるこれまでの手順で移行する\r\n- その他のテーブルに関してはダウンタイム中にpg_dump/pg_restoreを行い完全コピーを行う\r\n\r\n上記を実行するために、テーブルスキーマのHerokuからのdump→Auroraへのrestoreが済んだ状態(データは空)で\r\n- **外部キー制約がある**logsテーブル、display_logsテーブルに対しrestoreができること\r\n- 上記restoreができた状態で他のテーブルに問題なくデータがrestoreできること\r\n\r\nを確認する。\r\n\r\n<details>\r\n<summary>旧検討→失敗</summary>\r\n\r\n## 環境準備\r\n\r\ndockerで2つのDBを立て、片方をHeroku、もう一方をAuroraと見立てた状態にする。\r\nさらに3つめのコンテナにはEC2bucardoインスタンスのモックとしてbucardoを用意してあるが、今回はdumpとrestoreの検証のため一旦使わない\r\nデータにはking-apiで取得しているlatest.dump(stagingのdump)を利用し、Herokuモックに投入しておく。\r\nその後、[DB移行手順](https://docs.google.com/spreadsheets/d/1W3DymCJ_ifiXtSUwVAjcl9tzPGfz5WE6bmnnwYL9Gbo/edit#gid=602303325)に従って\r\n- スキーマをHerokuモックからdump→Auroraモックへrestore\r\n\r\n## 確認1.logs/display_logs\r\n\r\n検証の結果、これまで通りのrestore --data-onlyだと外部キー制約に引っかかってしまい不可能だった。\r\n\r\nまた、[内田1さんからもらったesa](https://qrio.esa.io/posts/1267#%E7%8F%BE%E5%9C%A8%E3%81%AE%E3%83%AD%E3%82%B0%E3%82%92S3%E3%81%AB%E4%BF%9D%E5%AD%98%E3%81%99%E3%82%8B%EF%BC%88%E4%BB%8A%E5%9B%9E%E3%81%AE%E3%81%BF%E3%81%AE%E5%AF%BE%E5%BF%9C%EF%BC%89)にある内容は、-cが含まれていて--data-onlyのdumpだと利用できない。\r\n```sh\r\npg_restore \r\n    -c  # --clean ここがdata-onlyのdumpだと利用できない\r\n    -Fc # --format=custom\r\n    -t logs # --table=logs\r\n    -h king-db-backup-staging.cucbox6dvi64.ap-northeast-1.rds.amazonaws.com \r\n    -U postgres -d king_db_backup_staging \r\n    721df311-e45e-4656-ade5-d812f36c6db2 #dumpファイル指定\r\n    -L content_list \r\n    -v # --verbose\r\n    -j 8 # 並列数\r\n```\r\n\r\n以下の方法で実現できた。\r\n\r\nhttps://www.postgresql.jp/document/14/html/app-pgrestore.html\r\n>--disable-triggers\r\nこのオプションは、データのみのダンプからリストアする際にしか適用されません。 データのリストア中、pg_restoreに対し、対象テーブル上のトリガを一時的に無効にするコマンドを実行するよう指示します。 このオプションは、データのリストア中には呼び出したくない参照整合性検査やその他のトリガがある場合に使用します。\r\n\r\n```sh\r\npg_restore \\\r\n    --format=custom \\\r\n    --data-only \\\r\n    --disable-triggers \\ # これがあると、外部キーのチェックトリガーを無効にしてデータ投入できる\r\n    --table=logs \\\r\n    --table=display_logs \\\r\n    --host=target-db \\\r\n    --username=postgres \\\r\n    --dbname=postgres \\\r\n    --port=5432 \\\r\n    logs_and_displaylogs.dump\r\n```\r\n\r\n## 該当テーブル全件チェック結果\r\n\r\n```logs.sh\r\n# コピー元DBのlogsテーブルを全件ファイルへ出力\r\nroot@27c638175257:/# psql -h source-db -U postgres -d postgres -p 5432 -c \"SELECT * from logs order by updated_at desc;\" >query11.log\r\nPassword for user postgres: \r\n# コピー先DBのlogsテーブルを全件ファイルへ出力\r\nroot@27c638175257:/# psql -h target-db -U postgres -d postgres -p 5432 -c \"SELECT * from logs order by updated_at desc;\" >query22.log\r\nPassword for user postgres: \r\n# diffコマンドで差異を見る(差異があれば出力がある)\r\nroot@27c638175257:/# diff query11.log query22.log \r\nroot@27c638175257:/# \r\n```\r\n\r\n```display_logs.sh\r\n# コピー元DBのdisplay_logsテーブルを全件ファイルへ出力\r\nroot@27c638175257:/# psql -h source-db -U postgres -d postgres -p 5432 -c \"SELECT * from display_logs order by created_at desc;\" >query33\r\nPassword for user postgres: \r\n# コピー先DBのdisplay_logsテーブルを全件ファイルへ出力\r\nroot@27c638175257:/# psql -h target-db -U postgres -d postgres -p 5432 -c \"SELECT * from display_logs order by created_at desc;\" >query44\r\nPassword for user postgres: \r\n# diffコマンドで差異を見る(差異があれば出力がある)\r\nroot@27c638175257:/# diff query33 query44 \r\nroot@27c638175257:/# \r\n```\r\n\r\n## 他のテーブルの行数\r\nAurora仮定のターゲットDBにlogsテーブルとdisplay_logsテーブルのみデータが挿入された。\r\n<details>\r\n\r\n<summary>ソースDB(Heroku仮定)</summary>\r\n\r\n```source.sql\r\npostgres=# ANALYZE;\r\nANALYZE\r\npostgres=# select relname, n_live_tup from pg_stat_user_tables order by relname asc;\r\n            relname             | n_live_tup \r\n--------------------------------+------------\r\n active_storage_attachments     |          0\r\n active_storage_blobs           |          0\r\n active_storage_variant_records |          0\r\n ar_internal_metadata           |          1\r\n autolock_schedules             |          0\r\n cards                          |          0\r\n command_logs                   |      51976\r\n dailies                        |         10\r\n display_logs                   |       1333\r\n door_mode_changed_histories    |        183\r\n durations                      |         12\r\n entrance_block_fob_keys        |          0\r\n entrance_block_knight_cards    |          0\r\n entrance_fob_keys              |          0\r\n entrance_invitations           |         12\r\n entrance_knight_keys           |          7\r\n entrance_knight_pins           |          3\r\n entrance_lock_settings         |          7\r\n entrance_locks                 |        407\r\n entrance_master_keys           |          7\r\n entrance_resident_guest_keys   |          1\r\n entrance_resident_keys         |          2\r\n family_keys                    |          4\r\n fob_keys                       |         10\r\n fobs                           |      95210\r\n guest_keys                     |          5\r\n hubs                           |      60216\r\n invitations                    |         14\r\n json_web_keys                  |          2\r\n knight_cards                   |         13\r\n knight_commands                |     266650\r\n knight_keys                    |        130\r\n knight_logs                    |        124\r\n knight_pins                    |         13\r\n knights                        |        753\r\n laresia_pins                   |          1\r\n lock_settings                  |        185\r\n lock_webhook_tokens            |         37\r\n locks                          |       1092\r\n logs                           |      23850\r\n managers                       |        117\r\n master_keys                    |        188\r\n mst_display_logs               |         80\r\n relationships                  |          1\r\n resident_guest_keys            |          1\r\n resident_keys                  |          8\r\n schema_migrations              |        103\r\n term_of_validities             |         26\r\n users                          |        981\r\n webhook_tokens                 |         24\r\n webhooks                       |          9\r\n weeklies                       |         10\r\n wena_keys                      |          1\r\n wenas                          |        259\r\n(54 rows)\r\n```\r\n\r\n</details>\r\n\r\n<details>\r\n\r\n<sumamry>ターゲットDB(Aurora仮定)</summary>\r\n\r\n```target.sql\r\npostgres=# ANALYZE;\r\nANALYZE\r\npostgres=# select relname, n_live_tup from pg_stat_user_tables order by relname asc;\r\n            relname             | n_live_tup \r\n--------------------------------+------------\r\n active_storage_attachments     |          0\r\n active_storage_blobs           |          0\r\n active_storage_variant_records |          0\r\n ar_internal_metadata           |          0\r\n autolock_schedules             |          0\r\n cards                          |          0\r\n command_logs                   |          0\r\n dailies                        |          0\r\n display_logs                   |       1333\r\n door_mode_changed_histories    |          0\r\n durations                      |          0\r\n entrance_block_fob_keys        |          0\r\n entrance_block_knight_cards    |          0\r\n entrance_fob_keys              |          0\r\n entrance_invitations           |          0\r\n entrance_knight_keys           |          0\r\n entrance_knight_pins           |          0\r\n entrance_lock_settings         |          0\r\n entrance_locks                 |          0\r\n entrance_master_keys           |          0\r\n entrance_resident_guest_keys   |          0\r\n entrance_resident_keys         |          0\r\n family_keys                    |          0\r\n fob_keys                       |          0\r\n fobs                           |          0\r\n guest_keys                     |          0\r\n hubs                           |          0\r\n invitations                    |          0\r\n json_web_keys                  |          0\r\n knight_cards                   |          0\r\n knight_commands                |          0\r\n knight_keys                    |          0\r\n knight_logs                    |          0\r\n knight_pins                    |          0\r\n knights                        |          0\r\n laresia_pins                   |          0\r\n lock_settings                  |          0\r\n lock_webhook_tokens            |          0\r\n locks                          |          0\r\n logs                           |      23850\r\n managers                       |          0\r\n master_keys                    |          0\r\n mst_display_logs               |          0\r\n relationships                  |          0\r\n resident_guest_keys            |          0\r\n resident_keys                  |          0\r\n schema_migrations              |          0\r\n term_of_validities             |          0\r\n users                          |          0\r\n webhook_tokens                 |          0\r\n webhooks                       |          0\r\n weeklies                       |          0\r\n wena_keys                      |          0\r\n wenas                          |          0\r\n(54 rows)\r\n```\r\n\r\n</details>\r\n\r\n## 確認2. logs/display_logs以外のデータのdump/restore\r\n### dump\r\npg_dump --format=custom --verbose --data-only --exclude-table=logs --exclude-table=display_logs -h source-db -U postgres -d postgres -p 5432 > main_data.dump\r\n<details>\r\n```sh\r\npg_dump: last built-in OID is 16383\r\npg_dump: reading extensions\r\npg_dump: identifying extension members\r\npg_dump: reading schemas\r\npg_dump: reading user-defined tables\r\npg_dump: reading user-defined functions\r\npg_dump: reading user-defined types\r\npg_dump: reading procedural languages\r\npg_dump: reading user-defined aggregate functions\r\npg_dump: reading user-defined operators\r\npg_dump: reading user-defined access methods\r\npg_dump: reading user-defined operator classes\r\npg_dump: reading user-defined operator families\r\npg_dump: reading user-defined text search parsers\r\npg_dump: reading user-defined text search templates\r\npg_dump: reading user-defined text search dictionaries\r\npg_dump: reading user-defined text search configurations\r\npg_dump: reading user-defined foreign-data wrappers\r\npg_dump: reading user-defined foreign servers\r\npg_dump: reading default privileges\r\npg_dump: reading user-defined collations\r\npg_dump: reading user-defined conversions\r\npg_dump: reading type casts\r\npg_dump: reading transforms\r\npg_dump: reading table inheritance information\r\npg_dump: reading event triggers\r\npg_dump: finding extension tables\r\npg_dump: finding inheritance relationships\r\npg_dump: reading column info for interesting tables\r\npg_dump: finding the columns and types of table \"public.pg_stat_statements_info\"\r\npg_dump: finding the columns and types of table \"public.pg_stat_statements\"\r\npg_dump: finding the columns and types of table \"public.active_storage_attachments\"\r\npg_dump: finding the columns and types of table \"public.active_storage_blobs\"\r\npg_dump: finding the columns and types of table \"public.active_storage_variant_records\"\r\npg_dump: finding the columns and types of table \"public.ar_internal_metadata\"\r\npg_dump: finding the columns and types of table \"public.autolock_schedules\"\r\npg_dump: finding the columns and types of table \"public.cards\"\r\npg_dump: finding the columns and types of table \"public.command_logs\"\r\npg_dump: finding the columns and types of table \"public.dailies\"\r\npg_dump: finding the columns and types of table \"public.door_mode_changed_histories\"\r\npg_dump: finding the columns and types of table \"public.durations\"\r\npg_dump: finding the columns and types of table \"public.entrance_block_fob_keys\"\r\npg_dump: finding the columns and types of table \"public.entrance_block_knight_cards\"\r\npg_dump: finding the columns and types of table \"public.entrance_fob_keys\"\r\npg_dump: finding the columns and types of table \"public.entrance_invitations\"\r\npg_dump: finding the columns and types of table \"public.entrance_knight_keys\"\r\npg_dump: finding the columns and types of table \"public.entrance_knight_pins\"\r\npg_dump: finding the columns and types of table \"public.entrance_lock_settings\"\r\npg_dump: finding the columns and types of table \"public.entrance_locks\"\r\npg_dump: finding the columns and types of table \"public.entrance_master_keys\"\r\npg_dump: finding the columns and types of table \"public.entrance_resident_guest_keys\"\r\npg_dump: finding the columns and types of table \"public.entrance_resident_keys\"\r\npg_dump: finding the columns and types of table \"public.family_keys\"\r\npg_dump: finding the columns and types of table \"public.fob_keys\"\r\npg_dump: finding the columns and types of table \"public.fobs\"\r\npg_dump: finding the columns and types of table \"public.guest_keys\"\r\npg_dump: finding the columns and types of table \"public.hubs\"\r\npg_dump: finding the columns and types of table \"public.invitations\"\r\npg_dump: finding the columns and types of table \"public.json_web_keys\"\r\npg_dump: finding the columns and types of table \"public.knight_cards\"\r\npg_dump: finding the columns and types of table \"public.knight_commands\"\r\npg_dump: finding the columns and types of table \"public.knight_keys\"\r\npg_dump: finding the columns and types of table \"public.knight_logs\"\r\npg_dump: finding the columns and types of table \"public.knight_pins\"\r\npg_dump: finding the columns and types of table \"public.knights\"\r\npg_dump: finding the columns and types of table \"public.laresia_pins\"\r\npg_dump: finding the columns and types of table \"public.lock_settings\"\r\npg_dump: finding the columns and types of table \"public.lock_webhook_tokens\"\r\npg_dump: finding the columns and types of table \"public.locks\"\r\npg_dump: finding the columns and types of table \"public.managers\"\r\npg_dump: finding the columns and types of table \"public.master_keys\"\r\npg_dump: finding the columns and types of table \"public.mst_display_logs\"\r\npg_dump: finding the columns and types of table \"public.relationships\"\r\npg_dump: finding the columns and types of table \"public.resident_guest_keys\"\r\npg_dump: finding the columns and types of table \"public.resident_keys\"\r\npg_dump: finding the columns and types of table \"public.schema_migrations\"\r\npg_dump: finding the columns and types of table \"public.term_of_validities\"\r\npg_dump: finding the columns and types of table \"public.users\"\r\npg_dump: finding the columns and types of table \"public.webhook_tokens\"\r\npg_dump: finding the columns and types of table \"public.webhooks\"\r\npg_dump: finding the columns and types of table \"public.weeklies\"\r\npg_dump: finding the columns and types of table \"public.wena_keys\"\r\npg_dump: finding the columns and types of table \"public.wenas\"\r\npg_dump: flagging inherited columns in subtables\r\npg_dump: reading indexes\r\npg_dump: reading indexes for table \"public.active_storage_attachments\"\r\npg_dump: reading indexes for table \"public.active_storage_blobs\"\r\npg_dump: reading indexes for table \"public.active_storage_variant_records\"\r\npg_dump: reading indexes for table \"public.ar_internal_metadata\"\r\npg_dump: reading indexes for table \"public.autolock_schedules\"\r\npg_dump: reading indexes for table \"public.cards\"\r\npg_dump: reading indexes for table \"public.command_logs\"\r\npg_dump: reading indexes for table \"public.dailies\"\r\npg_dump: reading indexes for table \"public.door_mode_changed_histories\"\r\npg_dump: reading indexes for table \"public.durations\"\r\npg_dump: reading indexes for table \"public.entrance_block_fob_keys\"\r\npg_dump: reading indexes for table \"public.entrance_block_knight_cards\"\r\npg_dump: reading indexes for table \"public.entrance_fob_keys\"\r\npg_dump: reading indexes for table \"public.entrance_invitations\"\r\npg_dump: reading indexes for table \"public.entrance_knight_keys\"\r\npg_dump: reading indexes for table \"public.entrance_knight_pins\"\r\npg_dump: reading indexes for table \"public.entrance_lock_settings\"\r\npg_dump: reading indexes for table \"public.entrance_locks\"\r\npg_dump: reading indexes for table \"public.entrance_master_keys\"\r\npg_dump: reading indexes for table \"public.entrance_resident_guest_keys\"\r\npg_dump: reading indexes for table \"public.entrance_resident_keys\"\r\npg_dump: reading indexes for table \"public.family_keys\"\r\npg_dump: reading indexes for table \"public.fob_keys\"\r\npg_dump: reading indexes for table \"public.fobs\"\r\npg_dump: reading indexes for table \"public.guest_keys\"\r\npg_dump: reading indexes for table \"public.hubs\"\r\npg_dump: reading indexes for table \"public.invitations\"\r\npg_dump: reading indexes for table \"public.json_web_keys\"\r\npg_dump: reading indexes for table \"public.knight_cards\"\r\npg_dump: reading indexes for table \"public.knight_commands\"\r\npg_dump: reading indexes for table \"public.knight_keys\"\r\npg_dump: reading indexes for table \"public.knight_logs\"\r\npg_dump: reading indexes for table \"public.knight_pins\"\r\npg_dump: reading indexes for table \"public.knights\"\r\npg_dump: reading indexes for table \"public.laresia_pins\"\r\npg_dump: reading indexes for table \"public.lock_settings\"\r\npg_dump: reading indexes for table \"public.lock_webhook_tokens\"\r\npg_dump: reading indexes for table \"public.locks\"\r\npg_dump: reading indexes for table \"public.managers\"\r\npg_dump: reading indexes for table \"public.master_keys\"\r\npg_dump: reading indexes for table \"public.mst_display_logs\"\r\npg_dump: reading indexes for table \"public.relationships\"\r\npg_dump: reading indexes for table \"public.resident_guest_keys\"\r\npg_dump: reading indexes for table \"public.resident_keys\"\r\npg_dump: reading indexes for table \"public.schema_migrations\"\r\npg_dump: reading indexes for table \"public.term_of_validities\"\r\npg_dump: reading indexes for table \"public.users\"\r\npg_dump: reading indexes for table \"public.webhook_tokens\"\r\npg_dump: reading indexes for table \"public.webhooks\"\r\npg_dump: reading indexes for table \"public.weeklies\"\r\npg_dump: reading indexes for table \"public.wena_keys\"\r\npg_dump: reading indexes for table \"public.wenas\"\r\npg_dump: flagging indexes in partitioned tables\r\npg_dump: reading extended statistics\r\npg_dump: reading constraints\r\npg_dump: reading foreign key constraints for table \"public.active_storage_attachments\"\r\npg_dump: reading foreign key constraints for table \"public.active_storage_blobs\"\r\npg_dump: reading foreign key constraints for table \"public.active_storage_variant_records\"\r\npg_dump: reading foreign key constraints for table \"public.autolock_schedules\"\r\npg_dump: reading foreign key constraints for table \"public.command_logs\"\r\npg_dump: reading foreign key constraints for table \"public.dailies\"\r\npg_dump: reading foreign key constraints for table \"public.door_mode_changed_histories\"\r\npg_dump: reading foreign key constraints for table \"public.durations\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_block_fob_keys\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_block_knight_cards\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_fob_keys\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_invitations\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_knight_keys\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_knight_pins\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_lock_settings\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_locks\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_master_keys\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_resident_guest_keys\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_resident_keys\"\r\npg_dump: reading foreign key constraints for table \"public.family_keys\"\r\npg_dump: reading foreign key constraints for table \"public.fob_keys\"\r\npg_dump: reading foreign key constraints for table \"public.fobs\"\r\npg_dump: reading foreign key constraints for table \"public.guest_keys\"\r\npg_dump: reading foreign key constraints for table \"public.hubs\"\r\npg_dump: reading foreign key constraints for table \"public.invitations\"\r\npg_dump: reading foreign key constraints for table \"public.knight_cards\"\r\npg_dump: reading foreign key constraints for table \"public.knight_keys\"\r\npg_dump: reading foreign key constraints for table \"public.knight_logs\"\r\npg_dump: reading foreign key constraints for table \"public.knight_pins\"\r\npg_dump: reading foreign key constraints for table \"public.knights\"\r\npg_dump: reading foreign key constraints for table \"public.laresia_pins\"\r\npg_dump: reading foreign key constraints for table \"public.lock_settings\"\r\npg_dump: reading foreign key constraints for table \"public.lock_webhook_tokens\"\r\npg_dump: reading foreign key constraints for table \"public.locks\"\r\npg_dump: reading foreign key constraints for table \"public.managers\"\r\npg_dump: reading foreign key constraints for table \"public.master_keys\"\r\npg_dump: reading foreign key constraints for table \"public.mst_display_logs\"\r\npg_dump: reading foreign key constraints for table \"public.relationships\"\r\npg_dump: reading foreign key constraints for table \"public.resident_guest_keys\"\r\npg_dump: reading foreign key constraints for table \"public.resident_keys\"\r\npg_dump: reading foreign key constraints for table \"public.term_of_validities\"\r\npg_dump: reading foreign key constraints for table \"public.users\"\r\npg_dump: reading foreign key constraints for table \"public.webhook_tokens\"\r\npg_dump: reading foreign key constraints for table \"public.webhooks\"\r\npg_dump: reading foreign key constraints for table \"public.weeklies\"\r\npg_dump: reading foreign key constraints for table \"public.wena_keys\"\r\npg_dump: reading foreign key constraints for table \"public.wenas\"\r\npg_dump: reading triggers\r\npg_dump: reading triggers for table \"public.active_storage_attachments\"\r\npg_dump: reading triggers for table \"public.active_storage_blobs\"\r\npg_dump: reading triggers for table \"public.active_storage_variant_records\"\r\npg_dump: reading triggers for table \"public.autolock_schedules\"\r\npg_dump: reading triggers for table \"public.command_logs\"\r\npg_dump: reading triggers for table \"public.dailies\"\r\npg_dump: reading triggers for table \"public.door_mode_changed_histories\"\r\npg_dump: reading triggers for table \"public.durations\"\r\npg_dump: reading triggers for table \"public.entrance_block_fob_keys\"\r\npg_dump: reading triggers for table \"public.entrance_block_knight_cards\"\r\npg_dump: reading triggers for table \"public.entrance_fob_keys\"\r\npg_dump: reading triggers for table \"public.entrance_invitations\"\r\npg_dump: reading triggers for table \"public.entrance_knight_keys\"\r\npg_dump: reading triggers for table \"public.entrance_knight_pins\"\r\npg_dump: reading triggers for table \"public.entrance_lock_settings\"\r\npg_dump: reading triggers for table \"public.entrance_locks\"\r\npg_dump: reading triggers for table \"public.entrance_master_keys\"\r\npg_dump: reading triggers for table \"public.entrance_resident_guest_keys\"\r\npg_dump: reading triggers for table \"public.entrance_resident_keys\"\r\npg_dump: reading triggers for table \"public.family_keys\"\r\npg_dump: reading triggers for table \"public.fob_keys\"\r\npg_dump: reading triggers for table \"public.fobs\"\r\npg_dump: reading triggers for table \"public.guest_keys\"\r\npg_dump: reading triggers for table \"public.hubs\"\r\npg_dump: reading triggers for table \"public.invitations\"\r\npg_dump: reading triggers for table \"public.knight_cards\"\r\npg_dump: reading triggers for table \"public.knight_keys\"\r\npg_dump: reading triggers for table \"public.knight_logs\"\r\npg_dump: reading triggers for table \"public.knight_pins\"\r\npg_dump: reading triggers for table \"public.knights\"\r\npg_dump: reading triggers for table \"public.laresia_pins\"\r\npg_dump: reading triggers for table \"public.lock_settings\"\r\npg_dump: reading triggers for table \"public.lock_webhook_tokens\"\r\npg_dump: reading triggers for table \"public.locks\"\r\npg_dump: reading triggers for table \"public.managers\"\r\npg_dump: reading triggers for table \"public.master_keys\"\r\npg_dump: reading triggers for table \"public.mst_display_logs\"\r\npg_dump: reading triggers for table \"public.relationships\"\r\npg_dump: reading triggers for table \"public.resident_guest_keys\"\r\npg_dump: reading triggers for table \"public.resident_keys\"\r\npg_dump: reading triggers for table \"public.term_of_validities\"\r\npg_dump: reading triggers for table \"public.users\"\r\npg_dump: reading triggers for table \"public.webhook_tokens\"\r\npg_dump: reading triggers for table \"public.webhooks\"\r\npg_dump: reading triggers for table \"public.weeklies\"\r\npg_dump: reading triggers for table \"public.wena_keys\"\r\npg_dump: reading triggers for table \"public.wenas\"\r\npg_dump: reading rewrite rules\r\npg_dump: reading policies\r\npg_dump: reading row-level security policies\r\npg_dump: reading publications\r\npg_dump: reading publication membership\r\npg_dump: reading subscriptions\r\npg_dump: reading large objects\r\npg_dump: reading dependency data\r\npg_dump: saving encoding = UTF8\r\npg_dump: saving standard_conforming_strings = on\r\npg_dump: saving search_path = \r\npg_dump: saving database definition\r\npg_dump: dumping contents of table \"public.active_storage_blobs\"\r\npg_dump: dumping contents of table \"public.active_storage_attachments\"\r\npg_dump: dumping contents of table \"public.active_storage_variant_records\"\r\npg_dump: dumping contents of table \"public.ar_internal_metadata\"\r\npg_dump: dumping contents of table \"public.locks\"\r\npg_dump: dumping contents of table \"public.users\"\r\npg_dump: dumping contents of table \"public.master_keys\"\r\npg_dump: dumping contents of table \"public.autolock_schedules\"\r\npg_dump: dumping contents of table \"public.cards\"\r\npg_dump: dumping contents of table \"public.hubs\"\r\npg_dump: dumping contents of table \"public.command_logs\"\r\npg_dump: dumping contents of table \"public.term_of_validities\"\r\npg_dump: dumping contents of table \"public.dailies\"\r\npg_dump: dumping contents of table \"public.door_mode_changed_histories\"\r\npg_dump: dumping contents of table \"public.durations\"\r\npg_dump: dumping contents of table \"public.entrance_locks\"\r\npg_dump: dumping contents of table \"public.entrance_master_keys\"\r\npg_dump: dumping contents of table \"public.fobs\"\r\npg_dump: dumping contents of table \"public.fob_keys\"\r\npg_dump: dumping contents of table \"public.entrance_fob_keys\"\r\npg_dump: dumping contents of table \"public.entrance_block_fob_keys\"\r\npg_dump: dumping contents of table \"public.knights\"\r\npg_dump: dumping contents of table \"public.entrance_knight_keys\"\r\npg_dump: dumping contents of table \"public.knight_keys\"\r\npg_dump: dumping contents of table \"public.knight_cards\"\r\npg_dump: dumping contents of table \"public.entrance_block_knight_cards\"\r\npg_dump: dumping contents of table \"public.invitations\"\r\npg_dump: dumping contents of table \"public.entrance_invitations\"\r\npg_dump: dumping contents of table \"public.entrance_knight_pins\"\r\npg_dump: dumping contents of table \"public.entrance_lock_settings\"\r\npg_dump: dumping contents of table \"public.resident_guest_keys\"\r\npg_dump: dumping contents of table \"public.entrance_resident_guest_keys\"\r\npg_dump: dumping contents of table \"public.resident_keys\"\r\npg_dump: dumping contents of table \"public.entrance_resident_keys\"\r\npg_dump: dumping contents of table \"public.family_keys\"\r\npg_dump: dumping contents of table \"public.guest_keys\"\r\npg_dump: dumping contents of table \"public.json_web_keys\"\r\npg_dump: dumping contents of table \"public.knight_commands\"\r\npg_dump: dumping contents of table \"public.knight_logs\"\r\npg_dump: dumping contents of table \"public.knight_pins\"\r\npg_dump: dumping contents of table \"public.laresia_pins\"\r\npg_dump: dumping contents of table \"public.lock_settings\"\r\npg_dump: dumping contents of table \"public.webhook_tokens\"\r\npg_dump: dumping contents of table \"public.lock_webhook_tokens\"\r\npg_dump: dumping contents of table \"public.managers\"\r\npg_dump: dumping contents of table \"public.mst_display_logs\"\r\npg_dump: dumping contents of table \"public.relationships\"\r\npg_dump: dumping contents of table \"public.schema_migrations\"\r\npg_dump: dumping contents of table \"public.webhooks\"\r\npg_dump: dumping contents of table \"public.weeklies\"\r\npg_dump: dumping contents of table \"public.wenas\"\r\npg_dump: dumping contents of table \"public.wena_keys\"\r\n```\r\n</details>\r\n\r\n### restore\r\npg_restore --format=custom --verbose --data-only -h target-db -d postgres -U postgres -p 5432 main_data.dump\r\npg_restore: connecting to database for restore\r\n\r\n<details>\r\n\r\n```sh\r\npg_restore: processing data for table \"public.active_storage_blobs\"\r\npg_restore: processing data for table \"public.active_storage_attachments\"\r\npg_restore: processing data for table \"public.active_storage_variant_records\"\r\npg_restore: processing data for table \"public.ar_internal_metadata\"\r\npg_restore: processing data for table \"public.locks\"\r\npg_restore: processing data for table \"public.users\"\r\npg_restore: processing data for table \"public.master_keys\"\r\npg_restore: processing data for table \"public.autolock_schedules\"\r\npg_restore: processing data for table \"public.cards\"\r\npg_restore: processing data for table \"public.hubs\"\r\npg_restore: processing data for table \"public.command_logs\"\r\npg_restore: processing data for table \"public.term_of_validities\"\r\npg_restore: processing data for table \"public.dailies\"\r\npg_restore: processing data for table \"public.door_mode_changed_histories\"\r\npg_restore: processing data for table \"public.durations\"\r\npg_restore: processing data for table \"public.entrance_locks\"\r\npg_restore: processing data for table \"public.entrance_master_keys\"\r\npg_restore: processing data for table \"public.fobs\"\r\npg_restore: processing data for table \"public.fob_keys\"\r\npg_restore: processing data for table \"public.entrance_fob_keys\"\r\npg_restore: processing data for table \"public.entrance_block_fob_keys\"\r\npg_restore: processing data for table \"public.knights\"\r\npg_restore: processing data for table \"public.entrance_knight_keys\"\r\npg_restore: processing data for table \"public.knight_keys\"\r\npg_restore: processing data for table \"public.knight_cards\"\r\npg_restore: processing data for table \"public.entrance_block_knight_cards\"\r\npg_restore: processing data for table \"public.invitations\"\r\npg_restore: processing data for table \"public.entrance_invitations\"\r\npg_restore: processing data for table \"public.entrance_knight_pins\"\r\npg_restore: processing data for table \"public.entrance_lock_settings\"\r\npg_restore: processing data for table \"public.resident_guest_keys\"\r\npg_restore: processing data for table \"public.entrance_resident_guest_keys\"\r\npg_restore: processing data for table \"public.resident_keys\"\r\npg_restore: processing data for table \"public.entrance_resident_keys\"\r\npg_restore: processing data for table \"public.family_keys\"\r\npg_restore: processing data for table \"public.guest_keys\"\r\npg_restore: processing data for table \"public.json_web_keys\"\r\npg_restore: processing data for table \"public.knight_commands\"\r\npg_restore: processing data for table \"public.knight_logs\"\r\npg_restore: processing data for table \"public.knight_pins\"\r\npg_restore: processing data for table \"public.laresia_pins\"\r\npg_restore: processing data for table \"public.lock_settings\"\r\npg_restore: processing data for table \"public.webhook_tokens\"\r\npg_restore: processing data for table \"public.lock_webhook_tokens\"\r\npg_restore: processing data for table \"public.managers\"\r\npg_restore: processing data for table \"public.mst_display_logs\"\r\npg_restore: processing data for table \"public.relationships\"\r\npg_restore: processing data for table \"public.schema_migrations\"\r\npg_restore: processing data for table \"public.webhooks\"\r\npg_restore: processing data for table \"public.weeklies\"\r\npg_restore: processing data for table \"public.wenas\"\r\npg_restore: processing data for table \"public.wena_keys\"\r\npg_restore: executing SEQUENCE SET active_storage_attachments_id_seq\r\npg_restore: executing SEQUENCE SET active_storage_blobs_id_seq\r\npg_restore: executing SEQUENCE SET active_storage_variant_records_id_seq\r\npg_restore: executing SEQUENCE SET json_web_keys_id_seq\r\n```\r\n</details>\r\n\r\n### テーブル行数チェック\r\n\r\n#### Herokuモック\r\n\r\n<details>\r\n```source.sql\r\npostgres=# select relname, n_live_tup from pg_stat_user_tables order by relname asc;\r\n            relname             | n_live_tup \r\n--------------------------------+------------\r\n active_storage_attachments     |          0\r\n active_storage_blobs           |          0\r\n active_storage_variant_records |          0\r\n ar_internal_metadata           |          1\r\n autolock_schedules             |          0\r\n cards                          |          0\r\n command_logs                   |      51976\r\n dailies                        |         10\r\n display_logs                   |       1333\r\n door_mode_changed_histories    |        183\r\n durations                      |         12\r\n entrance_block_fob_keys        |          0\r\n entrance_block_knight_cards    |          0\r\n entrance_fob_keys              |          0\r\n entrance_invitations           |         12\r\n entrance_knight_keys           |          7\r\n entrance_knight_pins           |          3\r\n entrance_lock_settings         |          7\r\n entrance_locks                 |        407\r\n entrance_master_keys           |          7\r\n entrance_resident_guest_keys   |          1\r\n entrance_resident_keys         |          2\r\n family_keys                    |          4\r\n fob_keys                       |         10\r\n fobs                           |      95210\r\n guest_keys                     |          5\r\n hubs                           |      60216\r\n invitations                    |         14\r\n json_web_keys                  |          2\r\n knight_cards                   |         13\r\n knight_commands                |     266650\r\n knight_keys                    |        130\r\n knight_logs                    |        124\r\n knight_pins                    |         13\r\n knights                        |        753\r\n laresia_pins                   |          1\r\n lock_settings                  |        185\r\n lock_webhook_tokens            |         37\r\n locks                          |       1092\r\n logs                           |      23850\r\n managers                       |        117\r\n master_keys                    |        188\r\n mst_display_logs               |         80\r\n relationships                  |          1\r\n resident_guest_keys            |          1\r\n resident_keys                  |          8\r\n schema_migrations              |        103\r\n term_of_validities             |         26\r\n users                          |        981\r\n webhook_tokens                 |         24\r\n webhooks                       |          9\r\n weeklies                       |         10\r\n wena_keys                      |          1\r\n wenas                          |        259\r\n(54 rows)\r\n```\r\n</details>\r\n\r\n#### Auroraモック\r\n\r\n<details>\r\n```target.sql\r\npostgres=# select relname, n_live_tup from pg_stat_user_tables order by relname asc;\r\n            relname             | n_live_tup \r\n--------------------------------+------------\r\n active_storage_attachments     |          0\r\n active_storage_blobs           |          0\r\n active_storage_variant_records |          0\r\n ar_internal_metadata           |          1\r\n autolock_schedules             |          0\r\n cards                          |          0\r\n command_logs                   |      51976\r\n dailies                        |         10\r\n display_logs                   |       1333\r\n door_mode_changed_histories    |        183\r\n durations                      |         12\r\n entrance_block_fob_keys        |          0\r\n entrance_block_knight_cards    |          0\r\n entrance_fob_keys              |          0\r\n entrance_invitations           |         12\r\n entrance_knight_keys           |          7\r\n entrance_knight_pins           |          3\r\n entrance_lock_settings         |          7\r\n entrance_locks                 |        407\r\n entrance_master_keys           |          7\r\n entrance_resident_guest_keys   |          1\r\n entrance_resident_keys         |          2\r\n family_keys                    |          4\r\n fob_keys                       |         10\r\n fobs                           |      95210\r\n guest_keys                     |          5\r\n hubs                           |      60216\r\n invitations                    |         14\r\n json_web_keys                  |          2\r\n knight_cards                   |         13\r\n knight_commands                |     266650\r\n knight_keys                    |        130\r\n knight_logs                    |        124\r\n knight_pins                    |         13\r\n knights                        |        753\r\n laresia_pins                   |          1\r\n lock_settings                  |        185\r\n lock_webhook_tokens            |         37\r\n locks                          |       1092\r\n logs                           |      23850\r\n managers                       |        117\r\n master_keys                    |        188\r\n mst_display_logs               |         80\r\n relationships                  |          1\r\n resident_guest_keys            |          1\r\n resident_keys                  |          8\r\n schema_migrations              |        103\r\n term_of_validities             |         26\r\n users                          |        981\r\n webhook_tokens                 |         24\r\n webhooks                       |          9\r\n weeklies                       |         10\r\n wena_keys                      |          1\r\n wenas                          |        259\r\n(54 rows)\r\n```\r\n</details>\r\n差分なし\r\n\r\n## 旧検討の結論\r\n- logsテーブルとdisplay_logsは個別抽出した場合、先にそのデータだけrestoreする際は`--disable-triggers`で可能\r\n- その後に行う残りデータのdump/restoreも成功した\r\n\r\n</details>\r\n\r\n## どんでん返し\r\n- `pg_restore --disable-triggers`はsuperuser権限が必要\r\n- AWS RDSの仕様superuser権限を付与しない\r\n    - なのでStagingの移行でlogs/display_logsを投入できず失敗\r\n\r\nSAに確認→サポートに問い合わせてくれ→とりあえずの策を教示していただいた\r\n\r\n>\r\n> なお、私の調査した範囲では外部キー制約を一時的に無効化する方法として以下の2つの方法があるようです。\r\n> \r\n> 1. Aurora for PostgreSQLの”session_replication_role”パラメータを”replica”に設定する。\r\n>     - https://repost.aws/ja/knowledge-center/dms-foreign-key-constraint-error\r\n>     - （AWS DMSというDB移行サービスにおける外部キー制約違反エラーの回避策について解説したページですが、原因は同じであるかと思われます。）\r\n> 2. テーブルごとに“ALTER TABLE {テーブル名} DISABLE TRIGGER ALL”クエリを実行する。\r\n>     - https://sebenkyo.com/2020/04/17/post-779/\r\n>  \r\n> 確実な回答はサポートケースの回答をお待ちいただけたらと思いますが、緊急に解決する必要がある場合には上記の2つの方法がご参考になりましたら幸いです。\r\n\r\n## 1.session_replication_role='replica'\r\n\r\nhttps://www.postgresql.jp/document/14/html/runtime-config-client.html#GUC-SESSION-REPLICATION-ROLE\r\n\r\n> 現在のセッションでのレプリケーションに関連したトリガおよびルールの発行を制御します。 この変数を設定するには**スーパーユーザ権限**が必要で、かつ、これまでにキャッシュされた問い合わせ計画が破棄されることになります。 取り得る値は、origin（デフォルト）、replica、localです。\r\n\r\n> 外部キーはトリガとして実装されているため、このパラメータをreplicaとすることによって同時にすべての外部キー検査が無効になります。\r\n\r\n### やってみる\r\n\r\nstg環境でのpsql上では、`psqlで接続している間だけ`外部キー検査が無効となっていた(セッションなので当たり前)\r\n\r\n**Aurora上では、rds_superuserでもできました**\r\n\r\n(alter table disable trigger allはダメだけど)\r\n\r\n<details>\r\n<summary>replicaを設定してからpsqlをexitして再接続(pg_restoreを想定)</summary>\r\n\r\n```\r\nkingapi=> show session_replication_role;\r\n session_replication_role \r\n--------------------------\r\n origin\r\n(1 row)\r\n\r\nkingapi=> set session_replication_role='replica';\r\nSET\r\nkingapi=> show session_replication_role;\r\n session_replication_role \r\n--------------------------\r\n replica\r\n(1 row)\r\n\r\nkingapi=> exit\r\nroot@e2fb99adcaa5:/# psql -h king-api-staging.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com -d kingapi -U kingadmin -p 5432\r\npsql (14.7 (Ubuntu 14.7-0ubuntu0.22.04.1), server 14.5)\r\nSSL connection (protocol: TLSv1.3, cipher: TLS_AES_256_GCM_SHA384, bits: 256, compression: off)\r\nType \"help\" for help.\r\n\r\nkingapi=> show session_replication_role;\r\n session_replication_role \r\n--------------------------\r\n origin\r\n(1 row)\r\n```\r\n    \r\n</details>\r\n\r\npg_restoreする場合、手動でのSETコマンドでは対応が難しいか？\r\n\r\n\r\n### session_replication_role='replica'を維持したい\r\n\r\nhttps://docs.aws.amazon.com/ja_jp/dms/latest/userguide/CHAP_Target.PostgreSQL.html\r\n> PostgreSQL では、session_replication_role パラメータを使用します。\r\n\r\n> Amazon RDS では、**パラメータグループ**を使用してこのパラメータの設定を管理できます。\r\n\r\n→未検証",
    "body_html": "<h2 data-sourcepos=\"1:1-1:9\" id=\"0-1-0\" name=\"0-1-0\"><a class=\"anchor\" id=\"経緯\" name=\"経緯\" href=\"#経緯\" data-position=\"0-1-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"経緯\"> &gt; 経緯</span></a>経緯</h2>\n<p data-sourcepos=\"3:1-3:90\">Heroku→Aurora Database移行において、テーブルごとに作業分割すること</p>\n<ul data-sourcepos=\"4:1-6:0\">\n<li data-sourcepos=\"4:1-4:143\">logsテーブル、display_logsテーブルは重要度が<strong>比較的</strong>高くないためbucardoによるこれまでの手順で移行する</li>\n<li data-sourcepos=\"5:1-6:0\">その他のテーブルに関してはダウンタイム中にpg_dump/pg_restoreを行い完全コピーを行う</li>\n</ul>\n<p data-sourcepos=\"7:1-7:139\">上記を実行するために、テーブルスキーマのHerokuからのdump→Auroraへのrestoreが済んだ状態(データは空)で</p>\n<ul data-sourcepos=\"8:1-10:0\">\n<li data-sourcepos=\"8:1-8:110\"><strong>外部キー制約がある</strong>logsテーブル、display_logsテーブルに対しrestoreができること</li>\n<li data-sourcepos=\"9:1-10:0\">上記restoreができた状態で他のテーブルに問題なくデータがrestoreできること</li>\n</ul>\n<p data-sourcepos=\"11:1-11:18\">を確認する。</p>\n<details>\n<summary>旧検討→失敗</summary>\n<h2 data-sourcepos=\"16:1-16:15\" id=\"0-2-0\" name=\"0-2-0\"><a class=\"anchor\" id=\"環境準備\" name=\"環境準備\" href=\"#環境準備\" data-position=\"0-2-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"環境準備\"> &gt; 環境準備</span></a>環境準備</h2>\n<p data-sourcepos=\"18:1-21:144\">dockerで2つのDBを立て、片方をHeroku、もう一方をAuroraと見立てた状態にする。<br>\nさらに3つめのコンテナにはEC2bucardoインスタンスのモックとしてbucardoを用意してあるが、今回はdumpとrestoreの検証のため一旦使わない<br>\nデータにはking-apiで取得しているlatest.dump(stagingのdump)を利用し、Herokuモックに投入しておく。<br>\nその後、<a href=\"https://docs.google.com/spreadsheets/d/1W3DymCJ_ifiXtSUwVAjcl9tzPGfz5WE6bmnnwYL9Gbo/edit#gid=602303325\" target=\"_blank\" rel=\"noopener noreferrer\">DB移行手順</a>に従って</p>\n<ul data-sourcepos=\"22:1-23:0\">\n<li data-sourcepos=\"22:1-23:0\">スキーマをHerokuモックからdump→Auroraモックへrestore</li>\n</ul>\n<h2 data-sourcepos=\"24:1-24:28\" id=\"0-3-0\" name=\"0-3-0\"><a class=\"anchor\" id=\"確認1.logs/display_logs\" name=\"確認1.logs/display_logs\" href=\"#確認1.logs/display_logs\" data-position=\"0-3-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"確認1.logs/display_logs\"> &gt; 確認1.logs/display_logs</span></a>確認1.logs/display_logs</h2>\n<p data-sourcepos=\"26:1-26:133\">検証の結果、これまで通りのrestore --data-onlyだと外部キー制約に引っかかってしまい不可能だった。</p>\n<p data-sourcepos=\"28:1-28:349\">また、<a href=\"https://qrio.esa.io/posts/1267#%E7%8F%BE%E5%9C%A8%E3%81%AE%E3%83%AD%E3%82%B0%E3%82%92S3%E3%81%AB%E4%BF%9D%E5%AD%98%E3%81%99%E3%82%8B%EF%BC%88%E4%BB%8A%E5%9B%9E%E3%81%AE%E3%81%BF%E3%81%AE%E5%AF%BE%E5%BF%9C%EF%BC%89\">内田1さんからもらったesa</a>にある内容は、-cが含まれていて--data-onlyのdumpだと利用できない。</p>\n<div class=\"code-block\" data-sourcepos=\"29:1-40:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>pg_restore \n    <span class=\"nt\">-c</span>  <span class=\"c\"># --clean ここがdata-onlyのdumpだと利用できない</span>\n    <span class=\"nt\">-Fc</span> <span class=\"c\"># --format=custom</span>\n    <span class=\"nt\">-t</span> logs <span class=\"c\"># --table=logs</span>\n    <span class=\"nt\">-h</span> king-db-backup-staging.cucbox6dvi64.ap-northeast-1.rds.amazonaws.com \n    <span class=\"nt\">-U</span> postgres <span class=\"nt\">-d</span> king_db_backup_staging \n    721df311-e45e-4656-ade5-d812f36c6db2 <span class=\"c\">#dumpファイル指定</span>\n    <span class=\"nt\">-L</span> content_list \n    <span class=\"nt\">-v</span> <span class=\"c\"># --verbose</span>\n    <span class=\"nt\">-j</span> 8 <span class=\"c\"># 並列数</span>\n</code></pre></div></div>\n<p data-sourcepos=\"42:1-42:36\">以下の方法で実現できた。</p>\n<p data-sourcepos=\"44:1-44:61\"><a href=\"https://www.postgresql.jp/document/14/html/app-pgrestore.html\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.postgresql.jp/document/14/html/app-pgrestore.html</a></p>\n<blockquote data-sourcepos=\"45:1-46:447\">\n<p data-sourcepos=\"45:2-46:447\">--disable-triggers<br>\nこのオプションは、データのみのダンプからリストアする際にしか適用されません。 データのリストア中、pg_restoreに対し、対象テーブル上のトリガを一時的に無効にするコマンドを実行するよう指示します。 このオプションは、データのリストア中には呼び出したくない参照整合性検査やその他のトリガがある場合に使用します。</p>\n</blockquote>\n<div class=\"code-block\" data-sourcepos=\"48:1-60:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>pg_restore <span class=\"se\">\\</span>\n    <span class=\"nt\">--format</span><span class=\"o\">=</span>custom <span class=\"se\">\\</span>\n    <span class=\"nt\">--data-only</span> <span class=\"se\">\\</span>\n    <span class=\"nt\">--disable-triggers</span> <span class=\"se\">\\ </span><span class=\"c\"># これがあると、外部キーのチェックトリガーを無効にしてデータ投入できる</span>\n    <span class=\"nt\">--table</span><span class=\"o\">=</span>logs <span class=\"se\">\\</span>\n    <span class=\"nt\">--table</span><span class=\"o\">=</span>display_logs <span class=\"se\">\\</span>\n    <span class=\"nt\">--host</span><span class=\"o\">=</span>target-db <span class=\"se\">\\</span>\n    <span class=\"nt\">--username</span><span class=\"o\">=</span>postgres <span class=\"se\">\\</span>\n    <span class=\"nt\">--dbname</span><span class=\"o\">=</span>postgres <span class=\"se\">\\</span>\n    <span class=\"nt\">--port</span><span class=\"o\">=</span>5432 <span class=\"se\">\\</span>\n    logs_and_displaylogs.dump\n</code></pre></div></div>\n<h2 data-sourcepos=\"62:1-62:45\" id=\"0-4-0\" name=\"0-4-0\"><a class=\"anchor\" id=\"該当テーブル全件チェック結果\" name=\"該当テーブル全件チェック結果\" href=\"#該当テーブル全件チェック結果\" data-position=\"0-4-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"該当テーブル全件チェック結果\"> &gt; 該当テーブル全件チェック結果</span></a>該当テーブル全件チェック結果</h2>\n<div class=\"code-block\" data-sourcepos=\"64:1-74:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>logs.sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code><span class=\"c\"># コピー元DBのlogsテーブルを全件ファイルへ出力</span>\nroot@27c638175257:/# psql <span class=\"nt\">-h</span> source-db <span class=\"nt\">-U</span> postgres <span class=\"nt\">-d</span> postgres <span class=\"nt\">-p</span> 5432 <span class=\"nt\">-c</span> <span class=\"s2\">\"SELECT * from logs order by updated_at desc;\"</span> <span class=\"o\">&gt;</span>query11.log\nPassword <span class=\"k\">for </span>user postgres: \n<span class=\"c\"># コピー先DBのlogsテーブルを全件ファイルへ出力</span>\nroot@27c638175257:/# psql <span class=\"nt\">-h</span> target-db <span class=\"nt\">-U</span> postgres <span class=\"nt\">-d</span> postgres <span class=\"nt\">-p</span> 5432 <span class=\"nt\">-c</span> <span class=\"s2\">\"SELECT * from logs order by updated_at desc;\"</span> <span class=\"o\">&gt;</span>query22.log\nPassword <span class=\"k\">for </span>user postgres: \n<span class=\"c\"># diffコマンドで差異を見る(差異があれば出力がある)</span>\nroot@27c638175257:/# diff query11.log query22.log \nroot@27c638175257:/# \n</code></pre></div></div>\n<div class=\"code-block\" data-sourcepos=\"76:1-86:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>display_logs.sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code><span class=\"c\"># コピー元DBのdisplay_logsテーブルを全件ファイルへ出力</span>\nroot@27c638175257:/# psql <span class=\"nt\">-h</span> source-db <span class=\"nt\">-U</span> postgres <span class=\"nt\">-d</span> postgres <span class=\"nt\">-p</span> 5432 <span class=\"nt\">-c</span> <span class=\"s2\">\"SELECT * from display_logs order by created_at desc;\"</span> <span class=\"o\">&gt;</span>query33\nPassword <span class=\"k\">for </span>user postgres: \n<span class=\"c\"># コピー先DBのdisplay_logsテーブルを全件ファイルへ出力</span>\nroot@27c638175257:/# psql <span class=\"nt\">-h</span> target-db <span class=\"nt\">-U</span> postgres <span class=\"nt\">-d</span> postgres <span class=\"nt\">-p</span> 5432 <span class=\"nt\">-c</span> <span class=\"s2\">\"SELECT * from display_logs order by created_at desc;\"</span> <span class=\"o\">&gt;</span>query44\nPassword <span class=\"k\">for </span>user postgres: \n<span class=\"c\"># diffコマンドで差異を見る(差異があれば出力がある)</span>\nroot@27c638175257:/# diff query33 query44 \nroot@27c638175257:/# \n</code></pre></div></div>\n<h2 data-sourcepos=\"88:1-88:30\" id=\"0-5-0\" name=\"0-5-0\"><a class=\"anchor\" id=\"他のテーブルの行数\" name=\"他のテーブルの行数\" href=\"#他のテーブルの行数\" data-position=\"0-5-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"他のテーブルの行数\"> &gt; 他のテーブルの行数</span></a>他のテーブルの行数</h2>\n<p data-sourcepos=\"89:1-89:114\">Aurora仮定のターゲットDBにlogsテーブルとdisplay_logsテーブルのみデータが挿入された。</p>\n<details>\n<summary>ソースDB(Heroku仮定)</summary>\n<div class=\"code-block\" data-sourcepos=\"94:1-155:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>source.sql</div><div class=\"highlight\"><pre class=\"highlight plsql\"><code><span class=\"n\">postgres</span><span class=\"o\">=</span><span class=\"err\">#</span> <span class=\"k\">ANALYZE</span><span class=\"p\">;</span>\n<span class=\"k\">ANALYZE</span>\n<span class=\"n\">postgres</span><span class=\"o\">=</span><span class=\"err\">#</span> <span class=\"kr\">select</span> <span class=\"n\">relname</span><span class=\"p\">,</span> <span class=\"n\">n_live_tup</span> <span class=\"kr\">from</span> <span class=\"n\">pg_stat_user_tables</span> <span class=\"kr\">order</span> <span class=\"kr\">by</span> <span class=\"n\">relname</span> <span class=\"kr\">asc</span><span class=\"p\">;</span>\n            <span class=\"n\">relname</span>             <span class=\"err\">|</span> <span class=\"n\">n_live_tup</span> \n<span class=\"c1\">--------------------------------+------------</span>\n <span class=\"n\">active_storage_attachments</span>     <span class=\"err\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">active_storage_blobs</span>           <span class=\"err\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">active_storage_variant_records</span> <span class=\"err\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">ar_internal_metadata</span>           <span class=\"err\">|</span>          <span class=\"mi\">1</span>\n <span class=\"n\">autolock_schedules</span>             <span class=\"err\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">cards</span>                          <span class=\"err\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">command_logs</span>                   <span class=\"err\">|</span>      <span class=\"mi\">51976</span>\n <span class=\"n\">dailies</span>                        <span class=\"err\">|</span>         <span class=\"mi\">10</span>\n <span class=\"n\">display_logs</span>                   <span class=\"err\">|</span>       <span class=\"mi\">1333</span>\n <span class=\"n\">door_mode_changed_histories</span>    <span class=\"err\">|</span>        <span class=\"mi\">183</span>\n <span class=\"n\">durations</span>                      <span class=\"err\">|</span>         <span class=\"mi\">12</span>\n <span class=\"n\">entrance_block_fob_keys</span>        <span class=\"err\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">entrance_block_knight_cards</span>    <span class=\"err\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">entrance_fob_keys</span>              <span class=\"err\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">entrance_invitations</span>           <span class=\"err\">|</span>         <span class=\"mi\">12</span>\n <span class=\"n\">entrance_knight_keys</span>           <span class=\"err\">|</span>          <span class=\"mi\">7</span>\n <span class=\"n\">entrance_knight_pins</span>           <span class=\"err\">|</span>          <span class=\"mi\">3</span>\n <span class=\"n\">entrance_lock_settings</span>         <span class=\"err\">|</span>          <span class=\"mi\">7</span>\n <span class=\"n\">entrance_locks</span>                 <span class=\"err\">|</span>        <span class=\"mi\">407</span>\n <span class=\"n\">entrance_master_keys</span>           <span class=\"err\">|</span>          <span class=\"mi\">7</span>\n <span class=\"n\">entrance_resident_guest_keys</span>   <span class=\"err\">|</span>          <span class=\"mi\">1</span>\n <span class=\"n\">entrance_resident_keys</span>         <span class=\"err\">|</span>          <span class=\"mi\">2</span>\n <span class=\"n\">family_keys</span>                    <span class=\"err\">|</span>          <span class=\"mi\">4</span>\n <span class=\"n\">fob_keys</span>                       <span class=\"err\">|</span>         <span class=\"mi\">10</span>\n <span class=\"n\">fobs</span>                           <span class=\"err\">|</span>      <span class=\"mi\">95210</span>\n <span class=\"n\">guest_keys</span>                     <span class=\"err\">|</span>          <span class=\"mi\">5</span>\n <span class=\"n\">hubs</span>                           <span class=\"err\">|</span>      <span class=\"mi\">60216</span>\n <span class=\"n\">invitations</span>                    <span class=\"err\">|</span>         <span class=\"mi\">14</span>\n <span class=\"n\">json_web_keys</span>                  <span class=\"err\">|</span>          <span class=\"mi\">2</span>\n <span class=\"n\">knight_cards</span>                   <span class=\"err\">|</span>         <span class=\"mi\">13</span>\n <span class=\"n\">knight_commands</span>                <span class=\"err\">|</span>     <span class=\"mi\">266650</span>\n <span class=\"n\">knight_keys</span>                    <span class=\"err\">|</span>        <span class=\"mi\">130</span>\n <span class=\"n\">knight_logs</span>                    <span class=\"err\">|</span>        <span class=\"mi\">124</span>\n <span class=\"n\">knight_pins</span>                    <span class=\"err\">|</span>         <span class=\"mi\">13</span>\n <span class=\"n\">knights</span>                        <span class=\"err\">|</span>        <span class=\"mi\">753</span>\n <span class=\"n\">laresia_pins</span>                   <span class=\"err\">|</span>          <span class=\"mi\">1</span>\n <span class=\"n\">lock_settings</span>                  <span class=\"err\">|</span>        <span class=\"mi\">185</span>\n <span class=\"n\">lock_webhook_tokens</span>            <span class=\"err\">|</span>         <span class=\"mi\">37</span>\n <span class=\"n\">locks</span>                          <span class=\"err\">|</span>       <span class=\"mi\">1092</span>\n <span class=\"n\">logs</span>                           <span class=\"err\">|</span>      <span class=\"mi\">23850</span>\n <span class=\"n\">managers</span>                       <span class=\"err\">|</span>        <span class=\"mi\">117</span>\n <span class=\"n\">master_keys</span>                    <span class=\"err\">|</span>        <span class=\"mi\">188</span>\n <span class=\"n\">mst_display_logs</span>               <span class=\"err\">|</span>         <span class=\"mi\">80</span>\n <span class=\"n\">relationships</span>                  <span class=\"err\">|</span>          <span class=\"mi\">1</span>\n <span class=\"n\">resident_guest_keys</span>            <span class=\"err\">|</span>          <span class=\"mi\">1</span>\n <span class=\"n\">resident_keys</span>                  <span class=\"err\">|</span>          <span class=\"mi\">8</span>\n <span class=\"n\">schema_migrations</span>              <span class=\"err\">|</span>        <span class=\"mi\">103</span>\n <span class=\"n\">term_of_validities</span>             <span class=\"err\">|</span>         <span class=\"mi\">26</span>\n <span class=\"k\">users</span>                          <span class=\"err\">|</span>        <span class=\"mi\">981</span>\n <span class=\"n\">webhook_tokens</span>                 <span class=\"err\">|</span>         <span class=\"mi\">24</span>\n <span class=\"n\">webhooks</span>                       <span class=\"err\">|</span>          <span class=\"mi\">9</span>\n <span class=\"n\">weeklies</span>                       <span class=\"err\">|</span>         <span class=\"mi\">10</span>\n <span class=\"n\">wena_keys</span>                      <span class=\"err\">|</span>          <span class=\"mi\">1</span>\n <span class=\"n\">wenas</span>                          <span class=\"err\">|</span>        <span class=\"mi\">259</span>\n<span class=\"p\">(</span><span class=\"mi\">54</span> <span class=\"k\">rows</span><span class=\"p\">)</span>\n</code></pre></div></div>\n</details>\n<details>\n<p data-sourcepos=\"161:1-161:50\"><sumamry>ターゲットDB(Aurora仮定)</sumamry></p>\n<div class=\"code-block\" data-sourcepos=\"163:1-224:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>target.sql</div><div class=\"highlight\"><pre class=\"highlight plsql\"><code><span class=\"n\">postgres</span><span class=\"o\">=</span><span class=\"err\">#</span> <span class=\"k\">ANALYZE</span><span class=\"p\">;</span>\n<span class=\"k\">ANALYZE</span>\n<span class=\"n\">postgres</span><span class=\"o\">=</span><span class=\"err\">#</span> <span class=\"kr\">select</span> <span class=\"n\">relname</span><span class=\"p\">,</span> <span class=\"n\">n_live_tup</span> <span class=\"kr\">from</span> <span class=\"n\">pg_stat_user_tables</span> <span class=\"kr\">order</span> <span class=\"kr\">by</span> <span class=\"n\">relname</span> <span class=\"kr\">asc</span><span class=\"p\">;</span>\n            <span class=\"n\">relname</span>             <span class=\"err\">|</span> <span class=\"n\">n_live_tup</span> \n<span class=\"c1\">--------------------------------+------------</span>\n <span class=\"n\">active_storage_attachments</span>     <span class=\"err\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">active_storage_blobs</span>           <span class=\"err\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">active_storage_variant_records</span> <span class=\"err\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">ar_internal_metadata</span>           <span class=\"err\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">autolock_schedules</span>             <span class=\"err\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">cards</span>                          <span class=\"err\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">command_logs</span>                   <span class=\"err\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">dailies</span>                        <span class=\"err\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">display_logs</span>                   <span class=\"err\">|</span>       <span class=\"mi\">1333</span>\n <span class=\"n\">door_mode_changed_histories</span>    <span class=\"err\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">durations</span>                      <span class=\"err\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">entrance_block_fob_keys</span>        <span class=\"err\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">entrance_block_knight_cards</span>    <span class=\"err\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">entrance_fob_keys</span>              <span class=\"err\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">entrance_invitations</span>           <span class=\"err\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">entrance_knight_keys</span>           <span class=\"err\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">entrance_knight_pins</span>           <span class=\"err\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">entrance_lock_settings</span>         <span class=\"err\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">entrance_locks</span>                 <span class=\"err\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">entrance_master_keys</span>           <span class=\"err\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">entrance_resident_guest_keys</span>   <span class=\"err\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">entrance_resident_keys</span>         <span class=\"err\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">family_keys</span>                    <span class=\"err\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">fob_keys</span>                       <span class=\"err\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">fobs</span>                           <span class=\"err\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">guest_keys</span>                     <span class=\"err\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">hubs</span>                           <span class=\"err\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">invitations</span>                    <span class=\"err\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">json_web_keys</span>                  <span class=\"err\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">knight_cards</span>                   <span class=\"err\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">knight_commands</span>                <span class=\"err\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">knight_keys</span>                    <span class=\"err\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">knight_logs</span>                    <span class=\"err\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">knight_pins</span>                    <span class=\"err\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">knights</span>                        <span class=\"err\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">laresia_pins</span>                   <span class=\"err\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">lock_settings</span>                  <span class=\"err\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">lock_webhook_tokens</span>            <span class=\"err\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">locks</span>                          <span class=\"err\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">logs</span>                           <span class=\"err\">|</span>      <span class=\"mi\">23850</span>\n <span class=\"n\">managers</span>                       <span class=\"err\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">master_keys</span>                    <span class=\"err\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">mst_display_logs</span>               <span class=\"err\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">relationships</span>                  <span class=\"err\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">resident_guest_keys</span>            <span class=\"err\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">resident_keys</span>                  <span class=\"err\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">schema_migrations</span>              <span class=\"err\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">term_of_validities</span>             <span class=\"err\">|</span>          <span class=\"mi\">0</span>\n <span class=\"k\">users</span>                          <span class=\"err\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">webhook_tokens</span>                 <span class=\"err\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">webhooks</span>                       <span class=\"err\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">weeklies</span>                       <span class=\"err\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">wena_keys</span>                      <span class=\"err\">|</span>          <span class=\"mi\">0</span>\n <span class=\"n\">wenas</span>                          <span class=\"err\">|</span>          <span class=\"mi\">0</span>\n<span class=\"p\">(</span><span class=\"mi\">54</span> <span class=\"k\">rows</span><span class=\"p\">)</span>\n</code></pre></div></div>\n</details>\n<h2 data-sourcepos=\"228:1-228:62\" id=\"0-6-0\" name=\"0-6-0\"><a class=\"anchor\" id=\"確認2. logs/display_logs以外のデータのdump/restore\" name=\"確認2. logs/display_logs以外のデータのdump/restore\" href=\"#確認2. logs/display_logs以外のデータのdump/restore\" data-position=\"0-6-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"確認2. logs/display_logs以外のデータのdump/restore\"> &gt; 確認2. logs/display_logs以外のデータのdump/restore</span></a>確認2. logs/display_logs以外のデータのdump/restore</h2>\n<h3 data-sourcepos=\"229:1-229:8\" id=\"0-6-1\" name=\"0-6-1\"><a class=\"anchor\" id=\"dump\" name=\"dump\" href=\"#dump\" data-position=\"0-6-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"dump\"> &gt; dump</span></a>dump</h3>\n<p data-sourcepos=\"230:1-230:157\">pg_dump --format=custom --verbose --data-only --exclude-table=logs --exclude-table=display_logs -h source-db -U postgres -d postgres -p 5432 &gt; main_data.dump</p>\n<details>\n```sh\npg_dump: last built-in OID is 16383\npg_dump: reading extensions\npg_dump: identifying extension members\npg_dump: reading schemas\npg_dump: reading user-defined tables\npg_dump: reading user-defined functions\npg_dump: reading user-defined types\npg_dump: reading procedural languages\npg_dump: reading user-defined aggregate functions\npg_dump: reading user-defined operators\npg_dump: reading user-defined access methods\npg_dump: reading user-defined operator classes\npg_dump: reading user-defined operator families\npg_dump: reading user-defined text search parsers\npg_dump: reading user-defined text search templates\npg_dump: reading user-defined text search dictionaries\npg_dump: reading user-defined text search configurations\npg_dump: reading user-defined foreign-data wrappers\npg_dump: reading user-defined foreign servers\npg_dump: reading default privileges\npg_dump: reading user-defined collations\npg_dump: reading user-defined conversions\npg_dump: reading type casts\npg_dump: reading transforms\npg_dump: reading table inheritance information\npg_dump: reading event triggers\npg_dump: finding extension tables\npg_dump: finding inheritance relationships\npg_dump: reading column info for interesting tables\npg_dump: finding the columns and types of table \"public.pg_stat_statements_info\"\npg_dump: finding the columns and types of table \"public.pg_stat_statements\"\npg_dump: finding the columns and types of table \"public.active_storage_attachments\"\npg_dump: finding the columns and types of table \"public.active_storage_blobs\"\npg_dump: finding the columns and types of table \"public.active_storage_variant_records\"\npg_dump: finding the columns and types of table \"public.ar_internal_metadata\"\npg_dump: finding the columns and types of table \"public.autolock_schedules\"\npg_dump: finding the columns and types of table \"public.cards\"\npg_dump: finding the columns and types of table \"public.command_logs\"\npg_dump: finding the columns and types of table \"public.dailies\"\npg_dump: finding the columns and types of table \"public.door_mode_changed_histories\"\npg_dump: finding the columns and types of table \"public.durations\"\npg_dump: finding the columns and types of table \"public.entrance_block_fob_keys\"\npg_dump: finding the columns and types of table \"public.entrance_block_knight_cards\"\npg_dump: finding the columns and types of table \"public.entrance_fob_keys\"\npg_dump: finding the columns and types of table \"public.entrance_invitations\"\npg_dump: finding the columns and types of table \"public.entrance_knight_keys\"\npg_dump: finding the columns and types of table \"public.entrance_knight_pins\"\npg_dump: finding the columns and types of table \"public.entrance_lock_settings\"\npg_dump: finding the columns and types of table \"public.entrance_locks\"\npg_dump: finding the columns and types of table \"public.entrance_master_keys\"\npg_dump: finding the columns and types of table \"public.entrance_resident_guest_keys\"\npg_dump: finding the columns and types of table \"public.entrance_resident_keys\"\npg_dump: finding the columns and types of table \"public.family_keys\"\npg_dump: finding the columns and types of table \"public.fob_keys\"\npg_dump: finding the columns and types of table \"public.fobs\"\npg_dump: finding the columns and types of table \"public.guest_keys\"\npg_dump: finding the columns and types of table \"public.hubs\"\npg_dump: finding the columns and types of table \"public.invitations\"\npg_dump: finding the columns and types of table \"public.json_web_keys\"\npg_dump: finding the columns and types of table \"public.knight_cards\"\npg_dump: finding the columns and types of table \"public.knight_commands\"\npg_dump: finding the columns and types of table \"public.knight_keys\"\npg_dump: finding the columns and types of table \"public.knight_logs\"\npg_dump: finding the columns and types of table \"public.knight_pins\"\npg_dump: finding the columns and types of table \"public.knights\"\npg_dump: finding the columns and types of table \"public.laresia_pins\"\npg_dump: finding the columns and types of table \"public.lock_settings\"\npg_dump: finding the columns and types of table \"public.lock_webhook_tokens\"\npg_dump: finding the columns and types of table \"public.locks\"\npg_dump: finding the columns and types of table \"public.managers\"\npg_dump: finding the columns and types of table \"public.master_keys\"\npg_dump: finding the columns and types of table \"public.mst_display_logs\"\npg_dump: finding the columns and types of table \"public.relationships\"\npg_dump: finding the columns and types of table \"public.resident_guest_keys\"\npg_dump: finding the columns and types of table \"public.resident_keys\"\npg_dump: finding the columns and types of table \"public.schema_migrations\"\npg_dump: finding the columns and types of table \"public.term_of_validities\"\npg_dump: finding the columns and types of table \"public.users\"\npg_dump: finding the columns and types of table \"public.webhook_tokens\"\npg_dump: finding the columns and types of table \"public.webhooks\"\npg_dump: finding the columns and types of table \"public.weeklies\"\npg_dump: finding the columns and types of table \"public.wena_keys\"\npg_dump: finding the columns and types of table \"public.wenas\"\npg_dump: flagging inherited columns in subtables\npg_dump: reading indexes\npg_dump: reading indexes for table \"public.active_storage_attachments\"\npg_dump: reading indexes for table \"public.active_storage_blobs\"\npg_dump: reading indexes for table \"public.active_storage_variant_records\"\npg_dump: reading indexes for table \"public.ar_internal_metadata\"\npg_dump: reading indexes for table \"public.autolock_schedules\"\npg_dump: reading indexes for table \"public.cards\"\npg_dump: reading indexes for table \"public.command_logs\"\npg_dump: reading indexes for table \"public.dailies\"\npg_dump: reading indexes for table \"public.door_mode_changed_histories\"\npg_dump: reading indexes for table \"public.durations\"\npg_dump: reading indexes for table \"public.entrance_block_fob_keys\"\npg_dump: reading indexes for table \"public.entrance_block_knight_cards\"\npg_dump: reading indexes for table \"public.entrance_fob_keys\"\npg_dump: reading indexes for table \"public.entrance_invitations\"\npg_dump: reading indexes for table \"public.entrance_knight_keys\"\npg_dump: reading indexes for table \"public.entrance_knight_pins\"\npg_dump: reading indexes for table \"public.entrance_lock_settings\"\npg_dump: reading indexes for table \"public.entrance_locks\"\npg_dump: reading indexes for table \"public.entrance_master_keys\"\npg_dump: reading indexes for table \"public.entrance_resident_guest_keys\"\npg_dump: reading indexes for table \"public.entrance_resident_keys\"\npg_dump: reading indexes for table \"public.family_keys\"\npg_dump: reading indexes for table \"public.fob_keys\"\npg_dump: reading indexes for table \"public.fobs\"\npg_dump: reading indexes for table \"public.guest_keys\"\npg_dump: reading indexes for table \"public.hubs\"\npg_dump: reading indexes for table \"public.invitations\"\npg_dump: reading indexes for table \"public.json_web_keys\"\npg_dump: reading indexes for table \"public.knight_cards\"\npg_dump: reading indexes for table \"public.knight_commands\"\npg_dump: reading indexes for table \"public.knight_keys\"\npg_dump: reading indexes for table \"public.knight_logs\"\npg_dump: reading indexes for table \"public.knight_pins\"\npg_dump: reading indexes for table \"public.knights\"\npg_dump: reading indexes for table \"public.laresia_pins\"\npg_dump: reading indexes for table \"public.lock_settings\"\npg_dump: reading indexes for table \"public.lock_webhook_tokens\"\npg_dump: reading indexes for table \"public.locks\"\npg_dump: reading indexes for table \"public.managers\"\npg_dump: reading indexes for table \"public.master_keys\"\npg_dump: reading indexes for table \"public.mst_display_logs\"\npg_dump: reading indexes for table \"public.relationships\"\npg_dump: reading indexes for table \"public.resident_guest_keys\"\npg_dump: reading indexes for table \"public.resident_keys\"\npg_dump: reading indexes for table \"public.schema_migrations\"\npg_dump: reading indexes for table \"public.term_of_validities\"\npg_dump: reading indexes for table \"public.users\"\npg_dump: reading indexes for table \"public.webhook_tokens\"\npg_dump: reading indexes for table \"public.webhooks\"\npg_dump: reading indexes for table \"public.weeklies\"\npg_dump: reading indexes for table \"public.wena_keys\"\npg_dump: reading indexes for table \"public.wenas\"\npg_dump: flagging indexes in partitioned tables\npg_dump: reading extended statistics\npg_dump: reading constraints\npg_dump: reading foreign key constraints for table \"public.active_storage_attachments\"\npg_dump: reading foreign key constraints for table \"public.active_storage_blobs\"\npg_dump: reading foreign key constraints for table \"public.active_storage_variant_records\"\npg_dump: reading foreign key constraints for table \"public.autolock_schedules\"\npg_dump: reading foreign key constraints for table \"public.command_logs\"\npg_dump: reading foreign key constraints for table \"public.dailies\"\npg_dump: reading foreign key constraints for table \"public.door_mode_changed_histories\"\npg_dump: reading foreign key constraints for table \"public.durations\"\npg_dump: reading foreign key constraints for table \"public.entrance_block_fob_keys\"\npg_dump: reading foreign key constraints for table \"public.entrance_block_knight_cards\"\npg_dump: reading foreign key constraints for table \"public.entrance_fob_keys\"\npg_dump: reading foreign key constraints for table \"public.entrance_invitations\"\npg_dump: reading foreign key constraints for table \"public.entrance_knight_keys\"\npg_dump: reading foreign key constraints for table \"public.entrance_knight_pins\"\npg_dump: reading foreign key constraints for table \"public.entrance_lock_settings\"\npg_dump: reading foreign key constraints for table \"public.entrance_locks\"\npg_dump: reading foreign key constraints for table \"public.entrance_master_keys\"\npg_dump: reading foreign key constraints for table \"public.entrance_resident_guest_keys\"\npg_dump: reading foreign key constraints for table \"public.entrance_resident_keys\"\npg_dump: reading foreign key constraints for table \"public.family_keys\"\npg_dump: reading foreign key constraints for table \"public.fob_keys\"\npg_dump: reading foreign key constraints for table \"public.fobs\"\npg_dump: reading foreign key constraints for table \"public.guest_keys\"\npg_dump: reading foreign key constraints for table \"public.hubs\"\npg_dump: reading foreign key constraints for table \"public.invitations\"\npg_dump: reading foreign key constraints for table \"public.knight_cards\"\npg_dump: reading foreign key constraints for table \"public.knight_keys\"\npg_dump: reading foreign key constraints for table \"public.knight_logs\"\npg_dump: reading foreign key constraints for table \"public.knight_pins\"\npg_dump: reading foreign key constraints for table \"public.knights\"\npg_dump: reading foreign key constraints for table \"public.laresia_pins\"\npg_dump: reading foreign key constraints for table \"public.lock_settings\"\npg_dump: reading foreign key constraints for table \"public.lock_webhook_tokens\"\npg_dump: reading foreign key constraints for table \"public.locks\"\npg_dump: reading foreign key constraints for table \"public.managers\"\npg_dump: reading foreign key constraints for table \"public.master_keys\"\npg_dump: reading foreign key constraints for table \"public.mst_display_logs\"\npg_dump: reading foreign key constraints for table \"public.relationships\"\npg_dump: reading foreign key constraints for table \"public.resident_guest_keys\"\npg_dump: reading foreign key constraints for table \"public.resident_keys\"\npg_dump: reading foreign key constraints for table \"public.term_of_validities\"\npg_dump: reading foreign key constraints for table \"public.users\"\npg_dump: reading foreign key constraints for table \"public.webhook_tokens\"\npg_dump: reading foreign key constraints for table \"public.webhooks\"\npg_dump: reading foreign key constraints for table \"public.weeklies\"\npg_dump: reading foreign key constraints for table \"public.wena_keys\"\npg_dump: reading foreign key constraints for table \"public.wenas\"\npg_dump: reading triggers\npg_dump: reading triggers for table \"public.active_storage_attachments\"\npg_dump: reading triggers for table \"public.active_storage_blobs\"\npg_dump: reading triggers for table \"public.active_storage_variant_records\"\npg_dump: reading triggers for table \"public.autolock_schedules\"\npg_dump: reading triggers for table \"public.command_logs\"\npg_dump: reading triggers for table \"public.dailies\"\npg_dump: reading triggers for table \"public.door_mode_changed_histories\"\npg_dump: reading triggers for table \"public.durations\"\npg_dump: reading triggers for table \"public.entrance_block_fob_keys\"\npg_dump: reading triggers for table \"public.entrance_block_knight_cards\"\npg_dump: reading triggers for table \"public.entrance_fob_keys\"\npg_dump: reading triggers for table \"public.entrance_invitations\"\npg_dump: reading triggers for table \"public.entrance_knight_keys\"\npg_dump: reading triggers for table \"public.entrance_knight_pins\"\npg_dump: reading triggers for table \"public.entrance_lock_settings\"\npg_dump: reading triggers for table \"public.entrance_locks\"\npg_dump: reading triggers for table \"public.entrance_master_keys\"\npg_dump: reading triggers for table \"public.entrance_resident_guest_keys\"\npg_dump: reading triggers for table \"public.entrance_resident_keys\"\npg_dump: reading triggers for table \"public.family_keys\"\npg_dump: reading triggers for table \"public.fob_keys\"\npg_dump: reading triggers for table \"public.fobs\"\npg_dump: reading triggers for table \"public.guest_keys\"\npg_dump: reading triggers for table \"public.hubs\"\npg_dump: reading triggers for table \"public.invitations\"\npg_dump: reading triggers for table \"public.knight_cards\"\npg_dump: reading triggers for table \"public.knight_keys\"\npg_dump: reading triggers for table \"public.knight_logs\"\npg_dump: reading triggers for table \"public.knight_pins\"\npg_dump: reading triggers for table \"public.knights\"\npg_dump: reading triggers for table \"public.laresia_pins\"\npg_dump: reading triggers for table \"public.lock_settings\"\npg_dump: reading triggers for table \"public.lock_webhook_tokens\"\npg_dump: reading triggers for table \"public.locks\"\npg_dump: reading triggers for table \"public.managers\"\npg_dump: reading triggers for table \"public.master_keys\"\npg_dump: reading triggers for table \"public.mst_display_logs\"\npg_dump: reading triggers for table \"public.relationships\"\npg_dump: reading triggers for table \"public.resident_guest_keys\"\npg_dump: reading triggers for table \"public.resident_keys\"\npg_dump: reading triggers for table \"public.term_of_validities\"\npg_dump: reading triggers for table \"public.users\"\npg_dump: reading triggers for table \"public.webhook_tokens\"\npg_dump: reading triggers for table \"public.webhooks\"\npg_dump: reading triggers for table \"public.weeklies\"\npg_dump: reading triggers for table \"public.wena_keys\"\npg_dump: reading triggers for table \"public.wenas\"\npg_dump: reading rewrite rules\npg_dump: reading policies\npg_dump: reading row-level security policies\npg_dump: reading publications\npg_dump: reading publication membership\npg_dump: reading subscriptions\npg_dump: reading large objects\npg_dump: reading dependency data\npg_dump: saving encoding = UTF8\npg_dump: saving standard_conforming_strings = on\npg_dump: saving search_path = \npg_dump: saving database definition\npg_dump: dumping contents of table \"public.active_storage_blobs\"\npg_dump: dumping contents of table \"public.active_storage_attachments\"\npg_dump: dumping contents of table \"public.active_storage_variant_records\"\npg_dump: dumping contents of table \"public.ar_internal_metadata\"\npg_dump: dumping contents of table \"public.locks\"\npg_dump: dumping contents of table \"public.users\"\npg_dump: dumping contents of table \"public.master_keys\"\npg_dump: dumping contents of table \"public.autolock_schedules\"\npg_dump: dumping contents of table \"public.cards\"\npg_dump: dumping contents of table \"public.hubs\"\npg_dump: dumping contents of table \"public.command_logs\"\npg_dump: dumping contents of table \"public.term_of_validities\"\npg_dump: dumping contents of table \"public.dailies\"\npg_dump: dumping contents of table \"public.door_mode_changed_histories\"\npg_dump: dumping contents of table \"public.durations\"\npg_dump: dumping contents of table \"public.entrance_locks\"\npg_dump: dumping contents of table \"public.entrance_master_keys\"\npg_dump: dumping contents of table \"public.fobs\"\npg_dump: dumping contents of table \"public.fob_keys\"\npg_dump: dumping contents of table \"public.entrance_fob_keys\"\npg_dump: dumping contents of table \"public.entrance_block_fob_keys\"\npg_dump: dumping contents of table \"public.knights\"\npg_dump: dumping contents of table \"public.entrance_knight_keys\"\npg_dump: dumping contents of table \"public.knight_keys\"\npg_dump: dumping contents of table \"public.knight_cards\"\npg_dump: dumping contents of table \"public.entrance_block_knight_cards\"\npg_dump: dumping contents of table \"public.invitations\"\npg_dump: dumping contents of table \"public.entrance_invitations\"\npg_dump: dumping contents of table \"public.entrance_knight_pins\"\npg_dump: dumping contents of table \"public.entrance_lock_settings\"\npg_dump: dumping contents of table \"public.resident_guest_keys\"\npg_dump: dumping contents of table \"public.entrance_resident_guest_keys\"\npg_dump: dumping contents of table \"public.resident_keys\"\npg_dump: dumping contents of table \"public.entrance_resident_keys\"\npg_dump: dumping contents of table \"public.family_keys\"\npg_dump: dumping contents of table \"public.guest_keys\"\npg_dump: dumping contents of table \"public.json_web_keys\"\npg_dump: dumping contents of table \"public.knight_commands\"\npg_dump: dumping contents of table \"public.knight_logs\"\npg_dump: dumping contents of table \"public.knight_pins\"\npg_dump: dumping contents of table \"public.laresia_pins\"\npg_dump: dumping contents of table \"public.lock_settings\"\npg_dump: dumping contents of table \"public.webhook_tokens\"\npg_dump: dumping contents of table \"public.lock_webhook_tokens\"\npg_dump: dumping contents of table \"public.managers\"\npg_dump: dumping contents of table \"public.mst_display_logs\"\npg_dump: dumping contents of table \"public.relationships\"\npg_dump: dumping contents of table \"public.schema_migrations\"\npg_dump: dumping contents of table \"public.webhooks\"\npg_dump: dumping contents of table \"public.weeklies\"\npg_dump: dumping contents of table \"public.wenas\"\npg_dump: dumping contents of table \"public.wena_keys\"\n```\n</details>\n<h3 data-sourcepos=\"535:1-535:11\" id=\"0-6-2\" name=\"0-6-2\"><a class=\"anchor\" id=\"restore\" name=\"restore\" href=\"#restore\" data-position=\"0-6-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"restore\"> &gt; restore</span></a>restore</h3>\n<p data-sourcepos=\"536:1-537:46\">pg_restore --format=custom --verbose --data-only -h target-db -d postgres -U postgres -p 5432 main_data.dump<br>\npg_restore: connecting to database for restore</p>\n<details>\n<div class=\"code-block\" data-sourcepos=\"541:1-598:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>pg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.active_storage_blobs\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.active_storage_attachments\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.active_storage_variant_records\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.ar_internal_metadata\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.locks\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.users\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.master_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.autolock_schedules\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.cards\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.hubs\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.command_logs\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.term_of_validities\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.dailies\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.door_mode_changed_histories\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.durations\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_locks\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_master_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.fobs\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.fob_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_fob_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_block_fob_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.knights\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_knight_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_cards\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_block_knight_cards\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.invitations\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_invitations\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_knight_pins\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_lock_settings\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.resident_guest_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_resident_guest_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.resident_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_resident_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.family_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.guest_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.json_web_keys\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_commands\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_logs\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_pins\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.laresia_pins\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.lock_settings\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.webhook_tokens\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.lock_webhook_tokens\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.managers\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.mst_display_logs\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.relationships\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.schema_migrations\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.webhooks\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.weeklies\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.wenas\"</span>\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.wena_keys\"</span>\npg_restore: executing SEQUENCE SET active_storage_attachments_id_seq\npg_restore: executing SEQUENCE SET active_storage_blobs_id_seq\npg_restore: executing SEQUENCE SET active_storage_variant_records_id_seq\npg_restore: executing SEQUENCE SET json_web_keys_id_seq\n</code></pre></div></div>\n</details>\n<h3 data-sourcepos=\"601:1-601:34\" id=\"0-6-3\" name=\"0-6-3\"><a class=\"anchor\" id=\"テーブル行数チェック\" name=\"テーブル行数チェック\" href=\"#テーブル行数チェック\" data-position=\"0-6-3\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"テーブル行数チェック\"> &gt; テーブル行数チェック</span></a>テーブル行数チェック</h3>\n<h4 data-sourcepos=\"603:1-603:20\">Herokuモック</h4>\n<details>\n```source.sql\npostgres=# select relname, n_live_tup from pg_stat_user_tables order by relname asc;\n            relname             | n_live_tup \n--------------------------------+------------\n active_storage_attachments     |          0\n active_storage_blobs           |          0\n active_storage_variant_records |          0\n ar_internal_metadata           |          1\n autolock_schedules             |          0\n cards                          |          0\n command_logs                   |      51976\n dailies                        |         10\n display_logs                   |       1333\n door_mode_changed_histories    |        183\n durations                      |         12\n entrance_block_fob_keys        |          0\n entrance_block_knight_cards    |          0\n entrance_fob_keys              |          0\n entrance_invitations           |         12\n entrance_knight_keys           |          7\n entrance_knight_pins           |          3\n entrance_lock_settings         |          7\n entrance_locks                 |        407\n entrance_master_keys           |          7\n entrance_resident_guest_keys   |          1\n entrance_resident_keys         |          2\n family_keys                    |          4\n fob_keys                       |         10\n fobs                           |      95210\n guest_keys                     |          5\n hubs                           |      60216\n invitations                    |         14\n json_web_keys                  |          2\n knight_cards                   |         13\n knight_commands                |     266650\n knight_keys                    |        130\n knight_logs                    |        124\n knight_pins                    |         13\n knights                        |        753\n laresia_pins                   |          1\n lock_settings                  |        185\n lock_webhook_tokens            |         37\n locks                          |       1092\n logs                           |      23850\n managers                       |        117\n master_keys                    |        188\n mst_display_logs               |         80\n relationships                  |          1\n resident_guest_keys            |          1\n resident_keys                  |          8\n schema_migrations              |        103\n term_of_validities             |         26\n users                          |        981\n webhook_tokens                 |         24\n webhooks                       |          9\n weeklies                       |         10\n wena_keys                      |          1\n wenas                          |        259\n(54 rows)\n```\n</details>\n<h4 data-sourcepos=\"668:1-668:20\">Auroraモック</h4>\n<details>\n```target.sql\npostgres=# select relname, n_live_tup from pg_stat_user_tables order by relname asc;\n            relname             | n_live_tup \n--------------------------------+------------\n active_storage_attachments     |          0\n active_storage_blobs           |          0\n active_storage_variant_records |          0\n ar_internal_metadata           |          1\n autolock_schedules             |          0\n cards                          |          0\n command_logs                   |      51976\n dailies                        |         10\n display_logs                   |       1333\n door_mode_changed_histories    |        183\n durations                      |         12\n entrance_block_fob_keys        |          0\n entrance_block_knight_cards    |          0\n entrance_fob_keys              |          0\n entrance_invitations           |         12\n entrance_knight_keys           |          7\n entrance_knight_pins           |          3\n entrance_lock_settings         |          7\n entrance_locks                 |        407\n entrance_master_keys           |          7\n entrance_resident_guest_keys   |          1\n entrance_resident_keys         |          2\n family_keys                    |          4\n fob_keys                       |         10\n fobs                           |      95210\n guest_keys                     |          5\n hubs                           |      60216\n invitations                    |         14\n json_web_keys                  |          2\n knight_cards                   |         13\n knight_commands                |     266650\n knight_keys                    |        130\n knight_logs                    |        124\n knight_pins                    |         13\n knights                        |        753\n laresia_pins                   |          1\n lock_settings                  |        185\n lock_webhook_tokens            |         37\n locks                          |       1092\n logs                           |      23850\n managers                       |        117\n master_keys                    |        188\n mst_display_logs               |         80\n relationships                  |          1\n resident_guest_keys            |          1\n resident_keys                  |          8\n schema_migrations              |        103\n term_of_validities             |         26\n users                          |        981\n webhook_tokens                 |         24\n webhooks                       |          9\n weeklies                       |         10\n wena_keys                      |          1\n wenas                          |        259\n(54 rows)\n```\n</details>\n差分なし\n<h2 data-sourcepos=\"734:1-734:21\" id=\"0-7-0\" name=\"0-7-0\"><a class=\"anchor\" id=\"旧検討の結論\" name=\"旧検討の結論\" href=\"#旧検討の結論\" data-position=\"0-7-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"旧検討の結論\"> &gt; 旧検討の結論</span></a>旧検討の結論</h2>\n<ul data-sourcepos=\"735:1-737:0\">\n<li data-sourcepos=\"735:1-735:138\">logsテーブルとdisplay_logsは個別抽出した場合、先にそのデータだけrestoreする際は<code>--disable-triggers</code>で可能</li>\n<li data-sourcepos=\"736:1-737:0\">その後に行う残りデータのdump/restoreも成功した</li>\n</ul>\n</details>\n<h2 data-sourcepos=\"740:1-740:21\" id=\"0-8-0\" name=\"0-8-0\"><a class=\"anchor\" id=\"どんでん返し\" name=\"どんでん返し\" href=\"#どんでん返し\" data-position=\"0-8-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"どんでん返し\"> &gt; どんでん返し</span></a>どんでん返し</h2>\n<ul data-sourcepos=\"741:1-744:0\">\n<li data-sourcepos=\"741:1-741:60\"><code>pg_restore --disable-triggers</code>はsuperuser権限が必要</li>\n<li data-sourcepos=\"742:1-744:0\">AWS RDSの仕様superuser権限を付与しない\n<ul data-sourcepos=\"743:5-744:0\">\n<li data-sourcepos=\"743:5-744:0\">なのでStagingの移行でlogs/display_logsを投入できず失敗</li>\n</ul></li>\n</ul>\n<p data-sourcepos=\"745:1-745:107\">SAに確認→サポートに問い合わせてくれ→とりあえずの策を教示していただいた</p>\n<blockquote data-sourcepos=\"747:1-756:219\">\n<p data-sourcepos=\"748:3-748:150\">なお、私の調査した範囲では外部キー制約を一時的に無効化する方法として以下の2つの方法があるようです。</p>\n<ol data-sourcepos=\"750:3-755:3\">\n<li data-sourcepos=\"750:3-752:200\">Aurora for PostgreSQLの”session_replication_role”パラメータを”replica”に設定する。\n<ul data-sourcepos=\"751:7-752:200\">\n<li data-sourcepos=\"751:7-751:79\"><a href=\"https://repost.aws/ja/knowledge-center/dms-foreign-key-constraint-error\" target=\"_blank\" rel=\"noopener noreferrer\">https://repost.aws/ja/knowledge-center/dms-foreign-key-constraint-error</a></li>\n<li data-sourcepos=\"752:7-752:200\">（AWS DMSというDB移行サービスにおける外部キー制約違反エラーの回避策について解説したページですが、原因は同じであるかと思われます。）</li>\n</ul>\n</li>\n<li data-sourcepos=\"753:3-755:3\">テーブルごとに“ALTER TABLE {テーブル名} DISABLE TRIGGER ALL”クエリを実行する。\n<ul data-sourcepos=\"754:7-755:3\">\n<li data-sourcepos=\"754:7-755:3\"><a href=\"https://sebenkyo.com/2020/04/17/post-779/\" target=\"_blank\" rel=\"noopener noreferrer\">https://sebenkyo.com/2020/04/17/post-779/</a></li>\n</ul>\n</li>\n</ol>\n<p data-sourcepos=\"756:3-756:219\">確実な回答はサポートケースの回答をお待ちいただけたらと思いますが、緊急に解決する必要がある場合には上記の2つの方法がご参考になりましたら幸いです。</p>\n</blockquote>\n<h2 data-sourcepos=\"758:1-758:39\" id=\"0-9-0\" name=\"0-9-0\"><a class=\"anchor\" id=\"1.session_replication_role=&amp;#39;replica&amp;#39;\" name=\"1.session_replication_role=&amp;#39;replica&amp;#39;\" href=\"#1.session_replication_role=&amp;#39;replica&amp;#39;\" data-position=\"0-9-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"1.session_replication_role=&amp;#39;replica&amp;#39;\"> &gt; 1.session_replication_role='replica'</span></a>1.session_replication_role='replica'</h2>\n<p data-sourcepos=\"760:1-760:98\"><a href=\"https://www.postgresql.jp/document/14/html/runtime-config-client.html#GUC-SESSION-REPLICATION-ROLE\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.postgresql.jp/document/14/html/runtime-config-client.html#GUC-SESSION-REPLICATION-ROLE</a></p>\n<blockquote data-sourcepos=\"762:1-762:395\">\n<p data-sourcepos=\"762:3-762:395\">現在のセッションでのレプリケーションに関連したトリガおよびルールの発行を制御します。 この変数を設定するには<strong>スーパーユーザ権限</strong>が必要で、かつ、これまでにキャッシュされた問い合わせ計画が破棄されることになります。 取り得る値は、origin（デフォルト）、replica、localです。</p>\n</blockquote>\n<blockquote data-sourcepos=\"764:1-764:189\">\n<p data-sourcepos=\"764:3-764:189\">外部キーはトリガとして実装されているため、このパラメータをreplicaとすることによって同時にすべての外部キー検査が無効になります。</p>\n</blockquote>\n<h3 data-sourcepos=\"766:1-766:19\" id=\"0-9-1\" name=\"0-9-1\"><a class=\"anchor\" id=\"やってみる\" name=\"やってみる\" href=\"#やってみる\" data-position=\"0-9-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"やってみる\"> &gt; やってみる</span></a>やってみる</h3>\n<p data-sourcepos=\"768:1-768:150\">stg環境でのpsql上では、<code>psqlで接続している間だけ</code>外部キー検査が無効となっていた(セッションなので当たり前)</p>\n<p data-sourcepos=\"770:1-770:56\"><strong>Aurora上では、rds_superuserでもできました</strong></p>\n<p data-sourcepos=\"772:1-772:51\">(alter table disable trigger allはダメだけど)</p>\n<details>\n<summary>replicaを設定してからpsqlをexitして再接続(pg_restoreを想定)</summary>\n<div class=\"code-block\" data-sourcepos=\"777:1-803:3\"><div class=\"highlight\"><pre class=\"highlight plaintext\"><code>kingapi=&gt; show session_replication_role;\n session_replication_role \n--------------------------\n origin\n(1 row)\n\nkingapi=&gt; set session_replication_role='replica';\nSET\nkingapi=&gt; show session_replication_role;\n session_replication_role \n--------------------------\n replica\n(1 row)\n\nkingapi=&gt; exit\nroot@e2fb99adcaa5:/# psql -h king-api-staging.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com -d kingapi -U kingadmin -p 5432\npsql (14.7 (Ubuntu 14.7-0ubuntu0.22.04.1), server 14.5)\nSSL connection (protocol: TLSv1.3, cipher: TLS_AES_256_GCM_SHA384, bits: 256, compression: off)\nType \"help\" for help.\n\nkingapi=&gt; show session_replication_role;\n session_replication_role \n--------------------------\n origin\n(1 row)\n</code></pre></div></div>\n</details>\n<p data-sourcepos=\"807:1-807:82\">pg_restoreする場合、手動でのSETコマンドでは対応が難しいか？</p>\n<h3 data-sourcepos=\"810:1-810:56\" id=\"0-9-2\" name=\"0-9-2\"><a class=\"anchor\" id=\"session_replication_role=&amp;#39;replica&amp;#39;を維持したい\" name=\"session_replication_role=&amp;#39;replica&amp;#39;を維持したい\" href=\"#session_replication_role=&amp;#39;replica&amp;#39;を維持したい\" data-position=\"0-9-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"session_replication_role=&amp;#39;replica&amp;#39;を維持したい\"> &gt; session_replication_role='replica'を維持したい</span></a>session_replication_role='replica'を維持したい</h3>\n<p data-sourcepos=\"812:1-812:82\"><a href=\"https://docs.aws.amazon.com/ja_jp/dms/latest/userguide/CHAP_Target.PostgreSQL.html\" target=\"_blank\" rel=\"noopener noreferrer\">https://docs.aws.amazon.com/ja_jp/dms/latest/userguide/CHAP_Target.PostgreSQL.html</a></p>\n<blockquote data-sourcepos=\"813:1-813:83\">\n<p data-sourcepos=\"813:3-813:83\">PostgreSQL では、session_replication_role パラメータを使用します。</p>\n</blockquote>\n<blockquote data-sourcepos=\"815:1-815:122\">\n<p data-sourcepos=\"815:3-815:122\">Amazon RDS では、<strong>パラメータグループ</strong>を使用してこのパラメータの設定を管理できます。</p>\n</blockquote>\n<p data-sourcepos=\"817:1-817:12\">→未検証</p>\n",
    "created_at": "2023-03-28T22:14:17+09:00",
    "message": "Update post.",
    "kind": "stock",
    "comments_count": 3,
    "tasks_count": 0,
    "done_tasks_count": 0,
    "url": "https://qrio.esa.io/posts/1577",
    "updated_at": "2023-07-18T10:38:00+09:00",
    "tags": [],
    "category": "Users/杉山/Database",
    "revision_number": 8,
    "created_by": {
      "myself": false,
      "name": "杉山聡",
      "screen_name": "satoshi_sugiyama",
      "icon": "https://img.esa.io/uploads/production/members/129432/icon/thumb_m_4589e2842b9d87757c7c9db07c45c00d.jpg"
    },
    "updated_by": {
      "myself": false,
      "name": "杉山聡",
      "screen_name": "satoshi_sugiyama",
      "icon": "https://img.esa.io/uploads/production/members/129432/icon/thumb_m_4589e2842b9d87757c7c9db07c45c00d.jpg"
    },
    "stargazers_count": 0,
    "watchers_count": 2,
    "star": false,
    "watch": false,
    "sharing_urls": null
  },
  {
    "number": 1583,
    "name": "dumpに出てくるbucardoスキーマ",
    "full_name": "Users/杉山/Database/dumpに出てくるbucardoスキーマ",
    "wip": false,
    "body_md": "## 背景\r\n\r\nbucardo設定後のdumpの際にdumpログに出てきた\r\n\r\n```\r\npg_dump: dumping contents of table \"bucardo.track_public_logs\"\r\n```\r\n\r\nこいつが気になる問題\r\n\r\n## bucardoスキーマとは\r\n\r\n[Bucardo schema](https://bucardo.org/Bucardo/schema/)\r\n\r\n冒頭文を要約すると\r\n> bucardoが動いているインスタンス内データベースと追跡するデータベースにbucardoってスキーマ作るんでよろしく、bucardoが動いているインスタンスの方には設定ファイルとかが格納されている\r\n\r\nといったところ\r\n\r\n## Staging Heroku DBにいるのは？\r\n\r\n上記URLの[Remote Bucardo tables](https://bucardo.org/Bucardo/schema/)より\r\n\r\n以下英訳\r\n\r\n> スワップまたは**プッシュデルタ同期**のソースとして使用される各データベースには、以下のテーブルがbucardoスキーマにインストールされています\r\n\r\n※[プッシュデルタ同期](https://bucardo.org/Bucardo/object_types/pushdelta)が今回使うreplicationの方式\r\n>pushdeltaはBucardo同期の一種で、変更された行をあるデータベース（ソース）から1つまたは複数のターゲットデータベースにプッシュすることを意味します。\r\n\r\nbucardoスキーマ内のテーブル\r\n\r\n- bucardo_delta\r\n複製された各テーブルについて、どの行が変更されたかを保存する。\r\n- bucardo_track\r\nどの行がどのリモートターゲットにレプリケートされたかを保存する。\r\n- bucardo_delta_targets\r\nテーブルをリモートデータベースにマッピング\r\n- bucardo_sequences\r\n複製された配列[**シーケンス**]の現在の状態を追跡する\r\n- bucardo_truncate_trigger bucardo_truncate_trigger_log\r\n複製されたテーブルの切り捨て[**TRUNCATE**]を追跡する\r\n\r\nつまりStaging Heroku DBにあるlogs,display_logsテーブルについての変更情報がやAuroraへのマッピング情報が追記されていく。\r\nこのスキーマの情報は**Bucardoのプログラムそのものが参照**しAuroraへとデータを流す仕組みとなっている。\r\n\r\nよってdumpの際は除外することが可能。Auroraには必要ない情報である\r\n\r\n## 一応確認\r\n\r\nローカルでdockerコンテナを立てて再現。各DBエンジンはPostgres14です。\r\n\r\n**A**. Bucardoインスタンス&DBがあるコンテナ: EC2のモック\r\n**B**. ソースDBがあるコンテナ: Herokuのモック\r\n**C**. ターゲットDBがあるコンテナ: Auroraのモック\r\n\r\n検証用としてStagingのdumpデータをソースDBに投入。\r\n\r\nその後は[移行手順](https://docs.google.com/spreadsheets/d/1W3DymCJ_ifiXtSUwVAjcl9tzPGfz5WE6bmnnwYL9Gbo/edit?usp=sharing)通りに\r\n- テーブルスキーマのdumpとリストア(B→A→C)\r\n- Bucardoの設定、データプールの開始\r\n- logs, display_logsのdump\r\n- logs, display_logsのrestore\r\n\r\nここまでを行った状態(main_dataのdumpより前の状態)で、**B**. ソースDBがあるコンテナを参照した。\r\n\r\n<details>\r\n<summary>\r\nbucardoスキーマが生成され、logsとdisplay_logsに関するdelta_〜などのテーブルが生成されている。\r\n    </summary>\r\n\r\n```sql\r\npostgres=# \\d bucardo.*\r\n                  Table \"bucardo.bucardo_delta_names\"\r\n  Column   |           Type           | Collation | Nullable | Default\r\n-----------+--------------------------+-----------+----------+---------\r\n sync      | text                     |           |          |\r\n tablename | text                     |           |          |\r\n deltaname | text                     |           |          |\r\n trackname | text                     |           |          |\r\n cdate     | timestamp with time zone |           | not null | now()\r\nIndexes:\r\n    \"bucardo_delta_names_unique\" UNIQUE, btree (sync, tablename)\r\nTriggers:\r\n    bucardo_delta_namemaker BEFORE INSERT OR UPDATE ON bucardo.bucardo_delta_names FOR EACH ROW EXECUTE FUNCTION bucardo.bucardo_delta_names_helper()\r\n\r\nIndex \"bucardo.bucardo_delta_names_unique\"\r\n  Column   | Type | Key? | Definition\r\n-----------+------+------+------------\r\n sync      | text | yes  | sync\r\n tablename | text | yes  | tablename\r\nunique, btree, for table \"bucardo.bucardo_delta_names\"\r\n\r\nIndex \"bucardo.bucardo_delta_target_unique\"\r\n  Column   | Type | Key? | Definition\r\n-----------+------+------+------------\r\n tablename | oid  | yes  | tablename\r\n target    | text | yes  | target\r\nbtree, for table \"bucardo.bucardo_delta_targets\"\r\n\r\n                 Table \"bucardo.bucardo_delta_targets\"\r\n  Column   |           Type           | Collation | Nullable | Default\r\n-----------+--------------------------+-----------+----------+---------\r\n tablename | oid                      |           | not null |\r\n target    | text                     |           | not null |\r\n cdate     | timestamp with time zone |           | not null | now()\r\nIndexes:\r\n    \"bucardo_delta_target_unique\" btree (tablename, target)\r\n\r\n            Table \"bucardo.bucardo_sequences\"\r\n    Column    |  Type   | Collation | Nullable | Default\r\n--------------+---------+-----------+----------+---------\r\n schemaname   | text    |           | not null |\r\n seqname      | text    |           | not null |\r\n syncname     | text    |           | not null |\r\n targetname   | text    |           | not null |\r\n last_value   | bigint  |           | not null |\r\n start_value  | bigint  |           | not null |\r\n increment_by | bigint  |           | not null |\r\n max_value    | bigint  |           | not null |\r\n min_value    | bigint  |           | not null |\r\n is_cycled    | boolean |           | not null |\r\n is_called    | boolean |           | not null |\r\nIndexes:\r\n    \"bucardo_sequences_tablename\" UNIQUE, btree (schemaname, seqname, syncname, targetname)\r\n\r\nIndex \"bucardo.bucardo_sequences_tablename\"\r\n   Column   | Type | Key? | Definition\r\n------------+------+------+------------\r\n schemaname | text | yes  | schemaname\r\n seqname    | text | yes  | seqname\r\n syncname   | text | yes  | syncname\r\n targetname | text | yes  | targetname\r\nunique, btree, for table \"bucardo.bucardo_sequences\"\r\n\r\n                Table \"bucardo.bucardo_truncate_trigger\"\r\n   Column   |           Type           | Collation | Nullable | Default\r\n------------+--------------------------+-----------+----------+---------\r\n tablename  | oid                      |           | not null |\r\n sname      | text                     |           | not null |\r\n tname      | text                     |           | not null |\r\n sync       | text                     |           | not null |\r\n replicated | timestamp with time zone |           |          |\r\n cdate      | timestamp with time zone |           | not null | now()\r\nIndexes:\r\n    \"bucardo_truncate_trigger_index\" btree (sync, tablename) WHERE replicated IS NULL\r\n\r\nIndex \"bucardo.bucardo_truncate_trigger_index\"\r\n  Column   | Type | Key? | Definition\r\n-----------+------+------+------------\r\n sync      | text | yes  | sync\r\n tablename | oid  | yes  | tablename\r\nbtree, for table \"bucardo.bucardo_truncate_trigger\", predicate (replicated IS NULL)\r\n\r\n              Table \"bucardo.bucardo_truncate_trigger_log\"\r\n   Column   |           Type           | Collation | Nullable | Default\r\n------------+--------------------------+-----------+----------+---------\r\n tablename  | oid                      |           | not null |\r\n sname      | text                     |           | not null |\r\n tname      | text                     |           | not null |\r\n sync       | text                     |           | not null |\r\n target     | text                     |           | not null |\r\n replicated | timestamp with time zone |           | not null |\r\n cdate      | timestamp with time zone |           | not null | now()\r\n\r\n              Table \"bucardo.delta_public_display_logs\"\r\n Column  |           Type           | Collation | Nullable | Default\r\n---------+--------------------------+-----------+----------+---------\r\n id      | uuid                     |           |          |\r\n txntime | timestamp with time zone |           | not null | now()\r\nIndexes:\r\n    \"dex1_public_display_logs\" btree (txntime)\r\n    \"dex2_public_display_logs\" btree (id)\r\n\r\n                  Table \"bucardo.delta_public_logs\"\r\n Column  |           Type           | Collation | Nullable | Default\r\n---------+--------------------------+-----------+----------+---------\r\n id      | uuid                     |           |          |\r\n txntime | timestamp with time zone |           | not null | now()\r\nIndexes:\r\n    \"dex1_public_logs\" btree (txntime)\r\n    \"dex2_public_logs\" btree (id)\r\n\r\n        Index \"bucardo.dex1_public_display_logs\"\r\n Column  |           Type           | Key? | Definition\r\n---------+--------------------------+------+------------\r\n txntime | timestamp with time zone | yes  | txntime\r\nbtree, for table \"bucardo.delta_public_display_logs\"\r\n\r\n            Index \"bucardo.dex1_public_logs\"\r\n Column  |           Type           | Key? | Definition\r\n---------+--------------------------+------+------------\r\n txntime | timestamp with time zone | yes  | txntime\r\nbtree, for table \"bucardo.delta_public_logs\"\r\n\r\nIndex \"bucardo.dex2_public_display_logs\"\r\n Column | Type | Key? | Definition\r\n--------+------+------+------------\r\n id     | uuid | yes  | id\r\nbtree, for table \"bucardo.delta_public_display_logs\"\r\n\r\n Index \"bucardo.dex2_public_logs\"\r\n Column | Type | Key? | Definition\r\n--------+------+------+------------\r\n id     | uuid | yes  | id\r\nbtree, for table \"bucardo.delta_public_logs\"\r\n\r\n        Index \"bucardo.dex3_public_display_logs\"\r\n Column  |           Type           | Key? | Definition\r\n---------+--------------------------+------+------------\r\n target  | text                     | yes  | target\r\n txntime | timestamp with time zone | yes  | txntime\r\nbtree, for table \"bucardo.track_public_display_logs\"\r\n\r\n            Index \"bucardo.dex3_public_logs\"\r\n Column  |           Type           | Key? | Definition\r\n---------+--------------------------+------+------------\r\n target  | text                     | yes  | target\r\n txntime | timestamp with time zone | yes  | txntime\r\nbtree, for table \"bucardo.track_public_logs\"\r\n\r\n         Unlogged table \"bucardo.stage_public_display_logs\"\r\n Column  |           Type           | Collation | Nullable | Default\r\n---------+--------------------------+-----------+----------+---------\r\n txntime | timestamp with time zone |           |          |\r\n target  | text                     |           |          |\r\n\r\n             Unlogged table \"bucardo.stage_public_logs\"\r\n Column  |           Type           | Collation | Nullable | Default\r\n---------+--------------------------+-----------+----------+---------\r\n txntime | timestamp with time zone |           |          |\r\n target  | text                     |           |          |\r\n\r\n              Table \"bucardo.track_public_display_logs\"\r\n Column  |           Type           | Collation | Nullable | Default\r\n---------+--------------------------+-----------+----------+---------\r\n txntime | timestamp with time zone |           |          |\r\n target  | text                     |           |          |\r\nIndexes:\r\n    \"dex3_public_display_logs\" btree (target text_pattern_ops, txntime)\r\n\r\n                  Table \"bucardo.track_public_logs\"\r\n Column  |           Type           | Collation | Nullable | Default\r\n---------+--------------------------+-----------+----------+---------\r\n txntime | timestamp with time zone |           |          |\r\n target  | text                     |           |          |\r\nIndexes:\r\n    \"dex3_public_logs\" btree (target text_pattern_ops, txntime)\r\n```\r\n\r\n</details>\r\n\r\n## ではdumpはどうすれば良いか\r\n\r\n移行する必要のあるpublicスキーマのみを指定すると、bucardoスキーマやheroku_ext、datadogなどを除外できる。\r\n以下はstaging heroku dbに対して実行するdump\r\n\r\n```sh\r\npg_dump --format=custom \\\r\n    --verbose --data-only \\\r\n    --schema=public \\ #ここでpublicを指定する\r\n    --exclude-table=logs --exclude-table=display_logs \\\r\n    -h ec2-35-75-149-42.ap-northeast-1.compute.amazonaws.com -U u9sa4ppg0l8rjd -p 5432 -d d675i6ifmkurp3 \\\r\n    > main_data.dump\r\n```\r\n\r\n### staging heroku dbに対して上記実行結果\r\n<details>\r\n<summary>dumpそのものは成功</summary>\r\n\r\n```sh\r\n$ pg_dump --format=custom --verbose --data-only --schema=public --exclude-table=logs --exclude-table=display-logs -h ec2-35-75-149-42.ap-northeast-1.compute.amazonaws.com -U u9sa4ppg0l8rjd -p 5432 -d d675i6ifmkurp3 > main_data.dump\r\nPassword:\r\npg_dump: last built-in OID is 16383\r\npg_dump: reading extensions\r\npg_dump: identifying extension members\r\npg_dump: reading schemas\r\npg_dump: reading user-defined tables\r\npg_dump: reading user-defined functions\r\npg_dump: reading user-defined types\r\npg_dump: reading procedural languages\r\npg_dump: reading user-defined aggregate functions\r\npg_dump: reading user-defined operators\r\npg_dump: reading user-defined access methods\r\npg_dump: reading user-defined operator classes\r\npg_dump: reading user-defined operator families\r\npg_dump: reading user-defined text search parsers\r\npg_dump: reading user-defined text search templates\r\npg_dump: reading user-defined text search dictionaries\r\npg_dump: reading user-defined text search configurations\r\npg_dump: reading user-defined foreign-data wrappers\r\npg_dump: reading user-defined foreign servers\r\npg_dump: reading default privileges\r\npg_dump: reading user-defined collations\r\npg_dump: reading user-defined conversions\r\npg_dump: reading type casts\r\npg_dump: reading transforms\r\npg_dump: reading table inheritance information\r\npg_dump: reading event triggers\r\npg_dump: finding extension tables\r\npg_dump: finding inheritance relationships\r\npg_dump: reading column info for interesting tables\r\npg_dump: finding the columns and types of table \"public.active_storage_attachments\"\r\npg_dump: finding the columns and types of table \"public.active_storage_blobs\"\r\npg_dump: finding the columns and types of table \"public.active_storage_variant_records\"\r\npg_dump: finding the columns and types of table \"public.ar_internal_metadata\"\r\npg_dump: finding the columns and types of table \"public.autolock_schedules\"\r\npg_dump: finding the columns and types of table \"public.cards\"\r\npg_dump: finding the columns and types of table \"public.command_logs\"\r\npg_dump: finding the columns and types of table \"public.dailies\"\r\npg_dump: finding the columns and types of table \"public.display_logs\"\r\npg_dump: finding the columns and types of table \"public.door_mode_changed_histories\"\r\npg_dump: finding the columns and types of table \"public.durations\"\r\npg_dump: finding the columns and types of table \"public.entrance_block_fob_keys\"\r\npg_dump: finding the columns and types of table \"public.entrance_block_knight_cards\"\r\npg_dump: finding the columns and types of table \"public.entrance_fob_keys\"\r\npg_dump: finding the columns and types of table \"public.entrance_invitations\"\r\npg_dump: finding the columns and types of table \"public.entrance_knight_keys\"\r\npg_dump: finding the columns and types of table \"public.entrance_knight_pins\"\r\npg_dump: finding the columns and types of table \"public.entrance_lock_settings\"\r\npg_dump: finding the columns and types of table \"public.entrance_locks\"\r\npg_dump: finding the columns and types of table \"public.entrance_master_keys\"\r\npg_dump: finding the columns and types of table \"public.entrance_resident_guest_keys\"\r\npg_dump: finding the columns and types of table \"public.entrance_resident_keys\"\r\npg_dump: finding the columns and types of table \"public.family_keys\"\r\npg_dump: finding the columns and types of table \"public.fob_keys\"\r\npg_dump: finding the columns and types of table \"public.fobs\"\r\npg_dump: finding the columns and types of table \"public.guest_keys\"\r\npg_dump: finding the columns and types of table \"public.hubs\"\r\npg_dump: finding the columns and types of table \"public.invitations\"\r\npg_dump: finding the columns and types of table \"public.json_web_keys\"\r\npg_dump: finding the columns and types of table \"public.knight_cards\"\r\npg_dump: finding the columns and types of table \"public.knight_commands\"\r\npg_dump: finding the columns and types of table \"public.knight_keys\"\r\npg_dump: finding the columns and types of table \"public.knight_logs\"\r\npg_dump: finding the columns and types of table \"public.knight_pins\"\r\npg_dump: finding the columns and types of table \"public.knights\"\r\npg_dump: finding the columns and types of table \"public.lock_settings\"\r\npg_dump: finding the columns and types of table \"public.lock_webhook_tokens\"\r\npg_dump: finding the columns and types of table \"public.locks\"\r\npg_dump: finding the columns and types of table \"public.managers\"\r\npg_dump: finding the columns and types of table \"public.master_keys\"\r\npg_dump: finding the columns and types of table \"public.mst_display_logs\"\r\npg_dump: finding the columns and types of table \"public.relationships\"\r\npg_dump: finding the columns and types of table \"public.resident_guest_keys\"\r\npg_dump: finding the columns and types of table \"public.resident_keys\"\r\npg_dump: finding the columns and types of table \"public.schema_migrations\"\r\npg_dump: finding the columns and types of table \"public.term_of_validities\"\r\npg_dump: finding the columns and types of table \"public.users\"\r\npg_dump: finding the columns and types of table \"public.webhook_tokens\"\r\npg_dump: finding the columns and types of table \"public.webhooks\"\r\npg_dump: finding the columns and types of table \"public.weeklies\"\r\npg_dump: finding the columns and types of table \"public.wena_keys\"\r\npg_dump: finding the columns and types of table \"public.wenas\"\r\npg_dump: finding the columns and types of table \"public.laresia_pins\"\r\npg_dump: flagging inherited columns in subtables\r\npg_dump: reading indexes\r\npg_dump: reading indexes for table \"public.active_storage_attachments\"\r\npg_dump: reading indexes for table \"public.active_storage_blobs\"\r\npg_dump: reading indexes for table \"public.active_storage_variant_records\"\r\npg_dump: reading indexes for table \"public.ar_internal_metadata\"\r\npg_dump: reading indexes for table \"public.autolock_schedules\"\r\npg_dump: reading indexes for table \"public.cards\"\r\npg_dump: reading indexes for table \"public.command_logs\"\r\npg_dump: reading indexes for table \"public.dailies\"\r\npg_dump: reading indexes for table \"public.display_logs\"\r\npg_dump: reading indexes for table \"public.door_mode_changed_histories\"\r\npg_dump: reading indexes for table \"public.durations\"\r\npg_dump: reading indexes for table \"public.entrance_block_fob_keys\"\r\npg_dump: reading indexes for table \"public.entrance_block_knight_cards\"\r\npg_dump: reading indexes for table \"public.entrance_fob_keys\"\r\npg_dump: reading indexes for table \"public.entrance_invitations\"\r\npg_dump: reading indexes for table \"public.entrance_knight_keys\"\r\npg_dump: reading indexes for table \"public.entrance_knight_pins\"\r\npg_dump: reading indexes for table \"public.entrance_lock_settings\"\r\npg_dump: reading indexes for table \"public.entrance_locks\"\r\npg_dump: reading indexes for table \"public.entrance_master_keys\"\r\npg_dump: reading indexes for table \"public.entrance_resident_guest_keys\"\r\npg_dump: reading indexes for table \"public.entrance_resident_keys\"\r\npg_dump: reading indexes for table \"public.family_keys\"\r\npg_dump: reading indexes for table \"public.fob_keys\"\r\npg_dump: reading indexes for table \"public.fobs\"\r\npg_dump: reading indexes for table \"public.guest_keys\"\r\npg_dump: reading indexes for table \"public.hubs\"\r\npg_dump: reading indexes for table \"public.invitations\"\r\npg_dump: reading indexes for table \"public.json_web_keys\"\r\npg_dump: reading indexes for table \"public.knight_cards\"\r\npg_dump: reading indexes for table \"public.knight_commands\"\r\npg_dump: reading indexes for table \"public.knight_keys\"\r\npg_dump: reading indexes for table \"public.knight_logs\"\r\npg_dump: reading indexes for table \"public.knight_pins\"\r\npg_dump: reading indexes for table \"public.knights\"\r\npg_dump: reading indexes for table \"public.lock_settings\"\r\npg_dump: reading indexes for table \"public.lock_webhook_tokens\"\r\npg_dump: reading indexes for table \"public.locks\"\r\npg_dump: reading indexes for table \"public.managers\"\r\npg_dump: reading indexes for table \"public.master_keys\"\r\npg_dump: reading indexes for table \"public.mst_display_logs\"\r\npg_dump: reading indexes for table \"public.relationships\"\r\npg_dump: reading indexes for table \"public.resident_guest_keys\"\r\npg_dump: reading indexes for table \"public.resident_keys\"\r\npg_dump: reading indexes for table \"public.schema_migrations\"\r\npg_dump: reading indexes for table \"public.term_of_validities\"\r\npg_dump: reading indexes for table \"public.users\"\r\npg_dump: reading indexes for table \"public.webhook_tokens\"\r\npg_dump: reading indexes for table \"public.webhooks\"\r\npg_dump: reading indexes for table \"public.weeklies\"\r\npg_dump: reading indexes for table \"public.wena_keys\"\r\npg_dump: reading indexes for table \"public.wenas\"\r\npg_dump: reading indexes for table \"public.laresia_pins\"\r\npg_dump: flagging indexes in partitioned tables\r\npg_dump: reading extended statistics\r\npg_dump: reading constraints\r\npg_dump: reading foreign key constraints for table \"public.active_storage_attachments\"\r\npg_dump: reading foreign key constraints for table \"public.active_storage_blobs\"\r\npg_dump: reading foreign key constraints for table \"public.active_storage_variant_records\"\r\npg_dump: reading foreign key constraints for table \"public.ar_internal_metadata\"\r\npg_dump: reading foreign key constraints for table \"public.autolock_schedules\"\r\npg_dump: reading foreign key constraints for table \"public.cards\"\r\npg_dump: reading foreign key constraints for table \"public.command_logs\"\r\npg_dump: reading foreign key constraints for table \"public.dailies\"\r\npg_dump: reading foreign key constraints for table \"public.display_logs\"\r\npg_dump: reading foreign key constraints for table \"public.door_mode_changed_histories\"\r\npg_dump: reading foreign key constraints for table \"public.durations\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_block_fob_keys\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_block_knight_cards\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_fob_keys\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_invitations\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_knight_keys\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_knight_pins\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_lock_settings\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_locks\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_master_keys\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_resident_guest_keys\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_resident_keys\"\r\npg_dump: reading foreign key constraints for table \"public.family_keys\"\r\npg_dump: reading foreign key constraints for table \"public.fob_keys\"\r\npg_dump: reading foreign key constraints for table \"public.fobs\"\r\npg_dump: reading foreign key constraints for table \"public.guest_keys\"\r\npg_dump: reading foreign key constraints for table \"public.hubs\"\r\npg_dump: reading foreign key constraints for table \"public.invitations\"\r\npg_dump: reading foreign key constraints for table \"public.json_web_keys\"\r\npg_dump: reading foreign key constraints for table \"public.knight_cards\"\r\npg_dump: reading foreign key constraints for table \"public.knight_keys\"\r\npg_dump: reading foreign key constraints for table \"public.knight_logs\"\r\npg_dump: reading foreign key constraints for table \"public.knight_pins\"\r\npg_dump: reading foreign key constraints for table \"public.knights\"\r\npg_dump: reading foreign key constraints for table \"public.lock_settings\"\r\npg_dump: reading foreign key constraints for table \"public.lock_webhook_tokens\"\r\npg_dump: reading foreign key constraints for table \"public.locks\"\r\npg_dump: reading foreign key constraints for table \"public.managers\"\r\npg_dump: reading foreign key constraints for table \"public.master_keys\"\r\npg_dump: reading foreign key constraints for table \"public.mst_display_logs\"\r\npg_dump: reading foreign key constraints for table \"public.relationships\"\r\npg_dump: reading foreign key constraints for table \"public.resident_guest_keys\"\r\npg_dump: reading foreign key constraints for table \"public.resident_keys\"\r\npg_dump: reading foreign key constraints for table \"public.schema_migrations\"\r\npg_dump: reading foreign key constraints for table \"public.term_of_validities\"\r\npg_dump: reading foreign key constraints for table \"public.users\"\r\npg_dump: reading foreign key constraints for table \"public.webhook_tokens\"\r\npg_dump: reading foreign key constraints for table \"public.webhooks\"\r\npg_dump: reading foreign key constraints for table \"public.weeklies\"\r\npg_dump: reading foreign key constraints for table \"public.wena_keys\"\r\npg_dump: reading foreign key constraints for table \"public.wenas\"\r\npg_dump: reading foreign key constraints for table \"public.laresia_pins\"\r\npg_dump: reading triggers\r\npg_dump: reading triggers for table \"public.active_storage_attachments\"\r\npg_dump: reading triggers for table \"public.active_storage_blobs\"\r\npg_dump: reading triggers for table \"public.active_storage_variant_records\"\r\npg_dump: reading triggers for table \"public.ar_internal_metadata\"\r\npg_dump: reading triggers for table \"public.autolock_schedules\"\r\npg_dump: reading triggers for table \"public.cards\"\r\npg_dump: reading triggers for table \"public.command_logs\"\r\npg_dump: reading triggers for table \"public.dailies\"\r\npg_dump: reading triggers for table \"public.display_logs\"\r\npg_dump: reading triggers for table \"public.door_mode_changed_histories\"\r\npg_dump: reading triggers for table \"public.durations\"\r\npg_dump: reading triggers for table \"public.entrance_block_fob_keys\"\r\npg_dump: reading triggers for table \"public.entrance_block_knight_cards\"\r\npg_dump: reading triggers for table \"public.entrance_fob_keys\"\r\npg_dump: reading triggers for table \"public.entrance_invitations\"\r\npg_dump: reading triggers for table \"public.entrance_knight_keys\"\r\npg_dump: reading triggers for table \"public.entrance_knight_pins\"\r\npg_dump: reading triggers for table \"public.entrance_lock_settings\"\r\npg_dump: reading triggers for table \"public.entrance_locks\"\r\npg_dump: reading triggers for table \"public.entrance_master_keys\"\r\npg_dump: reading triggers for table \"public.entrance_resident_guest_keys\"\r\npg_dump: reading triggers for table \"public.entrance_resident_keys\"\r\npg_dump: reading triggers for table \"public.family_keys\"\r\npg_dump: reading triggers for table \"public.fob_keys\"\r\npg_dump: reading triggers for table \"public.fobs\"\r\npg_dump: reading triggers for table \"public.guest_keys\"\r\npg_dump: reading triggers for table \"public.hubs\"\r\npg_dump: reading triggers for table \"public.invitations\"\r\npg_dump: reading triggers for table \"public.json_web_keys\"\r\npg_dump: reading triggers for table \"public.knight_cards\"\r\npg_dump: reading triggers for table \"public.knight_keys\"\r\npg_dump: reading triggers for table \"public.knight_logs\"\r\npg_dump: reading triggers for table \"public.knight_pins\"\r\npg_dump: reading triggers for table \"public.knights\"\r\npg_dump: reading triggers for table \"public.lock_settings\"\r\npg_dump: reading triggers for table \"public.lock_webhook_tokens\"\r\npg_dump: reading triggers for table \"public.locks\"\r\npg_dump: reading triggers for table \"public.managers\"\r\npg_dump: reading triggers for table \"public.master_keys\"\r\npg_dump: reading triggers for table \"public.mst_display_logs\"\r\npg_dump: reading triggers for table \"public.relationships\"\r\npg_dump: reading triggers for table \"public.resident_guest_keys\"\r\npg_dump: reading triggers for table \"public.resident_keys\"\r\npg_dump: reading triggers for table \"public.schema_migrations\"\r\npg_dump: reading triggers for table \"public.term_of_validities\"\r\npg_dump: reading triggers for table \"public.users\"\r\npg_dump: reading triggers for table \"public.webhook_tokens\"\r\npg_dump: reading triggers for table \"public.webhooks\"\r\npg_dump: reading triggers for table \"public.weeklies\"\r\npg_dump: reading triggers for table \"public.wena_keys\"\r\npg_dump: reading triggers for table \"public.wenas\"\r\npg_dump: reading triggers for table \"public.laresia_pins\"\r\npg_dump: reading rewrite rules\r\npg_dump: reading policies\r\npg_dump: reading row-level security policies\r\npg_dump: reading publications\r\npg_dump: reading publication membership\r\npg_dump: reading subscriptions\r\npg_dump: reading dependency data\r\npg_dump: saving encoding = UTF8\r\npg_dump: saving standard_conforming_strings = on\r\npg_dump: saving search_path =\r\npg_dump: saving database definition\r\npg_dump: dumping contents of table \"public.active_storage_blobs\"\r\npg_dump: dumping contents of table \"public.active_storage_attachments\"\r\npg_dump: dumping contents of table \"public.active_storage_variant_records\"\r\npg_dump: dumping contents of table \"public.ar_internal_metadata\"\r\npg_dump: dumping contents of table \"public.locks\"\r\npg_dump: dumping contents of table \"public.users\"\r\npg_dump: dumping contents of table \"public.master_keys\"\r\npg_dump: dumping contents of table \"public.autolock_schedules\"\r\npg_dump: dumping contents of table \"public.cards\"\r\npg_dump: dumping contents of table \"public.hubs\"\r\npg_dump: dumping contents of table \"public.command_logs\"\r\npg_dump: dumping contents of table \"public.term_of_validities\"\r\npg_dump: dumping contents of table \"public.dailies\"\r\npg_dump: dumping contents of table \"public.mst_display_logs\"\r\npg_dump: dumping contents of table \"public.display_logs\"\r\npg_dump: dumping contents of table \"public.door_mode_changed_histories\"\r\npg_dump: dumping contents of table \"public.durations\"\r\npg_dump: dumping contents of table \"public.entrance_locks\"\r\npg_dump: dumping contents of table \"public.entrance_master_keys\"\r\npg_dump: dumping contents of table \"public.fobs\"\r\npg_dump: dumping contents of table \"public.fob_keys\"\r\npg_dump: dumping contents of table \"public.entrance_fob_keys\"\r\npg_dump: dumping contents of table \"public.entrance_block_fob_keys\"\r\npg_dump: dumping contents of table \"public.knights\"\r\npg_dump: dumping contents of table \"public.entrance_knight_keys\"\r\npg_dump: dumping contents of table \"public.knight_keys\"\r\npg_dump: dumping contents of table \"public.knight_cards\"\r\npg_dump: dumping contents of table \"public.entrance_block_knight_cards\"\r\npg_dump: dumping contents of table \"public.invitations\"\r\npg_dump: dumping contents of table \"public.entrance_invitations\"\r\npg_dump: dumping contents of table \"public.entrance_knight_pins\"\r\npg_dump: dumping contents of table \"public.entrance_lock_settings\"\r\npg_dump: dumping contents of table \"public.resident_guest_keys\"\r\npg_dump: dumping contents of table \"public.entrance_resident_guest_keys\"\r\npg_dump: dumping contents of table \"public.resident_keys\"\r\npg_dump: dumping contents of table \"public.entrance_resident_keys\"\r\npg_dump: dumping contents of table \"public.family_keys\"\r\npg_dump: dumping contents of table \"public.guest_keys\"\r\npg_dump: dumping contents of table \"public.json_web_keys\"\r\npg_dump: dumping contents of table \"public.knight_commands\"\r\npg_dump: dumping contents of table \"public.knight_logs\"\r\npg_dump: dumping contents of table \"public.knight_pins\"\r\npg_dump: dumping contents of table \"public.laresia_pins\"\r\npg_dump: dumping contents of table \"public.lock_settings\"\r\npg_dump: dumping contents of table \"public.webhook_tokens\"\r\npg_dump: dumping contents of table \"public.lock_webhook_tokens\"\r\npg_dump: dumping contents of table \"public.managers\"\r\npg_dump: dumping contents of table \"public.relationships\"\r\npg_dump: dumping contents of table \"public.schema_migrations\"\r\npg_dump: dumping contents of table \"public.webhooks\"\r\npg_dump: dumping contents of table \"public.weeklies\"\r\npg_dump: dumping contents of table \"public.wenas\"\r\npg_dump: dumping contents of table \"public.wena_keys\"\r\n```\r\n</details>\r\n    \r\n## --schemaオプションを有効にしてローカルでmain_dataのdumpとrestoreをやってみる\r\n\r\n### テーブルスキーマdump\r\n\r\n<details>\r\n<summary>成功</summary>\r\n\r\n```sh\r\nroot@c4e9fe68d14c:/# pg_dump --format=custom --verbose --schema-only -h source-db -d postgres -U postgres -p 5432 >heroku_tables.dump\r\nPassword:\r\npg_dump: last built-in OID is 16383\r\npg_dump: reading extensions\r\npg_dump: identifying extension members\r\npg_dump: reading schemas\r\npg_dump: reading user-defined tables\r\npg_dump: reading user-defined functions\r\npg_dump: reading user-defined types\r\npg_dump: reading procedural languages\r\npg_dump: reading user-defined aggregate functions\r\npg_dump: reading user-defined operators\r\npg_dump: reading user-defined access methods\r\npg_dump: reading user-defined operator classes\r\npg_dump: reading user-defined operator families\r\npg_dump: reading user-defined text search parsers\r\npg_dump: reading user-defined text search templates\r\npg_dump: reading user-defined text search dictionaries\r\npg_dump: reading user-defined text search configurations\r\npg_dump: reading user-defined foreign-data wrappers\r\npg_dump: reading user-defined foreign servers\r\npg_dump: reading default privileges\r\npg_dump: reading user-defined collations\r\npg_dump: reading user-defined conversions\r\npg_dump: reading type casts\r\npg_dump: reading transforms\r\npg_dump: reading table inheritance information\r\npg_dump: reading event triggers\r\npg_dump: finding extension tables\r\npg_dump: finding inheritance relationships\r\npg_dump: reading column info for interesting tables\r\npg_dump: finding the columns and types of table \"public.pg_stat_statements_info\"\r\npg_dump: finding the columns and types of table \"public.pg_stat_statements\"\r\npg_dump: finding the columns and types of table \"public.active_storage_attachments\"\r\npg_dump: finding default expressions of table \"public.active_storage_attachments\"\r\npg_dump: finding the columns and types of table \"public.active_storage_blobs\"\r\npg_dump: finding default expressions of table \"public.active_storage_blobs\"\r\npg_dump: finding the columns and types of table \"public.active_storage_variant_records\"\r\npg_dump: finding default expressions of table \"public.active_storage_variant_records\"\r\npg_dump: finding the columns and types of table \"public.ar_internal_metadata\"\r\npg_dump: finding the columns and types of table \"public.autolock_schedules\"\r\npg_dump: finding default expressions of table \"public.autolock_schedules\"\r\npg_dump: finding the columns and types of table \"public.cards\"\r\npg_dump: finding default expressions of table \"public.cards\"\r\npg_dump: finding the columns and types of table \"public.command_logs\"\r\npg_dump: finding default expressions of table \"public.command_logs\"\r\npg_dump: finding the columns and types of table \"public.dailies\"\r\npg_dump: finding default expressions of table \"public.dailies\"\r\npg_dump: finding the columns and types of table \"public.display_logs\"\r\npg_dump: finding default expressions of table \"public.display_logs\"\r\npg_dump: finding the columns and types of table \"public.door_mode_changed_histories\"\r\npg_dump: finding default expressions of table \"public.door_mode_changed_histories\"\r\npg_dump: finding the columns and types of table \"public.durations\"\r\npg_dump: finding default expressions of table \"public.durations\"\r\npg_dump: finding the columns and types of table \"public.entrance_block_fob_keys\"\r\npg_dump: finding default expressions of table \"public.entrance_block_fob_keys\"\r\npg_dump: finding the columns and types of table \"public.entrance_block_knight_cards\"\r\npg_dump: finding default expressions of table \"public.entrance_block_knight_cards\"\r\npg_dump: finding the columns and types of table \"public.entrance_fob_keys\"\r\npg_dump: finding default expressions of table \"public.entrance_fob_keys\"\r\npg_dump: finding the columns and types of table \"public.entrance_invitations\"\r\npg_dump: finding default expressions of table \"public.entrance_invitations\"\r\npg_dump: finding the columns and types of table \"public.entrance_knight_keys\"\r\npg_dump: finding default expressions of table \"public.entrance_knight_keys\"\r\npg_dump: finding the columns and types of table \"public.entrance_knight_pins\"\r\npg_dump: finding default expressions of table \"public.entrance_knight_pins\"\r\npg_dump: finding the columns and types of table \"public.entrance_lock_settings\"\r\npg_dump: finding default expressions of table \"public.entrance_lock_settings\"\r\npg_dump: finding the columns and types of table \"public.entrance_locks\"\r\npg_dump: finding default expressions of table \"public.entrance_locks\"\r\npg_dump: finding the columns and types of table \"public.entrance_master_keys\"\r\npg_dump: finding default expressions of table \"public.entrance_master_keys\"\r\npg_dump: finding the columns and types of table \"public.entrance_resident_guest_keys\"\r\npg_dump: finding default expressions of table \"public.entrance_resident_guest_keys\"\r\npg_dump: finding the columns and types of table \"public.entrance_resident_keys\"\r\npg_dump: finding default expressions of table \"public.entrance_resident_keys\"\r\npg_dump: finding the columns and types of table \"public.family_keys\"\r\npg_dump: finding default expressions of table \"public.family_keys\"\r\npg_dump: finding the columns and types of table \"public.fob_keys\"\r\npg_dump: finding default expressions of table \"public.fob_keys\"\r\npg_dump: finding the columns and types of table \"public.fobs\"\r\npg_dump: finding default expressions of table \"public.fobs\"\r\npg_dump: finding the columns and types of table \"public.guest_keys\"\r\npg_dump: finding default expressions of table \"public.guest_keys\"\r\npg_dump: finding the columns and types of table \"public.hubs\"\r\npg_dump: finding default expressions of table \"public.hubs\"\r\npg_dump: finding the columns and types of table \"public.invitations\"\r\npg_dump: finding default expressions of table \"public.invitations\"\r\npg_dump: finding the columns and types of table \"public.json_web_keys\"\r\npg_dump: finding default expressions of table \"public.json_web_keys\"\r\npg_dump: finding the columns and types of table \"public.knight_cards\"\r\npg_dump: finding default expressions of table \"public.knight_cards\"\r\npg_dump: finding the columns and types of table \"public.knight_commands\"\r\npg_dump: finding default expressions of table \"public.knight_commands\"\r\npg_dump: finding the columns and types of table \"public.knight_keys\"\r\npg_dump: finding default expressions of table \"public.knight_keys\"\r\npg_dump: finding the columns and types of table \"public.knight_logs\"\r\npg_dump: finding default expressions of table \"public.knight_logs\"\r\npg_dump: finding the columns and types of table \"public.knight_pins\"\r\npg_dump: finding default expressions of table \"public.knight_pins\"\r\npg_dump: finding the columns and types of table \"public.knights\"\r\npg_dump: finding default expressions of table \"public.knights\"\r\npg_dump: finding the columns and types of table \"public.laresia_pins\"\r\npg_dump: finding default expressions of table \"public.laresia_pins\"\r\npg_dump: finding the columns and types of table \"public.lock_settings\"\r\npg_dump: finding default expressions of table \"public.lock_settings\"\r\npg_dump: finding the columns and types of table \"public.lock_webhook_tokens\"\r\npg_dump: finding default expressions of table \"public.lock_webhook_tokens\"\r\npg_dump: finding the columns and types of table \"public.locks\"\r\npg_dump: finding default expressions of table \"public.locks\"\r\npg_dump: finding the columns and types of table \"public.logs\"\r\npg_dump: finding default expressions of table \"public.logs\"\r\npg_dump: finding the columns and types of table \"public.managers\"\r\npg_dump: finding default expressions of table \"public.managers\"\r\npg_dump: finding the columns and types of table \"public.master_keys\"\r\npg_dump: finding default expressions of table \"public.master_keys\"\r\npg_dump: finding the columns and types of table \"public.mst_display_logs\"\r\npg_dump: finding default expressions of table \"public.mst_display_logs\"\r\npg_dump: finding the columns and types of table \"public.relationships\"\r\npg_dump: finding default expressions of table \"public.relationships\"\r\npg_dump: finding the columns and types of table \"public.resident_guest_keys\"\r\npg_dump: finding default expressions of table \"public.resident_guest_keys\"\r\npg_dump: finding the columns and types of table \"public.resident_keys\"\r\npg_dump: finding default expressions of table \"public.resident_keys\"\r\npg_dump: finding the columns and types of table \"public.schema_migrations\"\r\npg_dump: finding the columns and types of table \"public.term_of_validities\"\r\npg_dump: finding default expressions of table \"public.term_of_validities\"\r\npg_dump: finding the columns and types of table \"public.users\"\r\npg_dump: finding default expressions of table \"public.users\"\r\npg_dump: finding the columns and types of table \"public.webhook_tokens\"\r\npg_dump: finding default expressions of table \"public.webhook_tokens\"\r\npg_dump: finding the columns and types of table \"public.webhooks\"\r\npg_dump: finding default expressions of table \"public.webhooks\"\r\npg_dump: finding the columns and types of table \"public.weeklies\"\r\npg_dump: finding default expressions of table \"public.weeklies\"\r\npg_dump: finding the columns and types of table \"public.wena_keys\"\r\npg_dump: finding default expressions of table \"public.wena_keys\"\r\npg_dump: finding the columns and types of table \"public.wenas\"\r\npg_dump: finding default expressions of table \"public.wenas\"\r\npg_dump: flagging inherited columns in subtables\r\npg_dump: reading indexes\r\npg_dump: reading indexes for table \"public.active_storage_attachments\"\r\npg_dump: reading indexes for table \"public.active_storage_blobs\"\r\npg_dump: reading indexes for table \"public.active_storage_variant_records\"\r\npg_dump: reading indexes for table \"public.ar_internal_metadata\"\r\npg_dump: reading indexes for table \"public.autolock_schedules\"\r\npg_dump: reading indexes for table \"public.cards\"\r\npg_dump: reading indexes for table \"public.command_logs\"\r\npg_dump: reading indexes for table \"public.dailies\"\r\npg_dump: reading indexes for table \"public.display_logs\"\r\npg_dump: reading indexes for table \"public.door_mode_changed_histories\"\r\npg_dump: reading indexes for table \"public.durations\"\r\npg_dump: reading indexes for table \"public.entrance_block_fob_keys\"\r\npg_dump: reading indexes for table \"public.entrance_block_knight_cards\"\r\npg_dump: reading indexes for table \"public.entrance_fob_keys\"\r\npg_dump: reading indexes for table \"public.entrance_invitations\"\r\npg_dump: reading indexes for table \"public.entrance_knight_keys\"\r\npg_dump: reading indexes for table \"public.entrance_knight_pins\"\r\npg_dump: reading indexes for table \"public.entrance_lock_settings\"\r\npg_dump: reading indexes for table \"public.entrance_locks\"\r\npg_dump: reading indexes for table \"public.entrance_master_keys\"\r\npg_dump: reading indexes for table \"public.entrance_resident_guest_keys\"\r\npg_dump: reading indexes for table \"public.entrance_resident_keys\"\r\npg_dump: reading indexes for table \"public.family_keys\"\r\npg_dump: reading indexes for table \"public.fob_keys\"\r\npg_dump: reading indexes for table \"public.fobs\"\r\npg_dump: reading indexes for table \"public.guest_keys\"\r\npg_dump: reading indexes for table \"public.hubs\"\r\npg_dump: reading indexes for table \"public.invitations\"\r\npg_dump: reading indexes for table \"public.json_web_keys\"\r\npg_dump: reading indexes for table \"public.knight_cards\"\r\npg_dump: reading indexes for table \"public.knight_commands\"\r\npg_dump: reading indexes for table \"public.knight_keys\"\r\npg_dump: reading indexes for table \"public.knight_logs\"\r\npg_dump: reading indexes for table \"public.knight_pins\"\r\npg_dump: reading indexes for table \"public.knights\"\r\npg_dump: reading indexes for table \"public.laresia_pins\"\r\npg_dump: reading indexes for table \"public.lock_settings\"\r\npg_dump: reading indexes for table \"public.lock_webhook_tokens\"\r\npg_dump: reading indexes for table \"public.locks\"\r\npg_dump: reading indexes for table \"public.logs\"\r\npg_dump: reading indexes for table \"public.managers\"\r\npg_dump: reading indexes for table \"public.master_keys\"\r\npg_dump: reading indexes for table \"public.mst_display_logs\"\r\npg_dump: reading indexes for table \"public.relationships\"\r\npg_dump: reading indexes for table \"public.resident_guest_keys\"\r\npg_dump: reading indexes for table \"public.resident_keys\"\r\npg_dump: reading indexes for table \"public.schema_migrations\"\r\npg_dump: reading indexes for table \"public.term_of_validities\"\r\npg_dump: reading indexes for table \"public.users\"\r\npg_dump: reading indexes for table \"public.webhook_tokens\"\r\npg_dump: reading indexes for table \"public.webhooks\"\r\npg_dump: reading indexes for table \"public.weeklies\"\r\npg_dump: reading indexes for table \"public.wena_keys\"\r\npg_dump: reading indexes for table \"public.wenas\"\r\npg_dump: flagging indexes in partitioned tables\r\npg_dump: reading extended statistics\r\npg_dump: reading constraints\r\npg_dump: reading foreign key constraints for table \"public.active_storage_attachments\"\r\npg_dump: reading foreign key constraints for table \"public.active_storage_blobs\"\r\npg_dump: reading foreign key constraints for table \"public.active_storage_variant_records\"\r\npg_dump: reading foreign key constraints for table \"public.autolock_schedules\"\r\npg_dump: reading foreign key constraints for table \"public.command_logs\"\r\npg_dump: reading foreign key constraints for table \"public.dailies\"\r\npg_dump: reading foreign key constraints for table \"public.display_logs\"\r\npg_dump: reading foreign key constraints for table \"public.door_mode_changed_histories\"\r\npg_dump: reading foreign key constraints for table \"public.durations\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_block_fob_keys\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_block_knight_cards\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_fob_keys\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_invitations\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_knight_keys\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_knight_pins\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_lock_settings\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_locks\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_master_keys\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_resident_guest_keys\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_resident_keys\"\r\npg_dump: reading foreign key constraints for table \"public.family_keys\"\r\npg_dump: reading foreign key constraints for table \"public.fob_keys\"\r\npg_dump: reading foreign key constraints for table \"public.fobs\"\r\npg_dump: reading foreign key constraints for table \"public.guest_keys\"\r\npg_dump: reading foreign key constraints for table \"public.hubs\"\r\npg_dump: reading foreign key constraints for table \"public.invitations\"\r\npg_dump: reading foreign key constraints for table \"public.knight_cards\"\r\npg_dump: reading foreign key constraints for table \"public.knight_keys\"\r\npg_dump: reading foreign key constraints for table \"public.knight_logs\"\r\npg_dump: reading foreign key constraints for table \"public.knight_pins\"\r\npg_dump: reading foreign key constraints for table \"public.knights\"\r\npg_dump: reading foreign key constraints for table \"public.laresia_pins\"\r\npg_dump: reading foreign key constraints for table \"public.lock_settings\"\r\npg_dump: reading foreign key constraints for table \"public.lock_webhook_tokens\"\r\npg_dump: reading foreign key constraints for table \"public.locks\"\r\npg_dump: reading foreign key constraints for table \"public.logs\"\r\npg_dump: reading foreign key constraints for table \"public.managers\"\r\npg_dump: reading foreign key constraints for table \"public.master_keys\"\r\npg_dump: reading foreign key constraints for table \"public.mst_display_logs\"\r\npg_dump: reading foreign key constraints for table \"public.relationships\"\r\npg_dump: reading foreign key constraints for table \"public.resident_guest_keys\"\r\npg_dump: reading foreign key constraints for table \"public.resident_keys\"\r\npg_dump: reading foreign key constraints for table \"public.term_of_validities\"\r\npg_dump: reading foreign key constraints for table \"public.users\"\r\npg_dump: reading foreign key constraints for table \"public.webhook_tokens\"\r\npg_dump: reading foreign key constraints for table \"public.webhooks\"\r\npg_dump: reading foreign key constraints for table \"public.weeklies\"\r\npg_dump: reading foreign key constraints for table \"public.wena_keys\"\r\npg_dump: reading foreign key constraints for table \"public.wenas\"\r\npg_dump: reading triggers\r\npg_dump: reading triggers for table \"public.active_storage_attachments\"\r\npg_dump: reading triggers for table \"public.active_storage_blobs\"\r\npg_dump: reading triggers for table \"public.active_storage_variant_records\"\r\npg_dump: reading triggers for table \"public.autolock_schedules\"\r\npg_dump: reading triggers for table \"public.command_logs\"\r\npg_dump: reading triggers for table \"public.dailies\"\r\npg_dump: reading triggers for table \"public.display_logs\"\r\npg_dump: reading triggers for table \"public.door_mode_changed_histories\"\r\npg_dump: reading triggers for table \"public.durations\"\r\npg_dump: reading triggers for table \"public.entrance_block_fob_keys\"\r\npg_dump: reading triggers for table \"public.entrance_block_knight_cards\"\r\npg_dump: reading triggers for table \"public.entrance_fob_keys\"\r\npg_dump: reading triggers for table \"public.entrance_invitations\"\r\npg_dump: reading triggers for table \"public.entrance_knight_keys\"\r\npg_dump: reading triggers for table \"public.entrance_knight_pins\"\r\npg_dump: reading triggers for table \"public.entrance_lock_settings\"\r\npg_dump: reading triggers for table \"public.entrance_locks\"\r\npg_dump: reading triggers for table \"public.entrance_master_keys\"\r\npg_dump: reading triggers for table \"public.entrance_resident_guest_keys\"\r\npg_dump: reading triggers for table \"public.entrance_resident_keys\"\r\npg_dump: reading triggers for table \"public.family_keys\"\r\npg_dump: reading triggers for table \"public.fob_keys\"\r\npg_dump: reading triggers for table \"public.fobs\"\r\npg_dump: reading triggers for table \"public.guest_keys\"\r\npg_dump: reading triggers for table \"public.hubs\"\r\npg_dump: reading triggers for table \"public.invitations\"\r\npg_dump: reading triggers for table \"public.knight_cards\"\r\npg_dump: reading triggers for table \"public.knight_keys\"\r\npg_dump: reading triggers for table \"public.knight_logs\"\r\npg_dump: reading triggers for table \"public.knight_pins\"\r\npg_dump: reading triggers for table \"public.knights\"\r\npg_dump: reading triggers for table \"public.laresia_pins\"\r\npg_dump: reading triggers for table \"public.lock_settings\"\r\npg_dump: reading triggers for table \"public.lock_webhook_tokens\"\r\npg_dump: reading triggers for table \"public.locks\"\r\npg_dump: reading triggers for table \"public.logs\"\r\npg_dump: reading triggers for table \"public.managers\"\r\npg_dump: reading triggers for table \"public.master_keys\"\r\npg_dump: reading triggers for table \"public.mst_display_logs\"\r\npg_dump: reading triggers for table \"public.relationships\"\r\npg_dump: reading triggers for table \"public.resident_guest_keys\"\r\npg_dump: reading triggers for table \"public.resident_keys\"\r\npg_dump: reading triggers for table \"public.term_of_validities\"\r\npg_dump: reading triggers for table \"public.users\"\r\npg_dump: reading triggers for table \"public.webhook_tokens\"\r\npg_dump: reading triggers for table \"public.webhooks\"\r\npg_dump: reading triggers for table \"public.weeklies\"\r\npg_dump: reading triggers for table \"public.wena_keys\"\r\npg_dump: reading triggers for table \"public.wenas\"\r\npg_dump: reading rewrite rules\r\npg_dump: reading policies\r\npg_dump: reading row-level security policies\r\npg_dump: reading publications\r\npg_dump: reading publication membership\r\npg_dump: reading subscriptions\r\npg_dump: reading dependency data\r\npg_dump: saving encoding = UTF8\r\npg_dump: saving standard_conforming_strings = on\r\npg_dump: saving search_path =\r\npg_dump: saving database definition\r\n```\r\n\r\n</details>\r\n\r\n### テーブルスキーマrestore\r\n\r\n<details>\r\n<summary>成功</summary>\r\n\r\n```sh\r\nroot@c4e9fe68d14c:/# pg_restore --verbose --schema-only -h target-db -U postgres -d postgres -p 5432 heroku_tables.dump\r\npg_restore: connecting to database for restore\r\nPassword:\r\npg_restore: creating EXTENSION \"pg_stat_statements\"\r\npg_restore: creating COMMENT \"EXTENSION pg_stat_statements\"\r\npg_restore: creating EXTENSION \"pgcrypto\"\r\npg_restore: creating COMMENT \"EXTENSION pgcrypto\"\r\npg_restore: creating TYPE \"public.command_log_remote_source_type\"\r\npg_restore: creating TYPE \"public.display_log_lock_position\"\r\npg_restore: creating TYPE \"public.display_log_open_close_type\"\r\npg_restore: creating TYPE \"public.door_mode_changed_history_door_mode\"\r\npg_restore: creating TYPE \"public.knight_command_remote_source_type\"\r\npg_restore: creating TYPE \"public.mst_display_log_open_close_type\"\r\npg_restore: creating TYPE \"public.mst_display_log_operation_type\"\r\npg_restore: creating TABLE \"public.active_storage_attachments\"\r\npg_restore: creating SEQUENCE \"public.active_storage_attachments_id_seq\"\r\npg_restore: creating SEQUENCE OWNED BY \"public.active_storage_attachments_id_seq\"\r\npg_restore: creating TABLE \"public.active_storage_blobs\"\r\npg_restore: creating SEQUENCE \"public.active_storage_blobs_id_seq\"\r\npg_restore: creating SEQUENCE OWNED BY \"public.active_storage_blobs_id_seq\"\r\npg_restore: creating TABLE \"public.active_storage_variant_records\"\r\npg_restore: creating SEQUENCE \"public.active_storage_variant_records_id_seq\"\r\npg_restore: creating SEQUENCE OWNED BY \"public.active_storage_variant_records_id_seq\"\r\npg_restore: creating TABLE \"public.ar_internal_metadata\"\r\npg_restore: creating TABLE \"public.autolock_schedules\"\r\npg_restore: creating TABLE \"public.cards\"\r\npg_restore: creating TABLE \"public.command_logs\"\r\npg_restore: creating COMMENT \"public.COLUMN command_logs.notification_id\"\r\npg_restore: creating COMMENT \"public.COLUMN command_logs.remote_source_type\"\r\npg_restore: creating TABLE \"public.dailies\"\r\npg_restore: creating TABLE \"public.display_logs\"\r\npg_restore: creating COMMENT \"public.COLUMN display_logs.open_close_type\"\r\npg_restore: creating COMMENT \"public.COLUMN display_logs.lock_position\"\r\npg_restore: creating TABLE \"public.door_mode_changed_histories\"\r\npg_restore: creating COMMENT \"public.COLUMN door_mode_changed_histories.door_mode\"\r\npg_restore: creating TABLE \"public.durations\"\r\npg_restore: creating TABLE \"public.entrance_block_fob_keys\"\r\npg_restore: creating COMMENT \"public.COLUMN entrance_block_fob_keys.fob_type\"\r\npg_restore: creating TABLE \"public.entrance_block_knight_cards\"\r\npg_restore: creating TABLE \"public.entrance_fob_keys\"\r\npg_restore: creating TABLE \"public.entrance_invitations\"\r\npg_restore: creating TABLE \"public.entrance_knight_keys\"\r\npg_restore: creating TABLE \"public.entrance_knight_pins\"\r\npg_restore: creating TABLE \"public.entrance_lock_settings\"\r\npg_restore: creating TABLE \"public.entrance_locks\"\r\npg_restore: creating TABLE \"public.entrance_master_keys\"\r\npg_restore: creating TABLE \"public.entrance_resident_guest_keys\"\r\npg_restore: creating TABLE \"public.entrance_resident_keys\"\r\npg_restore: creating TABLE \"public.family_keys\"\r\npg_restore: creating TABLE \"public.fob_keys\"\r\npg_restore: creating TABLE \"public.fobs\"\r\npg_restore: creating TABLE \"public.guest_keys\"\r\npg_restore: creating TABLE \"public.hubs\"\r\npg_restore: creating COMMENT \"public.COLUMN hubs.is_roomon_manager_hub\"\r\npg_restore: creating TABLE \"public.invitations\"\r\npg_restore: creating TABLE \"public.json_web_keys\"\r\npg_restore: creating SEQUENCE \"public.json_web_keys_id_seq\"\r\npg_restore: creating SEQUENCE OWNED BY \"public.json_web_keys_id_seq\"\r\npg_restore: creating TABLE \"public.knight_cards\"\r\npg_restore: creating TABLE \"public.knight_commands\"\r\npg_restore: creating COMMENT \"public.COLUMN knight_commands.notification_id\"\r\npg_restore: creating COMMENT \"public.COLUMN knight_commands.remote_source_type\"\r\npg_restore: creating TABLE \"public.knight_keys\"\r\npg_restore: creating TABLE \"public.knight_logs\"\r\npg_restore: creating TABLE \"public.knight_pins\"\r\npg_restore: creating TABLE \"public.knights\"\r\npg_restore: creating COMMENT \"public.COLUMN knights.model_id\"\r\npg_restore: creating COMMENT \"public.COLUMN knights.mode\"\r\npg_restore: creating COMMENT \"public.COLUMN knights.relay_on_seconds\"\r\npg_restore: creating COMMENT \"public.COLUMN knights.remote_setting_mode_adv_interval\"\r\npg_restore: creating TABLE \"public.laresia_pins\"\r\npg_restore: creating TABLE \"public.lock_settings\"\r\npg_restore: creating TABLE \"public.lock_webhook_tokens\"\r\npg_restore: creating TABLE \"public.locks\"\r\npg_restore: creating COMMENT \"public.COLUMN locks.model_id\"\r\npg_restore: creating TABLE \"public.logs\"\r\npg_restore: creating TABLE \"public.managers\"\r\npg_restore: creating TABLE \"public.master_keys\"\r\npg_restore: creating TABLE \"public.mst_display_logs\"\r\npg_restore: creating COMMENT \"public.COLUMN mst_display_logs.open_close_type\"\r\npg_restore: creating COMMENT \"public.COLUMN mst_display_logs.operation_type\"\r\npg_restore: creating TABLE \"public.relationships\"\r\npg_restore: creating TABLE \"public.resident_guest_keys\"\r\npg_restore: creating TABLE \"public.resident_keys\"\r\npg_restore: creating TABLE \"public.schema_migrations\"\r\npg_restore: creating TABLE \"public.term_of_validities\"\r\npg_restore: creating TABLE \"public.users\"\r\npg_restore: creating TABLE \"public.webhook_tokens\"\r\npg_restore: creating TABLE \"public.webhooks\"\r\npg_restore: creating TABLE \"public.weeklies\"\r\npg_restore: creating TABLE \"public.wena_keys\"\r\npg_restore: creating TABLE \"public.wenas\"\r\npg_restore: creating COMMENT \"public.COLUMN wenas.wena_type\"\r\npg_restore: creating DEFAULT \"public.active_storage_attachments id\"\r\npg_restore: creating DEFAULT \"public.active_storage_blobs id\"\r\npg_restore: creating DEFAULT \"public.active_storage_variant_records id\"\r\npg_restore: creating DEFAULT \"public.json_web_keys id\"\r\npg_restore: creating CONSTRAINT \"public.active_storage_attachments active_storage_attachments_pkey\"\r\npg_restore: creating CONSTRAINT \"public.active_storage_blobs active_storage_blobs_pkey\"\r\npg_restore: creating CONSTRAINT \"public.active_storage_variant_records active_storage_variant_records_pkey\"\r\npg_restore: creating CONSTRAINT \"public.ar_internal_metadata ar_internal_metadata_pkey\"\r\npg_restore: creating CONSTRAINT \"public.autolock_schedules autolock_schedules_pkey\"\r\npg_restore: creating CONSTRAINT \"public.cards cards_pkey\"\r\npg_restore: creating CONSTRAINT \"public.command_logs command_logs_pkey\"\r\npg_restore: creating CONSTRAINT \"public.dailies dailies_pkey\"\r\npg_restore: creating CONSTRAINT \"public.display_logs display_logs_pkey\"\r\npg_restore: creating CONSTRAINT \"public.door_mode_changed_histories door_mode_changed_histories_pkey\"\r\npg_restore: creating CONSTRAINT \"public.durations durations_pkey\"\r\npg_restore: creating CONSTRAINT \"public.entrance_block_fob_keys entrance_block_fob_keys_pkey\"\r\npg_restore: creating CONSTRAINT \"public.entrance_block_knight_cards entrance_block_knight_cards_pkey\"\r\npg_restore: creating CONSTRAINT \"public.entrance_fob_keys entrance_fob_keys_pkey\"\r\npg_restore: creating CONSTRAINT \"public.entrance_invitations entrance_invitations_pkey\"\r\npg_restore: creating CONSTRAINT \"public.entrance_knight_keys entrance_knight_keys_pkey\"\r\npg_restore: creating CONSTRAINT \"public.entrance_knight_pins entrance_knight_pins_pkey\"\r\npg_restore: creating CONSTRAINT \"public.entrance_lock_settings entrance_lock_settings_pkey\"\r\npg_restore: creating CONSTRAINT \"public.entrance_locks entrance_locks_pkey\"\r\npg_restore: creating CONSTRAINT \"public.entrance_master_keys entrance_master_keys_pkey\"\r\npg_restore: creating CONSTRAINT \"public.entrance_resident_guest_keys entrance_resident_guest_keys_pkey\"\r\npg_restore: creating CONSTRAINT \"public.entrance_resident_keys entrance_resident_keys_pkey\"\r\npg_restore: creating CONSTRAINT \"public.family_keys family_keys_pkey\"\r\npg_restore: creating CONSTRAINT \"public.fob_keys fob_keys_pkey\"\r\npg_restore: creating CONSTRAINT \"public.fobs fobs_pkey\"\r\npg_restore: creating CONSTRAINT \"public.guest_keys guest_keys_pkey\"\r\npg_restore: creating CONSTRAINT \"public.hubs hubs_pkey\"\r\npg_restore: creating CONSTRAINT \"public.invitations invitations_pkey\"\r\npg_restore: creating CONSTRAINT \"public.json_web_keys json_web_keys_pkey\"\r\npg_restore: creating CONSTRAINT \"public.knight_cards knight_cards_pkey\"\r\npg_restore: creating CONSTRAINT \"public.knight_commands knight_commands_pkey\"\r\npg_restore: creating CONSTRAINT \"public.knight_keys knight_keys_pkey\"\r\npg_restore: creating CONSTRAINT \"public.knight_logs knight_logs_pkey\"\r\npg_restore: creating CONSTRAINT \"public.knight_pins knight_pins_pkey\"\r\npg_restore: creating CONSTRAINT \"public.knights knights_pkey\"\r\npg_restore: creating CONSTRAINT \"public.laresia_pins laresia_pins_pkey\"\r\npg_restore: creating CONSTRAINT \"public.lock_settings lock_settings_pkey\"\r\npg_restore: creating CONSTRAINT \"public.lock_webhook_tokens lock_webhook_tokens_pkey\"\r\npg_restore: creating CONSTRAINT \"public.locks locks_pkey\"\r\npg_restore: creating CONSTRAINT \"public.logs logs_pkey\"\r\npg_restore: creating CONSTRAINT \"public.managers managers_pkey\"\r\npg_restore: creating CONSTRAINT \"public.master_keys master_keys_pkey\"\r\npg_restore: creating CONSTRAINT \"public.mst_display_logs mst_display_logs_pkey\"\r\npg_restore: creating CONSTRAINT \"public.relationships relationships_pkey\"\r\npg_restore: creating CONSTRAINT \"public.resident_guest_keys resident_guest_keys_pkey\"\r\npg_restore: creating CONSTRAINT \"public.resident_keys resident_keys_pkey\"\r\npg_restore: creating CONSTRAINT \"public.schema_migrations schema_migrations_pkey\"\r\npg_restore: creating CONSTRAINT \"public.term_of_validities term_of_validities_pkey\"\r\npg_restore: creating CONSTRAINT \"public.users users_pkey\"\r\npg_restore: creating CONSTRAINT \"public.webhook_tokens webhook_tokens_pkey\"\r\npg_restore: creating CONSTRAINT \"public.webhooks webhooks_pkey\"\r\npg_restore: creating CONSTRAINT \"public.weeklies weeklies_pkey\"\r\npg_restore: creating CONSTRAINT \"public.wena_keys wena_keys_pkey\"\r\npg_restore: creating CONSTRAINT \"public.wenas wenas_pkey\"\r\npg_restore: creating INDEX \"public.index_active_storage_attachments_on_blob_id\"\r\npg_restore: creating INDEX \"public.index_active_storage_attachments_uniqueness\"\r\npg_restore: creating INDEX \"public.index_active_storage_blobs_on_key\"\r\npg_restore: creating INDEX \"public.index_active_storage_variant_records_uniqueness\"\r\npg_restore: creating INDEX \"public.index_autolock_schedules_on_disable_hour\"\r\npg_restore: creating INDEX \"public.index_autolock_schedules_on_enable_hour\"\r\npg_restore: creating INDEX \"public.index_autolock_schedules_on_master_key_id\"\r\npg_restore: creating INDEX \"public.index_cards_on_serial_no\"\r\npg_restore: creating INDEX \"public.index_command_logs_on_hub_id\"\r\npg_restore: creating INDEX \"public.index_command_logs_on_lock_id\"\r\npg_restore: creating INDEX \"public.index_dailies_on_term_of_validity_id\"\r\npg_restore: creating INDEX \"public.index_display_logs_on_logged_at\"\r\npg_restore: creating INDEX \"public.index_display_logs_on_master_key_id\"\r\npg_restore: creating INDEX \"public.index_display_logs_on_mst_display_log_id\"\r\npg_restore: creating INDEX \"public.index_door_mode_changed_histories_on_master_key_id\"\r\npg_restore: creating INDEX \"public.index_durations_on_term_of_validity_id\"\r\npg_restore: creating INDEX \"public.index_entrance_block_fob_keys_on_entrance_fob_key_id\"\r\npg_restore: creating INDEX \"public.index_entrance_block_fob_keys_on_entrance_master_key_id\"\r\npg_restore: creating INDEX \"public.index_entrance_block_fob_keys_on_fob_id\"\r\npg_restore: creating INDEX \"public.index_entrance_block_knight_cards_on_entrance_knight_key_id\"\r\npg_restore: creating INDEX \"public.index_entrance_block_knight_cards_on_knight_card_id\"\r\npg_restore: creating INDEX \"public.index_entrance_fob_keys_on_entrance_master_key_id\"\r\npg_restore: creating INDEX \"public.index_entrance_fob_keys_on_fob_key_id\"\r\npg_restore: creating INDEX \"public.index_entrance_invitations_on_entrance_master_key_id\"\r\npg_restore: creating INDEX \"public.index_entrance_invitations_on_invitation_id\"\r\npg_restore: creating INDEX \"public.index_entrance_knight_keys_on_entrance_master_key_id\"\r\npg_restore: creating INDEX \"public.index_entrance_knight_keys_on_knight_id\"\r\npg_restore: creating INDEX \"public.index_entrance_knight_pins_on_entrance_knight_key_id\"\r\npg_restore: creating INDEX \"public.index_entrance_knight_pins_on_entrance_knight_key_id_and_pin\"\r\npg_restore: creating INDEX \"public.index_entrance_lock_settings_on_entrance_master_key_id\"\r\npg_restore: creating INDEX \"public.index_entrance_lock_settings_on_hub_id\"\r\npg_restore: creating INDEX \"public.index_entrance_locks_on_serial_no\"\r\npg_restore: creating INDEX \"public.index_entrance_master_keys_on_entrance_lock_id\"\r\npg_restore: creating INDEX \"public.index_entrance_master_keys_on_user_id\"\r\npg_restore: creating INDEX \"public.index_entrance_resident_guest_keys_on_entrance_master_key_id\"\r\npg_restore: creating INDEX \"public.index_entrance_resident_guest_keys_on_resident_guest_key_id\"\r\npg_restore: creating INDEX \"public.index_entrance_resident_keys_on_entrance_master_key_id\"\r\npg_restore: creating INDEX \"public.index_entrance_resident_keys_on_resident_key_id\"\r\npg_restore: creating INDEX \"public.index_family_keys_on_master_key_id\"\r\npg_restore: creating INDEX \"public.index_family_keys_on_master_key_id_and_user_id\"\r\npg_restore: creating INDEX \"public.index_family_keys_on_user_id\"\r\npg_restore: creating INDEX \"public.index_fob_keys_on_fob_id\"\r\npg_restore: creating INDEX \"public.index_fob_keys_on_master_key_id\"\r\npg_restore: creating INDEX \"public.index_fobs_on_serial_no_and_fob_type\"\r\npg_restore: creating INDEX \"public.index_guest_keys_on_master_key_id\"\r\npg_restore: creating INDEX \"public.index_guest_keys_on_term_of_validity_id\"\r\npg_restore: creating INDEX \"public.index_guest_keys_on_user_id\"\r\npg_restore: creating INDEX \"public.index_hubs_on_serial_no\"\r\npg_restore: creating INDEX \"public.index_invitations_on_master_key_id\"\r\npg_restore: creating INDEX \"public.index_invitations_on_term_of_validity_id\"\r\npg_restore: creating INDEX \"public.index_invitations_on_user_id\"\r\npg_restore: creating INDEX \"public.index_json_web_keys_on_kid\"\r\npg_restore: creating INDEX \"public.index_knight_cards_on_display_serial_no\"\r\npg_restore: creating INDEX \"public.index_knight_cards_on_knight_key_id\"\r\npg_restore: creating INDEX \"public.index_knight_cards_on_knight_key_id_and_idm\"\r\npg_restore: creating INDEX \"public.index_knight_commands_on_hub_id\"\r\npg_restore: creating INDEX \"public.index_knight_commands_on_knight_id\"\r\npg_restore: creating INDEX \"public.index_knight_keys_on_knight_id\"\r\npg_restore: creating INDEX \"public.index_knight_keys_on_master_key_id\"\r\npg_restore: creating INDEX \"public.index_knight_logs_on_knight_id\"\r\npg_restore: creating INDEX \"public.index_knight_logs_on_knight_id_and_knight_log_id\"\r\npg_restore: creating INDEX \"public.index_knight_pins_on_knight_key_id\"\r\npg_restore: creating INDEX \"public.index_knight_pins_on_knight_key_id_and_pin\"\r\npg_restore: creating INDEX \"public.index_knights_on_serial_no_and_model_id\"\r\npg_restore: creating INDEX \"public.index_laresia_pins_on_master_key_id\"\r\npg_restore: creating INDEX \"public.index_lock_settings_on_hub_id\"\r\npg_restore: creating INDEX \"public.index_lock_settings_on_main_knight_id\"\r\npg_restore: creating INDEX \"public.index_lock_settings_on_master_key_id\"\r\npg_restore: creating INDEX \"public.index_lock_settings_on_sub_knight_id\"\r\npg_restore: creating INDEX \"public.index_lock_settings_on_sub_lock_id\"\r\npg_restore: creating INDEX \"public.index_lock_webhook_tokens_on_lock_id\"\r\npg_restore: creating INDEX \"public.index_lock_webhook_tokens_on_lock_id_and_webhook_token_id\"\r\npg_restore: creating INDEX \"public.index_lock_webhook_tokens_on_webhook_token_id\"\r\npg_restore: creating INDEX \"public.index_locks_on_serial_no_and_model_id\"\r\npg_restore: creating INDEX \"public.index_logs_on_lock_id\"\r\npg_restore: creating INDEX \"public.index_logs_on_lock_id_and_lock_log_id\"\r\npg_restore: creating INDEX \"public.index_logs_on_lock_id_and_logged_at\"\r\npg_restore: creating INDEX \"public.index_logs_on_recordable_type_and_recordable_id\"\r\npg_restore: creating INDEX \"public.index_managers_on_user_id\"\r\npg_restore: creating INDEX \"public.index_master_keys_on_lock_id\"\r\npg_restore: creating INDEX \"public.index_master_keys_on_user_id\"\r\npg_restore: creating INDEX \"public.index_relationships_on_follow_id\"\r\npg_restore: creating INDEX \"public.index_relationships_on_user_id\"\r\npg_restore: creating INDEX \"public.index_relationships_on_user_id_and_follow_id\"\r\npg_restore: creating INDEX \"public.index_resident_guest_keys_on_master_key_id\"\r\npg_restore: creating INDEX \"public.index_resident_guest_keys_on_term_of_validity_id\"\r\npg_restore: creating INDEX \"public.index_resident_guest_keys_on_user_id\"\r\npg_restore: creating INDEX \"public.index_resident_keys_on_master_key_id\"\r\npg_restore: creating INDEX \"public.index_resident_keys_on_user_id\"\r\npg_restore: creating INDEX \"public.index_term_of_validities_on_master_key_id\"\r\npg_restore: creating INDEX \"public.index_users_on_auth0_id\"\r\npg_restore: creating INDEX \"public.index_webhook_tokens_on_user_id\"\r\npg_restore: creating INDEX \"public.index_webhook_tokens_on_user_id_and_platform\"\r\npg_restore: creating INDEX \"public.index_webhooks_on_master_key_id\"\r\npg_restore: creating INDEX \"public.index_webhooks_on_master_key_id_and_payload_url\"\r\npg_restore: creating INDEX \"public.index_weeklies_on_term_of_validity_id\"\r\npg_restore: creating INDEX \"public.index_wena_keys_on_master_key_id\"\r\npg_restore: creating INDEX \"public.index_wena_keys_on_wena_id\"\r\npg_restore: creating INDEX \"public.index_wenas_on_serial_no\"\r\npg_restore: creating INDEX \"public.unique_idx_e_b_k_c_on_entrance_knight_key_id_and_encrypted_idm\"\r\npg_restore: creating FK CONSTRAINT \"public.command_logs fk_rails_014f6a2546\"\r\npg_restore: creating FK CONSTRAINT \"public.laresia_pins fk_rails_0169d87320\"\r\npg_restore: creating FK CONSTRAINT \"public.knight_keys fk_rails_021cf26662\"\r\npg_restore: creating FK CONSTRAINT \"public.knight_cards fk_rails_0456909398\"\r\npg_restore: creating FK CONSTRAINT \"public.master_keys fk_rails_0704a51e19\"\r\npg_restore: creating FK CONSTRAINT \"public.durations fk_rails_09e2ff6011\"\r\npg_restore: creating FK CONSTRAINT \"public.entrance_resident_guest_keys fk_rails_0e04b9b004\"\r\npg_restore: creating FK CONSTRAINT \"public.webhook_tokens fk_rails_0e442b724e\"\r\npg_restore: creating FK CONSTRAINT \"public.fob_keys fk_rails_10751d7ff3\"\r\npg_restore: creating FK CONSTRAINT \"public.managers fk_rails_1306270b4d\"\r\npg_restore: creating FK CONSTRAINT \"public.lock_settings fk_rails_14b5845605\"\r\npg_restore: creating FK CONSTRAINT \"public.entrance_invitations fk_rails_1cd45ae85f\"\r\npg_restore: creating FK CONSTRAINT \"public.resident_guest_keys fk_rails_264f594299\"\r\npg_restore: creating FK CONSTRAINT \"public.master_keys fk_rails_2ce43857fe\"\r\npg_restore: creating FK CONSTRAINT \"public.invitations fk_rails_392831049d\"\r\npg_restore: creating FK CONSTRAINT \"public.entrance_fob_keys fk_rails_3baf99c215\"\r\npg_restore: creating FK CONSTRAINT \"public.guest_keys fk_rails_423d4bed43\"\r\npg_restore: creating FK CONSTRAINT \"public.command_logs fk_rails_479d47afa1\"\r\npg_restore: creating FK CONSTRAINT \"public.door_mode_changed_histories fk_rails_49b0247336\"\r\npg_restore: creating FK CONSTRAINT \"public.webhooks fk_rails_4ed36f717c\"\r\npg_restore: creating FK CONSTRAINT \"public.guest_keys fk_rails_511d97b2e6\"\r\npg_restore: creating FK CONSTRAINT \"public.entrance_lock_settings fk_rails_51210f8c81\"\r\npg_restore: creating FK CONSTRAINT \"public.family_keys fk_rails_51c51759a6\"\r\npg_restore: creating FK CONSTRAINT \"public.display_logs fk_rails_59cca4309c\"\r\npg_restore: creating FK CONSTRAINT \"public.family_keys fk_rails_60c83f8be9\"\r\npg_restore: creating FK CONSTRAINT \"public.guest_keys fk_rails_6c5179c7f7\"\r\npg_restore: creating FK CONSTRAINT \"public.display_logs fk_rails_6d35c11a37\"\r\npg_restore: creating FK CONSTRAINT \"public.entrance_block_fob_keys fk_rails_73c502cbb2\"\r\npg_restore: creating FK CONSTRAINT \"public.resident_guest_keys fk_rails_79146fb483\"\r\npg_restore: creating FK CONSTRAINT \"public.entrance_resident_keys fk_rails_7e4b69180e\"\r\npg_restore: creating FK CONSTRAINT \"public.invitations fk_rails_7eae413fe6\"\r\npg_restore: creating FK CONSTRAINT \"public.dailies fk_rails_82a55d246d\"\r\npg_restore: creating FK CONSTRAINT \"public.knight_keys fk_rails_85a7a025e9\"\r\npg_restore: creating FK CONSTRAINT \"public.lock_settings fk_rails_8bb146ac2a\"\r\npg_restore: creating FK CONSTRAINT \"public.lock_webhook_tokens fk_rails_8fba90749d\"\r\npg_restore: creating FK CONSTRAINT \"public.entrance_block_fob_keys fk_rails_919d63f111\"\r\npg_restore: creating FK CONSTRAINT \"public.lock_webhook_tokens fk_rails_95203493c9\"\r\npg_restore: creating FK CONSTRAINT \"public.resident_guest_keys fk_rails_9539b5c88f\"\r\npg_restore: creating FK CONSTRAINT \"public.active_storage_variant_records fk_rails_993965df05\"\r\npg_restore: creating FK CONSTRAINT \"public.entrance_invitations fk_rails_9992af7a62\"\r\npg_restore: creating FK CONSTRAINT \"public.wena_keys fk_rails_99ec462bd1\"\r\npg_restore: creating FK CONSTRAINT \"public.fob_keys fk_rails_9b950aa82f\"\r\npg_restore: creating FK CONSTRAINT \"public.entrance_lock_settings fk_rails_9befedd7c2\"\r\npg_restore: creating FK CONSTRAINT \"public.autolock_schedules fk_rails_a0e63f0c58\"\r\npg_restore: creating FK CONSTRAINT \"public.relationships fk_rails_a3d77c3b00\"\r\npg_restore: creating FK CONSTRAINT \"public.entrance_block_fob_keys fk_rails_a403765376\"\r\npg_restore: creating FK CONSTRAINT \"public.entrance_resident_keys fk_rails_a5035d381f\"\r\npg_restore: creating FK CONSTRAINT \"public.entrance_knight_keys fk_rails_a635401c41\"\r\npg_restore: creating FK CONSTRAINT \"public.knight_pins fk_rails_a64ee923a2\"\r\npg_restore: creating FK CONSTRAINT \"public.entrance_fob_keys fk_rails_af780e48bc\"\r\npg_restore: creating FK CONSTRAINT \"public.resident_keys fk_rails_b0fd978d66\"\r\npg_restore: creating FK CONSTRAINT \"public.entrance_resident_guest_keys fk_rails_b6ec476525\"\r\npg_restore: creating FK CONSTRAINT \"public.entrance_knight_pins fk_rails_b7c2bfe16b\"\r\npg_restore: creating FK CONSTRAINT \"public.entrance_master_keys fk_rails_b86cbd1481\"\r\npg_restore: creating FK CONSTRAINT \"public.relationships fk_rails_be1f05b3d7\"\r\npg_restore: creating FK CONSTRAINT \"public.lock_settings fk_rails_c004fa487a\"\r\npg_restore: creating FK CONSTRAINT \"public.term_of_validities fk_rails_c0c932f574\"\r\npg_restore: creating FK CONSTRAINT \"public.active_storage_attachments fk_rails_c3b3935057\"\r\npg_restore: creating FK CONSTRAINT \"public.entrance_master_keys fk_rails_cf36d974ef\"\r\npg_restore: creating FK CONSTRAINT \"public.wena_keys fk_rails_d5ecae402c\"\r\npg_restore: creating FK CONSTRAINT \"public.weeklies fk_rails_d7ff067ab0\"\r\npg_restore: creating FK CONSTRAINT \"public.knight_logs fk_rails_ded551fbb4\"\r\npg_restore: creating FK CONSTRAINT \"public.resident_keys fk_rails_dfe4427a9d\"\r\npg_restore: creating FK CONSTRAINT \"public.entrance_block_knight_cards fk_rails_e8410af2ce\"\r\npg_restore: creating FK CONSTRAINT \"public.logs fk_rails_ef0f5cfa81\"\r\npg_restore: creating FK CONSTRAINT \"public.entrance_knight_keys fk_rails_f404f37ec9\"\r\npg_restore: creating FK CONSTRAINT \"public.entrance_block_knight_cards fk_rails_f6a259853d\"\r\npg_restore: creating FK CONSTRAINT \"public.invitations fk_rails_f87be4c20b\"\r\n```\r\n\r\n</details>\r\n\r\n### Bucardoの設定、データプールの開始\r\n成功\r\n```sh\r\nroot@c4e9fe68d14c:/# bucardo add db heroku_db dbhost=source-db dbport=5432 dbuser=postgres dbname=postgres dbpass=postgres\r\nAdded database \"heroku_db\"\r\nroot@c4e9fe68d14c:/# bucardo add db aws_db dbhost=target-db dbport=5432 dbuser=postgres dbname=postgres dbpass=postgres\r\nAdded database \"aws_db\"\r\nroot@c4e9fe68d14c:/# bucardo add dbgroup dbs heroku_db:source aws_db:target\r\nCreated dbgroup \"dbs\"\r\nAdded database \"heroku_db\" to dbgroup \"dbs\" as source\r\nAdded database \"aws_db\" to dbgroup \"dbs\" as target\r\nroot@c4e9fe68d14c:/# bucardo add table logs display_logs herd=herd_heroku_db db=heroku_db\r\nAdded the following tables or sequences:\r\n  public.display_logs\r\n  public.logs\r\nCreated the relgroup named \"herd_heroku_db\"\r\nThe following tables or sequences are now part of the relgroup \"herd_heroku_db\":\r\n  public.display_logs\r\n  public.logs\r\n```\r\nソースDBにpsqlしてbucardoスキーマがないことを確認、その後bucardo add syncしてbucardoスキーマが生成された\r\n```sh\r\nroot@c4e9fe68d14c:/# psql -h source-db -U postgres -d postgres -p 5432\r\nPassword for user postgres:\r\npsql (14.7 (Ubuntu 14.7-0ubuntu0.22.04.1), server 14.5 (Debian 14.5-2.pgdg110+2))\r\nType \"help\" for help.\r\n\r\npostgres=# \\d bucardo.*\r\nDid not find any relation named \"bucardo.*\".\r\npostgres=# exit\r\nroot@c4e9fe68d14c:/# bucardo add sync sync_heroku_aws relgroup=herd_heroku_db db=heroku_db,aws_db\r\nAdded sync \"sync_heroku_aws\"\r\nUsing existing dbgroup \"dbs\"\r\nroot@c4e9fe68d14c:/# psql -h source-db -U postgres -d postgres -p 5432\r\nPassword for user postgres:\r\npsql (14.7 (Ubuntu 14.7-0ubuntu0.22.04.1), server 14.5 (Debian 14.5-2.pgdg110+2))\r\nType \"help\" for help.\r\n\r\npostgres=# \\d bucardo.*\r\n                  Table \"bucardo.bucardo_delta_names\"\r\n  Column   |           Type           | Collation | Nullable | Default\r\n-----------+--------------------------+-----------+----------+---------\r\n sync      | text                     |           |          |\r\n tablename | text                     |           |          |\r\n deltaname | text                     |           |          |\r\n trackname | text                     |           |          |\r\n cdate     | timestamp with time zone |           | not null | now()\r\nIndexes:\r\n    \"bucardo_delta_names_unique\"\r\n    以下略\r\n```\r\n\r\n### logs, display_logsのdump\r\n\r\n<details>\r\n<summary>成功</summary>\r\n\r\n```sh\r\npg_dump --format=custom --verbose --data-only --table=logs --table=display_logs -h source-db -U postgres -d postgres -p 5432 >logs_displaylogs.dump\r\nPassword:\r\npg_dump: last built-in OID is 16383\r\npg_dump: reading extensions\r\npg_dump: identifying extension members\r\npg_dump: reading schemas\r\npg_dump: reading user-defined tables\r\npg_dump: reading user-defined functions\r\npg_dump: reading user-defined types\r\npg_dump: reading procedural languages\r\npg_dump: reading user-defined aggregate functions\r\npg_dump: reading user-defined operators\r\npg_dump: reading user-defined access methods\r\npg_dump: reading user-defined operator classes\r\npg_dump: reading user-defined operator families\r\npg_dump: reading user-defined text search parsers\r\npg_dump: reading user-defined text search templates\r\npg_dump: reading user-defined text search dictionaries\r\npg_dump: reading user-defined text search configurations\r\npg_dump: reading user-defined foreign-data wrappers\r\npg_dump: reading user-defined foreign servers\r\npg_dump: reading default privileges\r\npg_dump: reading user-defined collations\r\npg_dump: reading user-defined conversions\r\npg_dump: reading type casts\r\npg_dump: reading transforms\r\npg_dump: reading table inheritance information\r\npg_dump: reading event triggers\r\npg_dump: finding extension tables\r\npg_dump: finding inheritance relationships\r\npg_dump: reading column info for interesting tables\r\npg_dump: finding the columns and types of table \"public.display_logs\"\r\npg_dump: finding the columns and types of table \"public.logs\"\r\npg_dump: flagging inherited columns in subtables\r\npg_dump: reading indexes\r\npg_dump: reading indexes for table \"public.display_logs\"\r\npg_dump: reading indexes for table \"public.logs\"\r\npg_dump: flagging indexes in partitioned tables\r\npg_dump: reading extended statistics\r\npg_dump: reading constraints\r\npg_dump: reading foreign key constraints for table \"public.display_logs\"\r\npg_dump: reading foreign key constraints for table \"public.logs\"\r\npg_dump: reading triggers\r\npg_dump: reading triggers for table \"public.display_logs\"\r\npg_dump: reading triggers for table \"public.logs\"\r\npg_dump: reading rewrite rules\r\npg_dump: reading policies\r\npg_dump: reading row-level security policies\r\npg_dump: reading publications\r\npg_dump: reading publication membership\r\npg_dump: reading subscriptions\r\npg_dump: reading dependency data\r\npg_dump: saving encoding = UTF8\r\npg_dump: saving standard_conforming_strings = on\r\npg_dump: saving search_path =\r\npg_dump: saving database definition\r\npg_dump: dumping contents of table \"public.display_logs\"\r\npg_dump: dumping contents of table \"public.logs\"\r\n```\r\n\r\n</details>\r\n    \r\n### logs, display_logsのrestore\r\n成功\r\n    \r\n```sh\r\npg_restore --verbose --data-only --disable-triggers -h target-db -p 5432 -U postgres -d postgres logs_displaylogs.dump\r\npg_restore: connecting to database for restore\r\nPassword:\r\npg_restore: disabling triggers for display_logs\r\npg_restore: processing data for table \"public.display_logs\"\r\npg_restore: enabling triggers for display_logs\r\npg_restore: disabling triggers for logs\r\npg_restore: processing data for table \"public.logs\"\r\npg_restore: enabling triggers for logs\r\n```\r\n\r\n## ここからが検証\r\n\r\n### logs, display_logs以外のdump\r\n\r\n<details>\r\n```sh\r\npg_dump --format=custom     --verbose --data-only     --schema=public --exclude-table=logs --exclude-table=display_logs -h source-db -U postgres -d postgres -p 5432 > main_data.dump\r\nPassword:\r\npg_dump: last built-in OID is 16383\r\npg_dump: reading extensions\r\npg_dump: identifying extension members\r\npg_dump: reading schemas\r\npg_dump: reading user-defined tables\r\npg_dump: reading user-defined functions\r\npg_dump: reading user-defined types\r\npg_dump: reading procedural languages\r\npg_dump: reading user-defined aggregate functions\r\npg_dump: reading user-defined operators\r\npg_dump: reading user-defined access methods\r\npg_dump: reading user-defined operator classes\r\npg_dump: reading user-defined operator families\r\npg_dump: reading user-defined text search parsers\r\npg_dump: reading user-defined text search templates\r\npg_dump: reading user-defined text search dictionaries\r\npg_dump: reading user-defined text search configurations\r\npg_dump: reading user-defined foreign-data wrappers\r\npg_dump: reading user-defined foreign servers\r\npg_dump: reading default privileges\r\npg_dump: reading user-defined collations\r\npg_dump: reading user-defined conversions\r\npg_dump: reading type casts\r\npg_dump: reading transforms\r\npg_dump: reading table inheritance information\r\npg_dump: reading event triggers\r\npg_dump: finding extension tables\r\npg_dump: finding inheritance relationships\r\npg_dump: reading column info for interesting tables\r\npg_dump: finding the columns and types of table \"public.active_storage_attachments\"\r\npg_dump: finding the columns and types of table \"public.active_storage_blobs\"\r\npg_dump: finding the columns and types of table \"public.active_storage_variant_records\"\r\npg_dump: finding the columns and types of table \"public.ar_internal_metadata\"\r\npg_dump: finding the columns and types of table \"public.autolock_schedules\"\r\npg_dump: finding the columns and types of table \"public.cards\"\r\npg_dump: finding the columns and types of table \"public.command_logs\"\r\npg_dump: finding the columns and types of table \"public.dailies\"\r\npg_dump: finding the columns and types of table \"public.door_mode_changed_histories\"\r\npg_dump: finding the columns and types of table \"public.durations\"\r\npg_dump: finding the columns and types of table \"public.entrance_block_fob_keys\"\r\npg_dump: finding the columns and types of table \"public.entrance_block_knight_cards\"\r\npg_dump: finding the columns and types of table \"public.entrance_fob_keys\"\r\npg_dump: finding the columns and types of table \"public.entrance_invitations\"\r\npg_dump: finding the columns and types of table \"public.entrance_knight_keys\"\r\npg_dump: finding the columns and types of table \"public.entrance_knight_pins\"\r\npg_dump: finding the columns and types of table \"public.entrance_lock_settings\"\r\npg_dump: finding the columns and types of table \"public.entrance_locks\"\r\npg_dump: finding the columns and types of table \"public.entrance_master_keys\"\r\npg_dump: finding the columns and types of table \"public.entrance_resident_guest_keys\"\r\npg_dump: finding the columns and types of table \"public.entrance_resident_keys\"\r\npg_dump: finding the columns and types of table \"public.family_keys\"\r\npg_dump: finding the columns and types of table \"public.fob_keys\"\r\npg_dump: finding the columns and types of table \"public.fobs\"\r\npg_dump: finding the columns and types of table \"public.guest_keys\"\r\npg_dump: finding the columns and types of table \"public.hubs\"\r\npg_dump: finding the columns and types of table \"public.invitations\"\r\npg_dump: finding the columns and types of table \"public.json_web_keys\"\r\npg_dump: finding the columns and types of table \"public.knight_cards\"\r\npg_dump: finding the columns and types of table \"public.knight_commands\"\r\npg_dump: finding the columns and types of table \"public.knight_keys\"\r\npg_dump: finding the columns and types of table \"public.knight_logs\"\r\npg_dump: finding the columns and types of table \"public.knight_pins\"\r\npg_dump: finding the columns and types of table \"public.knights\"\r\npg_dump: finding the columns and types of table \"public.laresia_pins\"\r\npg_dump: finding the columns and types of table \"public.lock_settings\"\r\npg_dump: finding the columns and types of table \"public.lock_webhook_tokens\"\r\npg_dump: finding the columns and types of table \"public.locks\"\r\npg_dump: finding the columns and types of table \"public.managers\"\r\npg_dump: finding the columns and types of table \"public.master_keys\"\r\npg_dump: finding the columns and types of table \"public.mst_display_logs\"\r\npg_dump: finding the columns and types of table \"public.relationships\"\r\npg_dump: finding the columns and types of table \"public.resident_guest_keys\"\r\npg_dump: finding the columns and types of table \"public.resident_keys\"\r\npg_dump: finding the columns and types of table \"public.schema_migrations\"\r\npg_dump: finding the columns and types of table \"public.term_of_validities\"\r\npg_dump: finding the columns and types of table \"public.users\"\r\npg_dump: finding the columns and types of table \"public.webhook_tokens\"\r\npg_dump: finding the columns and types of table \"public.webhooks\"\r\npg_dump: finding the columns and types of table \"public.weeklies\"\r\npg_dump: finding the columns and types of table \"public.wena_keys\"\r\npg_dump: finding the columns and types of table \"public.wenas\"\r\npg_dump: flagging inherited columns in subtables\r\npg_dump: reading indexes\r\npg_dump: reading indexes for table \"public.active_storage_attachments\"\r\npg_dump: reading indexes for table \"public.active_storage_blobs\"\r\npg_dump: reading indexes for table \"public.active_storage_variant_records\"\r\npg_dump: reading indexes for table \"public.ar_internal_metadata\"\r\npg_dump: reading indexes for table \"public.autolock_schedules\"\r\npg_dump: reading indexes for table \"public.cards\"\r\npg_dump: reading indexes for table \"public.command_logs\"\r\npg_dump: reading indexes for table \"public.dailies\"\r\npg_dump: reading indexes for table \"public.door_mode_changed_histories\"\r\npg_dump: reading indexes for table \"public.durations\"\r\npg_dump: reading indexes for table \"public.entrance_block_fob_keys\"\r\npg_dump: reading indexes for table \"public.entrance_block_knight_cards\"\r\npg_dump: reading indexes for table \"public.entrance_fob_keys\"\r\npg_dump: reading indexes for table \"public.entrance_invitations\"\r\npg_dump: reading indexes for table \"public.entrance_knight_keys\"\r\npg_dump: reading indexes for table \"public.entrance_knight_pins\"\r\npg_dump: reading indexes for table \"public.entrance_lock_settings\"\r\npg_dump: reading indexes for table \"public.entrance_locks\"\r\npg_dump: reading indexes for table \"public.entrance_master_keys\"\r\npg_dump: reading indexes for table \"public.entrance_resident_guest_keys\"\r\npg_dump: reading indexes for table \"public.entrance_resident_keys\"\r\npg_dump: reading indexes for table \"public.family_keys\"\r\npg_dump: reading indexes for table \"public.fob_keys\"\r\npg_dump: reading indexes for table \"public.fobs\"\r\npg_dump: reading indexes for table \"public.guest_keys\"\r\npg_dump: reading indexes for table \"public.hubs\"\r\npg_dump: reading indexes for table \"public.invitations\"\r\npg_dump: reading indexes for table \"public.json_web_keys\"\r\npg_dump: reading indexes for table \"public.knight_cards\"\r\npg_dump: reading indexes for table \"public.knight_commands\"\r\npg_dump: reading indexes for table \"public.knight_keys\"\r\npg_dump: reading indexes for table \"public.knight_logs\"\r\npg_dump: reading indexes for table \"public.knight_pins\"\r\npg_dump: reading indexes for table \"public.knights\"\r\npg_dump: reading indexes for table \"public.laresia_pins\"\r\npg_dump: reading indexes for table \"public.lock_settings\"\r\npg_dump: reading indexes for table \"public.lock_webhook_tokens\"\r\npg_dump: reading indexes for table \"public.locks\"\r\npg_dump: reading indexes for table \"public.managers\"\r\npg_dump: reading indexes for table \"public.master_keys\"\r\npg_dump: reading indexes for table \"public.mst_display_logs\"\r\npg_dump: reading indexes for table \"public.relationships\"\r\npg_dump: reading indexes for table \"public.resident_guest_keys\"\r\npg_dump: reading indexes for table \"public.resident_keys\"\r\npg_dump: reading indexes for table \"public.schema_migrations\"\r\npg_dump: reading indexes for table \"public.term_of_validities\"\r\npg_dump: reading indexes for table \"public.users\"\r\npg_dump: reading indexes for table \"public.webhook_tokens\"\r\npg_dump: reading indexes for table \"public.webhooks\"\r\npg_dump: reading indexes for table \"public.weeklies\"\r\npg_dump: reading indexes for table \"public.wena_keys\"\r\npg_dump: reading indexes for table \"public.wenas\"\r\npg_dump: flagging indexes in partitioned tables\r\npg_dump: reading extended statistics\r\npg_dump: reading constraints\r\npg_dump: reading foreign key constraints for table \"public.active_storage_attachments\"\r\npg_dump: reading foreign key constraints for table \"public.active_storage_blobs\"\r\npg_dump: reading foreign key constraints for table \"public.active_storage_variant_records\"\r\npg_dump: reading foreign key constraints for table \"public.autolock_schedules\"\r\npg_dump: reading foreign key constraints for table \"public.command_logs\"\r\npg_dump: reading foreign key constraints for table \"public.dailies\"\r\npg_dump: reading foreign key constraints for table \"public.door_mode_changed_histories\"\r\npg_dump: reading foreign key constraints for table \"public.durations\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_block_fob_keys\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_block_knight_cards\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_fob_keys\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_invitations\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_knight_keys\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_knight_pins\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_lock_settings\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_locks\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_master_keys\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_resident_guest_keys\"\r\npg_dump: reading foreign key constraints for table \"public.entrance_resident_keys\"\r\npg_dump: reading foreign key constraints for table \"public.family_keys\"\r\npg_dump: reading foreign key constraints for table \"public.fob_keys\"\r\npg_dump: reading foreign key constraints for table \"public.fobs\"\r\npg_dump: reading foreign key constraints for table \"public.guest_keys\"\r\npg_dump: reading foreign key constraints for table \"public.hubs\"\r\npg_dump: reading foreign key constraints for table \"public.invitations\"\r\npg_dump: reading foreign key constraints for table \"public.knight_cards\"\r\npg_dump: reading foreign key constraints for table \"public.knight_keys\"\r\npg_dump: reading foreign key constraints for table \"public.knight_logs\"\r\npg_dump: reading foreign key constraints for table \"public.knight_pins\"\r\npg_dump: reading foreign key constraints for table \"public.knights\"\r\npg_dump: reading foreign key constraints for table \"public.laresia_pins\"\r\npg_dump: reading foreign key constraints for table \"public.lock_settings\"\r\npg_dump: reading foreign key constraints for table \"public.lock_webhook_tokens\"\r\npg_dump: reading foreign key constraints for table \"public.locks\"\r\npg_dump: reading foreign key constraints for table \"public.managers\"\r\npg_dump: reading foreign key constraints for table \"public.master_keys\"\r\npg_dump: reading foreign key constraints for table \"public.mst_display_logs\"\r\npg_dump: reading foreign key constraints for table \"public.relationships\"\r\npg_dump: reading foreign key constraints for table \"public.resident_guest_keys\"\r\npg_dump: reading foreign key constraints for table \"public.resident_keys\"\r\npg_dump: reading foreign key constraints for table \"public.term_of_validities\"\r\npg_dump: reading foreign key constraints for table \"public.users\"\r\npg_dump: reading foreign key constraints for table \"public.webhook_tokens\"\r\npg_dump: reading foreign key constraints for table \"public.webhooks\"\r\npg_dump: reading foreign key constraints for table \"public.weeklies\"\r\npg_dump: reading foreign key constraints for table \"public.wena_keys\"\r\npg_dump: reading foreign key constraints for table \"public.wenas\"\r\npg_dump: reading triggers\r\npg_dump: reading triggers for table \"public.active_storage_attachments\"\r\npg_dump: reading triggers for table \"public.active_storage_blobs\"\r\npg_dump: reading triggers for table \"public.active_storage_variant_records\"\r\npg_dump: reading triggers for table \"public.autolock_schedules\"\r\npg_dump: reading triggers for table \"public.command_logs\"\r\npg_dump: reading triggers for table \"public.dailies\"\r\npg_dump: reading triggers for table \"public.door_mode_changed_histories\"\r\npg_dump: reading triggers for table \"public.durations\"\r\npg_dump: reading triggers for table \"public.entrance_block_fob_keys\"\r\npg_dump: reading triggers for table \"public.entrance_block_knight_cards\"\r\npg_dump: reading triggers for table \"public.entrance_fob_keys\"\r\npg_dump: reading triggers for table \"public.entrance_invitations\"\r\npg_dump: reading triggers for table \"public.entrance_knight_keys\"\r\npg_dump: reading triggers for table \"public.entrance_knight_pins\"\r\npg_dump: reading triggers for table \"public.entrance_lock_settings\"\r\npg_dump: reading triggers for table \"public.entrance_locks\"\r\npg_dump: reading triggers for table \"public.entrance_master_keys\"\r\npg_dump: reading triggers for table \"public.entrance_resident_guest_keys\"\r\npg_dump: reading triggers for table \"public.entrance_resident_keys\"\r\npg_dump: reading triggers for table \"public.family_keys\"\r\npg_dump: reading triggers for table \"public.fob_keys\"\r\npg_dump: reading triggers for table \"public.fobs\"\r\npg_dump: reading triggers for table \"public.guest_keys\"\r\npg_dump: reading triggers for table \"public.hubs\"\r\npg_dump: reading triggers for table \"public.invitations\"\r\npg_dump: reading triggers for table \"public.knight_cards\"\r\npg_dump: reading triggers for table \"public.knight_keys\"\r\npg_dump: reading triggers for table \"public.knight_logs\"\r\npg_dump: reading triggers for table \"public.knight_pins\"\r\npg_dump: reading triggers for table \"public.knights\"\r\npg_dump: reading triggers for table \"public.laresia_pins\"\r\npg_dump: reading triggers for table \"public.lock_settings\"\r\npg_dump: reading triggers for table \"public.lock_webhook_tokens\"\r\npg_dump: reading triggers for table \"public.locks\"\r\npg_dump: reading triggers for table \"public.managers\"\r\npg_dump: reading triggers for table \"public.master_keys\"\r\npg_dump: reading triggers for table \"public.mst_display_logs\"\r\npg_dump: reading triggers for table \"public.relationships\"\r\npg_dump: reading triggers for table \"public.resident_guest_keys\"\r\npg_dump: reading triggers for table \"public.resident_keys\"\r\npg_dump: reading triggers for table \"public.term_of_validities\"\r\npg_dump: reading triggers for table \"public.users\"\r\npg_dump: reading triggers for table \"public.webhook_tokens\"\r\npg_dump: reading triggers for table \"public.webhooks\"\r\npg_dump: reading triggers for table \"public.weeklies\"\r\npg_dump: reading triggers for table \"public.wena_keys\"\r\npg_dump: reading triggers for table \"public.wenas\"\r\npg_dump: reading rewrite rules\r\npg_dump: reading policies\r\npg_dump: reading row-level security policies\r\npg_dump: reading publications\r\npg_dump: reading publication membership\r\npg_dump: reading subscriptions\r\npg_dump: reading dependency data\r\npg_dump: saving encoding = UTF8\r\npg_dump: saving standard_conforming_strings = on\r\npg_dump: saving search_path =\r\npg_dump: saving database definition\r\npg_dump: dumping contents of table \"public.active_storage_blobs\"\r\npg_dump: dumping contents of table \"public.active_storage_attachments\"\r\npg_dump: dumping contents of table \"public.active_storage_variant_records\"\r\npg_dump: dumping contents of table \"public.ar_internal_metadata\"\r\npg_dump: dumping contents of table \"public.locks\"\r\npg_dump: dumping contents of table \"public.users\"\r\npg_dump: dumping contents of table \"public.master_keys\"\r\npg_dump: dumping contents of table \"public.autolock_schedules\"\r\npg_dump: dumping contents of table \"public.cards\"\r\npg_dump: dumping contents of table \"public.hubs\"\r\npg_dump: dumping contents of table \"public.command_logs\"\r\npg_dump: dumping contents of table \"public.term_of_validities\"\r\npg_dump: dumping contents of table \"public.dailies\"\r\npg_dump: dumping contents of table \"public.door_mode_changed_histories\"\r\npg_dump: dumping contents of table \"public.durations\"\r\npg_dump: dumping contents of table \"public.entrance_locks\"\r\npg_dump: dumping contents of table \"public.entrance_master_keys\"\r\npg_dump: dumping contents of table \"public.fobs\"\r\npg_dump: dumping contents of table \"public.fob_keys\"\r\npg_dump: dumping contents of table \"public.entrance_fob_keys\"\r\npg_dump: dumping contents of table \"public.entrance_block_fob_keys\"\r\npg_dump: dumping contents of table \"public.knights\"\r\npg_dump: dumping contents of table \"public.entrance_knight_keys\"\r\npg_dump: dumping contents of table \"public.knight_keys\"\r\npg_dump: dumping contents of table \"public.knight_cards\"\r\npg_dump: dumping contents of table \"public.entrance_block_knight_cards\"\r\npg_dump: dumping contents of table \"public.invitations\"\r\npg_dump: dumping contents of table \"public.entrance_invitations\"\r\npg_dump: dumping contents of table \"public.entrance_knight_pins\"\r\npg_dump: dumping contents of table \"public.entrance_lock_settings\"\r\npg_dump: dumping contents of table \"public.resident_guest_keys\"\r\npg_dump: dumping contents of table \"public.entrance_resident_guest_keys\"\r\npg_dump: dumping contents of table \"public.resident_keys\"\r\npg_dump: dumping contents of table \"public.entrance_resident_keys\"\r\npg_dump: dumping contents of table \"public.family_keys\"\r\npg_dump: dumping contents of table \"public.guest_keys\"\r\npg_dump: dumping contents of table \"public.json_web_keys\"\r\npg_dump: dumping contents of table \"public.knight_commands\"\r\npg_dump: dumping contents of table \"public.knight_logs\"\r\npg_dump: dumping contents of table \"public.knight_pins\"\r\npg_dump: dumping contents of table \"public.laresia_pins\"\r\npg_dump: dumping contents of table \"public.lock_settings\"\r\npg_dump: dumping contents of table \"public.webhook_tokens\"\r\npg_dump: dumping contents of table \"public.lock_webhook_tokens\"\r\npg_dump: dumping contents of table \"public.managers\"\r\npg_dump: dumping contents of table \"public.mst_display_logs\"\r\npg_dump: dumping contents of table \"public.relationships\"\r\npg_dump: dumping contents of table \"public.schema_migrations\"\r\npg_dump: dumping contents of table \"public.webhooks\"\r\npg_dump: dumping contents of table \"public.weeklies\"\r\npg_dump: dumping contents of table \"public.wenas\"\r\npg_dump: dumping contents of table \"public.wena_keys\"\r\n```\r\n\r\n</details>\r\n\r\n### logs, display_logs以外のrestore\r\n\r\n<details>\r\n```sh\r\nroot@c4e9fe68d14c:/# pg_restore --verbose --data-only -h target-db -p 5432 -U postgres -d postgres main_data.dump\r\npg_restore: connecting to database for restore\r\nPassword:\r\npg_restore: processing data for table \"public.active_storage_blobs\"\r\npg_restore: processing data for table \"public.active_storage_attachments\"\r\npg_restore: processing data for table \"public.active_storage_variant_records\"\r\npg_restore: processing data for table \"public.ar_internal_metadata\"\r\npg_restore: processing data for table \"public.locks\"\r\npg_restore: processing data for table \"public.users\"\r\npg_restore: processing data for table \"public.master_keys\"\r\npg_restore: processing data for table \"public.autolock_schedules\"\r\npg_restore: processing data for table \"public.cards\"\r\npg_restore: processing data for table \"public.hubs\"\r\npg_restore: processing data for table \"public.command_logs\"\r\npg_restore: processing data for table \"public.term_of_validities\"\r\npg_restore: processing data for table \"public.dailies\"\r\npg_restore: processing data for table \"public.door_mode_changed_histories\"\r\npg_restore: processing data for table \"public.durations\"\r\npg_restore: processing data for table \"public.entrance_locks\"\r\npg_restore: processing data for table \"public.entrance_master_keys\"\r\npg_restore: processing data for table \"public.fobs\"\r\npg_restore: processing data for table \"public.fob_keys\"\r\npg_restore: processing data for table \"public.entrance_fob_keys\"\r\npg_restore: processing data for table \"public.entrance_block_fob_keys\"\r\npg_restore: processing data for table \"public.knights\"\r\npg_restore: processing data for table \"public.entrance_knight_keys\"\r\npg_restore: processing data for table \"public.knight_keys\"\r\npg_restore: processing data for table \"public.knight_cards\"\r\npg_restore: processing data for table \"public.entrance_block_knight_cards\"\r\npg_restore: processing data for table \"public.invitations\"\r\npg_restore: processing data for table \"public.entrance_invitations\"\r\npg_restore: processing data for table \"public.entrance_knight_pins\"\r\npg_restore: processing data for table \"public.entrance_lock_settings\"\r\npg_restore: processing data for table \"public.resident_guest_keys\"\r\npg_restore: processing data for table \"public.entrance_resident_guest_keys\"\r\npg_restore: processing data for table \"public.resident_keys\"\r\npg_restore: processing data for table \"public.entrance_resident_keys\"\r\npg_restore: processing data for table \"public.family_keys\"\r\npg_restore: processing data for table \"public.guest_keys\"\r\npg_restore: processing data for table \"public.json_web_keys\"\r\npg_restore: processing data for table \"public.knight_commands\"\r\npg_restore: processing data for table \"public.knight_logs\"\r\npg_restore: processing data for table \"public.knight_pins\"\r\npg_restore: processing data for table \"public.laresia_pins\"\r\npg_restore: processing data for table \"public.lock_settings\"\r\npg_restore: processing data for table \"public.webhook_tokens\"\r\npg_restore: processing data for table \"public.lock_webhook_tokens\"\r\npg_restore: processing data for table \"public.managers\"\r\npg_restore: processing data for table \"public.mst_display_logs\"\r\npg_restore: processing data for table \"public.relationships\"\r\npg_restore: processing data for table \"public.schema_migrations\"\r\npg_restore: processing data for table \"public.webhooks\"\r\npg_restore: processing data for table \"public.weeklies\"\r\npg_restore: processing data for table \"public.wenas\"\r\npg_restore: processing data for table \"public.wena_keys\"\r\npg_restore: executing SEQUENCE SET active_storage_attachments_id_seq\r\npg_restore: executing SEQUENCE SET active_storage_blobs_id_seq\r\npg_restore: executing SEQUENCE SET active_storage_variant_records_id_seq\r\npg_restore: executing SEQUENCE SET json_web_keys_id_seq\r\n```\r\n</details>\r\n\r\n## 現状の結論\r\n\r\nbucardo以外のスキーマについて調査不足のため今回のDB移行に`--schema=public`は採用しない方針\r\n\r\n## 他のスキーマについて調査が必要\r\n\r\n### datadog\r\nheroku上のアドオンでdatadogがあるが、それを追加した際にできたスキーマ\r\n移行不要\r\n### heroku_ext\r\n> Heroku Postgres で作成されるすべての新しい拡張機能は heroku_ext スキーマにインストールされます。以前は、拡張機能は public スキーマまたは user-defined スキーマにインストールされていました。古い拡張機能を更新するには、拡張機能を DROP して再び CREATE する必要があります。その後、古い public スキーマまたは user-definedスキーマを参照するアプリケーションコードを変更できます。heroku_extスキーマを追加することによって、カスタムロールを更新できます。\r\n\r\nhttps://devcenter.heroku.com/ja/articles/heroku-postgres-extensions-postgis-full-text-search\r\nPostgresqlに関わるアドオン用のスキーマのようなので、移行した方が良い\r\n### information_schema\r\n### pg_catalog\r\n",
    "body_html": "<h2 data-sourcepos=\"1:1-1:9\" id=\"0-1-0\" name=\"0-1-0\"><a class=\"anchor\" id=\"背景\" name=\"背景\" href=\"#背景\" data-position=\"0-1-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"背景\"> &gt; 背景</span></a>背景</h2>\n<p data-sourcepos=\"3:1-3:57\">bucardo設定後のdumpの際にdumpログに出てきた</p>\n<div class=\"code-block\" data-sourcepos=\"5:1-7:3\"><div class=\"highlight\"><pre class=\"highlight plaintext\"><code>pg_dump: dumping contents of table \"bucardo.track_public_logs\"\n</code></pre></div></div>\n<p data-sourcepos=\"9:1-9:30\">こいつが気になる問題</p>\n<h2 data-sourcepos=\"11:1-11:28\" id=\"0-2-0\" name=\"0-2-0\"><a class=\"anchor\" id=\"bucardoスキーマとは\" name=\"bucardoスキーマとは\" href=\"#bucardoスキーマとは\" data-position=\"0-2-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"bucardoスキーマとは\"> &gt; bucardoスキーマとは</span></a>bucardoスキーマとは</h2>\n<p data-sourcepos=\"13:1-13:53\"><a href=\"https://bucardo.org/Bucardo/schema/\" target=\"_blank\" rel=\"noopener noreferrer\">Bucardo schema</a></p>\n<p data-sourcepos=\"15:1-15:27\">冒頭文を要約すると</p>\n<blockquote data-sourcepos=\"16:1-16:257\">\n<p data-sourcepos=\"16:3-16:257\">bucardoが動いているインスタンス内データベースと追跡するデータベースにbucardoってスキーマ作るんでよろしく、bucardoが動いているインスタンスの方には設定ファイルとかが格納されている</p>\n</blockquote>\n<p data-sourcepos=\"18:1-18:21\">といったところ</p>\n<h2 data-sourcepos=\"20:1-20:38\" id=\"0-3-0\" name=\"0-3-0\"><a class=\"anchor\" id=\"Staging Heroku DBにいるのは？\" name=\"Staging Heroku DBにいるのは？\" href=\"#Staging Heroku DBにいるのは？\" data-position=\"0-3-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"Staging Heroku DBにいるのは？\"> &gt; Staging Heroku DBにいるのは？</span></a>Staging Heroku DBにいるのは？</h2>\n<p data-sourcepos=\"22:1-22:78\">上記URLの<a href=\"https://bucardo.org/Bucardo/schema/\" target=\"_blank\" rel=\"noopener noreferrer\">Remote Bucardo tables</a>より</p>\n<p data-sourcepos=\"24:1-24:12\">以下英訳</p>\n<blockquote data-sourcepos=\"26:1-26:202\">\n<p data-sourcepos=\"26:3-26:202\">スワップまたは<strong>プッシュデルタ同期</strong>のソースとして使用される各データベースには、以下のテーブルがbucardoスキーマにインストールされています</p>\n</blockquote>\n<p data-sourcepos=\"28:1-28:119\">※<a href=\"https://bucardo.org/Bucardo/object_types/pushdelta\" target=\"_blank\" rel=\"noopener noreferrer\">プッシュデルタ同期</a>が今回使うreplicationの方式</p>\n<blockquote data-sourcepos=\"29:1-29:210\">\n<p data-sourcepos=\"29:2-29:210\">pushdeltaはBucardo同期の一種で、変更された行をあるデータベース（ソース）から1つまたは複数のターゲットデータベースにプッシュすることを意味します。</p>\n</blockquote>\n<p data-sourcepos=\"31:1-31:37\">bucardoスキーマ内のテーブル</p>\n<ul data-sourcepos=\"33:1-43:0\">\n<li data-sourcepos=\"33:1-34:93\">bucardo_delta<br>\n複製された各テーブルについて、どの行が変更されたかを保存する。</li>\n<li data-sourcepos=\"35:1-36:96\">bucardo_track<br>\nどの行がどのリモートターゲットにレプリケートされたかを保存する。</li>\n<li data-sourcepos=\"37:1-38:63\">bucardo_delta_targets<br>\nテーブルをリモートデータベースにマッピング</li>\n<li data-sourcepos=\"39:1-40:75\">bucardo_sequences<br>\n複製された配列[<strong>シーケンス</strong>]の現在の状態を追跡する</li>\n<li data-sourcepos=\"41:1-43:0\">bucardo_truncate_trigger bucardo_truncate_trigger_log<br>\n複製されたテーブルの切り捨て[<strong>TRUNCATE</strong>]を追跡する</li>\n</ul>\n<p data-sourcepos=\"44:1-45:143\">つまりStaging Heroku DBにあるlogs,display_logsテーブルについての変更情報がやAuroraへのマッピング情報が追記されていく。<br>\nこのスキーマの情報は<strong>Bucardoのプログラムそのものが参照</strong>しAuroraへとデータを流す仕組みとなっている。</p>\n<p data-sourcepos=\"47:1-47:91\">よってdumpの際は除外することが可能。Auroraには必要ない情報である</p>\n<h2 data-sourcepos=\"49:1-49:15\" id=\"0-4-0\" name=\"0-4-0\"><a class=\"anchor\" id=\"一応確認\" name=\"一応確認\" href=\"#一応確認\" data-position=\"0-4-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"一応確認\"> &gt; 一応確認</span></a>一応確認</h2>\n<p data-sourcepos=\"51:1-51:93\">ローカルでdockerコンテナを立てて再現。各DBエンジンはPostgres14です。</p>\n<p data-sourcepos=\"53:1-55:65\"><strong>A</strong>. Bucardoインスタンス&amp;DBがあるコンテナ: EC2のモック<br>\n<strong>B</strong>. ソースDBがあるコンテナ: Herokuのモック<br>\n<strong>C</strong>. ターゲットDBがあるコンテナ: Auroraのモック</p>\n<p data-sourcepos=\"57:1-57:67\">検証用としてStagingのdumpデータをソースDBに投入。</p>\n<p data-sourcepos=\"59:1-59:137\">その後は<a href=\"https://docs.google.com/spreadsheets/d/1W3DymCJ_ifiXtSUwVAjcl9tzPGfz5WE6bmnnwYL9Gbo/edit?usp=sharing\" target=\"_blank\" rel=\"noopener noreferrer\">移行手順</a>通りに</p>\n<ul data-sourcepos=\"60:1-64:0\">\n<li data-sourcepos=\"60:1-60:59\">テーブルスキーマのdumpとリストア(B→A→C)</li>\n<li data-sourcepos=\"61:1-61:48\">Bucardoの設定、データプールの開始</li>\n<li data-sourcepos=\"62:1-62:27\">logs, display_logsのdump</li>\n<li data-sourcepos=\"63:1-64:0\">logs, display_logsのrestore</li>\n</ul>\n<p data-sourcepos=\"65:1-65:129\">ここまでを行った状態(main_dataのdumpより前の状態)で、<strong>B</strong>. ソースDBがあるコンテナを参照した。</p>\n<details>\n<summary>\nbucardoスキーマが生成され、logsとdisplay_logsに関するdelta_〜などのテーブルが生成されている。\n    </summary>\n<div class=\"code-block\" data-sourcepos=\"72:1-249:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sql</div><div class=\"highlight\"><pre class=\"highlight sql\"><code><span class=\"n\">postgres</span><span class=\"o\">=#</span> <span class=\"err\">\\</span><span class=\"n\">d</span> <span class=\"n\">bucardo</span><span class=\"p\">.</span><span class=\"o\">*</span>\n                  <span class=\"k\">Table</span> <span class=\"nv\">\"bucardo.bucardo_delta_names\"</span>\n  <span class=\"k\">Column</span>   <span class=\"o\">|</span>           <span class=\"k\">Type</span>           <span class=\"o\">|</span> <span class=\"k\">Collation</span> <span class=\"o\">|</span> <span class=\"k\">Nullable</span> <span class=\"o\">|</span> <span class=\"k\">Default</span>\n<span class=\"c1\">-----------+--------------------------+-----------+----------+---------</span>\n <span class=\"n\">sync</span>      <span class=\"o\">|</span> <span class=\"nb\">text</span>                     <span class=\"o\">|</span>           <span class=\"o\">|</span>          <span class=\"o\">|</span>\n <span class=\"n\">tablename</span> <span class=\"o\">|</span> <span class=\"nb\">text</span>                     <span class=\"o\">|</span>           <span class=\"o\">|</span>          <span class=\"o\">|</span>\n <span class=\"n\">deltaname</span> <span class=\"o\">|</span> <span class=\"nb\">text</span>                     <span class=\"o\">|</span>           <span class=\"o\">|</span>          <span class=\"o\">|</span>\n <span class=\"n\">trackname</span> <span class=\"o\">|</span> <span class=\"nb\">text</span>                     <span class=\"o\">|</span>           <span class=\"o\">|</span>          <span class=\"o\">|</span>\n <span class=\"n\">cdate</span>     <span class=\"o\">|</span> <span class=\"nb\">timestamp</span> <span class=\"k\">with</span> <span class=\"nb\">time</span> <span class=\"k\">zone</span> <span class=\"o\">|</span>           <span class=\"o\">|</span> <span class=\"k\">not</span> <span class=\"k\">null</span> <span class=\"o\">|</span> <span class=\"n\">now</span><span class=\"p\">()</span>\n<span class=\"n\">Indexes</span><span class=\"p\">:</span>\n    <span class=\"nv\">\"bucardo_delta_names_unique\"</span> <span class=\"k\">UNIQUE</span><span class=\"p\">,</span> <span class=\"n\">btree</span> <span class=\"p\">(</span><span class=\"n\">sync</span><span class=\"p\">,</span> <span class=\"n\">tablename</span><span class=\"p\">)</span>\n<span class=\"n\">Triggers</span><span class=\"p\">:</span>\n    <span class=\"n\">bucardo_delta_namemaker</span> <span class=\"k\">BEFORE</span> <span class=\"k\">INSERT</span> <span class=\"k\">OR</span> <span class=\"k\">UPDATE</span> <span class=\"k\">ON</span> <span class=\"n\">bucardo</span><span class=\"p\">.</span><span class=\"n\">bucardo_delta_names</span> <span class=\"k\">FOR</span> <span class=\"k\">EACH</span> <span class=\"k\">ROW</span> <span class=\"k\">EXECUTE</span> <span class=\"k\">FUNCTION</span> <span class=\"n\">bucardo</span><span class=\"p\">.</span><span class=\"n\">bucardo_delta_names_helper</span><span class=\"p\">()</span>\n\n<span class=\"k\">Index</span> <span class=\"nv\">\"bucardo.bucardo_delta_names_unique\"</span>\n  <span class=\"k\">Column</span>   <span class=\"o\">|</span> <span class=\"k\">Type</span> <span class=\"o\">|</span> <span class=\"k\">Key</span><span class=\"o\">?</span> <span class=\"o\">|</span> <span class=\"n\">Definition</span>\n<span class=\"c1\">-----------+------+------+------------</span>\n <span class=\"n\">sync</span>      <span class=\"o\">|</span> <span class=\"nb\">text</span> <span class=\"o\">|</span> <span class=\"n\">yes</span>  <span class=\"o\">|</span> <span class=\"n\">sync</span>\n <span class=\"n\">tablename</span> <span class=\"o\">|</span> <span class=\"nb\">text</span> <span class=\"o\">|</span> <span class=\"n\">yes</span>  <span class=\"o\">|</span> <span class=\"n\">tablename</span>\n<span class=\"k\">unique</span><span class=\"p\">,</span> <span class=\"n\">btree</span><span class=\"p\">,</span> <span class=\"k\">for</span> <span class=\"k\">table</span> <span class=\"nv\">\"bucardo.bucardo_delta_names\"</span>\n\n<span class=\"k\">Index</span> <span class=\"nv\">\"bucardo.bucardo_delta_target_unique\"</span>\n  <span class=\"k\">Column</span>   <span class=\"o\">|</span> <span class=\"k\">Type</span> <span class=\"o\">|</span> <span class=\"k\">Key</span><span class=\"o\">?</span> <span class=\"o\">|</span> <span class=\"n\">Definition</span>\n<span class=\"c1\">-----------+------+------+------------</span>\n <span class=\"n\">tablename</span> <span class=\"o\">|</span> <span class=\"n\">oid</span>  <span class=\"o\">|</span> <span class=\"n\">yes</span>  <span class=\"o\">|</span> <span class=\"n\">tablename</span>\n <span class=\"n\">target</span>    <span class=\"o\">|</span> <span class=\"nb\">text</span> <span class=\"o\">|</span> <span class=\"n\">yes</span>  <span class=\"o\">|</span> <span class=\"n\">target</span>\n<span class=\"n\">btree</span><span class=\"p\">,</span> <span class=\"k\">for</span> <span class=\"k\">table</span> <span class=\"nv\">\"bucardo.bucardo_delta_targets\"</span>\n\n                 <span class=\"k\">Table</span> <span class=\"nv\">\"bucardo.bucardo_delta_targets\"</span>\n  <span class=\"k\">Column</span>   <span class=\"o\">|</span>           <span class=\"k\">Type</span>           <span class=\"o\">|</span> <span class=\"k\">Collation</span> <span class=\"o\">|</span> <span class=\"k\">Nullable</span> <span class=\"o\">|</span> <span class=\"k\">Default</span>\n<span class=\"c1\">-----------+--------------------------+-----------+----------+---------</span>\n <span class=\"n\">tablename</span> <span class=\"o\">|</span> <span class=\"n\">oid</span>                      <span class=\"o\">|</span>           <span class=\"o\">|</span> <span class=\"k\">not</span> <span class=\"k\">null</span> <span class=\"o\">|</span>\n <span class=\"n\">target</span>    <span class=\"o\">|</span> <span class=\"nb\">text</span>                     <span class=\"o\">|</span>           <span class=\"o\">|</span> <span class=\"k\">not</span> <span class=\"k\">null</span> <span class=\"o\">|</span>\n <span class=\"n\">cdate</span>     <span class=\"o\">|</span> <span class=\"nb\">timestamp</span> <span class=\"k\">with</span> <span class=\"nb\">time</span> <span class=\"k\">zone</span> <span class=\"o\">|</span>           <span class=\"o\">|</span> <span class=\"k\">not</span> <span class=\"k\">null</span> <span class=\"o\">|</span> <span class=\"n\">now</span><span class=\"p\">()</span>\n<span class=\"n\">Indexes</span><span class=\"p\">:</span>\n    <span class=\"nv\">\"bucardo_delta_target_unique\"</span> <span class=\"n\">btree</span> <span class=\"p\">(</span><span class=\"n\">tablename</span><span class=\"p\">,</span> <span class=\"n\">target</span><span class=\"p\">)</span>\n\n            <span class=\"k\">Table</span> <span class=\"nv\">\"bucardo.bucardo_sequences\"</span>\n    <span class=\"k\">Column</span>    <span class=\"o\">|</span>  <span class=\"k\">Type</span>   <span class=\"o\">|</span> <span class=\"k\">Collation</span> <span class=\"o\">|</span> <span class=\"k\">Nullable</span> <span class=\"o\">|</span> <span class=\"k\">Default</span>\n<span class=\"c1\">--------------+---------+-----------+----------+---------</span>\n <span class=\"n\">schemaname</span>   <span class=\"o\">|</span> <span class=\"nb\">text</span>    <span class=\"o\">|</span>           <span class=\"o\">|</span> <span class=\"k\">not</span> <span class=\"k\">null</span> <span class=\"o\">|</span>\n <span class=\"n\">seqname</span>      <span class=\"o\">|</span> <span class=\"nb\">text</span>    <span class=\"o\">|</span>           <span class=\"o\">|</span> <span class=\"k\">not</span> <span class=\"k\">null</span> <span class=\"o\">|</span>\n <span class=\"n\">syncname</span>     <span class=\"o\">|</span> <span class=\"nb\">text</span>    <span class=\"o\">|</span>           <span class=\"o\">|</span> <span class=\"k\">not</span> <span class=\"k\">null</span> <span class=\"o\">|</span>\n <span class=\"n\">targetname</span>   <span class=\"o\">|</span> <span class=\"nb\">text</span>    <span class=\"o\">|</span>           <span class=\"o\">|</span> <span class=\"k\">not</span> <span class=\"k\">null</span> <span class=\"o\">|</span>\n <span class=\"n\">last_value</span>   <span class=\"o\">|</span> <span class=\"nb\">bigint</span>  <span class=\"o\">|</span>           <span class=\"o\">|</span> <span class=\"k\">not</span> <span class=\"k\">null</span> <span class=\"o\">|</span>\n <span class=\"n\">start_value</span>  <span class=\"o\">|</span> <span class=\"nb\">bigint</span>  <span class=\"o\">|</span>           <span class=\"o\">|</span> <span class=\"k\">not</span> <span class=\"k\">null</span> <span class=\"o\">|</span>\n <span class=\"n\">increment_by</span> <span class=\"o\">|</span> <span class=\"nb\">bigint</span>  <span class=\"o\">|</span>           <span class=\"o\">|</span> <span class=\"k\">not</span> <span class=\"k\">null</span> <span class=\"o\">|</span>\n <span class=\"n\">max_value</span>    <span class=\"o\">|</span> <span class=\"nb\">bigint</span>  <span class=\"o\">|</span>           <span class=\"o\">|</span> <span class=\"k\">not</span> <span class=\"k\">null</span> <span class=\"o\">|</span>\n <span class=\"n\">min_value</span>    <span class=\"o\">|</span> <span class=\"nb\">bigint</span>  <span class=\"o\">|</span>           <span class=\"o\">|</span> <span class=\"k\">not</span> <span class=\"k\">null</span> <span class=\"o\">|</span>\n <span class=\"n\">is_cycled</span>    <span class=\"o\">|</span> <span class=\"nb\">boolean</span> <span class=\"o\">|</span>           <span class=\"o\">|</span> <span class=\"k\">not</span> <span class=\"k\">null</span> <span class=\"o\">|</span>\n <span class=\"n\">is_called</span>    <span class=\"o\">|</span> <span class=\"nb\">boolean</span> <span class=\"o\">|</span>           <span class=\"o\">|</span> <span class=\"k\">not</span> <span class=\"k\">null</span> <span class=\"o\">|</span>\n<span class=\"n\">Indexes</span><span class=\"p\">:</span>\n    <span class=\"nv\">\"bucardo_sequences_tablename\"</span> <span class=\"k\">UNIQUE</span><span class=\"p\">,</span> <span class=\"n\">btree</span> <span class=\"p\">(</span><span class=\"n\">schemaname</span><span class=\"p\">,</span> <span class=\"n\">seqname</span><span class=\"p\">,</span> <span class=\"n\">syncname</span><span class=\"p\">,</span> <span class=\"n\">targetname</span><span class=\"p\">)</span>\n\n<span class=\"k\">Index</span> <span class=\"nv\">\"bucardo.bucardo_sequences_tablename\"</span>\n   <span class=\"k\">Column</span>   <span class=\"o\">|</span> <span class=\"k\">Type</span> <span class=\"o\">|</span> <span class=\"k\">Key</span><span class=\"o\">?</span> <span class=\"o\">|</span> <span class=\"n\">Definition</span>\n<span class=\"c1\">------------+------+------+------------</span>\n <span class=\"n\">schemaname</span> <span class=\"o\">|</span> <span class=\"nb\">text</span> <span class=\"o\">|</span> <span class=\"n\">yes</span>  <span class=\"o\">|</span> <span class=\"n\">schemaname</span>\n <span class=\"n\">seqname</span>    <span class=\"o\">|</span> <span class=\"nb\">text</span> <span class=\"o\">|</span> <span class=\"n\">yes</span>  <span class=\"o\">|</span> <span class=\"n\">seqname</span>\n <span class=\"n\">syncname</span>   <span class=\"o\">|</span> <span class=\"nb\">text</span> <span class=\"o\">|</span> <span class=\"n\">yes</span>  <span class=\"o\">|</span> <span class=\"n\">syncname</span>\n <span class=\"n\">targetname</span> <span class=\"o\">|</span> <span class=\"nb\">text</span> <span class=\"o\">|</span> <span class=\"n\">yes</span>  <span class=\"o\">|</span> <span class=\"n\">targetname</span>\n<span class=\"k\">unique</span><span class=\"p\">,</span> <span class=\"n\">btree</span><span class=\"p\">,</span> <span class=\"k\">for</span> <span class=\"k\">table</span> <span class=\"nv\">\"bucardo.bucardo_sequences\"</span>\n\n                <span class=\"k\">Table</span> <span class=\"nv\">\"bucardo.bucardo_truncate_trigger\"</span>\n   <span class=\"k\">Column</span>   <span class=\"o\">|</span>           <span class=\"k\">Type</span>           <span class=\"o\">|</span> <span class=\"k\">Collation</span> <span class=\"o\">|</span> <span class=\"k\">Nullable</span> <span class=\"o\">|</span> <span class=\"k\">Default</span>\n<span class=\"c1\">------------+--------------------------+-----------+----------+---------</span>\n <span class=\"n\">tablename</span>  <span class=\"o\">|</span> <span class=\"n\">oid</span>                      <span class=\"o\">|</span>           <span class=\"o\">|</span> <span class=\"k\">not</span> <span class=\"k\">null</span> <span class=\"o\">|</span>\n <span class=\"n\">sname</span>      <span class=\"o\">|</span> <span class=\"nb\">text</span>                     <span class=\"o\">|</span>           <span class=\"o\">|</span> <span class=\"k\">not</span> <span class=\"k\">null</span> <span class=\"o\">|</span>\n <span class=\"n\">tname</span>      <span class=\"o\">|</span> <span class=\"nb\">text</span>                     <span class=\"o\">|</span>           <span class=\"o\">|</span> <span class=\"k\">not</span> <span class=\"k\">null</span> <span class=\"o\">|</span>\n <span class=\"n\">sync</span>       <span class=\"o\">|</span> <span class=\"nb\">text</span>                     <span class=\"o\">|</span>           <span class=\"o\">|</span> <span class=\"k\">not</span> <span class=\"k\">null</span> <span class=\"o\">|</span>\n <span class=\"n\">replicated</span> <span class=\"o\">|</span> <span class=\"nb\">timestamp</span> <span class=\"k\">with</span> <span class=\"nb\">time</span> <span class=\"k\">zone</span> <span class=\"o\">|</span>           <span class=\"o\">|</span>          <span class=\"o\">|</span>\n <span class=\"n\">cdate</span>      <span class=\"o\">|</span> <span class=\"nb\">timestamp</span> <span class=\"k\">with</span> <span class=\"nb\">time</span> <span class=\"k\">zone</span> <span class=\"o\">|</span>           <span class=\"o\">|</span> <span class=\"k\">not</span> <span class=\"k\">null</span> <span class=\"o\">|</span> <span class=\"n\">now</span><span class=\"p\">()</span>\n<span class=\"n\">Indexes</span><span class=\"p\">:</span>\n    <span class=\"nv\">\"bucardo_truncate_trigger_index\"</span> <span class=\"n\">btree</span> <span class=\"p\">(</span><span class=\"n\">sync</span><span class=\"p\">,</span> <span class=\"n\">tablename</span><span class=\"p\">)</span> <span class=\"k\">WHERE</span> <span class=\"n\">replicated</span> <span class=\"k\">IS</span> <span class=\"k\">NULL</span>\n\n<span class=\"k\">Index</span> <span class=\"nv\">\"bucardo.bucardo_truncate_trigger_index\"</span>\n  <span class=\"k\">Column</span>   <span class=\"o\">|</span> <span class=\"k\">Type</span> <span class=\"o\">|</span> <span class=\"k\">Key</span><span class=\"o\">?</span> <span class=\"o\">|</span> <span class=\"n\">Definition</span>\n<span class=\"c1\">-----------+------+------+------------</span>\n <span class=\"n\">sync</span>      <span class=\"o\">|</span> <span class=\"nb\">text</span> <span class=\"o\">|</span> <span class=\"n\">yes</span>  <span class=\"o\">|</span> <span class=\"n\">sync</span>\n <span class=\"n\">tablename</span> <span class=\"o\">|</span> <span class=\"n\">oid</span>  <span class=\"o\">|</span> <span class=\"n\">yes</span>  <span class=\"o\">|</span> <span class=\"n\">tablename</span>\n<span class=\"n\">btree</span><span class=\"p\">,</span> <span class=\"k\">for</span> <span class=\"k\">table</span> <span class=\"nv\">\"bucardo.bucardo_truncate_trigger\"</span><span class=\"p\">,</span> <span class=\"n\">predicate</span> <span class=\"p\">(</span><span class=\"n\">replicated</span> <span class=\"k\">IS</span> <span class=\"k\">NULL</span><span class=\"p\">)</span>\n\n              <span class=\"k\">Table</span> <span class=\"nv\">\"bucardo.bucardo_truncate_trigger_log\"</span>\n   <span class=\"k\">Column</span>   <span class=\"o\">|</span>           <span class=\"k\">Type</span>           <span class=\"o\">|</span> <span class=\"k\">Collation</span> <span class=\"o\">|</span> <span class=\"k\">Nullable</span> <span class=\"o\">|</span> <span class=\"k\">Default</span>\n<span class=\"c1\">------------+--------------------------+-----------+----------+---------</span>\n <span class=\"n\">tablename</span>  <span class=\"o\">|</span> <span class=\"n\">oid</span>                      <span class=\"o\">|</span>           <span class=\"o\">|</span> <span class=\"k\">not</span> <span class=\"k\">null</span> <span class=\"o\">|</span>\n <span class=\"n\">sname</span>      <span class=\"o\">|</span> <span class=\"nb\">text</span>                     <span class=\"o\">|</span>           <span class=\"o\">|</span> <span class=\"k\">not</span> <span class=\"k\">null</span> <span class=\"o\">|</span>\n <span class=\"n\">tname</span>      <span class=\"o\">|</span> <span class=\"nb\">text</span>                     <span class=\"o\">|</span>           <span class=\"o\">|</span> <span class=\"k\">not</span> <span class=\"k\">null</span> <span class=\"o\">|</span>\n <span class=\"n\">sync</span>       <span class=\"o\">|</span> <span class=\"nb\">text</span>                     <span class=\"o\">|</span>           <span class=\"o\">|</span> <span class=\"k\">not</span> <span class=\"k\">null</span> <span class=\"o\">|</span>\n <span class=\"n\">target</span>     <span class=\"o\">|</span> <span class=\"nb\">text</span>                     <span class=\"o\">|</span>           <span class=\"o\">|</span> <span class=\"k\">not</span> <span class=\"k\">null</span> <span class=\"o\">|</span>\n <span class=\"n\">replicated</span> <span class=\"o\">|</span> <span class=\"nb\">timestamp</span> <span class=\"k\">with</span> <span class=\"nb\">time</span> <span class=\"k\">zone</span> <span class=\"o\">|</span>           <span class=\"o\">|</span> <span class=\"k\">not</span> <span class=\"k\">null</span> <span class=\"o\">|</span>\n <span class=\"n\">cdate</span>      <span class=\"o\">|</span> <span class=\"nb\">timestamp</span> <span class=\"k\">with</span> <span class=\"nb\">time</span> <span class=\"k\">zone</span> <span class=\"o\">|</span>           <span class=\"o\">|</span> <span class=\"k\">not</span> <span class=\"k\">null</span> <span class=\"o\">|</span> <span class=\"n\">now</span><span class=\"p\">()</span>\n\n              <span class=\"k\">Table</span> <span class=\"nv\">\"bucardo.delta_public_display_logs\"</span>\n <span class=\"k\">Column</span>  <span class=\"o\">|</span>           <span class=\"k\">Type</span>           <span class=\"o\">|</span> <span class=\"k\">Collation</span> <span class=\"o\">|</span> <span class=\"k\">Nullable</span> <span class=\"o\">|</span> <span class=\"k\">Default</span>\n<span class=\"c1\">---------+--------------------------+-----------+----------+---------</span>\n <span class=\"n\">id</span>      <span class=\"o\">|</span> <span class=\"n\">uuid</span>                     <span class=\"o\">|</span>           <span class=\"o\">|</span>          <span class=\"o\">|</span>\n <span class=\"n\">txntime</span> <span class=\"o\">|</span> <span class=\"nb\">timestamp</span> <span class=\"k\">with</span> <span class=\"nb\">time</span> <span class=\"k\">zone</span> <span class=\"o\">|</span>           <span class=\"o\">|</span> <span class=\"k\">not</span> <span class=\"k\">null</span> <span class=\"o\">|</span> <span class=\"n\">now</span><span class=\"p\">()</span>\n<span class=\"n\">Indexes</span><span class=\"p\">:</span>\n    <span class=\"nv\">\"dex1_public_display_logs\"</span> <span class=\"n\">btree</span> <span class=\"p\">(</span><span class=\"n\">txntime</span><span class=\"p\">)</span>\n    <span class=\"nv\">\"dex2_public_display_logs\"</span> <span class=\"n\">btree</span> <span class=\"p\">(</span><span class=\"n\">id</span><span class=\"p\">)</span>\n\n                  <span class=\"k\">Table</span> <span class=\"nv\">\"bucardo.delta_public_logs\"</span>\n <span class=\"k\">Column</span>  <span class=\"o\">|</span>           <span class=\"k\">Type</span>           <span class=\"o\">|</span> <span class=\"k\">Collation</span> <span class=\"o\">|</span> <span class=\"k\">Nullable</span> <span class=\"o\">|</span> <span class=\"k\">Default</span>\n<span class=\"c1\">---------+--------------------------+-----------+----------+---------</span>\n <span class=\"n\">id</span>      <span class=\"o\">|</span> <span class=\"n\">uuid</span>                     <span class=\"o\">|</span>           <span class=\"o\">|</span>          <span class=\"o\">|</span>\n <span class=\"n\">txntime</span> <span class=\"o\">|</span> <span class=\"nb\">timestamp</span> <span class=\"k\">with</span> <span class=\"nb\">time</span> <span class=\"k\">zone</span> <span class=\"o\">|</span>           <span class=\"o\">|</span> <span class=\"k\">not</span> <span class=\"k\">null</span> <span class=\"o\">|</span> <span class=\"n\">now</span><span class=\"p\">()</span>\n<span class=\"n\">Indexes</span><span class=\"p\">:</span>\n    <span class=\"nv\">\"dex1_public_logs\"</span> <span class=\"n\">btree</span> <span class=\"p\">(</span><span class=\"n\">txntime</span><span class=\"p\">)</span>\n    <span class=\"nv\">\"dex2_public_logs\"</span> <span class=\"n\">btree</span> <span class=\"p\">(</span><span class=\"n\">id</span><span class=\"p\">)</span>\n\n        <span class=\"k\">Index</span> <span class=\"nv\">\"bucardo.dex1_public_display_logs\"</span>\n <span class=\"k\">Column</span>  <span class=\"o\">|</span>           <span class=\"k\">Type</span>           <span class=\"o\">|</span> <span class=\"k\">Key</span><span class=\"o\">?</span> <span class=\"o\">|</span> <span class=\"n\">Definition</span>\n<span class=\"c1\">---------+--------------------------+------+------------</span>\n <span class=\"n\">txntime</span> <span class=\"o\">|</span> <span class=\"nb\">timestamp</span> <span class=\"k\">with</span> <span class=\"nb\">time</span> <span class=\"k\">zone</span> <span class=\"o\">|</span> <span class=\"n\">yes</span>  <span class=\"o\">|</span> <span class=\"n\">txntime</span>\n<span class=\"n\">btree</span><span class=\"p\">,</span> <span class=\"k\">for</span> <span class=\"k\">table</span> <span class=\"nv\">\"bucardo.delta_public_display_logs\"</span>\n\n            <span class=\"k\">Index</span> <span class=\"nv\">\"bucardo.dex1_public_logs\"</span>\n <span class=\"k\">Column</span>  <span class=\"o\">|</span>           <span class=\"k\">Type</span>           <span class=\"o\">|</span> <span class=\"k\">Key</span><span class=\"o\">?</span> <span class=\"o\">|</span> <span class=\"n\">Definition</span>\n<span class=\"c1\">---------+--------------------------+------+------------</span>\n <span class=\"n\">txntime</span> <span class=\"o\">|</span> <span class=\"nb\">timestamp</span> <span class=\"k\">with</span> <span class=\"nb\">time</span> <span class=\"k\">zone</span> <span class=\"o\">|</span> <span class=\"n\">yes</span>  <span class=\"o\">|</span> <span class=\"n\">txntime</span>\n<span class=\"n\">btree</span><span class=\"p\">,</span> <span class=\"k\">for</span> <span class=\"k\">table</span> <span class=\"nv\">\"bucardo.delta_public_logs\"</span>\n\n<span class=\"k\">Index</span> <span class=\"nv\">\"bucardo.dex2_public_display_logs\"</span>\n <span class=\"k\">Column</span> <span class=\"o\">|</span> <span class=\"k\">Type</span> <span class=\"o\">|</span> <span class=\"k\">Key</span><span class=\"o\">?</span> <span class=\"o\">|</span> <span class=\"n\">Definition</span>\n<span class=\"c1\">--------+------+------+------------</span>\n <span class=\"n\">id</span>     <span class=\"o\">|</span> <span class=\"n\">uuid</span> <span class=\"o\">|</span> <span class=\"n\">yes</span>  <span class=\"o\">|</span> <span class=\"n\">id</span>\n<span class=\"n\">btree</span><span class=\"p\">,</span> <span class=\"k\">for</span> <span class=\"k\">table</span> <span class=\"nv\">\"bucardo.delta_public_display_logs\"</span>\n\n <span class=\"k\">Index</span> <span class=\"nv\">\"bucardo.dex2_public_logs\"</span>\n <span class=\"k\">Column</span> <span class=\"o\">|</span> <span class=\"k\">Type</span> <span class=\"o\">|</span> <span class=\"k\">Key</span><span class=\"o\">?</span> <span class=\"o\">|</span> <span class=\"n\">Definition</span>\n<span class=\"c1\">--------+------+------+------------</span>\n <span class=\"n\">id</span>     <span class=\"o\">|</span> <span class=\"n\">uuid</span> <span class=\"o\">|</span> <span class=\"n\">yes</span>  <span class=\"o\">|</span> <span class=\"n\">id</span>\n<span class=\"n\">btree</span><span class=\"p\">,</span> <span class=\"k\">for</span> <span class=\"k\">table</span> <span class=\"nv\">\"bucardo.delta_public_logs\"</span>\n\n        <span class=\"k\">Index</span> <span class=\"nv\">\"bucardo.dex3_public_display_logs\"</span>\n <span class=\"k\">Column</span>  <span class=\"o\">|</span>           <span class=\"k\">Type</span>           <span class=\"o\">|</span> <span class=\"k\">Key</span><span class=\"o\">?</span> <span class=\"o\">|</span> <span class=\"n\">Definition</span>\n<span class=\"c1\">---------+--------------------------+------+------------</span>\n <span class=\"n\">target</span>  <span class=\"o\">|</span> <span class=\"nb\">text</span>                     <span class=\"o\">|</span> <span class=\"n\">yes</span>  <span class=\"o\">|</span> <span class=\"n\">target</span>\n <span class=\"n\">txntime</span> <span class=\"o\">|</span> <span class=\"nb\">timestamp</span> <span class=\"k\">with</span> <span class=\"nb\">time</span> <span class=\"k\">zone</span> <span class=\"o\">|</span> <span class=\"n\">yes</span>  <span class=\"o\">|</span> <span class=\"n\">txntime</span>\n<span class=\"n\">btree</span><span class=\"p\">,</span> <span class=\"k\">for</span> <span class=\"k\">table</span> <span class=\"nv\">\"bucardo.track_public_display_logs\"</span>\n\n            <span class=\"k\">Index</span> <span class=\"nv\">\"bucardo.dex3_public_logs\"</span>\n <span class=\"k\">Column</span>  <span class=\"o\">|</span>           <span class=\"k\">Type</span>           <span class=\"o\">|</span> <span class=\"k\">Key</span><span class=\"o\">?</span> <span class=\"o\">|</span> <span class=\"n\">Definition</span>\n<span class=\"c1\">---------+--------------------------+------+------------</span>\n <span class=\"n\">target</span>  <span class=\"o\">|</span> <span class=\"nb\">text</span>                     <span class=\"o\">|</span> <span class=\"n\">yes</span>  <span class=\"o\">|</span> <span class=\"n\">target</span>\n <span class=\"n\">txntime</span> <span class=\"o\">|</span> <span class=\"nb\">timestamp</span> <span class=\"k\">with</span> <span class=\"nb\">time</span> <span class=\"k\">zone</span> <span class=\"o\">|</span> <span class=\"n\">yes</span>  <span class=\"o\">|</span> <span class=\"n\">txntime</span>\n<span class=\"n\">btree</span><span class=\"p\">,</span> <span class=\"k\">for</span> <span class=\"k\">table</span> <span class=\"nv\">\"bucardo.track_public_logs\"</span>\n\n         <span class=\"n\">Unlogged</span> <span class=\"k\">table</span> <span class=\"nv\">\"bucardo.stage_public_display_logs\"</span>\n <span class=\"k\">Column</span>  <span class=\"o\">|</span>           <span class=\"k\">Type</span>           <span class=\"o\">|</span> <span class=\"k\">Collation</span> <span class=\"o\">|</span> <span class=\"k\">Nullable</span> <span class=\"o\">|</span> <span class=\"k\">Default</span>\n<span class=\"c1\">---------+--------------------------+-----------+----------+---------</span>\n <span class=\"n\">txntime</span> <span class=\"o\">|</span> <span class=\"nb\">timestamp</span> <span class=\"k\">with</span> <span class=\"nb\">time</span> <span class=\"k\">zone</span> <span class=\"o\">|</span>           <span class=\"o\">|</span>          <span class=\"o\">|</span>\n <span class=\"n\">target</span>  <span class=\"o\">|</span> <span class=\"nb\">text</span>                     <span class=\"o\">|</span>           <span class=\"o\">|</span>          <span class=\"o\">|</span>\n\n             <span class=\"n\">Unlogged</span> <span class=\"k\">table</span> <span class=\"nv\">\"bucardo.stage_public_logs\"</span>\n <span class=\"k\">Column</span>  <span class=\"o\">|</span>           <span class=\"k\">Type</span>           <span class=\"o\">|</span> <span class=\"k\">Collation</span> <span class=\"o\">|</span> <span class=\"k\">Nullable</span> <span class=\"o\">|</span> <span class=\"k\">Default</span>\n<span class=\"c1\">---------+--------------------------+-----------+----------+---------</span>\n <span class=\"n\">txntime</span> <span class=\"o\">|</span> <span class=\"nb\">timestamp</span> <span class=\"k\">with</span> <span class=\"nb\">time</span> <span class=\"k\">zone</span> <span class=\"o\">|</span>           <span class=\"o\">|</span>          <span class=\"o\">|</span>\n <span class=\"n\">target</span>  <span class=\"o\">|</span> <span class=\"nb\">text</span>                     <span class=\"o\">|</span>           <span class=\"o\">|</span>          <span class=\"o\">|</span>\n\n              <span class=\"k\">Table</span> <span class=\"nv\">\"bucardo.track_public_display_logs\"</span>\n <span class=\"k\">Column</span>  <span class=\"o\">|</span>           <span class=\"k\">Type</span>           <span class=\"o\">|</span> <span class=\"k\">Collation</span> <span class=\"o\">|</span> <span class=\"k\">Nullable</span> <span class=\"o\">|</span> <span class=\"k\">Default</span>\n<span class=\"c1\">---------+--------------------------+-----------+----------+---------</span>\n <span class=\"n\">txntime</span> <span class=\"o\">|</span> <span class=\"nb\">timestamp</span> <span class=\"k\">with</span> <span class=\"nb\">time</span> <span class=\"k\">zone</span> <span class=\"o\">|</span>           <span class=\"o\">|</span>          <span class=\"o\">|</span>\n <span class=\"n\">target</span>  <span class=\"o\">|</span> <span class=\"nb\">text</span>                     <span class=\"o\">|</span>           <span class=\"o\">|</span>          <span class=\"o\">|</span>\n<span class=\"n\">Indexes</span><span class=\"p\">:</span>\n    <span class=\"nv\">\"dex3_public_display_logs\"</span> <span class=\"n\">btree</span> <span class=\"p\">(</span><span class=\"n\">target</span> <span class=\"n\">text_pattern_ops</span><span class=\"p\">,</span> <span class=\"n\">txntime</span><span class=\"p\">)</span>\n\n                  <span class=\"k\">Table</span> <span class=\"nv\">\"bucardo.track_public_logs\"</span>\n <span class=\"k\">Column</span>  <span class=\"o\">|</span>           <span class=\"k\">Type</span>           <span class=\"o\">|</span> <span class=\"k\">Collation</span> <span class=\"o\">|</span> <span class=\"k\">Nullable</span> <span class=\"o\">|</span> <span class=\"k\">Default</span>\n<span class=\"c1\">---------+--------------------------+-----------+----------+---------</span>\n <span class=\"n\">txntime</span> <span class=\"o\">|</span> <span class=\"nb\">timestamp</span> <span class=\"k\">with</span> <span class=\"nb\">time</span> <span class=\"k\">zone</span> <span class=\"o\">|</span>           <span class=\"o\">|</span>          <span class=\"o\">|</span>\n <span class=\"n\">target</span>  <span class=\"o\">|</span> <span class=\"nb\">text</span>                     <span class=\"o\">|</span>           <span class=\"o\">|</span>          <span class=\"o\">|</span>\n<span class=\"n\">Indexes</span><span class=\"p\">:</span>\n    <span class=\"nv\">\"dex3_public_logs\"</span> <span class=\"n\">btree</span> <span class=\"p\">(</span><span class=\"n\">target</span> <span class=\"n\">text_pattern_ops</span><span class=\"p\">,</span> <span class=\"n\">txntime</span><span class=\"p\">)</span>\n</code></pre></div></div>\n</details>\n<h2 data-sourcepos=\"253:1-253:40\" id=\"0-5-0\" name=\"0-5-0\"><a class=\"anchor\" id=\"ではdumpはどうすれば良いか\" name=\"ではdumpはどうすれば良いか\" href=\"#ではdumpはどうすれば良いか\" data-position=\"0-5-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"ではdumpはどうすれば良いか\"> &gt; ではdumpはどうすれば良いか</span></a>ではdumpはどうすれば良いか</h2>\n<p data-sourcepos=\"255:1-256:54\">移行する必要のあるpublicスキーマのみを指定すると、bucardoスキーマやheroku_ext、datadogなどを除外できる。<br>\n以下はstaging heroku dbに対して実行するdump</p>\n<div class=\"code-block\" data-sourcepos=\"258:1-265:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>pg_dump <span class=\"nt\">--format</span><span class=\"o\">=</span>custom <span class=\"se\">\\</span>\n    <span class=\"nt\">--verbose</span> <span class=\"nt\">--data-only</span> <span class=\"se\">\\</span>\n    <span class=\"nt\">--schema</span><span class=\"o\">=</span>public <span class=\"se\">\\ </span><span class=\"c\">#ここでpublicを指定する</span>\n    <span class=\"nt\">--exclude-table</span><span class=\"o\">=</span>logs <span class=\"nt\">--exclude-table</span><span class=\"o\">=</span>display_logs <span class=\"se\">\\</span>\n    <span class=\"nt\">-h</span> ec2-35-75-149-42.ap-northeast-1.compute.amazonaws.com <span class=\"nt\">-U</span> u9sa4ppg0l8rjd <span class=\"nt\">-p</span> 5432 <span class=\"nt\">-d</span> d675i6ifmkurp3 <span class=\"se\">\\</span>\n    <span class=\"o\">&gt;</span> main_data.dump\n</code></pre></div></div>\n<h3 data-sourcepos=\"267:1-267:51\" id=\"0-5-1\" name=\"0-5-1\"><a class=\"anchor\" id=\"staging heroku dbに対して上記実行結果\" name=\"staging heroku dbに対して上記実行結果\" href=\"#staging heroku dbに対して上記実行結果\" data-position=\"0-5-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"staging heroku dbに対して上記実行結果\"> &gt; staging heroku dbに対して上記実行結果</span></a>staging heroku dbに対して上記実行結果</h3>\n<details>\n<summary>dumpそのものは成功</summary>\n<div class=\"code-block\" data-sourcepos=\"271:1-583:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code><span class=\"nv\">$ </span>pg_dump <span class=\"nt\">--format</span><span class=\"o\">=</span>custom <span class=\"nt\">--verbose</span> <span class=\"nt\">--data-only</span> <span class=\"nt\">--schema</span><span class=\"o\">=</span>public <span class=\"nt\">--exclude-table</span><span class=\"o\">=</span>logs <span class=\"nt\">--exclude-table</span><span class=\"o\">=</span>display-logs <span class=\"nt\">-h</span> ec2-35-75-149-42.ap-northeast-1.compute.amazonaws.com <span class=\"nt\">-U</span> u9sa4ppg0l8rjd <span class=\"nt\">-p</span> 5432 <span class=\"nt\">-d</span> d675i6ifmkurp3 <span class=\"o\">&gt;</span> main_data.dump\nPassword:\npg_dump: last built-in OID is 16383\npg_dump: reading extensions\npg_dump: identifying extension members\npg_dump: reading schemas\npg_dump: reading user-defined tables\npg_dump: reading user-defined functions\npg_dump: reading user-defined types\npg_dump: reading procedural languages\npg_dump: reading user-defined aggregate functions\npg_dump: reading user-defined operators\npg_dump: reading user-defined access methods\npg_dump: reading user-defined operator classes\npg_dump: reading user-defined operator families\npg_dump: reading user-defined text search parsers\npg_dump: reading user-defined text search templates\npg_dump: reading user-defined text search dictionaries\npg_dump: reading user-defined text search configurations\npg_dump: reading user-defined foreign-data wrappers\npg_dump: reading user-defined foreign servers\npg_dump: reading default privileges\npg_dump: reading user-defined collations\npg_dump: reading user-defined conversions\npg_dump: reading <span class=\"nb\">type </span>casts\npg_dump: reading transforms\npg_dump: reading table inheritance information\npg_dump: reading event triggers\npg_dump: finding extension tables\npg_dump: finding inheritance relationships\npg_dump: reading column info <span class=\"k\">for </span>interesting tables\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.active_storage_attachments\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.active_storage_blobs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.active_storage_variant_records\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.ar_internal_metadata\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.autolock_schedules\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.cards\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.command_logs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.dailies\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.display_logs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.door_mode_changed_histories\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.durations\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.entrance_block_fob_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.entrance_block_knight_cards\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.entrance_fob_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.entrance_invitations\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.entrance_knight_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.entrance_knight_pins\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.entrance_lock_settings\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.entrance_locks\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.entrance_master_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.entrance_resident_guest_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.entrance_resident_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.family_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.fob_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.fobs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.guest_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.hubs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.invitations\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.json_web_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.knight_cards\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.knight_commands\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.knight_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.knight_logs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.knight_pins\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.knights\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.lock_settings\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.lock_webhook_tokens\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.locks\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.managers\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.master_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.mst_display_logs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.relationships\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.resident_guest_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.resident_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.schema_migrations\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.term_of_validities\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.users\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.webhook_tokens\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.webhooks\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.weeklies\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.wena_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.wenas\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.laresia_pins\"</span>\npg_dump: flagging inherited columns <span class=\"k\">in </span>subtables\npg_dump: reading indexes\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.active_storage_attachments\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.active_storage_blobs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.active_storage_variant_records\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.ar_internal_metadata\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.autolock_schedules\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.cards\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.command_logs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.dailies\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.display_logs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.door_mode_changed_histories\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.durations\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_block_fob_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_block_knight_cards\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_fob_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_invitations\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_knight_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_knight_pins\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_lock_settings\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_locks\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_master_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_resident_guest_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_resident_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.family_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.fob_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.fobs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.guest_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.hubs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.invitations\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.json_web_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_cards\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_commands\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_logs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_pins\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.knights\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.lock_settings\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.lock_webhook_tokens\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.locks\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.managers\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.master_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.mst_display_logs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.relationships\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.resident_guest_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.resident_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.schema_migrations\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.term_of_validities\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.users\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.webhook_tokens\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.webhooks\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.weeklies\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.wena_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.wenas\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.laresia_pins\"</span>\npg_dump: flagging indexes <span class=\"k\">in </span>partitioned tables\npg_dump: reading extended statistics\npg_dump: reading constraints\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.active_storage_attachments\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.active_storage_blobs\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.active_storage_variant_records\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.ar_internal_metadata\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.autolock_schedules\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.cards\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.command_logs\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.dailies\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.display_logs\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.door_mode_changed_histories\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.durations\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_block_fob_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_block_knight_cards\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_fob_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_invitations\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_knight_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_knight_pins\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_lock_settings\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_locks\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_master_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_resident_guest_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_resident_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.family_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.fob_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.fobs\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.guest_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.hubs\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.invitations\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.json_web_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_cards\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_logs\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_pins\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.knights\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.lock_settings\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.lock_webhook_tokens\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.locks\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.managers\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.master_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.mst_display_logs\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.relationships\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.resident_guest_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.resident_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.schema_migrations\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.term_of_validities\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.users\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.webhook_tokens\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.webhooks\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.weeklies\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.wena_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.wenas\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.laresia_pins\"</span>\npg_dump: reading triggers\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.active_storage_attachments\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.active_storage_blobs\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.active_storage_variant_records\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.ar_internal_metadata\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.autolock_schedules\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.cards\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.command_logs\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.dailies\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.display_logs\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.door_mode_changed_histories\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.durations\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_block_fob_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_block_knight_cards\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_fob_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_invitations\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_knight_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_knight_pins\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_lock_settings\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_locks\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_master_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_resident_guest_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_resident_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.family_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.fob_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.fobs\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.guest_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.hubs\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.invitations\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.json_web_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_cards\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_logs\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_pins\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.knights\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.lock_settings\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.lock_webhook_tokens\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.locks\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.managers\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.master_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.mst_display_logs\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.relationships\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.resident_guest_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.resident_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.schema_migrations\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.term_of_validities\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.users\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.webhook_tokens\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.webhooks\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.weeklies\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.wena_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.wenas\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.laresia_pins\"</span>\npg_dump: reading rewrite rules\npg_dump: reading policies\npg_dump: reading row-level security policies\npg_dump: reading publications\npg_dump: reading publication membership\npg_dump: reading subscriptions\npg_dump: reading dependency data\npg_dump: saving encoding <span class=\"o\">=</span> UTF8\npg_dump: saving standard_conforming_strings <span class=\"o\">=</span> on\npg_dump: saving search_path <span class=\"o\">=</span>\npg_dump: saving database definition\npg_dump: dumping contents of table <span class=\"s2\">\"public.active_storage_blobs\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.active_storage_attachments\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.active_storage_variant_records\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.ar_internal_metadata\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.locks\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.users\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.master_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.autolock_schedules\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.cards\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.hubs\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.command_logs\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.term_of_validities\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.dailies\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.mst_display_logs\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.display_logs\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.door_mode_changed_histories\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.durations\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.entrance_locks\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.entrance_master_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.fobs\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.fob_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.entrance_fob_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.entrance_block_fob_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.knights\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.entrance_knight_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.knight_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.knight_cards\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.entrance_block_knight_cards\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.invitations\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.entrance_invitations\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.entrance_knight_pins\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.entrance_lock_settings\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.resident_guest_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.entrance_resident_guest_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.resident_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.entrance_resident_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.family_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.guest_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.json_web_keys\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.knight_commands\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.knight_logs\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.knight_pins\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.laresia_pins\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.lock_settings\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.webhook_tokens\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.lock_webhook_tokens\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.managers\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.relationships\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.schema_migrations\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.webhooks\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.weeklies\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.wenas\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.wena_keys\"</span>\n</code></pre></div></div>\n</details>\n<h2 data-sourcepos=\"586:1-586:103\" id=\"0-6-0\" name=\"0-6-0\"><a class=\"anchor\" id=\"--schemaオプションを有効にしてローカルでmain_dataのdumpとrestoreをやってみる\" name=\"--schemaオプションを有効にしてローカルでmain_dataのdumpとrestoreをやってみる\" href=\"#--schemaオプションを有効にしてローカルでmain_dataのdumpとrestoreをやってみる\" data-position=\"0-6-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"--schemaオプションを有効にしてローカルでmain_dataのdumpとrestoreをやってみる\"> &gt; --schemaオプションを有効にしてローカルでmain_dataのdumpとrestoreをやってみる</span></a>--schemaオプションを有効にしてローカルでmain_dataのdumpとrestoreをやってみる</h2>\n<h3 data-sourcepos=\"588:1-588:32\" id=\"0-6-1\" name=\"0-6-1\"><a class=\"anchor\" id=\"テーブルスキーマdump\" name=\"テーブルスキーマdump\" href=\"#テーブルスキーマdump\" data-position=\"0-6-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"テーブルスキーマdump\"> &gt; テーブルスキーマdump</span></a>テーブルスキーマdump</h3>\n<details>\n<summary>成功</summary>\n<div class=\"code-block\" data-sourcepos=\"593:1-902:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>root@c4e9fe68d14c:/# pg_dump <span class=\"nt\">--format</span><span class=\"o\">=</span>custom <span class=\"nt\">--verbose</span> <span class=\"nt\">--schema-only</span> <span class=\"nt\">-h</span> source-db <span class=\"nt\">-d</span> postgres <span class=\"nt\">-U</span> postgres <span class=\"nt\">-p</span> 5432 <span class=\"o\">&gt;</span>heroku_tables.dump\nPassword:\npg_dump: last built-in OID is 16383\npg_dump: reading extensions\npg_dump: identifying extension members\npg_dump: reading schemas\npg_dump: reading user-defined tables\npg_dump: reading user-defined functions\npg_dump: reading user-defined types\npg_dump: reading procedural languages\npg_dump: reading user-defined aggregate functions\npg_dump: reading user-defined operators\npg_dump: reading user-defined access methods\npg_dump: reading user-defined operator classes\npg_dump: reading user-defined operator families\npg_dump: reading user-defined text search parsers\npg_dump: reading user-defined text search templates\npg_dump: reading user-defined text search dictionaries\npg_dump: reading user-defined text search configurations\npg_dump: reading user-defined foreign-data wrappers\npg_dump: reading user-defined foreign servers\npg_dump: reading default privileges\npg_dump: reading user-defined collations\npg_dump: reading user-defined conversions\npg_dump: reading <span class=\"nb\">type </span>casts\npg_dump: reading transforms\npg_dump: reading table inheritance information\npg_dump: reading event triggers\npg_dump: finding extension tables\npg_dump: finding inheritance relationships\npg_dump: reading column info <span class=\"k\">for </span>interesting tables\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.pg_stat_statements_info\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.pg_stat_statements\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.active_storage_attachments\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.active_storage_attachments\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.active_storage_blobs\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.active_storage_blobs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.active_storage_variant_records\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.active_storage_variant_records\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.ar_internal_metadata\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.autolock_schedules\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.autolock_schedules\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.cards\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.cards\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.command_logs\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.command_logs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.dailies\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.dailies\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.display_logs\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.display_logs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.door_mode_changed_histories\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.door_mode_changed_histories\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.durations\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.durations\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.entrance_block_fob_keys\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.entrance_block_fob_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.entrance_block_knight_cards\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.entrance_block_knight_cards\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.entrance_fob_keys\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.entrance_fob_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.entrance_invitations\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.entrance_invitations\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.entrance_knight_keys\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.entrance_knight_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.entrance_knight_pins\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.entrance_knight_pins\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.entrance_lock_settings\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.entrance_lock_settings\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.entrance_locks\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.entrance_locks\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.entrance_master_keys\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.entrance_master_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.entrance_resident_guest_keys\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.entrance_resident_guest_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.entrance_resident_keys\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.entrance_resident_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.family_keys\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.family_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.fob_keys\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.fob_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.fobs\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.fobs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.guest_keys\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.guest_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.hubs\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.hubs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.invitations\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.invitations\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.json_web_keys\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.json_web_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.knight_cards\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.knight_cards\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.knight_commands\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.knight_commands\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.knight_keys\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.knight_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.knight_logs\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.knight_logs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.knight_pins\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.knight_pins\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.knights\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.knights\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.laresia_pins\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.laresia_pins\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.lock_settings\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.lock_settings\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.lock_webhook_tokens\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.lock_webhook_tokens\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.locks\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.locks\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.logs\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.logs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.managers\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.managers\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.master_keys\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.master_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.mst_display_logs\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.mst_display_logs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.relationships\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.relationships\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.resident_guest_keys\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.resident_guest_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.resident_keys\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.resident_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.schema_migrations\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.term_of_validities\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.term_of_validities\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.users\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.users\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.webhook_tokens\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.webhook_tokens\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.webhooks\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.webhooks\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.weeklies\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.weeklies\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.wena_keys\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.wena_keys\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.wenas\"</span>\npg_dump: finding default expressions of table <span class=\"s2\">\"public.wenas\"</span>\npg_dump: flagging inherited columns <span class=\"k\">in </span>subtables\npg_dump: reading indexes\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.active_storage_attachments\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.active_storage_blobs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.active_storage_variant_records\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.ar_internal_metadata\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.autolock_schedules\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.cards\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.command_logs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.dailies\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.display_logs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.door_mode_changed_histories\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.durations\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_block_fob_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_block_knight_cards\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_fob_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_invitations\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_knight_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_knight_pins\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_lock_settings\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_locks\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_master_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_resident_guest_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_resident_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.family_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.fob_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.fobs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.guest_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.hubs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.invitations\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.json_web_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_cards\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_commands\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_logs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_pins\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.knights\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.laresia_pins\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.lock_settings\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.lock_webhook_tokens\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.locks\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.logs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.managers\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.master_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.mst_display_logs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.relationships\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.resident_guest_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.resident_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.schema_migrations\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.term_of_validities\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.users\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.webhook_tokens\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.webhooks\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.weeklies\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.wena_keys\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.wenas\"</span>\npg_dump: flagging indexes <span class=\"k\">in </span>partitioned tables\npg_dump: reading extended statistics\npg_dump: reading constraints\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.active_storage_attachments\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.active_storage_blobs\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.active_storage_variant_records\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.autolock_schedules\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.command_logs\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.dailies\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.display_logs\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.door_mode_changed_histories\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.durations\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_block_fob_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_block_knight_cards\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_fob_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_invitations\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_knight_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_knight_pins\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_lock_settings\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_locks\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_master_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_resident_guest_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_resident_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.family_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.fob_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.fobs\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.guest_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.hubs\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.invitations\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_cards\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_logs\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_pins\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.knights\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.laresia_pins\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.lock_settings\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.lock_webhook_tokens\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.locks\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.logs\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.managers\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.master_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.mst_display_logs\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.relationships\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.resident_guest_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.resident_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.term_of_validities\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.users\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.webhook_tokens\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.webhooks\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.weeklies\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.wena_keys\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.wenas\"</span>\npg_dump: reading triggers\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.active_storage_attachments\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.active_storage_blobs\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.active_storage_variant_records\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.autolock_schedules\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.command_logs\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.dailies\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.display_logs\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.door_mode_changed_histories\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.durations\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_block_fob_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_block_knight_cards\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_fob_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_invitations\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_knight_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_knight_pins\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_lock_settings\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_locks\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_master_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_resident_guest_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.entrance_resident_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.family_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.fob_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.fobs\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.guest_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.hubs\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.invitations\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_cards\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_logs\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.knight_pins\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.knights\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.laresia_pins\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.lock_settings\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.lock_webhook_tokens\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.locks\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.logs\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.managers\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.master_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.mst_display_logs\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.relationships\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.resident_guest_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.resident_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.term_of_validities\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.users\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.webhook_tokens\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.webhooks\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.weeklies\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.wena_keys\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.wenas\"</span>\npg_dump: reading rewrite rules\npg_dump: reading policies\npg_dump: reading row-level security policies\npg_dump: reading publications\npg_dump: reading publication membership\npg_dump: reading subscriptions\npg_dump: reading dependency data\npg_dump: saving encoding <span class=\"o\">=</span> UTF8\npg_dump: saving standard_conforming_strings <span class=\"o\">=</span> on\npg_dump: saving search_path <span class=\"o\">=</span>\npg_dump: saving database definition\n</code></pre></div></div>\n</details>\n<h3 data-sourcepos=\"906:1-906:35\" id=\"0-6-2\" name=\"0-6-2\"><a class=\"anchor\" id=\"テーブルスキーマrestore\" name=\"テーブルスキーマrestore\" href=\"#テーブルスキーマrestore\" data-position=\"0-6-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"テーブルスキーマrestore\"> &gt; テーブルスキーマrestore</span></a>テーブルスキーマrestore</h3>\n<details>\n<summary>成功</summary>\n<div class=\"code-block\" data-sourcepos=\"911:1-1231:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>root@c4e9fe68d14c:/# pg_restore <span class=\"nt\">--verbose</span> <span class=\"nt\">--schema-only</span> <span class=\"nt\">-h</span> target-db <span class=\"nt\">-U</span> postgres <span class=\"nt\">-d</span> postgres <span class=\"nt\">-p</span> 5432 heroku_tables.dump\npg_restore: connecting to database <span class=\"k\">for </span>restore\nPassword:\npg_restore: creating EXTENSION <span class=\"s2\">\"pg_stat_statements\"</span>\npg_restore: creating COMMENT <span class=\"s2\">\"EXTENSION pg_stat_statements\"</span>\npg_restore: creating EXTENSION <span class=\"s2\">\"pgcrypto\"</span>\npg_restore: creating COMMENT <span class=\"s2\">\"EXTENSION pgcrypto\"</span>\npg_restore: creating TYPE <span class=\"s2\">\"public.command_log_remote_source_type\"</span>\npg_restore: creating TYPE <span class=\"s2\">\"public.display_log_lock_position\"</span>\npg_restore: creating TYPE <span class=\"s2\">\"public.display_log_open_close_type\"</span>\npg_restore: creating TYPE <span class=\"s2\">\"public.door_mode_changed_history_door_mode\"</span>\npg_restore: creating TYPE <span class=\"s2\">\"public.knight_command_remote_source_type\"</span>\npg_restore: creating TYPE <span class=\"s2\">\"public.mst_display_log_open_close_type\"</span>\npg_restore: creating TYPE <span class=\"s2\">\"public.mst_display_log_operation_type\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.active_storage_attachments\"</span>\npg_restore: creating SEQUENCE <span class=\"s2\">\"public.active_storage_attachments_id_seq\"</span>\npg_restore: creating SEQUENCE OWNED BY <span class=\"s2\">\"public.active_storage_attachments_id_seq\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.active_storage_blobs\"</span>\npg_restore: creating SEQUENCE <span class=\"s2\">\"public.active_storage_blobs_id_seq\"</span>\npg_restore: creating SEQUENCE OWNED BY <span class=\"s2\">\"public.active_storage_blobs_id_seq\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.active_storage_variant_records\"</span>\npg_restore: creating SEQUENCE <span class=\"s2\">\"public.active_storage_variant_records_id_seq\"</span>\npg_restore: creating SEQUENCE OWNED BY <span class=\"s2\">\"public.active_storage_variant_records_id_seq\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.ar_internal_metadata\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.autolock_schedules\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.cards\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.command_logs\"</span>\npg_restore: creating COMMENT <span class=\"s2\">\"public.COLUMN command_logs.notification_id\"</span>\npg_restore: creating COMMENT <span class=\"s2\">\"public.COLUMN command_logs.remote_source_type\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.dailies\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.display_logs\"</span>\npg_restore: creating COMMENT <span class=\"s2\">\"public.COLUMN display_logs.open_close_type\"</span>\npg_restore: creating COMMENT <span class=\"s2\">\"public.COLUMN display_logs.lock_position\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.door_mode_changed_histories\"</span>\npg_restore: creating COMMENT <span class=\"s2\">\"public.COLUMN door_mode_changed_histories.door_mode\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.durations\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.entrance_block_fob_keys\"</span>\npg_restore: creating COMMENT <span class=\"s2\">\"public.COLUMN entrance_block_fob_keys.fob_type\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.entrance_block_knight_cards\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.entrance_fob_keys\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.entrance_invitations\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.entrance_knight_keys\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.entrance_knight_pins\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.entrance_lock_settings\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.entrance_locks\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.entrance_master_keys\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.entrance_resident_guest_keys\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.entrance_resident_keys\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.family_keys\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.fob_keys\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.fobs\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.guest_keys\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.hubs\"</span>\npg_restore: creating COMMENT <span class=\"s2\">\"public.COLUMN hubs.is_roomon_manager_hub\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.invitations\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.json_web_keys\"</span>\npg_restore: creating SEQUENCE <span class=\"s2\">\"public.json_web_keys_id_seq\"</span>\npg_restore: creating SEQUENCE OWNED BY <span class=\"s2\">\"public.json_web_keys_id_seq\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.knight_cards\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.knight_commands\"</span>\npg_restore: creating COMMENT <span class=\"s2\">\"public.COLUMN knight_commands.notification_id\"</span>\npg_restore: creating COMMENT <span class=\"s2\">\"public.COLUMN knight_commands.remote_source_type\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.knight_keys\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.knight_logs\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.knight_pins\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.knights\"</span>\npg_restore: creating COMMENT <span class=\"s2\">\"public.COLUMN knights.model_id\"</span>\npg_restore: creating COMMENT <span class=\"s2\">\"public.COLUMN knights.mode\"</span>\npg_restore: creating COMMENT <span class=\"s2\">\"public.COLUMN knights.relay_on_seconds\"</span>\npg_restore: creating COMMENT <span class=\"s2\">\"public.COLUMN knights.remote_setting_mode_adv_interval\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.laresia_pins\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.lock_settings\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.lock_webhook_tokens\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.locks\"</span>\npg_restore: creating COMMENT <span class=\"s2\">\"public.COLUMN locks.model_id\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.logs\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.managers\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.master_keys\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.mst_display_logs\"</span>\npg_restore: creating COMMENT <span class=\"s2\">\"public.COLUMN mst_display_logs.open_close_type\"</span>\npg_restore: creating COMMENT <span class=\"s2\">\"public.COLUMN mst_display_logs.operation_type\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.relationships\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.resident_guest_keys\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.resident_keys\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.schema_migrations\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.term_of_validities\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.users\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.webhook_tokens\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.webhooks\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.weeklies\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.wena_keys\"</span>\npg_restore: creating TABLE <span class=\"s2\">\"public.wenas\"</span>\npg_restore: creating COMMENT <span class=\"s2\">\"public.COLUMN wenas.wena_type\"</span>\npg_restore: creating DEFAULT <span class=\"s2\">\"public.active_storage_attachments id\"</span>\npg_restore: creating DEFAULT <span class=\"s2\">\"public.active_storage_blobs id\"</span>\npg_restore: creating DEFAULT <span class=\"s2\">\"public.active_storage_variant_records id\"</span>\npg_restore: creating DEFAULT <span class=\"s2\">\"public.json_web_keys id\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.active_storage_attachments active_storage_attachments_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.active_storage_blobs active_storage_blobs_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.active_storage_variant_records active_storage_variant_records_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.ar_internal_metadata ar_internal_metadata_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.autolock_schedules autolock_schedules_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.cards cards_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.command_logs command_logs_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.dailies dailies_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.display_logs display_logs_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.door_mode_changed_histories door_mode_changed_histories_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.durations durations_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.entrance_block_fob_keys entrance_block_fob_keys_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.entrance_block_knight_cards entrance_block_knight_cards_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.entrance_fob_keys entrance_fob_keys_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.entrance_invitations entrance_invitations_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.entrance_knight_keys entrance_knight_keys_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.entrance_knight_pins entrance_knight_pins_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.entrance_lock_settings entrance_lock_settings_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.entrance_locks entrance_locks_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.entrance_master_keys entrance_master_keys_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.entrance_resident_guest_keys entrance_resident_guest_keys_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.entrance_resident_keys entrance_resident_keys_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.family_keys family_keys_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.fob_keys fob_keys_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.fobs fobs_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.guest_keys guest_keys_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.hubs hubs_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.invitations invitations_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.json_web_keys json_web_keys_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.knight_cards knight_cards_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.knight_commands knight_commands_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.knight_keys knight_keys_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.knight_logs knight_logs_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.knight_pins knight_pins_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.knights knights_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.laresia_pins laresia_pins_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.lock_settings lock_settings_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.lock_webhook_tokens lock_webhook_tokens_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.locks locks_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.logs logs_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.managers managers_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.master_keys master_keys_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.mst_display_logs mst_display_logs_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.relationships relationships_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.resident_guest_keys resident_guest_keys_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.resident_keys resident_keys_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.schema_migrations schema_migrations_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.term_of_validities term_of_validities_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.users users_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.webhook_tokens webhook_tokens_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.webhooks webhooks_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.weeklies weeklies_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.wena_keys wena_keys_pkey\"</span>\npg_restore: creating CONSTRAINT <span class=\"s2\">\"public.wenas wenas_pkey\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_active_storage_attachments_on_blob_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_active_storage_attachments_uniqueness\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_active_storage_blobs_on_key\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_active_storage_variant_records_uniqueness\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_autolock_schedules_on_disable_hour\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_autolock_schedules_on_enable_hour\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_autolock_schedules_on_master_key_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_cards_on_serial_no\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_command_logs_on_hub_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_command_logs_on_lock_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_dailies_on_term_of_validity_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_display_logs_on_logged_at\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_display_logs_on_master_key_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_display_logs_on_mst_display_log_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_door_mode_changed_histories_on_master_key_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_durations_on_term_of_validity_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_entrance_block_fob_keys_on_entrance_fob_key_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_entrance_block_fob_keys_on_entrance_master_key_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_entrance_block_fob_keys_on_fob_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_entrance_block_knight_cards_on_entrance_knight_key_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_entrance_block_knight_cards_on_knight_card_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_entrance_fob_keys_on_entrance_master_key_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_entrance_fob_keys_on_fob_key_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_entrance_invitations_on_entrance_master_key_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_entrance_invitations_on_invitation_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_entrance_knight_keys_on_entrance_master_key_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_entrance_knight_keys_on_knight_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_entrance_knight_pins_on_entrance_knight_key_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_entrance_knight_pins_on_entrance_knight_key_id_and_pin\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_entrance_lock_settings_on_entrance_master_key_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_entrance_lock_settings_on_hub_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_entrance_locks_on_serial_no\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_entrance_master_keys_on_entrance_lock_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_entrance_master_keys_on_user_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_entrance_resident_guest_keys_on_entrance_master_key_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_entrance_resident_guest_keys_on_resident_guest_key_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_entrance_resident_keys_on_entrance_master_key_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_entrance_resident_keys_on_resident_key_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_family_keys_on_master_key_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_family_keys_on_master_key_id_and_user_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_family_keys_on_user_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_fob_keys_on_fob_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_fob_keys_on_master_key_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_fobs_on_serial_no_and_fob_type\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_guest_keys_on_master_key_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_guest_keys_on_term_of_validity_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_guest_keys_on_user_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_hubs_on_serial_no\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_invitations_on_master_key_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_invitations_on_term_of_validity_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_invitations_on_user_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_json_web_keys_on_kid\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_knight_cards_on_display_serial_no\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_knight_cards_on_knight_key_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_knight_cards_on_knight_key_id_and_idm\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_knight_commands_on_hub_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_knight_commands_on_knight_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_knight_keys_on_knight_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_knight_keys_on_master_key_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_knight_logs_on_knight_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_knight_logs_on_knight_id_and_knight_log_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_knight_pins_on_knight_key_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_knight_pins_on_knight_key_id_and_pin\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_knights_on_serial_no_and_model_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_laresia_pins_on_master_key_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_lock_settings_on_hub_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_lock_settings_on_main_knight_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_lock_settings_on_master_key_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_lock_settings_on_sub_knight_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_lock_settings_on_sub_lock_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_lock_webhook_tokens_on_lock_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_lock_webhook_tokens_on_lock_id_and_webhook_token_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_lock_webhook_tokens_on_webhook_token_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_locks_on_serial_no_and_model_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_logs_on_lock_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_logs_on_lock_id_and_lock_log_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_logs_on_lock_id_and_logged_at\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_logs_on_recordable_type_and_recordable_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_managers_on_user_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_master_keys_on_lock_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_master_keys_on_user_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_relationships_on_follow_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_relationships_on_user_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_relationships_on_user_id_and_follow_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_resident_guest_keys_on_master_key_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_resident_guest_keys_on_term_of_validity_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_resident_guest_keys_on_user_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_resident_keys_on_master_key_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_resident_keys_on_user_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_term_of_validities_on_master_key_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_users_on_auth0_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_webhook_tokens_on_user_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_webhook_tokens_on_user_id_and_platform\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_webhooks_on_master_key_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_webhooks_on_master_key_id_and_payload_url\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_weeklies_on_term_of_validity_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_wena_keys_on_master_key_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_wena_keys_on_wena_id\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.index_wenas_on_serial_no\"</span>\npg_restore: creating INDEX <span class=\"s2\">\"public.unique_idx_e_b_k_c_on_entrance_knight_key_id_and_encrypted_idm\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.command_logs fk_rails_014f6a2546\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.laresia_pins fk_rails_0169d87320\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.knight_keys fk_rails_021cf26662\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.knight_cards fk_rails_0456909398\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.master_keys fk_rails_0704a51e19\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.durations fk_rails_09e2ff6011\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.entrance_resident_guest_keys fk_rails_0e04b9b004\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.webhook_tokens fk_rails_0e442b724e\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.fob_keys fk_rails_10751d7ff3\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.managers fk_rails_1306270b4d\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.lock_settings fk_rails_14b5845605\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.entrance_invitations fk_rails_1cd45ae85f\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.resident_guest_keys fk_rails_264f594299\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.master_keys fk_rails_2ce43857fe\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.invitations fk_rails_392831049d\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.entrance_fob_keys fk_rails_3baf99c215\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.guest_keys fk_rails_423d4bed43\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.command_logs fk_rails_479d47afa1\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.door_mode_changed_histories fk_rails_49b0247336\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.webhooks fk_rails_4ed36f717c\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.guest_keys fk_rails_511d97b2e6\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.entrance_lock_settings fk_rails_51210f8c81\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.family_keys fk_rails_51c51759a6\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.display_logs fk_rails_59cca4309c\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.family_keys fk_rails_60c83f8be9\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.guest_keys fk_rails_6c5179c7f7\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.display_logs fk_rails_6d35c11a37\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.entrance_block_fob_keys fk_rails_73c502cbb2\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.resident_guest_keys fk_rails_79146fb483\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.entrance_resident_keys fk_rails_7e4b69180e\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.invitations fk_rails_7eae413fe6\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.dailies fk_rails_82a55d246d\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.knight_keys fk_rails_85a7a025e9\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.lock_settings fk_rails_8bb146ac2a\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.lock_webhook_tokens fk_rails_8fba90749d\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.entrance_block_fob_keys fk_rails_919d63f111\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.lock_webhook_tokens fk_rails_95203493c9\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.resident_guest_keys fk_rails_9539b5c88f\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.active_storage_variant_records fk_rails_993965df05\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.entrance_invitations fk_rails_9992af7a62\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.wena_keys fk_rails_99ec462bd1\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.fob_keys fk_rails_9b950aa82f\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.entrance_lock_settings fk_rails_9befedd7c2\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.autolock_schedules fk_rails_a0e63f0c58\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.relationships fk_rails_a3d77c3b00\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.entrance_block_fob_keys fk_rails_a403765376\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.entrance_resident_keys fk_rails_a5035d381f\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.entrance_knight_keys fk_rails_a635401c41\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.knight_pins fk_rails_a64ee923a2\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.entrance_fob_keys fk_rails_af780e48bc\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.resident_keys fk_rails_b0fd978d66\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.entrance_resident_guest_keys fk_rails_b6ec476525\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.entrance_knight_pins fk_rails_b7c2bfe16b\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.entrance_master_keys fk_rails_b86cbd1481\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.relationships fk_rails_be1f05b3d7\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.lock_settings fk_rails_c004fa487a\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.term_of_validities fk_rails_c0c932f574\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.active_storage_attachments fk_rails_c3b3935057\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.entrance_master_keys fk_rails_cf36d974ef\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.wena_keys fk_rails_d5ecae402c\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.weeklies fk_rails_d7ff067ab0\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.knight_logs fk_rails_ded551fbb4\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.resident_keys fk_rails_dfe4427a9d\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.entrance_block_knight_cards fk_rails_e8410af2ce\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.logs fk_rails_ef0f5cfa81\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.entrance_knight_keys fk_rails_f404f37ec9\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.entrance_block_knight_cards fk_rails_f6a259853d\"</span>\npg_restore: creating FK CONSTRAINT <span class=\"s2\">\"public.invitations fk_rails_f87be4c20b\"</span>\n</code></pre></div></div>\n</details>\n<h3 data-sourcepos=\"1235:1-1235:50\" id=\"0-6-3\" name=\"0-6-3\"><a class=\"anchor\" id=\"Bucardoの設定、データプールの開始\" name=\"Bucardoの設定、データプールの開始\" href=\"#Bucardoの設定、データプールの開始\" data-position=\"0-6-3\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"Bucardoの設定、データプールの開始\"> &gt; Bucardoの設定、データプールの開始</span></a>Bucardoの設定、データプールの開始</h3>\n<p data-sourcepos=\"1236:1-1236:6\">成功</p>\n<div class=\"code-block\" data-sourcepos=\"1237:1-1254:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>root@c4e9fe68d14c:/# bucardo add db heroku_db <span class=\"nv\">dbhost</span><span class=\"o\">=</span>source-db <span class=\"nv\">dbport</span><span class=\"o\">=</span>5432 <span class=\"nv\">dbuser</span><span class=\"o\">=</span>postgres <span class=\"nv\">dbname</span><span class=\"o\">=</span>postgres <span class=\"nv\">dbpass</span><span class=\"o\">=</span>postgres\nAdded database <span class=\"s2\">\"heroku_db\"</span>\nroot@c4e9fe68d14c:/# bucardo add db aws_db <span class=\"nv\">dbhost</span><span class=\"o\">=</span>target-db <span class=\"nv\">dbport</span><span class=\"o\">=</span>5432 <span class=\"nv\">dbuser</span><span class=\"o\">=</span>postgres <span class=\"nv\">dbname</span><span class=\"o\">=</span>postgres <span class=\"nv\">dbpass</span><span class=\"o\">=</span>postgres\nAdded database <span class=\"s2\">\"aws_db\"</span>\nroot@c4e9fe68d14c:/# bucardo add dbgroup dbs heroku_db:source aws_db:target\nCreated dbgroup <span class=\"s2\">\"dbs\"</span>\nAdded database <span class=\"s2\">\"heroku_db\"</span> to dbgroup <span class=\"s2\">\"dbs\"</span> as <span class=\"nb\">source\n</span>Added database <span class=\"s2\">\"aws_db\"</span> to dbgroup <span class=\"s2\">\"dbs\"</span> as target\nroot@c4e9fe68d14c:/# bucardo add table logs display_logs <span class=\"nv\">herd</span><span class=\"o\">=</span>herd_heroku_db <span class=\"nv\">db</span><span class=\"o\">=</span>heroku_db\nAdded the following tables or sequences:\n  public.display_logs\n  public.logs\nCreated the relgroup named <span class=\"s2\">\"herd_heroku_db\"</span>\nThe following tables or sequences are now part of the relgroup <span class=\"s2\">\"herd_heroku_db\"</span>:\n  public.display_logs\n  public.logs\n</code></pre></div></div>\n<p data-sourcepos=\"1255:1-1255:138\">ソースDBにpsqlしてbucardoスキーマがないことを確認、その後bucardo add syncしてbucardoスキーマが生成された</p>\n<div class=\"code-block\" data-sourcepos=\"1256:1-1285:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>root@c4e9fe68d14c:/# psql <span class=\"nt\">-h</span> source-db <span class=\"nt\">-U</span> postgres <span class=\"nt\">-d</span> postgres <span class=\"nt\">-p</span> 5432\nPassword <span class=\"k\">for </span>user postgres:\npsql <span class=\"o\">(</span>14.7 <span class=\"o\">(</span>Ubuntu 14.7-0ubuntu0.22.04.1<span class=\"o\">)</span>, server 14.5 <span class=\"o\">(</span>Debian 14.5-2.pgdg110+2<span class=\"o\">))</span>\nType <span class=\"s2\">\"help\"</span> <span class=\"k\">for </span>help.\n\n<span class=\"nv\">postgres</span><span class=\"o\">=</span><span class=\"c\"># \\d bucardo.*</span>\nDid not find any relation named <span class=\"s2\">\"bucardo.*\"</span><span class=\"nb\">.</span>\n<span class=\"nv\">postgres</span><span class=\"o\">=</span><span class=\"c\"># exit</span>\nroot@c4e9fe68d14c:/# bucardo add <span class=\"nb\">sync </span>sync_heroku_aws <span class=\"nv\">relgroup</span><span class=\"o\">=</span>herd_heroku_db <span class=\"nv\">db</span><span class=\"o\">=</span>heroku_db,aws_db\nAdded <span class=\"nb\">sync</span> <span class=\"s2\">\"sync_heroku_aws\"</span>\nUsing existing dbgroup <span class=\"s2\">\"dbs\"</span>\nroot@c4e9fe68d14c:/# psql <span class=\"nt\">-h</span> source-db <span class=\"nt\">-U</span> postgres <span class=\"nt\">-d</span> postgres <span class=\"nt\">-p</span> 5432\nPassword <span class=\"k\">for </span>user postgres:\npsql <span class=\"o\">(</span>14.7 <span class=\"o\">(</span>Ubuntu 14.7-0ubuntu0.22.04.1<span class=\"o\">)</span>, server 14.5 <span class=\"o\">(</span>Debian 14.5-2.pgdg110+2<span class=\"o\">))</span>\nType <span class=\"s2\">\"help\"</span> <span class=\"k\">for </span>help.\n\n<span class=\"nv\">postgres</span><span class=\"o\">=</span><span class=\"c\"># \\d bucardo.*</span>\n                  Table <span class=\"s2\">\"bucardo.bucardo_delta_names\"</span>\n  Column   |           Type           | Collation | Nullable | Default\n<span class=\"nt\">-----------</span>+--------------------------+-----------+----------+---------\n <span class=\"nb\">sync</span>      | text                     |           |          |\n tablename | text                     |           |          |\n deltaname | text                     |           |          |\n trackname | text                     |           |          |\n cdate     | timestamp with <span class=\"nb\">time </span>zone |           | not null | now<span class=\"o\">()</span>\nIndexes:\n    <span class=\"s2\">\"bucardo_delta_names_unique\"</span>\n    以下略\n</code></pre></div></div>\n<h3 data-sourcepos=\"1287:1-1287:29\" id=\"0-6-4\" name=\"0-6-4\"><a class=\"anchor\" id=\"logs, display_logsのdump\" name=\"logs, display_logsのdump\" href=\"#logs, display_logsのdump\" data-position=\"0-6-4\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"logs, display_logsのdump\"> &gt; logs, display_logsのdump</span></a>logs, display_logsのdump</h3>\n<details>\n<summary>成功</summary>\n<div class=\"code-block\" data-sourcepos=\"1292:1-1351:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>pg_dump <span class=\"nt\">--format</span><span class=\"o\">=</span>custom <span class=\"nt\">--verbose</span> <span class=\"nt\">--data-only</span> <span class=\"nt\">--table</span><span class=\"o\">=</span>logs <span class=\"nt\">--table</span><span class=\"o\">=</span>display_logs <span class=\"nt\">-h</span> source-db <span class=\"nt\">-U</span> postgres <span class=\"nt\">-d</span> postgres <span class=\"nt\">-p</span> 5432 <span class=\"o\">&gt;</span>logs_displaylogs.dump\nPassword:\npg_dump: last built-in OID is 16383\npg_dump: reading extensions\npg_dump: identifying extension members\npg_dump: reading schemas\npg_dump: reading user-defined tables\npg_dump: reading user-defined functions\npg_dump: reading user-defined types\npg_dump: reading procedural languages\npg_dump: reading user-defined aggregate functions\npg_dump: reading user-defined operators\npg_dump: reading user-defined access methods\npg_dump: reading user-defined operator classes\npg_dump: reading user-defined operator families\npg_dump: reading user-defined text search parsers\npg_dump: reading user-defined text search templates\npg_dump: reading user-defined text search dictionaries\npg_dump: reading user-defined text search configurations\npg_dump: reading user-defined foreign-data wrappers\npg_dump: reading user-defined foreign servers\npg_dump: reading default privileges\npg_dump: reading user-defined collations\npg_dump: reading user-defined conversions\npg_dump: reading <span class=\"nb\">type </span>casts\npg_dump: reading transforms\npg_dump: reading table inheritance information\npg_dump: reading event triggers\npg_dump: finding extension tables\npg_dump: finding inheritance relationships\npg_dump: reading column info <span class=\"k\">for </span>interesting tables\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.display_logs\"</span>\npg_dump: finding the columns and types of table <span class=\"s2\">\"public.logs\"</span>\npg_dump: flagging inherited columns <span class=\"k\">in </span>subtables\npg_dump: reading indexes\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.display_logs\"</span>\npg_dump: reading indexes <span class=\"k\">for </span>table <span class=\"s2\">\"public.logs\"</span>\npg_dump: flagging indexes <span class=\"k\">in </span>partitioned tables\npg_dump: reading extended statistics\npg_dump: reading constraints\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.display_logs\"</span>\npg_dump: reading foreign key constraints <span class=\"k\">for </span>table <span class=\"s2\">\"public.logs\"</span>\npg_dump: reading triggers\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.display_logs\"</span>\npg_dump: reading triggers <span class=\"k\">for </span>table <span class=\"s2\">\"public.logs\"</span>\npg_dump: reading rewrite rules\npg_dump: reading policies\npg_dump: reading row-level security policies\npg_dump: reading publications\npg_dump: reading publication membership\npg_dump: reading subscriptions\npg_dump: reading dependency data\npg_dump: saving encoding <span class=\"o\">=</span> UTF8\npg_dump: saving standard_conforming_strings <span class=\"o\">=</span> on\npg_dump: saving search_path <span class=\"o\">=</span>\npg_dump: saving database definition\npg_dump: dumping contents of table <span class=\"s2\">\"public.display_logs\"</span>\npg_dump: dumping contents of table <span class=\"s2\">\"public.logs\"</span>\n</code></pre></div></div>\n</details>\n<h3 data-sourcepos=\"1355:1-1355:32\" id=\"0-6-5\" name=\"0-6-5\"><a class=\"anchor\" id=\"logs, display_logsのrestore\" name=\"logs, display_logsのrestore\" href=\"#logs, display_logsのrestore\" data-position=\"0-6-5\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"logs, display_logsのrestore\"> &gt; logs, display_logsのrestore</span></a>logs, display_logsのrestore</h3>\n<p data-sourcepos=\"1356:1-1356:6\">成功</p>\n<div class=\"code-block\" data-sourcepos=\"1358:1-1368:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>pg_restore <span class=\"nt\">--verbose</span> <span class=\"nt\">--data-only</span> <span class=\"nt\">--disable-triggers</span> <span class=\"nt\">-h</span> target-db <span class=\"nt\">-p</span> 5432 <span class=\"nt\">-U</span> postgres <span class=\"nt\">-d</span> postgres logs_displaylogs.dump\npg_restore: connecting to database <span class=\"k\">for </span>restore\nPassword:\npg_restore: disabling triggers <span class=\"k\">for </span>display_logs\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.display_logs\"</span>\npg_restore: enabling triggers <span class=\"k\">for </span>display_logs\npg_restore: disabling triggers <span class=\"k\">for </span>logs\npg_restore: processing data <span class=\"k\">for </span>table <span class=\"s2\">\"public.logs\"</span>\npg_restore: enabling triggers <span class=\"k\">for </span>logs\n</code></pre></div></div>\n<h2 data-sourcepos=\"1370:1-1370:24\" id=\"0-7-0\" name=\"0-7-0\"><a class=\"anchor\" id=\"ここからが検証\" name=\"ここからが検証\" href=\"#ここからが検証\" data-position=\"0-7-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"ここからが検証\"> &gt; ここからが検証</span></a>ここからが検証</h2>\n<h3 data-sourcepos=\"1372:1-1372:35\" id=\"0-7-1\" name=\"0-7-1\"><a class=\"anchor\" id=\"logs, display_logs以外のdump\" name=\"logs, display_logs以外のdump\" href=\"#logs, display_logs以外のdump\" data-position=\"0-7-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"logs, display_logs以外のdump\"> &gt; logs, display_logs以外のdump</span></a>logs, display_logs以外のdump</h3>\n<details>\n```sh\npg_dump --format=custom     --verbose --data-only     --schema=public --exclude-table=logs --exclude-table=display_logs -h source-db -U postgres -d postgres -p 5432 &gt; main_data.dump\nPassword:\npg_dump: last built-in OID is 16383\npg_dump: reading extensions\npg_dump: identifying extension members\npg_dump: reading schemas\npg_dump: reading user-defined tables\npg_dump: reading user-defined functions\npg_dump: reading user-defined types\npg_dump: reading procedural languages\npg_dump: reading user-defined aggregate functions\npg_dump: reading user-defined operators\npg_dump: reading user-defined access methods\npg_dump: reading user-defined operator classes\npg_dump: reading user-defined operator families\npg_dump: reading user-defined text search parsers\npg_dump: reading user-defined text search templates\npg_dump: reading user-defined text search dictionaries\npg_dump: reading user-defined text search configurations\npg_dump: reading user-defined foreign-data wrappers\npg_dump: reading user-defined foreign servers\npg_dump: reading default privileges\npg_dump: reading user-defined collations\npg_dump: reading user-defined conversions\npg_dump: reading type casts\npg_dump: reading transforms\npg_dump: reading table inheritance information\npg_dump: reading event triggers\npg_dump: finding extension tables\npg_dump: finding inheritance relationships\npg_dump: reading column info for interesting tables\npg_dump: finding the columns and types of table \"public.active_storage_attachments\"\npg_dump: finding the columns and types of table \"public.active_storage_blobs\"\npg_dump: finding the columns and types of table \"public.active_storage_variant_records\"\npg_dump: finding the columns and types of table \"public.ar_internal_metadata\"\npg_dump: finding the columns and types of table \"public.autolock_schedules\"\npg_dump: finding the columns and types of table \"public.cards\"\npg_dump: finding the columns and types of table \"public.command_logs\"\npg_dump: finding the columns and types of table \"public.dailies\"\npg_dump: finding the columns and types of table \"public.door_mode_changed_histories\"\npg_dump: finding the columns and types of table \"public.durations\"\npg_dump: finding the columns and types of table \"public.entrance_block_fob_keys\"\npg_dump: finding the columns and types of table \"public.entrance_block_knight_cards\"\npg_dump: finding the columns and types of table \"public.entrance_fob_keys\"\npg_dump: finding the columns and types of table \"public.entrance_invitations\"\npg_dump: finding the columns and types of table \"public.entrance_knight_keys\"\npg_dump: finding the columns and types of table \"public.entrance_knight_pins\"\npg_dump: finding the columns and types of table \"public.entrance_lock_settings\"\npg_dump: finding the columns and types of table \"public.entrance_locks\"\npg_dump: finding the columns and types of table \"public.entrance_master_keys\"\npg_dump: finding the columns and types of table \"public.entrance_resident_guest_keys\"\npg_dump: finding the columns and types of table \"public.entrance_resident_keys\"\npg_dump: finding the columns and types of table \"public.family_keys\"\npg_dump: finding the columns and types of table \"public.fob_keys\"\npg_dump: finding the columns and types of table \"public.fobs\"\npg_dump: finding the columns and types of table \"public.guest_keys\"\npg_dump: finding the columns and types of table \"public.hubs\"\npg_dump: finding the columns and types of table \"public.invitations\"\npg_dump: finding the columns and types of table \"public.json_web_keys\"\npg_dump: finding the columns and types of table \"public.knight_cards\"\npg_dump: finding the columns and types of table \"public.knight_commands\"\npg_dump: finding the columns and types of table \"public.knight_keys\"\npg_dump: finding the columns and types of table \"public.knight_logs\"\npg_dump: finding the columns and types of table \"public.knight_pins\"\npg_dump: finding the columns and types of table \"public.knights\"\npg_dump: finding the columns and types of table \"public.laresia_pins\"\npg_dump: finding the columns and types of table \"public.lock_settings\"\npg_dump: finding the columns and types of table \"public.lock_webhook_tokens\"\npg_dump: finding the columns and types of table \"public.locks\"\npg_dump: finding the columns and types of table \"public.managers\"\npg_dump: finding the columns and types of table \"public.master_keys\"\npg_dump: finding the columns and types of table \"public.mst_display_logs\"\npg_dump: finding the columns and types of table \"public.relationships\"\npg_dump: finding the columns and types of table \"public.resident_guest_keys\"\npg_dump: finding the columns and types of table \"public.resident_keys\"\npg_dump: finding the columns and types of table \"public.schema_migrations\"\npg_dump: finding the columns and types of table \"public.term_of_validities\"\npg_dump: finding the columns and types of table \"public.users\"\npg_dump: finding the columns and types of table \"public.webhook_tokens\"\npg_dump: finding the columns and types of table \"public.webhooks\"\npg_dump: finding the columns and types of table \"public.weeklies\"\npg_dump: finding the columns and types of table \"public.wena_keys\"\npg_dump: finding the columns and types of table \"public.wenas\"\npg_dump: flagging inherited columns in subtables\npg_dump: reading indexes\npg_dump: reading indexes for table \"public.active_storage_attachments\"\npg_dump: reading indexes for table \"public.active_storage_blobs\"\npg_dump: reading indexes for table \"public.active_storage_variant_records\"\npg_dump: reading indexes for table \"public.ar_internal_metadata\"\npg_dump: reading indexes for table \"public.autolock_schedules\"\npg_dump: reading indexes for table \"public.cards\"\npg_dump: reading indexes for table \"public.command_logs\"\npg_dump: reading indexes for table \"public.dailies\"\npg_dump: reading indexes for table \"public.door_mode_changed_histories\"\npg_dump: reading indexes for table \"public.durations\"\npg_dump: reading indexes for table \"public.entrance_block_fob_keys\"\npg_dump: reading indexes for table \"public.entrance_block_knight_cards\"\npg_dump: reading indexes for table \"public.entrance_fob_keys\"\npg_dump: reading indexes for table \"public.entrance_invitations\"\npg_dump: reading indexes for table \"public.entrance_knight_keys\"\npg_dump: reading indexes for table \"public.entrance_knight_pins\"\npg_dump: reading indexes for table \"public.entrance_lock_settings\"\npg_dump: reading indexes for table \"public.entrance_locks\"\npg_dump: reading indexes for table \"public.entrance_master_keys\"\npg_dump: reading indexes for table \"public.entrance_resident_guest_keys\"\npg_dump: reading indexes for table \"public.entrance_resident_keys\"\npg_dump: reading indexes for table \"public.family_keys\"\npg_dump: reading indexes for table \"public.fob_keys\"\npg_dump: reading indexes for table \"public.fobs\"\npg_dump: reading indexes for table \"public.guest_keys\"\npg_dump: reading indexes for table \"public.hubs\"\npg_dump: reading indexes for table \"public.invitations\"\npg_dump: reading indexes for table \"public.json_web_keys\"\npg_dump: reading indexes for table \"public.knight_cards\"\npg_dump: reading indexes for table \"public.knight_commands\"\npg_dump: reading indexes for table \"public.knight_keys\"\npg_dump: reading indexes for table \"public.knight_logs\"\npg_dump: reading indexes for table \"public.knight_pins\"\npg_dump: reading indexes for table \"public.knights\"\npg_dump: reading indexes for table \"public.laresia_pins\"\npg_dump: reading indexes for table \"public.lock_settings\"\npg_dump: reading indexes for table \"public.lock_webhook_tokens\"\npg_dump: reading indexes for table \"public.locks\"\npg_dump: reading indexes for table \"public.managers\"\npg_dump: reading indexes for table \"public.master_keys\"\npg_dump: reading indexes for table \"public.mst_display_logs\"\npg_dump: reading indexes for table \"public.relationships\"\npg_dump: reading indexes for table \"public.resident_guest_keys\"\npg_dump: reading indexes for table \"public.resident_keys\"\npg_dump: reading indexes for table \"public.schema_migrations\"\npg_dump: reading indexes for table \"public.term_of_validities\"\npg_dump: reading indexes for table \"public.users\"\npg_dump: reading indexes for table \"public.webhook_tokens\"\npg_dump: reading indexes for table \"public.webhooks\"\npg_dump: reading indexes for table \"public.weeklies\"\npg_dump: reading indexes for table \"public.wena_keys\"\npg_dump: reading indexes for table \"public.wenas\"\npg_dump: flagging indexes in partitioned tables\npg_dump: reading extended statistics\npg_dump: reading constraints\npg_dump: reading foreign key constraints for table \"public.active_storage_attachments\"\npg_dump: reading foreign key constraints for table \"public.active_storage_blobs\"\npg_dump: reading foreign key constraints for table \"public.active_storage_variant_records\"\npg_dump: reading foreign key constraints for table \"public.autolock_schedules\"\npg_dump: reading foreign key constraints for table \"public.command_logs\"\npg_dump: reading foreign key constraints for table \"public.dailies\"\npg_dump: reading foreign key constraints for table \"public.door_mode_changed_histories\"\npg_dump: reading foreign key constraints for table \"public.durations\"\npg_dump: reading foreign key constraints for table \"public.entrance_block_fob_keys\"\npg_dump: reading foreign key constraints for table \"public.entrance_block_knight_cards\"\npg_dump: reading foreign key constraints for table \"public.entrance_fob_keys\"\npg_dump: reading foreign key constraints for table \"public.entrance_invitations\"\npg_dump: reading foreign key constraints for table \"public.entrance_knight_keys\"\npg_dump: reading foreign key constraints for table \"public.entrance_knight_pins\"\npg_dump: reading foreign key constraints for table \"public.entrance_lock_settings\"\npg_dump: reading foreign key constraints for table \"public.entrance_locks\"\npg_dump: reading foreign key constraints for table \"public.entrance_master_keys\"\npg_dump: reading foreign key constraints for table \"public.entrance_resident_guest_keys\"\npg_dump: reading foreign key constraints for table \"public.entrance_resident_keys\"\npg_dump: reading foreign key constraints for table \"public.family_keys\"\npg_dump: reading foreign key constraints for table \"public.fob_keys\"\npg_dump: reading foreign key constraints for table \"public.fobs\"\npg_dump: reading foreign key constraints for table \"public.guest_keys\"\npg_dump: reading foreign key constraints for table \"public.hubs\"\npg_dump: reading foreign key constraints for table \"public.invitations\"\npg_dump: reading foreign key constraints for table \"public.knight_cards\"\npg_dump: reading foreign key constraints for table \"public.knight_keys\"\npg_dump: reading foreign key constraints for table \"public.knight_logs\"\npg_dump: reading foreign key constraints for table \"public.knight_pins\"\npg_dump: reading foreign key constraints for table \"public.knights\"\npg_dump: reading foreign key constraints for table \"public.laresia_pins\"\npg_dump: reading foreign key constraints for table \"public.lock_settings\"\npg_dump: reading foreign key constraints for table \"public.lock_webhook_tokens\"\npg_dump: reading foreign key constraints for table \"public.locks\"\npg_dump: reading foreign key constraints for table \"public.managers\"\npg_dump: reading foreign key constraints for table \"public.master_keys\"\npg_dump: reading foreign key constraints for table \"public.mst_display_logs\"\npg_dump: reading foreign key constraints for table \"public.relationships\"\npg_dump: reading foreign key constraints for table \"public.resident_guest_keys\"\npg_dump: reading foreign key constraints for table \"public.resident_keys\"\npg_dump: reading foreign key constraints for table \"public.term_of_validities\"\npg_dump: reading foreign key constraints for table \"public.users\"\npg_dump: reading foreign key constraints for table \"public.webhook_tokens\"\npg_dump: reading foreign key constraints for table \"public.webhooks\"\npg_dump: reading foreign key constraints for table \"public.weeklies\"\npg_dump: reading foreign key constraints for table \"public.wena_keys\"\npg_dump: reading foreign key constraints for table \"public.wenas\"\npg_dump: reading triggers\npg_dump: reading triggers for table \"public.active_storage_attachments\"\npg_dump: reading triggers for table \"public.active_storage_blobs\"\npg_dump: reading triggers for table \"public.active_storage_variant_records\"\npg_dump: reading triggers for table \"public.autolock_schedules\"\npg_dump: reading triggers for table \"public.command_logs\"\npg_dump: reading triggers for table \"public.dailies\"\npg_dump: reading triggers for table \"public.door_mode_changed_histories\"\npg_dump: reading triggers for table \"public.durations\"\npg_dump: reading triggers for table \"public.entrance_block_fob_keys\"\npg_dump: reading triggers for table \"public.entrance_block_knight_cards\"\npg_dump: reading triggers for table \"public.entrance_fob_keys\"\npg_dump: reading triggers for table \"public.entrance_invitations\"\npg_dump: reading triggers for table \"public.entrance_knight_keys\"\npg_dump: reading triggers for table \"public.entrance_knight_pins\"\npg_dump: reading triggers for table \"public.entrance_lock_settings\"\npg_dump: reading triggers for table \"public.entrance_locks\"\npg_dump: reading triggers for table \"public.entrance_master_keys\"\npg_dump: reading triggers for table \"public.entrance_resident_guest_keys\"\npg_dump: reading triggers for table \"public.entrance_resident_keys\"\npg_dump: reading triggers for table \"public.family_keys\"\npg_dump: reading triggers for table \"public.fob_keys\"\npg_dump: reading triggers for table \"public.fobs\"\npg_dump: reading triggers for table \"public.guest_keys\"\npg_dump: reading triggers for table \"public.hubs\"\npg_dump: reading triggers for table \"public.invitations\"\npg_dump: reading triggers for table \"public.knight_cards\"\npg_dump: reading triggers for table \"public.knight_keys\"\npg_dump: reading triggers for table \"public.knight_logs\"\npg_dump: reading triggers for table \"public.knight_pins\"\npg_dump: reading triggers for table \"public.knights\"\npg_dump: reading triggers for table \"public.laresia_pins\"\npg_dump: reading triggers for table \"public.lock_settings\"\npg_dump: reading triggers for table \"public.lock_webhook_tokens\"\npg_dump: reading triggers for table \"public.locks\"\npg_dump: reading triggers for table \"public.managers\"\npg_dump: reading triggers for table \"public.master_keys\"\npg_dump: reading triggers for table \"public.mst_display_logs\"\npg_dump: reading triggers for table \"public.relationships\"\npg_dump: reading triggers for table \"public.resident_guest_keys\"\npg_dump: reading triggers for table \"public.resident_keys\"\npg_dump: reading triggers for table \"public.term_of_validities\"\npg_dump: reading triggers for table \"public.users\"\npg_dump: reading triggers for table \"public.webhook_tokens\"\npg_dump: reading triggers for table \"public.webhooks\"\npg_dump: reading triggers for table \"public.weeklies\"\npg_dump: reading triggers for table \"public.wena_keys\"\npg_dump: reading triggers for table \"public.wenas\"\npg_dump: reading rewrite rules\npg_dump: reading policies\npg_dump: reading row-level security policies\npg_dump: reading publications\npg_dump: reading publication membership\npg_dump: reading subscriptions\npg_dump: reading dependency data\npg_dump: saving encoding = UTF8\npg_dump: saving standard_conforming_strings = on\npg_dump: saving search_path =\npg_dump: saving database definition\npg_dump: dumping contents of table \"public.active_storage_blobs\"\npg_dump: dumping contents of table \"public.active_storage_attachments\"\npg_dump: dumping contents of table \"public.active_storage_variant_records\"\npg_dump: dumping contents of table \"public.ar_internal_metadata\"\npg_dump: dumping contents of table \"public.locks\"\npg_dump: dumping contents of table \"public.users\"\npg_dump: dumping contents of table \"public.master_keys\"\npg_dump: dumping contents of table \"public.autolock_schedules\"\npg_dump: dumping contents of table \"public.cards\"\npg_dump: dumping contents of table \"public.hubs\"\npg_dump: dumping contents of table \"public.command_logs\"\npg_dump: dumping contents of table \"public.term_of_validities\"\npg_dump: dumping contents of table \"public.dailies\"\npg_dump: dumping contents of table \"public.door_mode_changed_histories\"\npg_dump: dumping contents of table \"public.durations\"\npg_dump: dumping contents of table \"public.entrance_locks\"\npg_dump: dumping contents of table \"public.entrance_master_keys\"\npg_dump: dumping contents of table \"public.fobs\"\npg_dump: dumping contents of table \"public.fob_keys\"\npg_dump: dumping contents of table \"public.entrance_fob_keys\"\npg_dump: dumping contents of table \"public.entrance_block_fob_keys\"\npg_dump: dumping contents of table \"public.knights\"\npg_dump: dumping contents of table \"public.entrance_knight_keys\"\npg_dump: dumping contents of table \"public.knight_keys\"\npg_dump: dumping contents of table \"public.knight_cards\"\npg_dump: dumping contents of table \"public.entrance_block_knight_cards\"\npg_dump: dumping contents of table \"public.invitations\"\npg_dump: dumping contents of table \"public.entrance_invitations\"\npg_dump: dumping contents of table \"public.entrance_knight_pins\"\npg_dump: dumping contents of table \"public.entrance_lock_settings\"\npg_dump: dumping contents of table \"public.resident_guest_keys\"\npg_dump: dumping contents of table \"public.entrance_resident_guest_keys\"\npg_dump: dumping contents of table \"public.resident_keys\"\npg_dump: dumping contents of table \"public.entrance_resident_keys\"\npg_dump: dumping contents of table \"public.family_keys\"\npg_dump: dumping contents of table \"public.guest_keys\"\npg_dump: dumping contents of table \"public.json_web_keys\"\npg_dump: dumping contents of table \"public.knight_commands\"\npg_dump: dumping contents of table \"public.knight_logs\"\npg_dump: dumping contents of table \"public.knight_pins\"\npg_dump: dumping contents of table \"public.laresia_pins\"\npg_dump: dumping contents of table \"public.lock_settings\"\npg_dump: dumping contents of table \"public.webhook_tokens\"\npg_dump: dumping contents of table \"public.lock_webhook_tokens\"\npg_dump: dumping contents of table \"public.managers\"\npg_dump: dumping contents of table \"public.mst_display_logs\"\npg_dump: dumping contents of table \"public.relationships\"\npg_dump: dumping contents of table \"public.schema_migrations\"\npg_dump: dumping contents of table \"public.webhooks\"\npg_dump: dumping contents of table \"public.weeklies\"\npg_dump: dumping contents of table \"public.wenas\"\npg_dump: dumping contents of table \"public.wena_keys\"\n```\n</details>\n<h3 data-sourcepos=\"1678:1-1678:38\" id=\"0-7-2\" name=\"0-7-2\"><a class=\"anchor\" id=\"logs, display_logs以外のrestore\" name=\"logs, display_logs以外のrestore\" href=\"#logs, display_logs以外のrestore\" data-position=\"0-7-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"logs, display_logs以外のrestore\"> &gt; logs, display_logs以外のrestore</span></a>logs, display_logs以外のrestore</h3>\n<details>\n```sh\nroot@c4e9fe68d14c:/# pg_restore --verbose --data-only -h target-db -p 5432 -U postgres -d postgres main_data.dump\npg_restore: connecting to database for restore\nPassword:\npg_restore: processing data for table \"public.active_storage_blobs\"\npg_restore: processing data for table \"public.active_storage_attachments\"\npg_restore: processing data for table \"public.active_storage_variant_records\"\npg_restore: processing data for table \"public.ar_internal_metadata\"\npg_restore: processing data for table \"public.locks\"\npg_restore: processing data for table \"public.users\"\npg_restore: processing data for table \"public.master_keys\"\npg_restore: processing data for table \"public.autolock_schedules\"\npg_restore: processing data for table \"public.cards\"\npg_restore: processing data for table \"public.hubs\"\npg_restore: processing data for table \"public.command_logs\"\npg_restore: processing data for table \"public.term_of_validities\"\npg_restore: processing data for table \"public.dailies\"\npg_restore: processing data for table \"public.door_mode_changed_histories\"\npg_restore: processing data for table \"public.durations\"\npg_restore: processing data for table \"public.entrance_locks\"\npg_restore: processing data for table \"public.entrance_master_keys\"\npg_restore: processing data for table \"public.fobs\"\npg_restore: processing data for table \"public.fob_keys\"\npg_restore: processing data for table \"public.entrance_fob_keys\"\npg_restore: processing data for table \"public.entrance_block_fob_keys\"\npg_restore: processing data for table \"public.knights\"\npg_restore: processing data for table \"public.entrance_knight_keys\"\npg_restore: processing data for table \"public.knight_keys\"\npg_restore: processing data for table \"public.knight_cards\"\npg_restore: processing data for table \"public.entrance_block_knight_cards\"\npg_restore: processing data for table \"public.invitations\"\npg_restore: processing data for table \"public.entrance_invitations\"\npg_restore: processing data for table \"public.entrance_knight_pins\"\npg_restore: processing data for table \"public.entrance_lock_settings\"\npg_restore: processing data for table \"public.resident_guest_keys\"\npg_restore: processing data for table \"public.entrance_resident_guest_keys\"\npg_restore: processing data for table \"public.resident_keys\"\npg_restore: processing data for table \"public.entrance_resident_keys\"\npg_restore: processing data for table \"public.family_keys\"\npg_restore: processing data for table \"public.guest_keys\"\npg_restore: processing data for table \"public.json_web_keys\"\npg_restore: processing data for table \"public.knight_commands\"\npg_restore: processing data for table \"public.knight_logs\"\npg_restore: processing data for table \"public.knight_pins\"\npg_restore: processing data for table \"public.laresia_pins\"\npg_restore: processing data for table \"public.lock_settings\"\npg_restore: processing data for table \"public.webhook_tokens\"\npg_restore: processing data for table \"public.lock_webhook_tokens\"\npg_restore: processing data for table \"public.managers\"\npg_restore: processing data for table \"public.mst_display_logs\"\npg_restore: processing data for table \"public.relationships\"\npg_restore: processing data for table \"public.schema_migrations\"\npg_restore: processing data for table \"public.webhooks\"\npg_restore: processing data for table \"public.weeklies\"\npg_restore: processing data for table \"public.wenas\"\npg_restore: processing data for table \"public.wena_keys\"\npg_restore: executing SEQUENCE SET active_storage_attachments_id_seq\npg_restore: executing SEQUENCE SET active_storage_blobs_id_seq\npg_restore: executing SEQUENCE SET active_storage_variant_records_id_seq\npg_restore: executing SEQUENCE SET json_web_keys_id_seq\n```\n</details>\n<h2 data-sourcepos=\"1744:1-1744:18\" id=\"0-8-0\" name=\"0-8-0\"><a class=\"anchor\" id=\"現状の結論\" name=\"現状の結論\" href=\"#現状の結論\" data-position=\"0-8-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"現状の結論\"> &gt; 現状の結論</span></a>現状の結論</h2>\n<p data-sourcepos=\"1746:1-1746:122\">bucardo以外のスキーマについて調査不足のため今回のDB移行に<code>--schema=public</code>は採用しない方針</p>\n<h2 data-sourcepos=\"1748:1-1748:48\" id=\"0-9-0\" name=\"0-9-0\"><a class=\"anchor\" id=\"他のスキーマについて調査が必要\" name=\"他のスキーマについて調査が必要\" href=\"#他のスキーマについて調査が必要\" data-position=\"0-9-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"他のスキーマについて調査が必要\"> &gt; 他のスキーマについて調査が必要</span></a>他のスキーマについて調査が必要</h2>\n<h3 data-sourcepos=\"1750:1-1750:11\" id=\"0-9-1\" name=\"0-9-1\"><a class=\"anchor\" id=\"datadog\" name=\"datadog\" href=\"#datadog\" data-position=\"0-9-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"datadog\"> &gt; datadog</span></a>datadog</h3>\n<p data-sourcepos=\"1751:1-1752:12\">heroku上のアドオンでdatadogがあるが、それを追加した際にできたスキーマ<br>\n移行不要</p>\n<h3 data-sourcepos=\"1753:1-1753:14\" id=\"0-9-2\" name=\"0-9-2\"><a class=\"anchor\" id=\"heroku_ext\" name=\"heroku_ext\" href=\"#heroku_ext\" data-position=\"0-9-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"heroku_ext\"> &gt; heroku_ext</span></a>heroku_ext</h3>\n<blockquote data-sourcepos=\"1754:1-1754:619\">\n<p data-sourcepos=\"1754:3-1754:619\">Heroku Postgres で作成されるすべての新しい拡張機能は heroku_ext スキーマにインストールされます。以前は、拡張機能は public スキーマまたは user-defined スキーマにインストールされていました。古い拡張機能を更新するには、拡張機能を DROP して再び CREATE する必要があります。その後、古い public スキーマまたは user-definedスキーマを参照するアプリケーションコードを変更できます。heroku_extスキーマを追加することによって、カスタムロールを更新できます。</p>\n</blockquote>\n<p data-sourcepos=\"1756:1-1757:97\"><a href=\"https://devcenter.heroku.com/ja/articles/heroku-postgres-extensions-postgis-full-text-search\" target=\"_blank\" rel=\"noopener noreferrer\">https://devcenter.heroku.com/ja/articles/heroku-postgres-extensions-postgis-full-text-search</a><br>\nPostgresqlに関わるアドオン用のスキーマのようなので、移行した方が良い</p>\n<h3 data-sourcepos=\"1758:1-1758:22\" id=\"0-9-3\" name=\"0-9-3\"><a class=\"anchor\" id=\"information_schema\" name=\"information_schema\" href=\"#information_schema\" data-position=\"0-9-3\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"information_schema\"> &gt; information_schema</span></a>information_schema</h3>\n<h3 data-sourcepos=\"1759:1-1759:14\" id=\"0-9-4\" name=\"0-9-4\"><a class=\"anchor\" id=\"pg_catalog\" name=\"pg_catalog\" href=\"#pg_catalog\" data-position=\"0-9-4\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"pg_catalog\"> &gt; pg_catalog</span></a>pg_catalog</h3>\n",
    "created_at": "2023-03-30T11:29:28+09:00",
    "message": "Update post.",
    "kind": "stock",
    "comments_count": 0,
    "tasks_count": 0,
    "done_tasks_count": 0,
    "url": "https://qrio.esa.io/posts/1583",
    "updated_at": "2023-07-18T10:37:18+09:00",
    "tags": [],
    "category": "Users/杉山/Database",
    "revision_number": 5,
    "created_by": {
      "myself": false,
      "name": "杉山聡",
      "screen_name": "satoshi_sugiyama",
      "icon": "https://img.esa.io/uploads/production/members/129432/icon/thumb_m_4589e2842b9d87757c7c9db07c45c00d.jpg"
    },
    "updated_by": {
      "myself": false,
      "name": "杉山聡",
      "screen_name": "satoshi_sugiyama",
      "icon": "https://img.esa.io/uploads/production/members/129432/icon/thumb_m_4589e2842b9d87757c7c9db07c45c00d.jpg"
    },
    "stargazers_count": 0,
    "watchers_count": 1,
    "star": false,
    "watch": false,
    "sharing_urls": null
  },
  {
    "number": 1582,
    "name": "移行前後のDBのcsv取得",
    "full_name": "Users/杉山/Database/移行前後のDBのcsv取得",
    "wip": false,
    "body_md": "## 移行手順書\r\nhttps://docs.google.com/spreadsheets/d/1W3DymCJ_ifiXtSUwVAjcl9tzPGfz5WE6bmnnwYL9Gbo/edit#gid=602303325\r\n\r\n## 実行確認(staging環境)\r\n\r\n```heroku_logs取得.sh\r\npsql -h ec2-35-75-149-42.ap-northeast-1.compute.amazonaws.com -U u9sa4ppg0l8rjd -d d675i6ifmkurp3 -p 5432 -c \"COPY (select * from logs where updated_at > (NOW() - interval '12 hours') order by updated_at desc) TO STDOUT WITH CSV HEADER;\" >./heroku_logs.csv\r\n```\r\n```aurora_logs取得.sh\r\npsql -h king-api-staging.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com -U kingadmin -d kingapi -p 5432 -c \"COPY (select * from logs where updated_at > (NOW() - interval '12 hours') order by updated_at desc) TO STDOUT WITH CSV HEADER;\" >./aurora_logs.csv\r\n```\r\n```heroku_display_logs取得.sh\r\npsql -h ec2-35-75-149-42.ap-northeast-1.compute.amazonaws.com -U u9sa4ppg0l8rjd -d d675i6ifmkurp3 -p 5432 -c \"COPY (select * from display_logs where created_at > (NOW() - interval '12 hours') order by created_at desc) TO STDOUT WITH CSV HEADER;\" >./heroku_display_logs.csv\r\n```\r\n```aurora_display_logs取得.sh\r\npsql -h king-api-staging.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com -U kingadmin -d kingapi -p 5432 -c \"COPY (select * from display_logs where updated_at > (NOW() - interval '12 hours') order by updated_at desc) TO STDOUT WITH CSV HEADER;\" >./aurora_display_logs.csv\r\n```\r\n\r\n### docker cpで コンテナからEC2へcsv移動\r\n\r\n```EC2へCSV移動.sh\r\ndocker cp d4307e33553a:/heroku_logs.csv /home/ubuntu/.\r\ndocker cp d4307e33553a:/aurora_logs.csv /home/ubuntu/.\r\ndocker cp d4307e33553a:/heroku_display_logs.csv /home/ubuntu/.\r\ndocker cp d4307e33553a:/aurora_display_logs.csv /home/ubuntu/.\r\n```\r\n\r\n### 結果\r\n```sh\r\nroot@ip-172-35-3-108:/home/ubuntu# ls -a |grep csv\r\naurora_display_logs.csv\r\naurora_logs.csv\r\nheroku_display_logs.csv\r\nheroku_logs.csv\r\n```\r\n\r\n### scpでEC2からローカルへファイル移動\r\n\r\n<pemファイル名はbucardo.pemから変更してあります>\r\n\r\n```sh\r\nscp -i \"king-api-staging-bucardo-ec2.pem\" ubuntu@ec2-35-77-81-181.ap-northeast-1.compute.amazonaws.com:/home/ubuntu/heroku_logs.csv .\r\nscp -i \"king-api-staging-bucardo-ec2.pem\" ubuntu@ec2-35-77-81-181.ap-northeast-1.compute.amazonaws.com:/home/ubuntu/aurora_logs.csv .\r\nscp -i \"king-api-staging-bucardo-ec2.pem\" ubuntu@ec2-35-77-81-181.ap-northeast-1.compute.amazonaws.com:/home/ubuntu/heroku_display_logs.csv .\r\nscp -i \"king-api-staging-bucardo-ec2.pem\" ubuntu@ec2-35-77-81-181.ap-northeast-1.compute.amazonaws.com:/home/ubuntu/aurora_display_logs.csv .\r\nheroku_logs.csv                          100%   93KB   2.2MB/s   00:00\r\naurora_logs.csv                          100%   92KB   3.0MB/s   00:00\r\nheroku_display_logs.csv                  100%   61KB   1.7MB/s   00:00\r\naurora_display_logs.csv                  100%   61KB   1.8MB/s   00:00\r\n```\r\n\r\n結果\r\n```sh\r\nsugiyamasatoshi @ sugiyamasatoshinoMacBook-Pro in ~/migrate-csv [15:40:33]\r\n$ ls -a                                                           15:40:33\r\n.                                heroku_display_logs.csv\r\n..                               heroku_logs.csv\r\naurora_display_logs.csv          king-api-staging-bucardo-ec2.pem\r\naurora_logs.csv\r\n```\r\n",
    "body_html": "<h2 data-sourcepos=\"1:1-1:18\" id=\"0-1-0\" name=\"0-1-0\"><a class=\"anchor\" id=\"移行手順書\" name=\"移行手順書\" href=\"#移行手順書\" data-position=\"0-1-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"移行手順書\"> &gt; 移行手順書</span></a>移行手順書</h2>\n<p data-sourcepos=\"2:1-2:102\"><a href=\"https://docs.google.com/spreadsheets/d/1W3DymCJ_ifiXtSUwVAjcl9tzPGfz5WE6bmnnwYL9Gbo/edit#gid=602303325\" target=\"_blank\" rel=\"noopener noreferrer\">https://docs.google.com/spreadsheets/d/1W3DymCJ_ifiXtSUwVAjcl9tzPGfz5WE6bmnnwYL9Gbo/edit#gid=602303325</a></p>\n<h2 data-sourcepos=\"4:1-4:30\" id=\"0-2-0\" name=\"0-2-0\"><a class=\"anchor\" id=\"実行確認(staging環境)\" name=\"実行確認(staging環境)\" href=\"#実行確認(staging環境)\" data-position=\"0-2-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"実行確認(staging環境)\"> &gt; 実行確認(staging環境)</span></a>実行確認(staging環境)</h2>\n<div class=\"code-block\" data-sourcepos=\"6:1-8:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>heroku_logs取得.sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>psql <span class=\"nt\">-h</span> ec2-35-75-149-42.ap-northeast-1.compute.amazonaws.com <span class=\"nt\">-U</span> u9sa4ppg0l8rjd <span class=\"nt\">-d</span> d675i6ifmkurp3 <span class=\"nt\">-p</span> 5432 <span class=\"nt\">-c</span> <span class=\"s2\">\"COPY (select * from logs where updated_at &gt; (NOW() - interval '12 hours') order by updated_at desc) TO STDOUT WITH CSV HEADER;\"</span> <span class=\"o\">&gt;</span>./heroku_logs.csv\n</code></pre></div></div>\n<div class=\"code-block\" data-sourcepos=\"9:1-11:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>aurora_logs取得.sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>psql <span class=\"nt\">-h</span> king-api-staging.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com <span class=\"nt\">-U</span> kingadmin <span class=\"nt\">-d</span> kingapi <span class=\"nt\">-p</span> 5432 <span class=\"nt\">-c</span> <span class=\"s2\">\"COPY (select * from logs where updated_at &gt; (NOW() - interval '12 hours') order by updated_at desc) TO STDOUT WITH CSV HEADER;\"</span> <span class=\"o\">&gt;</span>./aurora_logs.csv\n</code></pre></div></div>\n<div class=\"code-block\" data-sourcepos=\"12:1-14:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>heroku_display_logs取得.sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>psql <span class=\"nt\">-h</span> ec2-35-75-149-42.ap-northeast-1.compute.amazonaws.com <span class=\"nt\">-U</span> u9sa4ppg0l8rjd <span class=\"nt\">-d</span> d675i6ifmkurp3 <span class=\"nt\">-p</span> 5432 <span class=\"nt\">-c</span> <span class=\"s2\">\"COPY (select * from display_logs where created_at &gt; (NOW() - interval '12 hours') order by created_at desc) TO STDOUT WITH CSV HEADER;\"</span> <span class=\"o\">&gt;</span>./heroku_display_logs.csv\n</code></pre></div></div>\n<div class=\"code-block\" data-sourcepos=\"15:1-17:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>aurora_display_logs取得.sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>psql <span class=\"nt\">-h</span> king-api-staging.cluster-cucbox6dvi64.ap-northeast-1.rds.amazonaws.com <span class=\"nt\">-U</span> kingadmin <span class=\"nt\">-d</span> kingapi <span class=\"nt\">-p</span> 5432 <span class=\"nt\">-c</span> <span class=\"s2\">\"COPY (select * from display_logs where updated_at &gt; (NOW() - interval '12 hours') order by updated_at desc) TO STDOUT WITH CSV HEADER;\"</span> <span class=\"o\">&gt;</span>./aurora_display_logs.csv\n</code></pre></div></div>\n<h3 data-sourcepos=\"19:1-19:50\" id=\"0-2-1\" name=\"0-2-1\"><a class=\"anchor\" id=\"docker cpで コンテナからEC2へcsv移動\" name=\"docker cpで コンテナからEC2へcsv移動\" href=\"#docker cpで コンテナからEC2へcsv移動\" data-position=\"0-2-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"docker cpで コンテナからEC2へcsv移動\"> &gt; docker cpで コンテナからEC2へcsv移動</span></a>docker cpで コンテナからEC2へcsv移動</h3>\n<div class=\"code-block\" data-sourcepos=\"21:1-26:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>EC2へCSV移動.sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>docker <span class=\"nb\">cp </span>d4307e33553a:/heroku_logs.csv /home/ubuntu/.\ndocker <span class=\"nb\">cp </span>d4307e33553a:/aurora_logs.csv /home/ubuntu/.\ndocker <span class=\"nb\">cp </span>d4307e33553a:/heroku_display_logs.csv /home/ubuntu/.\ndocker <span class=\"nb\">cp </span>d4307e33553a:/aurora_display_logs.csv /home/ubuntu/.\n</code></pre></div></div>\n<h3 data-sourcepos=\"28:1-28:10\" id=\"0-2-2\" name=\"0-2-2\"><a class=\"anchor\" id=\"結果\" name=\"結果\" href=\"#結果\" data-position=\"0-2-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"結果\"> &gt; 結果</span></a>結果</h3>\n<div class=\"code-block\" data-sourcepos=\"29:1-35:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>root@ip-172-35-3-108:/home/ubuntu# <span class=\"nb\">ls</span> <span class=\"nt\">-a</span> |grep csv\naurora_display_logs.csv\naurora_logs.csv\nheroku_display_logs.csv\nheroku_logs.csv\n</code></pre></div></div>\n<h3 data-sourcepos=\"37:1-37:52\" id=\"0-2-3\" name=\"0-2-3\"><a class=\"anchor\" id=\"scpでEC2からローカルへファイル移動\" name=\"scpでEC2からローカルへファイル移動\" href=\"#scpでEC2からローカルへファイル移動\" data-position=\"0-2-3\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"scpでEC2からローカルへファイル移動\"> &gt; scpでEC2からローカルへファイル移動</span></a>scpでEC2からローカルへファイル移動</h3>\n<p data-sourcepos=\"39:1-39:64\">&lt;pemファイル名はbucardo.pemから変更してあります&gt;</p>\n<div class=\"code-block\" data-sourcepos=\"41:1-50:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>scp <span class=\"nt\">-i</span> <span class=\"s2\">\"king-api-staging-bucardo-ec2.pem\"</span> ubuntu@ec2-35-77-81-181.ap-northeast-1.compute.amazonaws.com:/home/ubuntu/heroku_logs.csv <span class=\"nb\">.</span>\nscp <span class=\"nt\">-i</span> <span class=\"s2\">\"king-api-staging-bucardo-ec2.pem\"</span> ubuntu@ec2-35-77-81-181.ap-northeast-1.compute.amazonaws.com:/home/ubuntu/aurora_logs.csv <span class=\"nb\">.</span>\nscp <span class=\"nt\">-i</span> <span class=\"s2\">\"king-api-staging-bucardo-ec2.pem\"</span> ubuntu@ec2-35-77-81-181.ap-northeast-1.compute.amazonaws.com:/home/ubuntu/heroku_display_logs.csv <span class=\"nb\">.</span>\nscp <span class=\"nt\">-i</span> <span class=\"s2\">\"king-api-staging-bucardo-ec2.pem\"</span> ubuntu@ec2-35-77-81-181.ap-northeast-1.compute.amazonaws.com:/home/ubuntu/aurora_display_logs.csv <span class=\"nb\">.</span>\nheroku_logs.csv                          100%   93KB   2.2MB/s   00:00\naurora_logs.csv                          100%   92KB   3.0MB/s   00:00\nheroku_display_logs.csv                  100%   61KB   1.7MB/s   00:00\naurora_display_logs.csv                  100%   61KB   1.8MB/s   00:00\n</code></pre></div></div>\n<p data-sourcepos=\"52:1-52:6\">結果</p>\n<div class=\"code-block\" data-sourcepos=\"53:1-60:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code>sugiyamasatoshi @ sugiyamasatoshinoMacBook-Pro <span class=\"k\">in</span> ~/migrate-csv <span class=\"o\">[</span>15:40:33]\n<span class=\"nv\">$ </span><span class=\"nb\">ls</span> <span class=\"nt\">-a</span>                                                           15:40:33\n<span class=\"nb\">.</span>                                heroku_display_logs.csv\n..                               heroku_logs.csv\naurora_display_logs.csv          king-api-staging-bucardo-ec2.pem\naurora_logs.csv\n</code></pre></div></div>\n",
    "created_at": "2023-03-29T15:41:33+09:00",
    "message": "Update post.",
    "kind": "stock",
    "comments_count": 0,
    "tasks_count": 0,
    "done_tasks_count": 0,
    "url": "https://qrio.esa.io/posts/1582",
    "updated_at": "2023-07-18T10:36:53+09:00",
    "tags": [],
    "category": "Users/杉山/Database",
    "revision_number": 2,
    "created_by": {
      "myself": false,
      "name": "杉山聡",
      "screen_name": "satoshi_sugiyama",
      "icon": "https://img.esa.io/uploads/production/members/129432/icon/thumb_m_4589e2842b9d87757c7c9db07c45c00d.jpg"
    },
    "updated_by": {
      "myself": false,
      "name": "杉山聡",
      "screen_name": "satoshi_sugiyama",
      "icon": "https://img.esa.io/uploads/production/members/129432/icon/thumb_m_4589e2842b9d87757c7c9db07c45c00d.jpg"
    },
    "stargazers_count": 0,
    "watchers_count": 1,
    "star": false,
    "watch": false,
    "sharing_urls": null
  }
]
